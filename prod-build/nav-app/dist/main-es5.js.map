{"version":3,"sources":["webpack:///src/app/icons.service.ts","webpack:///src/app/matrix/tactic-cell/tactic-cell.component.ts","webpack:///src/app/matrix/tactic-cell/tactic-cell.component.html","webpack:///crypto (ignored)?9175","webpack:///util (ignored)?26ad","webpack:///util (ignored)?5cd2","webpack:///util (ignored)","webpack:///src/app/sidebar/sidebar.component.ts","webpack:///src/app/sidebar/sidebar.component.html","webpack:///util (ignored)?9c36","webpack:///src/app/matrix/matrix-side/matrix-side.component.ts","webpack:///src/app/matrix/matrix-side/matrix-side.component.html","webpack:///buffer (ignored)?0f3d","webpack:///src/app/datatable/data-table.component.ts","webpack:///src/app/datatable/data-table.component.html","webpack:///crypto (ignored)","webpack:///buffer (ignored)","webpack:///src/app/matrix/technique-cell/contextmenu/contextmenu.component.ts","webpack:///src/app/matrix/technique-cell/contextmenu/contextmenu.component.html","webpack:///src/environments/environment.ts","webpack:///src/app/layer-information/layer-information.component.ts","webpack:///src/app/layer-information/layer-information.component.html","webpack:///src/app/matrix/matrix-mini/matrix-mini.component.ts","webpack:///src/app/matrix/matrix-mini/matrix-mini.component.html","webpack:///src/app/exporter/exporter.component.ts","webpack:///src/app/exporter/exporter.component.html","webpack:///src/app/search-and-multiselect/search-and-multiselect.component.ts","webpack:///src/app/search-and-multiselect/search-and-multiselect.component.html","webpack:///src/app/data.service.ts","webpack:///src/app/app.component.ts","webpack:///src/app/app.component.html","webpack:///src/app/version-upgrade/version-upgrade.component.ts","webpack:///src/app/version-upgrade/version-upgrade.component.html","webpack:///src/app/changelog/changelog.component.ts","webpack:///src/app/changelog/changelog.component.html","webpack:///src/app/layer-upgrade/layer-upgrade.component.ts","webpack:///src/app/layer-upgrade/layer-upgrade.component.html","webpack:///src/app/app.module.ts","webpack:///src/app/tabs/tabs.component.ts","webpack:///src/app/tabs/tabs.component.html","webpack:///src/app/matrix/cell.ts","webpack:///src/app/matrix/matrix-common.ts","webpack:///src/$_lazy_route_resource lazy namespace object","webpack:///src/app/list-input/list-input.component.ts","webpack:///src/app/list-input/list-input.component.html","webpack:///src/app/matrix/technique-cell/cell-popover.ts","webpack:///src/app/help/help.component.ts","webpack:///src/app/help/help.component.html","webpack:///src/app/matrix/matrix-flat/matrix-flat.component.ts","webpack:///src/app/matrix/matrix-flat/matrix-flat.component.html","webpack:///src/app/cookies.ts","webpack:///src/app/viewmodels.service.ts","webpack:///src/app/matrix/technique-cell/technique-cell.component.ts","webpack:///src/app/matrix/technique-cell/technique-cell.component.html","webpack:///src/app/matrix/technique-cell/tooltip/tooltip.component.ts","webpack:///src/app/matrix/technique-cell/tooltip/tooltip.component.html","webpack:///src/app/config.service.ts","webpack:///src/app/globals.ts","webpack:///src/app/layer-upgrade/changelog-cell/changelog-cell.component.ts","webpack:///src/app/layer-upgrade/changelog-cell/changelog-cell.component.html","webpack:///src/app/taxii2lib.ts","webpack:///src/main.ts"],"names":["IconsService","matIconRegistry","domSanitizer","loadIcons","Object","values","Icons","iconKeys","iconUrl","forEach","key","addSvgIcon","bypassSecurityTrustResourceUrl","providedIn","TacticCellComponent","selector","templateUrl","styleUrls","encapsulation","None","tactic","viewModel","SidebarComponent","dataService","reloadToggle","setTimeout","MatrixSideComponent","configService","viewModelsService","name","version","number","$event","target","value","DataTableComponent","tabs","sanitizer","customContextMenuItems","showingLegend","currentDropdown","dropdownChange","onScroll","previousScrollTop","headerHeight","footerHeight","controlsHeight","isScrollUp","handleScroll","e","diff","scrollRef","nativeElement","scrollTop","calculateScrollHeight","tabOffset","emit","scrollWindowHeight","style","height","commentEditField","scoreEditField","selectionChangeSubscription","onSelectionChange","subscribe","onTechniqueSelect","json","serialize","blob","Blob","type","filename","toLowerCase","replace","saveBlob","window","navigator","msSaveOrOpenBlob","svgUrl","URL","createObjectURL","downloadLink","document","createElement","href","download","body","appendChild","click","removeChild","workbook","domain","getDomain","domainVersionID","matrices","matrix","worksheet","addWorksheet","getVersion","columns","filterTactics","tactics","map","header","getDisplayName","tacticCol","getColumn","techniques","applyControls","techniqueCells","technique","subtechniqueList","subtechniqueCells","techniqueRow","indexOf","tvm","getTechniqueVM","showSubtechniques","subtechniques","sub","concat","excelIndex","subtechnique","splice","mergeCells","length","id","findIndex","col","subtechniqueCol","letter","toString","seen","eachCell","cell","row","undefined","find","s","substring","trim","includes","attackID","push","svm","styleCells","t","column","layout","showID","showName","width","getRow","alignment","horizontal","border","bottom","font","bold","showTacticRowBackground","fill","pattern","fgColor","tacticRowBackground","color","toHex","xlsx","writeBuffer","then","data","vertical","enabled","argb","_showAggregateScores","aggregateScoreColor","score","scoreColor","comment","note","top","left","isSubtechnique","right","querySelector","offsetHeight","addEventListener","unsubscribe","removeEventListener","event","url","isCurrentlyEditing","populateEditFields","showAnnotatedOnly","get_all_technique_tactic_ids","getTechniqueVM_id","some","sid","annotated","techniqueVMs","getEditingCommonValue","currentState","editSelectedTechniques","css","bypassSecurityTrustStyle","result","isNaN","Number","dropdown","anchor","parentNode","getBoundingClientRect","clientWidth","openSVGDialog","sidebarContentType","sidebarOpened","ContextmenuComponent","element","close","techniqueVM","links","placement","getPosition","clearSelectedTechniques","selectTechnique","closeContextmenu","unselectTechnique","selectAllTechniques","invertSelection","selectAnnotated","selectUnannotated","selectAllTechniquesInTactic","unselectAllTechniquesInTactic","open","pinnedCell","technique_tactic_union_id","customItem","getReplacedURL","link","pinCell","viewTechnique","viewTactic","environment","production","LayerInformationComponent","MatrixMiniComponent","ExporterComponent","dialogRef","config","svgDivName","unitEnum","buildSVGDebounce","vm","uid","self","filterTechniques","hasTechniqueVM","hasScores","legendSectionCount","hasLegendItems","legendHeight","legendX","legendWidth","legendY","showHeader","buildSVG","description","legendItems","showAbout","hasName","showDomain","hasDomain","showAggregateScores","hasDescription","showDescription","showFilters","showGradient","showLegend","legendDocked","bypassDebounce","console","log","margin","Math","max","convertToPx","unit","getElementById","innerHTML","svg","d3","select","append","attr","stroke_width","getSpacing","distance","divisions","spacing","res","i","insertLineBreaks","words","node","padding","xpos","ypos","totalDistance","spacingDistance","center","cellWidth","el","text","firstChild","tspan","offsetY","findSpace","cellHeight","maxFontSize","breakDistance","min","breakTextHeight","fitTextHeight","longestWordLength","Infinity","w","word","fitTextWidth","size","optimalFontSize","split","bestSize","bestWordArrangement","find_breaks","num_spaces","num_breaks","breaks","Set","recurse","breakset_inherit","depth","breakset","JSON","parse","stringify","add","join","initial_breaks","Array","from","binaryString","wordSet","k","centerValign","fontSize","children","child","getAttribute","endsWith","currY","hasAttribute","newY","floor","HeaderSectionContent","HeaderSection","legend","contents","group","sectionWidth","sectionHeight","gradient","colors","percent","interpolateNumber","minValue","maxValue","colorScale","scaleLinear","range","nCells","valuesRange","call","legendColor","shapeWidth","shapePadding","cells","shape","orient","scale","labelOffset","labelFormat","format","scaleOrdinal","item","label","descriptiveBox","sectionData","boxWidth","boxHeight","boxPadding","boxGroup","outerbox","titleEl","title","each","bbox","getBBox","coverPadding","cover","x","y","raise","boxContentGroup","boxContentHeight","boxContentWidth","boxGroupY","scaleBand","align","content","subsectionContent","contentGroup","bandwidth","headerSections","about","filterConfig","filterData","filters","platforms","selection","showAggregate","aggregateConfig","aggregateFunction","countUnscored","showLegendContainer","showLegendInHeader","headerGroup","headerX","paddingInner","section","sectionGroup","tablebody","RenderableMatrix","subtechniqueIndent","tableBorderColor","tacticGroups","selectAll","enter","shortname","techniqueGroups","yPosition","subtechniqueGroups","techniqueRects","subtechniqueRects","sidebarWidth","sidebar","sidebarAngle","minCellTextSize","textColor","minTacticLabelTextSize","tacticLabels","legendGroup","svgEl","setAttribute","svgData","XMLSerializer","serializeToString","preface","svgBlob","quantity","factor","error","cellheight","reverse","line","lineHeight","dy","parseFloat","pop","getComputedTextLength","thisdy","d","els","numTSpan","location","str","txt","charAt","toUpperCase","substr","obj","keys","downloadSVG","renderConfig","filteredTactics","RenderableTactic","heights","filteredTechniques","sortTechniques","filteredSubtechniques","RenderableTechnique","stixDataComponents","objects","SearchAndMultiselectComponent","Map","userClickedExpand","expandedPanels","fields","previousQuery","_query","techniqueResults","stixTypes","stixDataComponentLabels","newQuery","debounceFunction","getResults","results","get","items","query","sortTechniquesAndSubtechniques","filter","deprecated","revoked","sort","tA","tB","c1","parent","c2","localeCompare","a","b","seenIDs","has","field","labels","r","fieldToggled","filterAndSort","getTechniques","getStixData","filterAndSortLabels","expandPanels","isPrevExpanded","isExpanded","isAllCollapsed","isPanelExpanded","allTechniques","groups","software","mitigations","campaigns","dataComponents","c","source","set","thefield","mouseEnter","isTechnique","getRelated","selectTechniqueAcrossTactics","highlightTechnique","clearHighlight","stixObject","unselectTechniqueAcrossTactics","isTechniqueArray","deselect","relatedTechniques","DataService","http","domain_backwards_compatibility","domains","versions","subtechniquesEnabled","latestVersion","enterpriseAttackURL","mobileAttackURL","icsAttackURL","subscription","getConfig","next","setUpURLs","complete","callback","dataLoadedCallbacks","stixBundles","bundle","techniqueSDOs","matrixSDOs","idToTechniqueSDO","idToTacticSDO","sdo","isCustom","x_mitre_domains","domain_identifier","DataComponent","dataSources","external_references","Group","Software","Campaign","Mitigation","relationship_type","relationships","target_ref","ids","source_ref","startsWith","x_mitre_is_subtechnique","notes","Note","techniqueSDO","subtechniques_of","sub_id","Technique","matrixSDO","x_mitre_deprecated","Matrix","platform","dataLoaded","v","Version","match","identifier","domainObject","Domain","authentication","taxii_url","taxii_collection","urls","enterpriseDomain","mobileDomain","icsDomain","lowestSupportedVersion","refresh","configData$","conn","collectionInfo","collection","domainData$","forkJoin","getObjects","bundleData","httpOptions","headers","token","serviceName","apiKey","dataPromise","Promise","resolve","reject","getDomainData","parseBundle","versionNumber","all_techniques","supported","oldDomainVersionID","newDomainVersionID","changelog","VersionChangelog","oldDomain","newDomain","previousTechniques","latestTechniques","objectLookup","p","latestTechnique","prevTechnique","additions","modified","unchanged","revocations","deprecations","compareVersion","changes","minor_changes","BaseStix","stixSDO","supportsAttackID","external_id","alert","Error","created","x_mitre_version","that","thisVersion","thatVersion","rels","revoked_by","tactic_refs","tacticID","tacticSDO","Tactic","x_mitre_shortname","x_mitre_platforms","datasources","x_mitre_data_sources","kill_chain_phases","phase","phase_name","tactic_shortname","get_technique_tactic_id","reviewed","copied","dataSource","x_mitre_data_source_ref","component_rel","targetID","software_uses","used","group_uses","attributedCampaigns","campaigns_attributed_to","campaign_uses","campaign_id","usedSet","campaignsUsed","mitigates","mitigated","object_refs","AppComponent","iconsService","titleService","nav_version","prototype","user_theme","getFeature","returnValue","registerIcons","setTitle","theme","themeChangeHandler","tabsComponent","promptNavAway","VersionUpgradeComponent","currVersion","vmVersion","layerName","upgrade","upgradeVersion","providers","ChangelogComponent","dialog","markdownService","markdownElement","LayerUpgradeComponent","paginators","paginator_map","filteredIDs","sections","loading","descriptions","versionChangelog","compareTo","applyFilters","wait","getTechnique","search","anyAnnotated","sectionIDs","paginator","toArray","pageIndex","pageSize","start","end","slice","offset","nextSection","revokedByID","revokingObject","oldTechnique","newTechnique","sortArray","oldTactics","newTactics","every","panel","isReviewed","expanded","technique_tactic_ids","fromTechnique","toTechnique","copyAnnotations","revertCopy","toTactic","validTechnique","fromTvm","toTvm","rep","resetAnnotations","deSerialize","updateScoreColor","closeSidebar","stepper","AppModule","forRoot","declarations","imports","exports","bootstrap","entryComponents","safariDialogRef","scoreExpression","TabsComponent","onUserThemeChange","ds","vms","activeTab","dropdownEnabled","layerTabs","adjustedHeaderHeight","tabHeight","showHelpDropDown","loadData","coloring","comments","metadata","enabledness","loadURL","layerLinkURLs","customizedConfig","copiedRecently","newBlankTab","loadTabs","newLayer","selectTab","getFeatureList","bannerContent","banner","safariWarning","disableClose","panelClass","userTheme","newHeight","defaultLayers","bundle_url","getNamedFragmentValue","bundle_version","bundle_domain","fragment_value","newLayerFromURL","first","_i","urls_1","loadLayerFromURL","isCloseable","forceNew","dataTable","tab","Tab","dataContext","closeActiveTab","viewModels","allowNoTab","action","destroyViewModel","closeTab","featureName","openTab","dialogName","settings","maxWidth","root","conflictNumber","isInteger","n","String","numberPortion","domain_id","getDomainVersionID","valid","validateInput","exists","err","status","message","TypeError","loadDomainData","getUniqueLayerName","newViewModel","loadVMData","index","realIndex","fromCharCode","char","charHere","scoreVariables","regex","matches","charToIndex","layerLayerOperation","updateGradient","scope","noMatch","input","getCurrentVersion","afterClosed","isSupported","oldID","newID","oldViewModel","serialized","versionUpgradeDialog","selectTechniquesAcrossTactics","loads","old","dataSubscription","compareVersions","initCopyAnnotations","files","readJSONFile","file","reader","FileReader","onload","deSerializeDomainVersionID","layerUpgrade","readAsText","layerLinkURL","encodeURIComponent","subfeatures","j","copyText","selectLayerLink","execCommand","test","RegExp","exec","decodeURIComponent","showScoreVariables","isDataTable","Cell","showContextmenu","isDarkTheme","matchMedia","isHighlighted","idToMatch","selectSubtechniquesWithParent","highlightedTechniques","highlightedTactic","isTacticMatching","theclass","isTechniqueSelected","hasNotes","getTechniqueBackground","cell_color","clone","cell_color_alpha","getAlpha","setAlpha","emulate_alpha","comment_color","link_color","aggregateScore","MatrixCommon","shift","ctrl","meta","getSelectedTechniqueCount","isTacticSelected","webpackEmptyAsyncContext","req","code","module","ListInputComponent","fieldToClass","level","list","divider","removeDivider","updateList","editSelectedTechniqueValues","CellPopover","theElement","boundingRect","halfWidth","innerWidth","halfHeight","innerHeight","position","HelpComponent","renderer","headingAnchors","scrollTo","heading","img","escapedText","html","listenObj","listen","tagName","linkURL","preventDefault","openLayerDialog","scrollIntoView","behavior","block","inline","onMarkdownLoad","MatrixFlatComponent","setCookie","expirationDays","Date","setTime","getTime","expires","toUTCString","cookie","getCookie","decodedCookie","ca","hasCookie","deleteCookie","ViewModelsService","nonce","ViewModel","getNonce","score_min","score_max","techniqueIDs","techniqueID","mathResult","initializeScoresTo","technique_id","new_tvm","TechniqueVM","misses","scoreValue","hasTechniqueVM_id","setGradientPreset","inherit","inherit_vm","fieldname","inherit_TVM","Gradient","Gcolor","options","presets","redgreen","greenred","bluered","redblue","transparentblue","transparentred","colorList","gColor","hexstring","toHex8String","isColorStringArray","check","isValid","hex","preset","colorarray","gcolor","colorobj","gradientRGB","rgb","valueString","round","loaded","sorting","LayoutOptions","hideDisabled","backgroundPresets","legendColorPresets","needsToConstructTechniqueVMs","legacyTechniques","techIDtoUIDMap","techUIDtoIDMap","sidebarContentTypes","highlightedTechnique","selectedTechniques","linkMismatches","metadataMismatches","Filter","_sidebarOpened","newVal","_sidebarContentType","bundleURL","onDataLoad","initTechniqueVMs","initPlatformOptions","setTechniqueVM","technique_tactic_id","overwrite","selectTechniqueInTactic","unselectTechniqueInTactic","walkChildren","activeTvm","checkValues","highlightTechniques","clear","previouslySelected","selected","copy","fromVM","toVM","unionID","fieldToType","Link","Metadata","value_clone","commonValue","linkStr","metadataStr","first_id","isSubtechniqueEnabled","sub_platforms","technique1","technique2","techniqueVM1","techniqueVM2","score1","score2","sortSubTechniques","calculateAggregateScore","isFinite","sortingAlgorithm","validTechniquesCount","scores","scoreNum","NEGATIVE_INFINITY","aggScore","reduce","toFixed","getColor","modifiedTechniqueVMs","customDataURL","m","l","attack","legendItem","obj_technique","metadataObj","deserialize","viewMode","addColor","removeColor","updateLegendColorPresets","newObj","skipWords","wordSplit","wordIndex","charIndex","charCodeAt","idSplit","linkObj","filterName","isStringArray","backwards_compatibility_mappings","layoutOptions","_layout","aggregateFunctionOptions","_aggregateFunction","_showID","_showName","_countUnscored","newLayout","warn","oldLayout","newAggregateFunction","newval","TechniqueCellComponent","highlight","unhighlight","leftclick","isCellPinned","annotatedSubs","subVM","shiftKey","ctrlKey","metaKey","pageX","pageY","onRightClick","annotatedSubtechniques","onLeftClick","onMouseEnter","onMouseLeave","TechniqueEvent","TooltipComponent","ConfigService","features","featureGroups","contextMenuItems","featureObject","setFeature_object","getAllFragments","valueBool","isFeature","isFeatureGroup","setFeature","featureStructure","ContextMenuItem","subtechnique_url","featureGroup","subFeatures","count","getFeatureGroupCount","subFeatureName","override","hasOwnProperty","subfeature","featureGroupName","fragments","layer_version","ChangelogCellComponent","isCurrentVersion","isDraggable","selectionChanged","onClick","TaxiiConnect","user","password","timeout","baseURL","withoutLastSlash","hash","btoa","Headers","postConfig","getStixConfig","promise","timeoutPromise","fetch","path","fullPath","asQueryString","fetchTimeout","conf","flag","asyncFetch","cache","Server","withLastSlash","disOptions","apiOptions","fetchThis","discovery","_getApiRoots","apiRootMap","all","api_roots","apiroot","isEmpty","constructor","Collections","api_root_path","collectionsFlag","collections","cols","theConfig","Collection","colOptions","objsOptions","objOptions","manOptions","func","can_read","can_write","ifCanRead","obj_id","ifCanWrite","getManifests","Status","status_id","bootstrapModule"],"mappings":"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","file":"main-es5.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { MatIconRegistry } from \"@angular/material/icon\";\r\nimport { DomSanitizer } from \"@angular/platform-browser\";\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\n\r\nexport class IconsService {\r\n\r\n  constructor(private matIconRegistry: MatIconRegistry, private domSanitizer: DomSanitizer) {\r\n  }\r\n\r\n  public registerIcons(): void {\r\n    this.loadIcons(Object.values(Icons), 'assets/icons');\r\n  }\r\n\r\n  private loadIcons(iconKeys: string[], iconUrl: string): void {\r\n    iconKeys.forEach(key => {\r\n      this.matIconRegistry.addSvgIcon(key, this.domSanitizer.bypassSecurityTrustResourceUrl(`${iconUrl}/${key}.svg`));\r\n    });\r\n  }\r\n}\r\n\r\nexport enum Icons {\r\n  SORT_ALPHABETICAL_ASC = 'ic_sort_alphabetically_ascending',\r\n  SORT_ALPHABETICAL_DESC = 'ic_sort_alphabetically_descending',\r\n  SORT_NUMERICAL_ASC = 'ic_sort_numerically_ascending',\r\n  SORT_NUMERICAL_DESC = 'ic_sort_numerically_descending',\r\n  UNFOLD_MORE_ALT = 'ic_unfold_more_alt'\r\n}\r\n","import { Component, OnInit, Input, ViewEncapsulation } from '@angular/core';\r\nimport { Technique, Tactic } from '../../data.service';\r\nimport { ViewModel } from '../../viewmodels.service';\r\n\r\n@Component({\r\n  selector: 'tactic-cell',\r\n  templateUrl: './tactic-cell.component.html',\r\n  styleUrls: ['./tactic-cell.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class TacticCellComponent implements OnInit {\r\n    @Input() tactic: Tactic;\r\n    @Input() viewModel: ViewModel;\r\n\r\n    constructor() { }\r\n\r\n    ngOnInit() {\r\n    }\r\n}\r\n","<div class=\"tactic-cell noselect\" [class.bordered]=\"!(viewModel.layout.showID || viewModel.layout.showName)\" \r\n                         [class.mini]=\"viewModel.layout.layout == 'mini'\"\r\n                         [matTooltip]=\"tactic.attackID + ': ' + tactic.name\" \r\n                         [matTooltipDisabled]=\"viewModel.layout.showID || viewModel.layout.showName\" \r\n                         matTooltipPosition=\"above\">\r\n    <ng-container *ngIf=\"viewModel.layout.showID\">{{tactic.attackID}}</ng-container><div class=\"id-name-break\" *ngIf=\"viewModel.layout.showID && viewModel.layout.showName\"></div><ng-container *ngIf=\"viewModel.layout.showName\">{{tactic.name}}</ng-container>\r\n</div>\r\n","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","import { Component, Input, OnChanges } from '@angular/core';\r\nimport { DataService } from '../data.service';\r\nimport { ViewModel } from '../viewmodels.service';\r\n\r\n@Component({\r\n    selector: 'sidebar',\r\n    templateUrl: './sidebar.component.html',\r\n    styleUrls: ['./sidebar.component.scss']\r\n})\r\nexport class SidebarComponent implements OnChanges {\r\n    @Input() viewModel: ViewModel;\r\n    public reloadToggle: boolean = true;\r\n\r\n    constructor(public dataService: DataService) { }\r\n\r\n    ngOnChanges(): void {\r\n        this.reloadToggle = false;\r\n        setTimeout(() => this.reloadToggle = true);\r\n    }\r\n}\r\n","<div class=\"sidebar\">\r\n    <div *ngIf=\"viewModel\">\r\n        <div *ngIf=\"viewModel.sidebarContentType === 'search'\">\r\n            <app-search-and-multiselect [viewModel]=\"viewModel\"></app-search-and-multiselect>\r\n        </div>\r\n        <div *ngIf=\"viewModel.sidebarContentType === 'layerUpgrade' && reloadToggle\">\r\n            <div *ngIf=\"viewModel.versionChangelog && viewModel.compareTo\">\r\n                <layer-upgrade [viewModel]=\"viewModel\"></layer-upgrade>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","/* (ignored) */","import { Component, OnInit, ViewEncapsulation } from '@angular/core';\r\nimport { MatrixCommon } from '../matrix-common';\r\nimport { ConfigService } from '../../config.service';\r\nimport { ViewModelsService } from '../../viewmodels.service';\r\n\r\n@Component({\r\n  selector: 'matrix-side',\r\n  templateUrl: './matrix-side.component.html',\r\n  styleUrls: ['./matrix-side.component.scss'],\r\n  encapsulation: ViewEncapsulation.None,\r\n})\r\nexport class MatrixSideComponent extends MatrixCommon implements OnInit  {\r\n\r\n    constructor(configService: ConfigService, viewModelsService: ViewModelsService) {\r\n        super(configService, viewModelsService);\r\n    }\r\n\r\n    ngOnInit() {}\r\n}\r\n","<table class=\"matrix side\">\r\n    <thead [ngStyle]=\"tacticRowStyle\">\r\n        <tr class=\"tactic\">\r\n            <td *ngFor=\"let tactic of filterTactics(matrix.tactics)\" class=\"tactic name\"><a (click)=\"onTacticClick(tactic)\">\r\n                <tactic-cell [viewModel]=\"viewModel\" [tactic]=\"tactic\"></tactic-cell>\r\n            </a></td>\r\n        </tr>\r\n        <tr>\r\n            <td *ngFor=\"let tactic of filterTactics(matrix.tactics)\" class=\"tactic count\">\r\n                {{filterTechniques(tactic.techniques, tactic).length }}<ng-container *ngIf=\"viewModel.layout.showName\">&nbsp;techniques</ng-container>\r\n            </td>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr>\r\n            <td *ngFor=\"let tactic of filterTactics(matrix.tactics)\" class=\"tactic\">\r\n                <table class=\"techniques-table\">\r\n                    <tr *ngFor=\"let technique of applyControls(tactic.techniques, tactic)\" class=\"technique-row\">\r\n                        <td>\r\n                            <ng-container *ngIf=\"technique.subtechniques.length == 0; else supertechnique\">\r\n                                <technique-cell\r\n                                                [tactic]=\"tactic\"\r\n                                                [technique]=\"technique\" \r\n                                                [viewModel]=\"viewModel\"\r\n                                                [matrix]=\"matrix\"\r\n                                                (leftclick)=\"onTechniqueLeftClick($event, technique, tactic)\"\r\n                                                (rightclick)=\"onTechniqueRightClick($event, technique)\"\r\n                                                (highlight)=\"onTechniqueHighlight($event, technique, tactic)\"\r\n                                                (unhighlight)=\"onTechniqueUnhighlight($event)\">\r\n                                </technique-cell>\r\n                            </ng-container>\r\n                            <ng-template #supertechnique>\r\n                                <table class=\"supertechnique\">\r\n                                    <tr>\r\n                                        <td class=\"technique\">\r\n                                            <technique-cell\r\n                                                            [tactic]=\"tactic\"\r\n                                                            [technique]=\"technique\" \r\n                                                            [viewModel]=\"viewModel\"\r\n                                                            [matrix]=\"matrix\"\r\n                                                            (leftclick)=\"onTechniqueLeftClick($event, technique, tactic)\"\r\n                                                            (rightclick)=\"onTechniqueRightClick($event, technique)\"\r\n                                                            (highlight)=\"onTechniqueHighlight($event, technique, tactic)\"\r\n                                                            (unhighlight)=\"onTechniqueUnhighlight($event)\">\r\n                                            </technique-cell>\r\n                                        </td>\r\n                                    </tr>\r\n                                </table>\r\n                            </ng-template>\r\n                        </td>\r\n                        <!-- TODO onclick expand -->\r\n                        <td *ngIf=\"technique.subtechniques.length > 0\" [ngClass]=\"{disabled: applyControls(technique.subtechniques, tactic).length == 0, expanded: viewModel.getTechniqueVM(technique, tactic).showSubtechniques && applyControls(technique.subtechniques, tactic).length > 0}\"\r\n                                class=\"sidebar sidebar--{{tactic.id}}--{{technique.id}}\" (click)=\"onToggleSubtechniquesVisible(technique, tactic)\">                            \r\n                            <div class=\"angle top\">\r\n                                <svg width=\"12px\" height=\"12px\">\r\n                                    <path d=\"M0 12H12V0Z\"/>\r\n                                </svg>\r\n                            </div>\r\n                            <div class=\"handle\"> = </div>\r\n                            <div class=\"angle bottom\">\r\n                                <svg width=\"12px\" height=\"12px\">\r\n                                    <path d=\"M0 0H12V12Z\"/>\r\n                                </svg>\r\n                            </div>\r\n                        </td>\r\n                        <td class=\"subtechniques-td\">\r\n                            <div class=\"subtechniques\"\r\n                                    [class.hidden]=\"!viewModel.getTechniqueVM(technique, tactic).showSubtechniques\">\r\n                                <div *ngFor=\"let subtechnique of applyControls(technique.subtechniques, tactic)\" class=\"subtechnique\">\r\n                                    <technique-cell\r\n                                                    [tactic]=\"tactic\"\r\n                                                    [technique]=\"subtechnique\" \r\n                                                    [viewModel]=\"viewModel\"\r\n                                                    [matrix]=\"matrix\"\r\n                                                    (leftclick)=\"onTechniqueLeftClick($event, subtechnique, tactic)\"\r\n                                                    (rightclick)=\"onTechniqueRightClick($event, subtechnique)\"\r\n                                                    (highlight)=\"onTechniqueHighlight($event, subtechnique, tactic)\"\r\n                                                    (unhighlight)=\"onTechniqueUnhighlight($event)\">\r\n                                    </technique-cell>\r\n                                </div>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n    </tbody>\r\n</table>\r\n","/* (ignored) */","import { Component, Input, ViewChild, AfterViewInit, ViewEncapsulation, OnDestroy, ElementRef, Output, EventEmitter } from '@angular/core';\r\nimport { DataService } from '../data.service';\r\nimport { ConfigService } from '../config.service';\r\nimport { TabsComponent } from '../tabs/tabs.component';\r\nimport { ViewModel, ViewModelsService } from \"../viewmodels.service\";\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { Subscription } from 'rxjs';\r\nimport * as Excel from 'exceljs/dist/es5/exceljs.browser';\r\nimport * as is from 'is_js';\r\nimport * as tinycolor from 'tinycolor2';\r\n\r\n@Component({\r\n    selector: 'DataTable',\r\n    templateUrl: './data-table.component.html',\r\n    styleUrls: ['./data-table.component.scss'],\r\n    encapsulation: ViewEncapsulation.None,\r\n})\r\nexport class DataTableComponent implements AfterViewInit, OnDestroy {\r\n    @ViewChild('scrollRef') private scrollRef: ElementRef;\r\n\r\n    //items for custom context menu\r\n    customContextMenuItems = [];\r\n    //is the legend panel currently expanded\r\n    showingLegend = false;\r\n\r\n    // The ViewModel being used by this data-table\r\n    @Input() viewModel: ViewModel;\r\n    @Input() currentDropdown: string = \"\"; //current dropdown menu\r\n    @Output() dropdownChange = new EventEmitter<any>();\r\n    @Output() onScroll = new EventEmitter<any>();\r\n\r\n    //////////////////////////////////////////////////////////\r\n    // Stringifies the current view model into a json string//\r\n    // stores the string as a blob                          //\r\n    // and then saves the blob as a json file               //\r\n    //////////////////////////////////////////////////////////\r\n\r\n    saveLayerLocally(){\r\n        var json = this.viewModel.serialize();\r\n        var blob = new Blob([json], {type: \"text/json\"});\r\n        let filename = this.viewModel.name.toLowerCase().replace(/ /g, \"_\") + \".json\";\r\n        this.saveBlob(blob, filename);\r\n    }\r\n\r\n    saveBlob(blob, filename){\r\n        if (is.ie()) { //internet explorer\r\n            window.navigator.msSaveOrOpenBlob(blob, filename)\r\n        } else {\r\n            var svgUrl = URL.createObjectURL(blob);\r\n            var downloadLink = document.createElement(\"a\");\r\n            downloadLink.href = svgUrl;\r\n            downloadLink.download = filename\r\n            document.body.appendChild(downloadLink);\r\n            downloadLink.click();\r\n            document.body.removeChild(downloadLink);\r\n        }\r\n    }\r\n\r\n    /////////////////////////////\r\n    //     EXPORT TO EXCEL     //\r\n    /////////////////////////////\r\n\r\n    saveLayerLocallyExcel() {\r\n        var workbook = new Excel.Workbook();\r\n        let domain = this.dataService.getDomain(this.viewModel.domainVersionID);\r\n        for (let matrix of domain.matrices) {\r\n            var worksheet = workbook.addWorksheet(matrix.name + \" (v\" + domain.getVersion() + \")\");\r\n\r\n            // create tactic columns\r\n            let columns = this.viewModel.filterTactics(matrix.tactics, matrix).map(tactic => { return {header: this.getDisplayName(tactic), key: tactic.name} });\r\n            worksheet.columns = columns;\r\n\r\n            // create cells\r\n            for (let tactic of this.viewModel.filterTactics(matrix.tactics, matrix)) {\r\n                let tacticCol = worksheet.getColumn(tactic.name);\r\n                let techniques = this.viewModel.applyControls(tactic.techniques, tactic, matrix);\r\n                let techniqueCells = techniques.map(technique => { return technique.name });\r\n                let subtechniqueList = [];\r\n\r\n                // create subtechnique cells, if shown\r\n                let subtechniqueCells = [];\r\n                for (let technique of techniques) {\r\n                    let techniqueRow = techniqueCells.indexOf(technique.name);\r\n                    let tvm = this.viewModel.getTechniqueVM(technique, tactic);\r\n                    if(tvm.showSubtechniques) {\r\n                        // retrieve subtechniques\r\n                        let subtechniques = this.viewModel.applyControls(technique.subtechniques, tactic, matrix)\r\n                            .map( sub => { return sub.name });\r\n                        subtechniqueList = subtechniqueList.concat(technique.subtechniques);\r\n\r\n                        // format technique cells for subtechniques\r\n                        let excelIndex = 0;\r\n                        for (let subtechnique of subtechniques) {\r\n                            if(excelIndex !== 0) {\r\n                                techniqueCells.splice(techniqueRow + excelIndex, 0, technique.name);\r\n                            }\r\n                            subtechniqueCells[techniqueRow + excelIndex++] = subtechnique;\r\n                        }\r\n\r\n                        // merge technique cells\r\n                        if (excelIndex > 0) {\r\n                            worksheet.mergeCells(techniqueRow + 2, tacticCol.number, techniqueRow + excelIndex + 1, tacticCol.number);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if(subtechniqueCells.length > 0) {\r\n                    // add subtechniques column\r\n                    let id = columns.findIndex(col => col.key == tactic.name);\r\n                    columns.splice(id + 1, 0, {header: this.getDisplayName(tactic), key: tactic.name + \"Subtechniques\"});\r\n                    worksheet.columns = columns;\r\n\r\n                    // merge subtechniques header\r\n                    let subtechniqueCol = worksheet.getColumn(tactic.name + \"Subtechniques\");\r\n                    worksheet.mergeCells(tacticCol.letter + '1:' + subtechniqueCol.letter + '1');\r\n                    subtechniqueCol.values = [tactic.name.toString() + \"Subtechniques\"].concat(subtechniqueCells);\r\n\r\n                    // style subtechnique cells\r\n                    const seen = [];\r\n                    subtechniqueCol.eachCell(cell => {\r\n                        if(cell.row > 1) {\r\n                            if(cell.value && cell.value !== undefined) {\r\n                                let subtechnique = subtechniqueList.find(s => {\r\n                                    return s.name == cell.value.substring(cell.value.indexOf(':') + 1).trim() && !seen.includes(s.attackID) });\r\n                                seen.push(subtechnique.attackID);\r\n                                let svm = this.viewModel.getTechniqueVM(subtechnique, tactic);\r\n                                this.styleCells(cell, subtechnique, svm);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                tacticCol.values = [this.getDisplayName(tactic)].concat(techniqueCells);\r\n\r\n                // style technique cells\r\n                tacticCol.eachCell(cell => {\r\n                    if (cell.row > 1) {\r\n                        if(cell.value && cell.value !== undefined) {\r\n                            let technique = techniques.find( t => {\r\n                                return t.name === cell.value.substring(cell.value.indexOf(':') + 1).trim() || t.attackID === cell.value });\r\n                            let tvm = this.viewModel.getTechniqueVM(technique, tactic);\r\n                            this.styleCells(cell, technique, tvm);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            // style tactic headers\r\n            worksheet.columns.forEach(column => {\r\n                if (this.viewModel.layout.showID && !this.viewModel.layout.showName) {\r\n                    column.width = column.header.length < 15 ? 15 : column.header.length;\r\n                } else if (!this.viewModel.layout.showID && !this.viewModel.layout.showName) {\r\n                    column.width = 10;\r\n                } else {\r\n                    column.width = column.header.length < 30 ? 30 : column.header.length;\r\n                }\r\n            });\r\n\r\n            worksheet.getRow(1).alignment = {horizontal: 'center'};\r\n            worksheet.getRow(1).border = {bottom: {style: 'thin'}};\r\n            worksheet.getRow(1).font = {bold: true};\r\n            if (this.viewModel.showTacticRowBackground) {\r\n                worksheet.getRow(1).fill = {type: 'pattern', pattern: 'solid', fgColor: {'argb': 'FF' + this.viewModel.tacticRowBackground.substring(1)}}\r\n                worksheet.getRow(1).font = {bold: true, color: {\"argb\": 'FF' + tinycolor.mostReadable(this.viewModel.tacticRowBackground, [\"white\", \"black\"]).toHex()}};\r\n            }\r\n        }\r\n\r\n        // save file\r\n        workbook.xlsx.writeBuffer().then(data => {\r\n            const blob = new Blob( [data], {type: \"application/octet-stream\"} );\r\n            const filename = this.viewModel.name.toLowerCase().replace(/ /g, \"_\") + \".xlsx\";\r\n            this.saveBlob(blob, filename);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get the display name for technique/tactic as shown in layout\r\n     */\r\n    getDisplayName(technique) {\r\n        if (this.viewModel.layout.showID && this.viewModel.layout.showName) {\r\n            return technique.attackID + ': ' + technique.name;\r\n        } else if (this.viewModel.layout.showID) {\r\n            return technique.attackID;\r\n        } else if (this.viewModel.layout.showName) {\r\n            return technique.name;\r\n        } else {\r\n            return '';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Helper function for exporting to excel to stylize cells\r\n     */\r\n    styleCells(cell, technique, tvm) {\r\n        cell.value = this.getDisplayName(technique);\r\n\r\n        // cell format\r\n        cell.alignment = {vertical: 'top', horizontal: 'left'};\r\n        if(tvm.enabled) {\r\n            if (tvm.color) { //manually assigned\r\n                cell.fill = {type: 'pattern', pattern: 'solid', fgColor: {argb: 'FF' + tvm.color.substring(1)}};\r\n                cell.font = {color: {'argb': 'FF' + tinycolor.mostReadable(tvm.color, [\"white\", \"black\"]).toHex()}};\r\n            }\r\n            else if (this.viewModel.layout._showAggregateScores && tvm.aggregateScoreColor) {\r\n                cell.fill = {type: 'pattern', pattern: 'solid', fgColor: {argb: 'FF' + tvm.aggregateScoreColor.toHex()}};\r\n                cell.font = {color: {'argb': 'FF' + tinycolor.mostReadable(tvm.aggregateScoreColor, [\"white\", \"black\"]).toHex()}};\r\n            }\r\n            else if (tvm.score) { //score assigned\r\n                cell.fill = {type: 'pattern', pattern: 'solid', fgColor: {argb: 'FF' + tvm.scoreColor.toHex()}};\r\n                cell.font = {color: {'argb': 'FF' + tinycolor.mostReadable(tvm.scoreColor, [\"white\", \"black\"]).toHex()}};\r\n            }\r\n            if (tvm.comment) { //comment present on technique\r\n                cell.note = tvm.comment;\r\n            }\r\n        } else { //disabled\r\n            cell.font = {color: {'argb': 'FFBCBCBC'}}\r\n        }\r\n\r\n        // subtechniques border\r\n        if (tvm.showSubtechniques) {\r\n            cell.border = {top: {style: 'thin'}, bottom:{style: 'thin'}, left: {style: 'thin'}}\r\n        } else if (technique.isSubtechnique) {\r\n            cell.border = {top: {style: 'thin'}, bottom:{style: 'thin'}, right: {style: 'thin'}}\r\n        }\r\n    }\r\n\r\n    private selectionChangeSubscription: Subscription;\r\n    constructor(public dataService: DataService,\r\n                private tabs: TabsComponent,\r\n                private sanitizer: DomSanitizer,\r\n                private viewModelsService: ViewModelsService,\r\n                public configService: ConfigService) {\r\n\r\n        this.selectionChangeSubscription = this.viewModelsService.onSelectionChange.subscribe(() => {\r\n            this.onTechniqueSelect();\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Angular lifecycle hook\r\n     */\r\n    ngAfterViewInit(): void {\r\n        // setTimeout(() => this.exportRender(), 500);\r\n        this.headerHeight = document.querySelector<HTMLElement>('.header-wrapper')?.offsetHeight;\r\n        this.scrollRef.nativeElement.style.height = `calc(100vh - ${this.headerHeight + this.controlsHeight + this.footerHeight}px)`;\r\n        this.scrollRef.nativeElement.addEventListener('scroll', this.handleScroll);\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.selectionChangeSubscription.unsubscribe();\r\n        document.body.removeEventListener('scroll', this.handleScroll);\r\n    }\r\n\r\n    handleDescriptionDropdown() {\r\n        this.currentDropdown !== 'description' ? this.currentDropdown = 'description' : this.currentDropdown = '';\r\n        this.dropdownChange.emit(this.currentDropdown);\r\n    }\r\n\r\n    previousScrollTop = 0;\r\n    headerHeight = 0;\r\n    footerHeight = 32;\r\n    controlsHeight = 34;\r\n    isScrollUp = true;\r\n    handleScroll = (e) => {\r\n        const diff = this.scrollRef.nativeElement.scrollTop - this.previousScrollTop;\r\n        if (!this.isScrollUp && diff < 0) {\r\n            this.isScrollUp =  diff < 0;\r\n            this.calculateScrollHeight();\r\n            this.previousScrollTop = this.scrollRef.nativeElement.scrollTop;\r\n        } else if (this.isScrollUp && diff > 0) {\r\n            this.isScrollUp =  diff < 0;\r\n            this.calculateScrollHeight();\r\n            this.previousScrollTop = this.scrollRef.nativeElement.scrollTop;\r\n        } else if (!this.isScrollUp && this.scrollRef.nativeElement.scrollTop > 0 && diff === 0) {\r\n            this.calculateScrollHeight();\r\n        }\r\n    }\r\n\r\n    calculateScrollHeight = () => {\r\n        const tabOffset = this.isScrollUp ? 0 : this.headerHeight;\r\n        this.onScroll.emit(-1 * tabOffset);\r\n        const scrollWindowHeight = this.isScrollUp ? this.headerHeight + this.controlsHeight + this.footerHeight : this.controlsHeight;\r\n        this.scrollRef.nativeElement.style.height = `calc(100vh - ${scrollWindowHeight}px)`;\r\n    }\r\n\r\n    // open custom url in a new tab\r\n    openCustomURL(event, technique, url){\r\n        // var formattedTechniqueName = this.contextMenuSelectedTechnique.name.replace(/ /g, \"_\");\r\n\r\n        // var formattedURL = url.replace(/~Technique_ID~/g, this.contextMenuSelectedTechnique.technique_id);\r\n        // formattedURL = formattedURL.replace(/~Technique_Name~/g, formattedTechniqueName);\r\n        // formattedURL = formattedURL.replace(/~Tactic_Name~/g, this.contextMenuSelectedTactic);\r\n\r\n        // var win = window.open(formattedURL);\r\n        // if (win) {\r\n        //     win.focus();\r\n        // } else {\r\n        //     alert('Please allow popups for this website');\r\n        // }\r\n    }\r\n\r\n\r\n    // edit field bindings\r\n    commentEditField: string = \"\";\r\n    scoreEditField: string = \"\";\r\n\r\n    /**\r\n     * triggered on left click of technique\r\n     */\r\n    onTechniqueSelect(): void {\r\n        if (!this.viewModel.isCurrentlyEditing()) {\r\n            if ([\"comment\", \"score\", \"colorpicker\", \"link\", \"metadata\"].includes(this.currentDropdown)) this.currentDropdown = \"\"; //remove technique control dropdowns, because everything was deselected\r\n            return;\r\n        }\r\n        if (this.currentDropdown == \"link\" || this.currentDropdown == \"metadata\") {\r\n            this.currentDropdown = \"\";\r\n            return;\r\n        }\r\n        //else populate editing controls\r\n        this.populateEditFields();\r\n    }\r\n\r\n    /**\r\n     * Show all sub-techniques in layout view\r\n     */\r\n    expandSubtechniques(showAnnotatedOnly?: boolean): void {\r\n        if (this.viewModel.layout.layout == \"mini\") return; //control disabled in mini layout\r\n        for (let technique of this.dataService.getDomain(this.viewModel.domainVersionID).techniques) {\r\n            if (technique.subtechniques.length > 0) {\r\n                for (let id of technique.get_all_technique_tactic_ids()) {\r\n                    let tvm = this.viewModel.getTechniqueVM_id(id);\r\n                    if (!showAnnotatedOnly) {\r\n                        tvm.showSubtechniques = true;\r\n                    } else {\r\n                        for (let subtechnique of technique.subtechniques) {\r\n                            tvm.showSubtechniques = tvm.showSubtechniques || subtechnique.get_all_technique_tactic_ids().some((sid) => {\r\n                                let svm = this.viewModel.getTechniqueVM_id(sid);\r\n                                return svm.annotated();\r\n                            })\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Hide all sub-techniques in layout view\r\n     */\r\n    collapseSubtechniques(): void {\r\n        if (this.viewModel.layout.layout == \"mini\") return; //control disabled in mini layout\r\n        this.viewModel.techniqueVMs.forEach(function(tvm, key) {\r\n            tvm.showSubtechniques = false; });\r\n    }\r\n\r\n    /**\r\n     * populate edit fields. Gets common values if common values exist for all editing values\r\n     */\r\n    populateEditFields(): void {\r\n        this.commentEditField = this.viewModel.getEditingCommonValue(\"comment\");\r\n        this.scoreEditField = this.viewModel.getEditingCommonValue(\"score\");\r\n    }\r\n\r\n    /**\r\n     * Set the state (enabled/disabled) of the selected features\r\n     */\r\n    setSelectedState(): void {\r\n        let currentState = this.viewModel.getEditingCommonValue('enabled')\r\n        if (currentState === '') this.viewModel.editSelectedTechniques('enabled', false)\r\n        else                     this.viewModel.editSelectedTechniques('enabled', !currentState)\r\n    }\r\n\r\n    //sanitize the given css so that it can be displayed without error\r\n    sanitize(css) {\r\n        return this.sanitizer.bypassSecurityTrustStyle(css);\r\n    }\r\n\r\n    /**\r\n     * Is score input valid number\r\n     * @param  event keypress event just in case we need it\r\n     * @return       true if valid number\r\n     */\r\n    validateScoreInput(event) {\r\n        let result: boolean = isNaN(Number(this.scoreEditField))\r\n        return result\r\n    }\r\n\r\n    /**\r\n     * Return whether the given dropdown element would overflow the side of the page if aligned to the right of its anchor\r\n     * @param  dropdown the DOM node of the panel\r\n     * @return          true if it would overflow\r\n     */\r\n    checkalign(dropdown): boolean {\r\n        // console.log(anchor)\r\n        let anchor = dropdown.parentNode;\r\n        return anchor.getBoundingClientRect().left + dropdown.getBoundingClientRect().width > document.body.clientWidth;\r\n    }\r\n\r\n    /**\r\n     * open an export layer render tab for the current layer\r\n     */\r\n    exportRender(): void {\r\n        this.tabs.openSVGDialog(this.viewModel);\r\n    }\r\n\r\n    /**\r\n     * open search & multiselect sidebar\r\n     */\r\n    openSearch(): void {\r\n        if (this.viewModel.sidebarContentType !== 'layerUpgrade') {\r\n            this.viewModel.sidebarOpened = (this.viewModel.sidebarContentType !== 'search') ? true : !this.viewModel.sidebarOpened;\r\n            this.viewModel.sidebarContentType = 'search';\r\n        }\r\n    }\r\n}\r\n","<!--\r\n  oooooooo8   ooooooo  oooo   oooo ooooooooooo oooooooooo    ooooooo  ooooo        oooooooo8\r\no888     88 o888   888o 8888o  88  88  888  88  888    888 o888   888o 888        888\r\n888         888     888 88 888o88      888      888oooo88  888     888 888         888oooooo\r\n888o     oo 888o   o888 88   8888      888      888  88o   888o   o888 888      o         888\r\n 888oooo88    88ooo88  o88o    88     o888o    o888o  88o8   88ooo88  o888ooooo88 o88oooo888\r\n                                                                                              -->\r\n\r\n<div class=\"controlsContainer\">\r\n    <ul class=\"control-sections\">\r\n        <li *ngIf=\"configService.getFeatureGroup('selection_controls', 'any') && configService.getFeature('selecting_techniques')\">\r\n            <div *ngIf=\"configService.getFeatureGroupCount('selection_controls') >= 3\" class=\"section-label\">\r\n                selection controls\r\n            </div>\r\n\r\n\r\n            <!-- lock selection locks -->\r\n            <div *ngIf=\"configService.getFeature('selecting_techniques')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     (click)=\"currentDropdown = currentDropdown !== 'selection_behavior' ? 'selection_behavior' : null;\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"selection behavior\">\r\n                    <span class=\"material-icons\">lock</span>\r\n                </div>\r\n                <div class=\"dropdown-container select_behavior\" *ngIf=\"currentDropdown === 'selection_behavior'\" #dropdown [class.left]=\"checkalign(dropdown)\">\r\n                    <!-- selectTechniquesAcrossTactics -->\r\n                    <div>\r\n                        <input id=\"select_behavior_tactic\" class=\"checkbox-custom\" type=\"checkbox\" [(ngModel)]=\"viewModel.selectTechniquesAcrossTactics\">\r\n                        <label for=\"select_behavior_tactic\" class=\"checkbox-custom-label noselect\">select techniques across tactics</label>\r\n                    </div>\r\n                    <!-- selectSubtechniquesWithParent -->\r\n                    <div *ngIf=\"configService.getFeature('subtechniques')\">\r\n                        <input id=\"select_behavior_subtechnique\" class=\"checkbox-custom\" type=\"checkbox\"  [(ngModel)]=\"viewModel.selectSubtechniquesWithParent\">\r\n                        <label for=\"select_behavior_subtechnique\" class=\"checkbox-custom-label noselect\">select sub-techniques with parent</label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            <!-- Search -->\r\n            <div *ngIf=\"configService.getFeature('search')\" class=\"control-row-item\">\r\n\r\n                <div class=\"control-row-button noselect\"\r\n                     [ngClass]=\"{'disabled': viewModel.sidebarContentType === 'layerUpgrade'}\"\r\n                     (click)=\"openSearch()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"search & multiselect\">\r\n                    <span class=\"material-icons\" alt=\"search\">search</span>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- deselect all -->\r\n            <div *ngIf=\"configService.getFeature('deselect_all')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     (click)=\"viewModel.clearSelectedTechniques(); currentDropdown = null;\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"deselect {{this.viewModel.getSelectedTechniqueCount()}} techniques\">\r\n                    <span class=\"material-icons\" alt=\"deselect all\">clear</span>\r\n                    <span class=\"deselectNumber\">{{this.viewModel.getSelectedTechniqueCount()}}</span>\r\n                </div>\r\n            </div>\r\n\r\n\r\n        </li>\r\n        <li *ngIf=\"configService.getFeatureGroup('layer_controls', 'any')\">\r\n            <div *ngIf=\"configService.getFeatureGroupCount('layer_controls') >= 2\" class=\"section-label\">\r\n                layer controls\r\n            </div>\r\n\r\n            <!-- layer name, description, metadata, and links -->\r\n            <div *ngIf=\"configService.getFeature('layer_info')\" class=\"control-row-item\">\r\n\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     (click)=\"handleDescriptionDropdown()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"layer information\">\r\n                    <span class=\"material-icons\" alt=\"layer information\">description</span>\r\n                </div>\r\n\r\n                <!-- description input (invisible, absolute) -->\r\n                <div class=\"dropdown-container inputfield layer_info\" #dropdown [class.left]=\"checkalign(dropdown)\"\r\n                     *ngIf=\"currentDropdown === 'description'\">\r\n\r\n                    <!-- layer name field -->\r\n                    <div class=\"name_desc\">\r\n                        <mat-form-field>\r\n                                <input matInput\r\n                                        type=\"text\"\r\n                                        placeholder=\"name\"\r\n                                        [(ngModel)]=\"viewModel.name\" />\r\n                            </mat-form-field>\r\n\r\n                            <!-- layer description field -->\r\n                            <mat-form-field>\r\n                                <textarea matInput\r\n                                            matTextareaAutosize\r\n                                            placeholder=\"description\"\r\n                                            [(ngModel)]=\"viewModel.description\">\r\n                                </textarea>\r\n                            </mat-form-field>\r\n\r\n                            <!-- layer domain (uneditable) -->\r\n                            <mat-form-field>\r\n                                <input matInput readonly disabled\r\n                                    type=\"text\"\r\n                                    placeholder=\"domain\"\r\n                                    [(ngModel)]=\"dataService.getDomain(viewModel.domainVersionID).name\" />\r\n                            </mat-form-field>\r\n\r\n                            <!-- layer version (uneditable) -->\r\n                            <mat-form-field>\r\n                                <input matInput readonly disabled\r\n                                    type=\"text\"\r\n                                    placeholder=\"version\"\r\n                                    [(ngModel)]=\"dataService.getDomain(viewModel.domainVersionID).version.number\" />\r\n                            </mat-form-field>\r\n\r\n                            <!-- bundle URL (uneditable) -->\r\n                            <mat-form-field *ngIf=\"viewModel.bundleURL\">\r\n                                <input matInput readonly disabled\r\n                                    type=\"text\"\r\n                                    placeholder=\"collection/bundle url\"\r\n                                    [(ngModel)]=\"viewModel.bundleURL\" />\r\n                            </mat-form-field>\r\n                    </div>\r\n                    <div class=\"layer-data\">\r\n                        <!-- layer metadata -->\r\n                        <b>Metadata</b>\r\n                        <div class=\"data-input\">\r\n                            <app-list-input [config]=\"{'viewModel': viewModel, 'list': viewModel.metadata, 'level': 'layer', 'type': 'metadata', 'nameField': 'name', valueField: 'value'}\"></app-list-input>\r\n                        </div>\r\n\r\n                        <mat-divider class=\"layer-div\"></mat-divider>\r\n                        \r\n                        <!-- layer links -->\r\n                        <b>Links</b>\r\n                        <div class=\"data-input\">\r\n                            <app-list-input [config]=\"{'viewModel': viewModel, 'list': viewModel.links, 'level': 'layer', 'type': 'links', 'nameField': 'label', valueField: 'url'}\"></app-list-input>\r\n                        </div>\r\n                    </div>\r\n                 </div>\r\n             </div>\r\n\r\n\r\n\r\n            <!-- save locally as JSON -->\r\n            <div *ngIf=\"configService.getFeature('download_layer')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     (click)=\"saveLayerLocally()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"download layer as json\">\r\n                    <span class=\"material-icons\" alt=\"save layer\">file_download</span>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- export to excel -->\r\n            <div *ngIf=\"configService.getFeature('export_excel')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     (click)=\"saveLayerLocallyExcel()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"export to excel\">\r\n                    <span class=\"material-icons\" alt=\"save layer\">grid_on</span>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            <!-- render layer to SVG -->\r\n            <div *ngIf=\"configService.getFeature('export_render')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     (click)=\"exportRender()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"render layer to SVG\">\r\n                    <span class=\"material-icons\" alt=\"export render\">camera_alt</span>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Filters -->\r\n            <div *ngIf=\"configService.getFeature('filters')\" class=\"control-row-item\">\r\n\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     (click)=\"currentDropdown = currentDropdown !== 'filters' ? 'filters' : null;\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"filters\">\r\n                    <span class=\"material-icons\">filter_list</span>\r\n                </div>\r\n                <div class=\"dropdown-container filters\" *ngIf=\"currentDropdown === 'filters'\" #dropdown [class.left]=\"checkalign(dropdown)\">\r\n                    <div class=\"filter\" *ngFor=\"let filter of ['platforms']\">\r\n                        <b class=\"filter-label\">{{filter}}</b>\r\n                        <div *ngIf=\"viewModel.filters[filter].options.length !== 0\">\r\n                            <div class=\"filter-option\" *ngFor=\"let filterOption of viewModel.filters[filter].options\">\r\n                                <!-- <label class=\"noselect\"><input type=\"checkbox\" (click)=\"viewModel.filters.toggleInFilter(filter, filterOption); filterTechniques()\" [checked]=\"viewModel.filters.inFilter(filter, filterOption)\">{{filterOption}}</label> -->\r\n                                <input [id]=\"filterOption\" class=\"checkbox-custom\" type=\"checkbox\" (click)=\"viewModel.filters.toggleInFilter(filter, filterOption);\" [checked]=\"viewModel.filters.inFilter(filter, filterOption)\">\r\n                                <label [for]=\"filterOption\" class=\"checkbox-custom-label noselect\">{{filterOption}}</label>\r\n                            </div>\r\n                        </div>\r\n                        <div *ngIf=\"viewModel.filters[filter].options.length == 0\">\r\n                            Data does not include {{filter}}\r\n                        </div>\r\n                        <!-- <div class=\"filter-option\" *ngFor=\"let filterOption of viewModel.filters[filter].options\" (click)=\"viewModel.filters.toggleInFilter(filter, filterOption); filterTechniques()\">\r\n                            {{filterOption}}  {{viewModel.filters.inFilter(filter, filterOption)}}\r\n                        </div> -->\r\n                    </div>\r\n                    <!-- <mat-select placeholder=\"platforms\" [(ngModel)]=\"platformControl\"\r\n                        multiple disableRipple autofocus (change)=\"filterTechniques(); viewModel.filters.platforms.selection = platformsControl\">\r\n                        <mat-option *ngFor=\"let platformOption of viewModel.filters.platforms.options\" [value]=\"platformOption\">{{platformOption}}</mat-option>\r\n                    </mat-select> -->\r\n                    <!-- <filter-menu [dataTable]=\"this\"></filter-menu> -->\r\n                </div>\r\n            </div>\r\n\r\n            <!-- sorting -->\r\n            <div *ngIf=\"configService.getFeature('sorting')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     (click)=\"viewModel.sorting = (viewModel.sorting + 1) % 4;\"\r\n                     matTooltipPosition=\"below\"\r\n                     [matTooltip]=\"['sorting alphabetically ascending', 'sorting alphabetically descending', 'sorting by score ascending', 'sorting by score descending'][viewModel.sorting]\">\r\n                    <span [ngSwitch]=\"['alpha_asc', 'alpha_desc', 'numeric_asc', 'numeric_desc'][viewModel.sorting]\">\r\n                        <ng-container *ngSwitchCase=\"'alpha_asc'\"><mat-icon\r\n                                svgIcon=\"ic_sort_alphabetically_ascending\"></mat-icon></ng-container>\r\n                        <ng-container *ngSwitchCase=\"'alpha_desc'\"><mat-icon\r\n                                svgIcon=\"ic_sort_alphabetically_descending\"></mat-icon></ng-container>\r\n                        <ng-container *ngSwitchCase=\"'numeric_asc'\"><mat-icon\r\n                                svgIcon=\"ic_sort_numerically_ascending\"></mat-icon></ng-container>\r\n                        <ng-container *ngSwitchCase=\"'numeric_desc'\"><mat-icon\r\n                                svgIcon=\"ic_sort_numerically_descending\"></mat-icon></ng-container>\r\n                    </span>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- color setup -->\r\n            <div *ngIf=\"configService.getFeature('color_setup')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     (click)=\"currentDropdown = currentDropdown !== 'colorSetup' ? 'colorSetup' : null; viewModel.updateGradient()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"color setup\">\r\n                    <span class=\"material-icons\">palette</span>\r\n                </div>\r\n                <div class=\"dropdown-container colorSetup\" *ngIf=\"currentDropdown === 'colorSetup'\" #dropdown [class.left]=\"checkalign(dropdown)\">\r\n\r\n                    <div class=\"tacticRowColor\">\r\n                        <div class=\"gradient-section-label\">\r\n                            Tactic Row Background\r\n                        </div>\r\n                        <div class=\"gradient-section-content\">\r\n                            <input id=\"showTacticRowBackground\" type=\"checkbox\" class=\"checkbox-custom\" [(ngModel)]=viewModel.showTacticRowBackground>\r\n                            <label for=\"showTacticRowBackground\" class=\"checkbox-custom-label noselect\">show</label>\r\n                            <input class=\"colorpicker\" [(colorPicker)]=\"viewModel.tacticRowBackground\" [(ngModel)]=\"viewModel.tacticRowBackground\" [style.background]=\"viewModel.tacticRowBackground\" cpPosition=\"bottom\" [cpPresetColors]=\"['#ddd', '#aaaaaa', '#205B8F', '#B9482D']\">\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"gradient\">\r\n                        <div class=\"gradient-section-label\">\r\n                            Scoring Gradient\r\n                        </div>\r\n                        <div class=\"gradient-controls gradient-section-content\">\r\n                            <table>\r\n                                <tr class=\"minmax top\">\r\n                                    <td>Low value:</td>\r\n                                    <td class=\"col2\"><input type=\"number\" (input)=\"viewModel.updateGradient()\" [(ngModel)]=\"viewModel.gradient.minValue\" [max]=viewModel.gradient.maxValue></td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td class=\"buttons\">\r\n                                        <div *ngFor=\"let gradientStep of viewModel.gradient.colors; let $i = index\">\r\n                                            <div class=\"left\">\r\n                                                <button (click)=\"viewModel.removeGradientColor($i)\" [disabled]=\"viewModel.gradient.colors.length == 2\">remove</button>\r\n                                            </div>\r\n                                            <div class=\"right\">\r\n                                                <input class=\"colorpicker\" (colorPickerChange)=\"viewModel.updateGradient()\" (cpPresetColorsChange)=\"viewModel.updateGradient()\" (cpSliderChange)=\"viewModel.updateGradient()\" (cpInputChange)=\"viewModel.updateGradient()\" [(colorPicker)]=\"gradientStep.color\" [(ngModel)]=\"gradientStep.color\" [style.background]=\"gradientStep.color\" cpPosition=\"bottom\" [cpPresetColors]=\"viewModel.gradient.options\">\r\n                                                <!-- <select [(ngModel)]=\"gradientStep.color\" (ngModelChange)=\"viewModel.updateGradient()\">\r\n                                                    <option *ngFor=\"let color of viewModel.gradient.options\" [ngValue]=\"color\">{{color}}</option>\r\n                                                    option shows up if a nonstandard option is selected, from uploading a custom layer\r\n                                                    <option *ngIf=\"!(viewModel.gradient.labelToColor.hasOwnProperty(gradientStep.color))\" [ngValue]=gradientStep.color>{{gradientStep.color}}</option>\r\n                                                </select> -->\r\n                                            </div>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td class=\"col2\" [style.background-image]=\"sanitize(viewModel.gradient.gradient.css('linear', 'to bottom'))\"> </td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td><button class=\"addcolor\" (click)=\"viewModel.addGradientColor();\">add another color</button></td>\r\n                                </tr>\r\n                                <tr class=\"minmax bottom\">\r\n                                    <td>High value: </td>\r\n                                    <td class=\"col2 \"><input type=\"number\" (input)=\"viewModel.updateGradient()\" [(ngModel)]=\"viewModel.gradient.maxValue\" [min]=viewModel.gradient.minValue></td>\r\n                                </tr>\r\n                            </table>\r\n                            <div class=\"display-buttons\">\r\n                                <div class=\"squarebutton dropdown noselect\" (click)=\"presetsMenuVisible = !presetsMenuVisible\">\r\n                                    presets <span style=\"font-size:5pt\"></span>\r\n                                </div >\r\n                                <div class=\"dropdown-container presetsmenu\" *ngIf=\"presetsMenuVisible\">\r\n                                    <div class=\"squarebutton noselect gradient\" (click)=\"viewModel.gradient.setGradientPreset('redgreen'); presetsMenuVisible = false; viewModel.updateGradient()\" [style.background-image]=\"sanitize(viewModel.gradient.presetToTinyColor('redgreen'))\">red to green</div>\r\n                                    <div class=\"squarebutton noselect gradient\" (click)=\"viewModel.gradient.setGradientPreset('greenred'); presetsMenuVisible = false; viewModel.updateGradient()\" [style.background-image]=\"sanitize(viewModel.gradient.presetToTinyColor('greenred'))\">green to red</div>\r\n                                    <div class=\"squarebutton noselect gradient\" (click)=\"viewModel.gradient.setGradientPreset('bluered'); presetsMenuVisible = false; viewModel.updateGradient()\" [style.background-image]=\"sanitize(viewModel.gradient.presetToTinyColor('bluered'))\">blue to red</div>\r\n                                    <div class=\"squarebutton noselect gradient\" (click)=\"viewModel.gradient.setGradientPreset('redblue'); presetsMenuVisible = false; viewModel.updateGradient()\" [style.background-image]=\"sanitize(viewModel.gradient.presetToTinyColor('redblue'))\">red to blue</div>\r\n                                    <div class=\"squarebutton noselect gradient\" (click)=\"viewModel.gradient.setGradientPreset('transparentblue'); presetsMenuVisible = false; viewModel.updateGradient()\" [style.background-image]=\"sanitize(viewModel.gradient.presetToTinyColor('transparentblue'))\">transparent to blue</div>\r\n                                    <div class=\"squarebutton noselect gradient\" (click)=\"viewModel.gradient.setGradientPreset('transparentred'); presetsMenuVisible = false; viewModel.updateGradient()\" [style.background-image]=\"sanitize(viewModel.gradient.presetToTinyColor('transparentred'))\">transparent to red</div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- show or hide disabled techniques -->\r\n            <div *ngIf=\"configService.getFeature('toggle_hide_disabled')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     (click)=\"viewModel.hideDisabled = !viewModel.hideDisabled;\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"show/hide disabled\">\r\n                    <span *ngIf=\"viewModel.hideDisabled\" class=\"material-icons\"\r\n                          alt=\"show disabled\">visibility_off</span>\r\n                    <span *ngIf=\"!viewModel.hideDisabled\" class=\"material-icons\" alt=\"hide disabled\">visibility</span>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- expand all sub-techniques -->\r\n            <div *ngIf=\"configService.getFeature('subtechniques')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     [ngClass]=\"{'disabled': viewModel.layout.layout === 'mini'}\"\r\n                     (click)=\"expandSubtechniques()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"expand sub-techniques\">\r\n                    <span class=\"material-icons\"\r\n                          alt=\"expand sub-techniques\">unfold_more</span>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- expand only annotated sub-techniques -->\r\n            <div *ngIf=\"configService.getFeature('subtechniques')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     [ngClass]=\"{'disabled': viewModel.layout.layout === 'mini'}\"\r\n                     (click)=\"expandSubtechniques(true)\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"expand annotated sub-techniques\">\r\n                    <mat-icon svgIcon=\"ic_unfold_more_alt\"></mat-icon>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- collapse all sub-techniques -->\r\n            <div *ngIf=\"configService.getFeature('subtechniques')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     [ngClass]=\"{'disabled': viewModel.layout.layout === 'mini'}\"\r\n                     (click)=\"collapseSubtechniques()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"collapse sub-techniques\">\r\n                    <span class=\"material-icons\"\r\n                          alt=\"collapse sub-techniques\">unfold_less</span>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- layout -->\r\n            <div *ngIf=\"configService.getFeature('layout_controls')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     (click)=\"currentDropdown = currentDropdown !== 'layout' ? 'layout' : null;\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"matrix configuration\">\r\n                    <span class=\"material-icons\">view_module</span>\r\n                </div>\r\n                <div class=\"dropdown-container layout\" *ngIf=\"currentDropdown === 'layout'\" #dropdown [class.left]=\"checkalign(dropdown)\">\r\n                    <div class=\"section\">\r\n                        <select [(ngModel)]=\"viewModel.layout.layout\" placeholder=\"layout\">\r\n                            <option *ngFor=\"let option of viewModel.layout.layoutOptions\" [value]=\"option\">{{option}} layout</option>\r\n                        </select>\r\n                    </div>\r\n                    <div class=\"section\">\r\n                        <b class=\"filter-label\">labels</b>\r\n                        <div>\r\n                             <input [disabled]=\"viewModel.layout.layout == 'mini'\" id=\"showID-option\" class=\"checkbox-custom\" type=\"checkbox\" [(ngModel)]=\"viewModel.layout.showID\">\r\n                             <label [class.disabled]=\"viewModel.layout.layout == 'mini'\" for=\"showID-option\" class=\"checkbox-custom-label noselect\">show IDs</label>\r\n\r\n                        </div>\r\n                        <div>\r\n                            <input [disabled]=\"viewModel.layout.layout == 'mini'\" id=\"showName-option\" class=\"checkbox-custom\" type=\"checkbox\"  [(ngModel)]=\"viewModel.layout.showName\">\r\n                            <label [class.disabled]=\"viewModel.layout.layout == 'mini'\" for=\"showName-option\" class=\"checkbox-custom-label noselect\">show names</label>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"section\">\r\n                        <b class=\"filter-label\">aggregate scores</b>\r\n                        <div>\r\n                            <input id=\"showAggregateScores-option\" class=\"checkbox-custom\" type=\"checkbox\"  [(ngModel)]=\"viewModel.layout.showAggregateScores\">\r\n                            <label for=\"showAggregateScores-option\" class=\"checkbox-custom-label noselect\">show aggregate scores</label>\r\n                        </div>\r\n                        <div>\r\n                            <input [disabled]=\"!viewModel.layout.showAggregateScores || viewModel.layout.aggregateFunction !== 'average'\"\r\n                                id=\"countUnscored-option\" class=\"checkbox-custom\" type=\"checkbox\"\r\n                                [(ngModel)]=\"viewModel.layout.countUnscored\">\r\n                            <label [class.disabled]=\"!viewModel.layout.showAggregateScores || viewModel.layout.aggregateFunction !== 'average'\"\r\n                                for=\"countUnscored-option\"\r\n                                class=\"checkbox-custom-label noselect\">count unscored techniques as 0</label>\r\n                        </div>\r\n                        <div class=\"subsection\">\r\n                            <label for=\"aggregateFunctionDropdown\">aggregate function: </label>\r\n                            <div class=\"inner-dropdown-container\">\r\n                                <select\r\n                                    [disabled]=\"!viewModel.layout.showAggregateScores\"\r\n                                    id=\"aggregateFunctionDropdown\"\r\n                                    [(ngModel)]=\"viewModel.layout.aggregateFunction\" placeholder=\"function\">\r\n                                    <option *ngFor=\"let option of viewModel.layout.aggregateFunctionOptions\"\r\n                                            [value]=\"option\">{{option}}</option>\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n\r\n        </li>\r\n        <li *ngIf=\"configService.getFeatureGroup('technique_controls', 'any') && configService.getFeature('selecting_techniques')\">\r\n            <div *ngIf=\"configService.getFeatureGroupCount('technique_controls') >= 3\" class=\"section-label\">\r\n                technique controls\r\n            </div>\r\n            <!-- TECHNIQUE CONTROLS -->\r\n            <!-- enable/disable technique -->\r\n            <div *ngIf=\"configService.getFeature('disable_techniques')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     [ngClass]=\"{'disabled': !viewModel.isCurrentlyEditing()}\"\r\n                     (click)=\"setSelectedState()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"toggle state\"\r\n                     [matTooltipDisabled]=\"!viewModel.isCurrentlyEditing()\">\r\n                    <span class=\"material-icons\" alt=\"toggle state\">texture</span>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- background color -->\r\n            <div *ngIf=\"configService.getFeature('manual_color')\" class=\"control-row-item\">\r\n\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     [ngClass]=\"{'disabled': !viewModel.isCurrentlyEditing()}\"\r\n                     (click)=\"viewModel.isCurrentlyEditing() ? currentDropdown = currentDropdown !== 'colorpicker' ? 'colorpicker' : null : continue\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"background color\"\r\n                     [matTooltipDisabled]=\"!viewModel.isCurrentlyEditing()\">\r\n                    <span class=\"material-icons\" alt=\"edit background color\">format_color_fill</span>\r\n                </div>\r\n                <!-- color picker (invisible, absolute)-->\r\n                <div class=\"colorpicker dropdown-container\" #dropdown [class.left]=\"checkalign(dropdown)\"\r\n                     *ngIf=\"currentDropdown === 'colorpicker'\">\r\n\r\n                    <div class=\"color-block wide noselect dropdown\"\r\n                         (click)=\"viewModel.editSelectedTechniques('color', '')\">\r\n                        no color\r\n                    </div>\r\n                    <div class=\"color-block square\"\r\n                         *ngFor=\"let color of viewModel.backgroundPresets\"\r\n                         [style.background]=\"color\"\r\n                         (click)=\"viewModel.editSelectedTechniques('color', color)\"></div>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            <!-- score -->\r\n            <div *ngIf=\"configService.getFeature('scoring')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     [ngClass]=\"{'disabled': !viewModel.isCurrentlyEditing()}\"\r\n                     (click)=\"viewModel.isCurrentlyEditing() ? currentDropdown = currentDropdown !== 'score' ? 'score' : null : continue\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"scoring\"\r\n                     [matTooltipDisabled]=\"!viewModel.isCurrentlyEditing()\">\r\n                    <span class=\"material-icons\" alt=\"score\">insert_chart</span>\r\n                </div>\r\n                <div class=\"dropdown-container inputfield\" #dropdown [class.left]=\"checkalign(dropdown)\"\r\n                     *ngIf=\"currentDropdown === 'score'\">\r\n                     <mat-form-field>\r\n                         <!-- update data whenever it is typed in -->\r\n                         <input matInput\r\n                                type=\"text\"\r\n                                onkeypress=\"return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 46 || event.charCode == 45\"\r\n                                [(ngModel)]=\"scoreEditField\"\r\n                                placeholder=\"score\"\r\n                                (input)=\"viewModel.editSelectedTechniques('score', $event.target.value); viewModel.editSelectedTechniques('scoreColor', viewModel.gradient.getColor($event.target.value));\">\r\n                         <mat-hint style=\"color: red\" align=\"start\" *ngIf=\"validateScoreInput()\">not a number</mat-hint>\r\n                     </mat-form-field>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            <!-- comment -->\r\n            <div *ngIf=\"configService.getFeature('comments')\" class=\"control-row-item\">\r\n\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     [ngClass]=\"{'disabled': !viewModel.isCurrentlyEditing()}\"\r\n                     (click)=\"viewModel.isCurrentlyEditing() ? currentDropdown = currentDropdown !== 'comment' ? 'comment' : null : continue\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"comment\"\r\n                     [matTooltipDisabled]=\"!viewModel.isCurrentlyEditing()\">\r\n                    <span class=\"material-icons\" alt=\"comment\">insert_comment</span>\r\n                </div>\r\n                <!-- comment input (invisible, absolute) -->\r\n                <div class=\"dropdown-container inputfield left\" #dropdown [class.left]=\"checkalign(dropdown)\"\r\n                     *ngIf=\"currentDropdown === 'comment'\">\r\n\r\n                    <mat-form-field>\r\n                        <textarea matInput\r\n                                  matTextareaAutosize\r\n                                  placeholder=\"comment\"\r\n                                  [(ngModel)]=\"commentEditField\"\r\n                                  (input)=\"viewModel.editSelectedTechniques('comment', $event.target.value)\">\r\n                        </textarea>\r\n                    </mat-form-field>\r\n                 </div>\r\n             </div>\r\n\r\n            <!-- links -->\r\n            <div *ngIf=\"configService.getFeature('links')\"  class=\"control-row-item\">\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     [ngClass]=\"{'disabled': !viewModel.isCurrentlyEditing() || !viewModel.linksMatch}\"\r\n                     (click)=\"viewModel.isCurrentlyEditing() && viewModel.linksMatch ? currentDropdown = currentDropdown !== 'link' ? 'link' : null : continue\"\r\n                     matTooltipPosition=\"below\"\r\n                     [matTooltip]=\"viewModel.linksMatch ? 'link' : 'cannot edit links on selected techniques with differing links'\"\r\n                     [matTooltipDisabled]=\"!viewModel.isCurrentlyEditing()\">\r\n                     <span class=\"material-icons\" alt=\"add a link\">link</span>\r\n                </div>\r\n                <!-- link input -->\r\n                <div class=\"dropdown-container inputfield left list-input\" #dropdown *ngIf=\"currentDropdown === 'link'\" [class.left]=\"checkalign(dropdown)\">\r\n                    <app-list-input [config]=\"{'viewModel': viewModel, 'list': viewModel.activeTvm.links, 'level': 'technique', 'type': 'links', 'nameField': 'label', valueField: 'url'}\"></app-list-input>\r\n                </div>\r\n             </div>\r\n\r\n\r\n            <!-- technique metadata -->\r\n            <div *ngIf=\"configService.getFeature('metadata')\"  class=\"control-row-item\">\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     [ngClass]=\"{'disabled': !viewModel.isCurrentlyEditing() || !viewModel.metadataMatch}\"\r\n                     (click)=\"viewModel.isCurrentlyEditing() && viewModel.metadataMatch ? currentDropdown = currentDropdown !== 'metadata' ? 'metadata' : null : continue\"\r\n                     matTooltipPosition=\"below\"\r\n                     [matTooltip]=\"viewModel.metadataMatch ? 'metadata' : 'cannot edit metadata on selected techniques with differing metadata'\"\r\n                     [matTooltipDisabled]=\"!viewModel.isCurrentlyEditing()\">\r\n                     <span class=\"material-icons\" alt=\"add metadata\">list</span>\r\n                 </div>\r\n                 <!-- metadata input -->\r\n                 <div class=\"dropdown-container inputfield left list-input\" #dropdown *ngIf=\"currentDropdown === 'metadata'\" [class.left]=\"checkalign(dropdown)\">\r\n                    <app-list-input [config]=\"{'viewModel': viewModel, 'list': viewModel.activeTvm.metadata, 'level': 'technique', 'type': 'metadata', 'nameField': 'name', valueField: 'value'}\"></app-list-input>\r\n                </div>\r\n             </div>\r\n\r\n            <!-- remove all annotations -->\r\n            <div *ngIf=\"configService.getFeature('clear_annotations')\" class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                     [ngClass]=\"{'disabled': !viewModel.isCurrentlyEditing()}\"\r\n                     (click)=\"viewModel.resetSelectedTechniques(); populateEditFields()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"clear annotations on selected\"\r\n                     [matTooltipDisabled]=\"!viewModel.isCurrentlyEditing()\">\r\n                    <span class=\"material-icons\" alt=\"remove all annotations\">layers_clear</span>\r\n                </div>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n</div>\r\n\r\n<!--\r\noooo     oooo      o   ooooooooooo oooooooooo  ooooo ooooo  oooo\r\n 8888o   888      888  88  888  88  888    888  888    888  88\r\n 88 888o8 88     8  88     888      888oooo88   888      888\r\n 88  888  88    8oooo88    888      888  88o    888     88 888\r\no88o  8  o88o o88o  o888o o888o    o888o  88o8 o888o o88o  o888o\r\n                                                                 -->\r\n<mat-drawer-container class=\"matrices-content\" autosize>\r\n    <mat-drawer-content>\r\n        <div class=\"matrices\" #scrollRef>\r\n            <div oncontextmenu=\"return false\">\r\n                <div class=\"spinner\" *ngIf=\"!dataService.getDomain(viewModel.domainVersionID) || !dataService.getDomain(viewModel.domainVersionID).dataLoaded; else loadMatrices\">\r\n                    <mat-progress-spinner mode=\"indeterminate\"></mat-progress-spinner>\r\n                </div>\r\n                <ng-template #loadMatrices>\r\n                    <div class=\"matrices-columns\">\r\n                        <div class=\"matrix-column\" *ngFor=\"let matrix of dataService.getDomain(viewModel.domainVersionID).matrices\">\r\n                            <div *ngIf=\"dataService.getDomain(viewModel.domainVersionID).matrices.length > 1\" class=\"matrix-name\">{{matrix.name}}</div>\r\n                            <div *ngIf=\"viewModel.layout.layout == 'side'\">\r\n                                <matrix-side [matrix]=\"matrix\" [viewModel]=\"viewModel\"></matrix-side>\r\n                            </div>\r\n                            <div *ngIf=\"viewModel.layout.layout == 'flat'\">\r\n                                <matrix-flat [matrix]=\"matrix\" [viewModel]=\"viewModel\"></matrix-flat>\r\n                            </div>\r\n                            <div *ngIf=\"viewModel.layout.layout == 'mini'\">\r\n                                <matrix-mini [matrix]=\"matrix\" [viewModel]=\"viewModel\"></matrix-mini>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </ng-template>\r\n            </div>\r\n        </div>\r\n    </mat-drawer-content>\r\n    <mat-drawer [disableClose]=\"true\" mode=\"side\" position=\"end\" [opened]=\"viewModel.sidebarOpened\">\r\n        <sidebar [viewModel]=\"viewModel\"></sidebar>\r\n    </mat-drawer>\r\n</mat-drawer-container>\r\n\r\n\r\n<!--\r\nooooo       ooooooooooo  ooooooo8 ooooooooooo oooo   oooo ooooooooo\r\n 888         888    88 o888    88  888    88   8888o  88   888    88o\r\n 888         888ooo8   888    oooo 888ooo8     88 888o88   888    888\r\n 888      o  888    oo 888o    88  888    oo   88   8888   888    888\r\no888ooooo88 o888ooo8888 888ooo888 o888ooo8888 o88o    88  o888ooo88\r\n                                                                      -->\r\n\r\n<div class=\"legendBar\" (click)=\"showingLegend = !showingLegend\"\r\n     *ngIf=\"!showingLegend && configService.getFeature('legend')\">\r\n    <span class=\"material-icons\">keyboard_arrow_up</span>\r\n    <div class=\"noselect\" style=\"padding:4px; font-size:14px; position: absolute; width: 100%; text-align:center\">\r\n        legend\r\n    </div>\r\n</div>\r\n\r\n<div class=\"legend\" *ngIf=\"showingLegend && configService.getFeature('legend')\">\r\n    <div class=\"legendBar\" (click)=\"showingLegend = !showingLegend\" style=\"position: absolute; top:0px; left:0px;\">\r\n        <span class=\"material-icons\">keyboard_arrow_down</span>\r\n        <div class=\"noselect title\">\r\n            legend\r\n        </div>\r\n    </div>\r\n    <div class=\"itemArea\">\r\n        <div class=\"item\" *ngFor=\"let item of viewModel.legendItems; let Even=even; let i=index\" [class.even]=\"!Even\">\r\n            <input [(colorPicker)]=\"item.color\" [(ngModel)]=\"item.color\" [style.background]=\"item.color\" [cpPosition]=\"'top'\" [cpPresetColors]=\"viewModel.legendColorPresets\" style=\"width:75px;\"/>\r\n            <!-- <input class=\"label\" [(ngModel)]=\"item.label\"> -->\r\n            <mat-form-field class=\"label\">\r\n                    <input matInput\r\n\r\n                    [(ngModel)]=\"item.label\">\r\n\r\n            </mat-form-field>\r\n            <span class=\"material-icons\" (click)=\"viewModel.deleteLegendItem(i);\">clear</span>\r\n        </div>\r\n        <button style=\"margin-left:75px; margin-top:10px; margin-bottom:10px;\" class=\"button\" (click)=\"viewModel.addLegendItem();\">Add Item</button>\r\n        <button style=\"margin-top:10px; margin-bottom:10px;\" class=\"button\" (click)=\"viewModel.clearLegend();\">Clear</button>\r\n    </div>\r\n</div>\r\n","/* (ignored) */","/* (ignored) */","import { Component, OnInit, Input, Output, EventEmitter, ElementRef, ViewEncapsulation } from '@angular/core';\r\nimport { Technique, Tactic } from '../../../data.service';\r\nimport { ViewModel, ViewModelsService, TechniqueVM, Link } from '../../../viewmodels.service';\r\nimport { ConfigService, ContextMenuItem } from '../../../config.service';\r\nimport { CellPopover } from '../cell-popover';\r\n\r\n@Component({\r\n  selector: 'app-contextmenu',\r\n  templateUrl: './contextmenu.component.html',\r\n  styleUrls: ['./contextmenu.component.scss'],\r\n  encapsulation: ViewEncapsulation.None,\r\n})\r\nexport class ContextmenuComponent extends CellPopover implements OnInit {\r\n    @Input() technique: Technique;\r\n    @Input() tactic: Tactic;\r\n    @Input() viewModel: ViewModel;\r\n    public placement: string;\r\n    @Output() close = new EventEmitter<any>();\r\n\r\n    private get techniqueVM(): TechniqueVM {\r\n        return this.viewModel.getTechniqueVM(this.technique, this.tactic);\r\n    }\r\n\r\n    public get links(): Link[] {\r\n        return this.techniqueVM.links;\r\n    }\r\n\r\n    constructor(private element: ElementRef, public configService: ConfigService, public viewModelsService: ViewModelsService) {\r\n        super(element);\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.placement = this.getPosition();\r\n    }\r\n\r\n    public closeContextmenu() {\r\n        this.close.emit();\r\n    }\r\n\r\n    public select() {\r\n        this.viewModel.clearSelectedTechniques();\r\n        this.viewModel.selectTechnique(this.technique, this.tactic);\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public addSelection() {\r\n        this.viewModel.selectTechnique(this.technique, this.tactic);\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public removeSelection() {\r\n        this.viewModel.unselectTechnique(this.technique, this.tactic);\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public selectAll() {\r\n        this.viewModel.selectAllTechniques();\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public deselectAll() {\r\n        this.viewModel.clearSelectedTechniques();\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public invertSelection() {\r\n        this.viewModel.invertSelection();\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public selectAnnotated() {\r\n        this.viewModel.selectAnnotated();\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public selectUnannotated() {\r\n        this.viewModel.selectUnannotated();\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public selectAllInTactic(){\r\n        this.viewModel.selectAllTechniquesInTactic(this.tactic);\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public deselectAllInTactic(){\r\n        this.viewModel.unselectAllTechniquesInTactic(this.tactic);\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public viewTechnique() {\r\n        window.open(this.technique.url, \"_blank\");\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public viewTactic() {\r\n        window.open(this.tactic.url, \"_blank\");\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public pinCell() {\r\n        this.viewModelsService.pinnedCell = (this.viewModelsService.pinnedCell === this.techniqueVM.technique_tactic_union_id) ? \"\" : this.techniqueVM.technique_tactic_union_id;\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public openCustomContextMenuItem(customItem: ContextMenuItem) {\r\n        window.open(customItem.getReplacedURL(this.technique, this.tactic), \"_blank\");\r\n        this.closeContextmenu();\r\n    }\r\n\r\n    public openLink(link: Link) {\r\n        window.open(link.url);\r\n        this.closeContextmenu();\r\n    }\r\n}\r\n","<div class=\"contextmenu\" (contextmenu)=\"closeContextmenu()\">\r\n    <!-- covers entire screen -->\r\n    <div class=\"cover\" (click)=\"closeContextmenu()\"></div>\r\n    <!-- the actual menu -->\r\n    <div [ngClass]=\"'menu ' + placement\">\r\n        <div class=\"contextMenu-section\">\r\n            <div class=\"contextMenu-header\">\r\n                {{technique.name}} ({{technique.attackID}})\r\n            </div>\r\n        </div>\r\n        <div class=\"contextMenu-section\">\r\n            <div class=\"contextMenu-button\" (click)=\"pinCell()\">\r\n                pin/unpin tooltip\r\n            </div>\r\n        </div>\r\n        <div *ngIf=\"configService.getFeature('selecting_techniques')\" class=\"contextMenu-section\">\r\n            <div class=\"contextMenu-button\" (click)=\"select()\">\r\n                select\r\n            </div>\r\n            <div class=\"contextMenu-button\" (click)=\"addSelection()\">\r\n                add to selection\r\n            </div>\r\n            <div class=\"contextMenu-button\" (click)=\"removeSelection()\">\r\n                remove from selection\r\n            </div>\r\n        </div>\r\n        <div *ngIf=\"configService.getFeature('selecting_techniques')\" class=\"contextMenu-section\">\r\n            <div class=\"contextMenu-button\" (click)=\"selectAll()\">\r\n                select all\r\n            </div>\r\n            <div class=\"contextMenu-button\" (click)=\"deselectAll()\">\r\n                deselect all\r\n            </div>\r\n            <div class=\"contextMenu-button\" (click)=\"invertSelection()\">\r\n                invert selection\r\n            </div>\r\n        </div>\r\n        <div *ngIf=\"configService.getFeature('selecting_techniques')\" class=\"contextMenu-section\">\r\n            <div class=\"contextMenu-button\" (click)=\"selectAnnotated()\">\r\n                select annotated\r\n            </div>\r\n            <div class=\"contextMenu-button\" (click)=\"selectUnannotated()\">\r\n                select unannotated\r\n            </div>\r\n        </div>\r\n        <div *ngIf=\"configService.getFeature('selecting_techniques')\" class=\"contextMenu-section\">\r\n            <div class=\"contextMenu-button\" (click)=\"selectAllInTactic()\">\r\n                select all techniques in tactic\r\n            </div>\r\n            <div class=\"contextMenu-button\" (click)=\"deselectAllInTactic()\">\r\n                deselect all techniques in tactic\r\n            </div>\r\n        </div>\r\n        <div class=\"contextMenu-section\">\r\n            <div class=\"contextMenu-button\" (click)=\"viewTechnique()\">\r\n                view technique\r\n            </div>\r\n            <div class=\"contextMenu-button\" (click)=\"viewTactic()\">\r\n                view tactic\r\n            </div>\r\n        </div>\r\n        <div class=\"contextMenu-section\" *ngIf=\"configService.contextMenuItems.length > 0\">\r\n            <div class=\"contextMenu-button\" *ngFor=\"let contextMenuItem of configService.contextMenuItems\" (click)=\"openCustomContextMenuItem(contextMenuItem)\">\r\n                {{contextMenuItem.label}}\r\n            </div>\r\n        </div>\r\n        <div *ngIf=\"links.length\" class=\"contextMenu-section\">\r\n            <div class=\"link-container\" *ngFor=\"let link of links\">\r\n                <div *ngIf=\"!link.divider else divider\" class=\"contextMenu-button\" (click)=\"openLink(link)\">\r\n                    {{link.label}}\r\n                </div>\r\n                <ng-template #divider>\r\n                    <div class=\"divider\"></div>\r\n                </ng-template>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","// The file contents for the current environment will overwrite these during build.\r\n// The build system defaults to the dev environment which uses `environment.ts`, but if you do\r\n// `ng build --env=prod` then `environment.prod.ts` will be used instead.\r\n// The list of which env maps to which file can be found in `.angular-cli.json`.\r\n\r\nexport const environment = {\r\n  production: false\r\n};\r\n","import { Component, ViewEncapsulation } from '@angular/core';\r\nimport * as globals from \"../globals\";\r\n\r\n@Component({\r\n  selector: 'app-layer-information',\r\n  templateUrl: './layer-information.component.html',\r\n  styleUrls: ['./layer-information.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class LayerInformationComponent {\r\n  public get layerFormatLink(): string {\r\n    return `../layers/LAYERFORMATv${ globals.layer_version.replace(\".\", \"_\") }.md`\r\n  }\r\n}\r\n","<div class=\"layer-dialog\">\r\n    <div class=\"content markdown\">\r\n        <markdown #markdownElement [src]=\"layerFormatLink\"></markdown>\r\n    </div>\r\n    <div class=\"close-button\">\r\n        <button mat-button mat-dialog-close>close</button>\r\n    </div>\r\n</div>\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { MatrixCommon } from '../matrix-common';\r\nimport { ConfigService } from '../../config.service';\r\nimport { ViewModelsService } from '../../viewmodels.service';\r\n\r\n@Component({\r\n  selector: 'matrix-mini',\r\n  templateUrl: './matrix-mini.component.html',\r\n  styleUrls: ['./matrix-mini.component.scss']\r\n})\r\nexport class MatrixMiniComponent extends MatrixCommon implements OnInit  {\r\n\r\n    constructor(configService: ConfigService, viewModelsService: ViewModelsService) { \r\n        super(configService, viewModelsService);\r\n    }\r\n\r\n    ngOnInit() {}\r\n}\r\n","<table class=\"matrix mini\">\r\n    <thead>\r\n        <tr>\r\n            <td *ngFor=\"let tactic of filterTactics(matrix.tactics)\" class=\"tactic header\">\r\n                <tactic-cell [viewModel]=\"viewModel\" [tactic]=\"tactic\"></tactic-cell>\r\n            </td>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr>\r\n            <td *ngFor=\"let tactic of filterTactics(matrix.tactics)\" class=\"tactic body\">\r\n                <ng-container *ngFor=\"let technique of applyControls(tactic.techniques, tactic)\">\r\n                    <div class=\"cell-container supertechnique-group\" *ngIf=\"technique.subtechniques.length > 0 else elseblock\">\r\n                        <div class=\"cell-container supertechnique\">\r\n                            <technique-cell #elseblock\r\n                                        [tactic]=\"tactic\"\r\n                                        [technique]=\"technique\" \r\n                                        [viewModel]=\"viewModel\"\r\n                                        [matrix]=\"matrix\"\r\n                                        (leftclick)=\"onTechniqueLeftClick($event, technique, tactic)\"\r\n                                        (rightclick)=\"onTechniqueRightClick($event, technique)\"\r\n                                        (highlight)=\"onTechniqueHighlight($event, technique, tactic)\"\r\n                                        (unhighlight)=\"onTechniqueUnhighlight($event)\">\r\n                            </technique-cell>\r\n                        </div>\r\n                        <div class=\"cell-container subtechnique\" *ngFor=\"let subtechnique of applyControls(technique.subtechniques, tactic)\">\r\n                            <technique-cell\r\n                                        [tactic]=\"tactic\"\r\n                                        [technique]=\"subtechnique\" \r\n                                        [viewModel]=\"viewModel\"\r\n                                        [matrix]=\"matrix\"\r\n                                        (leftclick)=\"onTechniqueLeftClick($event, subtechnique, tactic)\"\r\n                                        (rightclick)=\"onTechniqueRightClick($event, subtechnique)\"\r\n                                        (highlight)=\"onTechniqueHighlight($event, subtechnique, tactic)\"\r\n                                        (unhighlight)=\"onTechniqueUnhighlight($event)\">\r\n                            </technique-cell>\r\n                        </div>\r\n                    </div>\r\n                    <ng-template #elseblock>\r\n                        <div class=\"cell-container\">\r\n                            <technique-cell \r\n                                            [tactic]=\"tactic\"\r\n                                            [technique]=\"technique\" \r\n                                            [viewModel]=\"viewModel\"\r\n                                            [matrix]=\"matrix\"\r\n                                            (leftclick)=\"onTechniqueLeftClick($event, technique, tactic)\"\r\n                                            (rightclick)=\"onTechniqueRightClick($event, technique)\"\r\n                                            (highlight)=\"onTechniqueHighlight($event, technique, tactic)\"\r\n                                            (unhighlight)=\"onTechniqueUnhighlight($event)\">\r\n                            </technique-cell>\r\n                        </div>\r\n                    </ng-template>\r\n                </ng-container>\r\n            </td>\r\n        </tr>\r\n    </tbody>\r\n</table>","import { Component, OnInit, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { ViewModel, TechniqueVM } from \"../viewmodels.service\";\r\nimport { ConfigService } from \"../config.service\";\r\nimport { Technique, DataService, Tactic, Matrix } from '../data.service';\r\nimport * as is from 'is_js';\r\nimport * as tinycolor from 'tinycolor2';\r\ndeclare var d3: any; //d3js\r\n\r\n@Component({\r\n    selector: 'exporter',\r\n    templateUrl: './exporter.component.html',\r\n    styleUrls: ['./exporter.component.scss']\r\n})\r\nexport class ExporterComponent implements OnInit {\r\n    \r\n    public currentDropdown: string = null;\r\n    viewModel: ViewModel;\r\n    public config: any = {}\r\n    \r\n    public isIE() {\r\n        return is.ie();\r\n    }\r\n\r\n    private svgDivName = \"svgInsert_tmp\"\r\n    unitEnum = 0; //counter for unit change ui element\r\n    constructor(private dialogRef: MatDialogRef<ExporterComponent>, \r\n                private configService: ConfigService, \r\n                private dataService: DataService,\r\n                @Inject(MAT_DIALOG_DATA) public data) {\r\n        this.config = { \r\n            \"width\": 11,\r\n            \"height\": 8.5,\r\n            \"headerHeight\": 1,\r\n\r\n            \"unit\": \"in\",\r\n\r\n            \"showSubtechniques\": \"expanded\",\r\n\r\n            \"font\": 'sans-serif',\r\n            \"tableBorderColor\": \"#6B7279\",\r\n\r\n            \"showHeader\": true,\r\n\r\n            \"legendDocked\": true,\r\n            \"legendX\": 0,\r\n            \"legendY\": 0,\r\n            \"legendWidth\": 2,\r\n            \"legendHeight\": 1,\r\n\r\n            \"showLegend\": true,\r\n            \"showGradient\": true,\r\n            \"showFilters\": true,\r\n            \"showAbout\": true,\r\n            \"showDomain\": true,\r\n            \"showAggregate\": false,\r\n        }\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.viewModel = this.data.vm;\r\n        this.svgDivName = \"svgInsert\" + this.viewModel.uid;\r\n        \r\n        let self = this;\r\n        //determine if the layer has any scores\r\n        for (let matrix of this.dataService.getDomain(this.viewModel.domainVersionID).matrices) {\r\n            for (let tactic of this.viewModel.filterTactics(matrix.tactics, matrix)) {\r\n                for (let technique of this.viewModel.filterTechniques(tactic.techniques, tactic, matrix)) {\r\n                    if (technique.subtechniques.length > 0) {\r\n                        for (let subtechnique of this.viewModel.filterTechniques(technique.subtechniques, tactic, matrix)) {\r\n                            if (self.viewModel.hasTechniqueVM(subtechnique, tactic)) {\r\n                                if (self.viewModel.getTechniqueVM(subtechnique, tactic).score != \"\") self.hasScores = true;\r\n                            }\r\n                        }\r\n                    }\r\n                    if (self.viewModel.hasTechniqueVM(technique, tactic)) {\r\n                        if (self.viewModel.getTechniqueVM(technique, tactic).score != \"\") self.hasScores = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        // dynamic legend height according to content;\r\n        let legendSectionCount = 0;\r\n        if (self.hasScores) legendSectionCount++;\r\n        if (self.hasLegendItems()) legendSectionCount++;\r\n        self.config.legendHeight = 0.5 * legendSectionCount; \r\n        //initial legend position for undocked legend\r\n        this.config.legendX = this.config.width - this.config.legendWidth - 0.1;\r\n        this.config.legendY = this.config.height - this.config.legendHeight - 0.1;\r\n        if (this.config.showHeader) this.config.legendY -= this.config.headerHeight; \r\n\r\n        //put at the end of the function queue so that the page can render before building the svg\r\n        window.setTimeout(function() {self.buildSVG(self)}, 0)\r\n    }\r\n\r\n    //visibility of SVG parts\r\n    //assess data in viewModel\r\n    hasName(): boolean {return this.viewModel.name.length > 0}\r\n    hasDomain(): boolean {return this.viewModel.domainVersionID.length > 0}\r\n    hasDescription(): boolean {return this.viewModel.description.length > 0}\r\n    hasScores: boolean; //does the viewmodel have scores? built in ngAfterViewInit\r\n    hasLegendItems(): boolean {return this.viewModel.legendItems.length > 0;}\r\n\r\n    //above && user preferences\r\n    showName(): boolean {return this.config.showAbout && this.hasName() && this.config.showHeader}\r\n    showDomain(): boolean {return this.config.showDomain && this.hasDomain() && this.config.showHeader}\r\n    showAggregate(): boolean {return this.viewModel.layout.showAggregateScores && this.config.showHeader}\r\n    showDescription(): boolean {return this.config.showAbout && this.hasDescription() && this.config.showHeader}\r\n    showLayerInfo(): boolean {return (this.showName() || this.showDescription()) && this.config.showHeader}\r\n    showFilters(): boolean {return this.config.showFilters && this.config.showHeader};\r\n    showGradient(): boolean {return this.config.showGradient && this.hasScores && this.config.showHeader}\r\n    showLegend(): boolean {return this.config.showLegend && this.hasLegendItems()}\r\n    showLegendContainer(): boolean{return this.showLegend() || this.showGradient()}\r\n    showLegendInHeader(): boolean {return this.config.legendDocked}\r\n    // showItemCount(): boolean {return this.config.showTechniqueCount}\r\n    buildSVGDebounce = false;\r\n    buildSVG(self?, bypassDebounce=false): void {\r\n        if (!self) self = this; //in case we were called from somewhere other than ngViewInit\r\n\r\n        console.log(\"settings changed\")\r\n        if (self.buildSVGDebounce && !bypassDebounce) {\r\n            // console.log(\"skipping debounce...\")\r\n            return;\r\n        }\r\n        if (!bypassDebounce) {\r\n            // console.log(\"debouncing...\");\r\n            self.buildSVGDebounce = true;\r\n            window.setTimeout(function() {self.buildSVG(self, true)}, 500)\r\n            return;\r\n        }\r\n        self.buildSVGDebounce = false;\r\n\r\n        console.log(\"building SVG\");\r\n\r\n        //check preconditions, make sure they're in the right range\r\n        let margin = {top: 5, right: 5, bottom: 5, left: 5};\r\n\r\n        let width = Math.max(self.convertToPx(self.config.width, self.config.unit)  - (margin.right + margin.left), 10); // console.log(\"width\", width);\r\n        let height = Math.max(self.convertToPx(self.config.height, self.config.unit) - (margin.top + margin.bottom), 10); // console.log(\"height\", height)\r\n        let headerHeight = Math.max(self.convertToPx(self.config.headerHeight, self.config.unit), 1); // console.log(\"headerHeight\", headerHeight);\r\n\r\n        let legendX = Math.max(self.convertToPx(self.config.legendX, self.config.unit), 0);\r\n        let legendY = Math.max(self.convertToPx(self.config.legendY, self.config.unit), 0);\r\n        let legendWidth = Math.max(self.convertToPx(self.config.legendWidth, self.config.unit), 10);\r\n        let legendHeight = Math.max(self.convertToPx(self.config.legendHeight, self.config.unit), 10);\r\n\r\n        //remove previous graphic\r\n        let element = <HTMLElement>document.getElementById(self.svgDivName);\r\n        element.innerHTML = \"\";\r\n\r\n        let svg = d3.select(\"#\" + self.svgDivName).append(\"svg\")\r\n            .attr(\"width\", width + margin.left + margin.right)\r\n            .attr(\"height\", height + margin.top + margin.bottom)\r\n            .attr(\"xmlns\", \"http://www.w3.org/2000/svg\")\r\n            .attr(\"id\", \"svg\" + self.viewModel.uid) //Tag for downloadSVG\r\n            .append(\"g\")\r\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\r\n            .style(\"font-family\", self.config.font);\r\n        let stroke_width = 1;\r\n\r\n        // ooooo ooooo            o888                                                 \r\n        //  888   888  ooooooooo8  888 ooooooooo    ooooooooo8 oo oooooo    oooooooo8  \r\n        //  888ooo888 888oooooo8   888  888    888 888oooooo8   888    888 888ooooooo  \r\n        //  888   888 888          888  888    888 888          888                888 \r\n        // o888o o888o  88oooo888 o888o 888ooo88     88oooo888 o888o       88oooooo88  \r\n        //                             o888                                            \r\n\r\n        // Essentially, the following functions brute force the optimal text arrangement for each cell \r\n        // in the matrix to maximize text size. The algorithm tries different combinations of line breaks\r\n        // in the cell text.\r\n\r\n        /**\r\n         * Divide distance into divisions equidistant anchor points S.T they all have equal\r\n         * padding from each other and the beginning and end of the distance\r\n         * @param  distance  distance to divide\r\n         * @param  divisions number of divisions\r\n         * @return           number[] where each number corresponds to a division-center offset\r\n         */\r\n        function getSpacing(distance, divisions) {\r\n            distance = distance - 1; //1px padding for border\r\n            let spacing = distance/(divisions*2);\r\n            let res = []\r\n            for (let i = 1; i <= divisions*2; i+=2) {\r\n                res.push(1 + (spacing * i))\r\n            }\r\n            return res\r\n        };\r\n\r\n        /**\r\n         * Magic function to insert line breaks. \r\n        * @param  {string[]} words         array of words to space\r\n        * @param  {dom node} self          the dom element with the text\r\n        * @param  {number} xpos            x pos to place multiline text at\r\n        * @param  {number} ypos            same but with y\r\n        * @param  {number} totalDistance   total distance to contain broken text.\r\n        *                                  amt in excess of spacingDistance\r\n        *                                  becomes v padding.\r\n        * @param  {number} spacingDistance total distance to space text inside,\r\n        *                                  should be < totalDistance\r\n        * @param {boolean} center          if true, center the text in the node, else left-align\r\n        * @param {number} cellWidth        total width of the cell to put the text in\r\n        */\r\n        function insertLineBreaks(words, node, padding, xpos, ypos, totalDistance, spacingDistance, center, cellWidth) {\r\n            let el = d3.select(node)\r\n            // el.attr(\"y\", y + (totalDistance - spacingDistance) / 2);\r\n\r\n            //clear previous content\r\n            el.text('');\r\n            while(node.firstChild) node.removeChild(node.firstChild);\r\n\r\n            let spacing = getSpacing(spacingDistance, words.length)\r\n            for (var i = 0; i < words.length; i++) {\r\n                var tspan = el.append('tspan').text(words[i]);\r\n                if (center) tspan.attr(\"text-anchor\",\"middle\");\r\n                // if (i > 0)\r\n                let offsetY = ((totalDistance - spacingDistance) / 2) + ypos + spacing[i]\r\n                tspan\r\n                    .attr('x', center? xpos + (cellWidth/2) : xpos + padding)\r\n                    .attr('y', offsetY);\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Given an array of words, find the optimal font size for the array of words to be\r\n         * broken onto 1 line each.\r\n         * @param  {string[]} words     to be broken onto each line\r\n         * @param  {dom node} node      the dom node of the cell\r\n         * @param  {cellWidth} number   the width of the cell\r\n         * @param  {cellHeight} number  the height of the cell\r\n         * @param {boolean} center      center the text?\r\n         * @param {number} maxFontSize  max font size, default is 12\r\n         * @return {number}             the largest possible font size\r\n         *                              not larger than 12\r\n         */\r\n        function findSpace(words: string[], node, cellWidth: number, cellHeight: number, center: boolean, maxFontSize=12) {\r\n            let padding = 4; //the amount of padding on the left and right\r\n            //break into multiple lines\r\n            let breakDistance = Math.min(cellHeight, (maxFontSize + 3) * words.length)\r\n            insertLineBreaks(words, node, padding, 0, 0, cellHeight, breakDistance, center, cellWidth)\r\n\r\n            //find right size to fit the height of the cell\r\n            let breakTextHeight = breakDistance / words.length;\r\n            let fitTextHeight = Math.min(breakTextHeight, cellHeight) * 0.8; //0.8\r\n\r\n            //find right size to fit the width of the cell\r\n            // let longestWord = words.sort(function(a,b) {return b.length - a.length})[0]\r\n            let longestWordLength = -Infinity;\r\n            for (let w = 0; w < words.length; w++) {\r\n                let word = words[w];\r\n                longestWordLength = Math.max(longestWordLength, word.length)\r\n            }\r\n            let fitTextWidth = ((cellWidth - (2 * padding)) / longestWordLength) * 1.45;\r\n\r\n            //the min fitting text size not larger than MaxFontSize\r\n            let size = Math.min(maxFontSize, fitTextHeight, fitTextWidth);\r\n\r\n            // if (size < 5) return \"0px\"; //enable for min text size\r\n            return size;\r\n        }\r\n\r\n        /**\r\n         * Given text, a dom node, and sizing parameters, \r\n         * try all combinations of word breaks to maximize font size inside of the given space\r\n         * returns font size in pixels\r\n         * @param {string} text                   the text to render in the cell\r\n         * @param {dom node} node                 the node for the cell\r\n         * @param {number} cellWidth              width of the cell to get the font size for\r\n         * @param {number} cellHeight             height of the cell to get the font size for\r\n         * @param {boolean} center                center the text?\r\n         * @param {number} maxFontSize            max font size, default is 12\r\n         * @return {string}                       the size in pixels\r\n         */\r\n        function optimalFontSize(text: string, node, cellWidth: number, cellHeight: number, center: boolean, maxFontSize=12): number {\r\n            let words = text.split(\" \");\r\n            let bestSize = -Infinity; //beat this size\r\n            let bestWordArrangement = [];\r\n\r\n            /**\r\n             * determine placement of line breaks to try. Shorter lists of words can try more positions\r\n             * @param {number} num_spaces the number of spaces in the words, aka words.length - 1\r\n             * @param {number} [num_breaks=3]  the number of breaks to insert\r\n             * @returns str[] where each index is a combination of breaks represented as [01]+ where 1 is a break and 0 is a space\r\n             */\r\n            function find_breaks(num_spaces:number, num_breaks=3) {\r\n                let breaks = new Set<string>();\r\n                function recurse(breakset_inherit, depth, num_breaks) {\r\n                    for (let i = 0; i < breakset_inherit.length; i++) {\r\n                        let breakset = JSON.parse(JSON.stringify(breakset_inherit)); //deep copy\r\n                        breakset[i] = 1; // insert break at this location\r\n                        breaks.add(breakset.join(\"\")); //save this combination\r\n                        if (depth < num_breaks - 1) recurse(breakset, depth + 1, num_breaks);\r\n                    }\r\n                }\r\n                let initial_breaks = []\r\n                while (initial_breaks.length < num_spaces) initial_breaks.push(0); //fill with 0s\r\n                breaks.add(initial_breaks.join(\"\")); //save this combination\r\n                recurse(initial_breaks, 0, num_breaks)\r\n                return breaks\r\n            }\r\n\r\n            let num_spaces = words.length;\r\n            // longer strings can't try as many combinations without the page lagging\r\n            let num_breaks = 1;\r\n            if (num_spaces < 20) num_breaks = 3;\r\n            else if (num_spaces < 50) num_breaks = 2;\r\n            else num_breaks = 1;\r\n            let breaks = Array.from(find_breaks(num_spaces, num_breaks))\r\n            for (let binaryString of breaks) { // find the best option of the proposed placements generated by find_breaks\r\n                //binaryString: binary representation of newline locations, e.g 001011\r\n                //where 1 is newline and 0 is no newline\r\n                let wordSet = []; //build this array\r\n                \r\n                for (let k = 0; k < binaryString.length; k++) {\r\n                    if (binaryString[k] === \"0\") {//join with space\r\n                        if (wordSet.length == 0) wordSet.push(words[k]);\r\n                        else wordSet[wordSet.length - 1] = wordSet[wordSet.length - 1] + \" \" + words[k]; //append to previous word in array\r\n                    } else { //linebreak\r\n                        wordSet.push(words[k]) //new word in array\r\n                    }\r\n                }\r\n\r\n                let size = findSpace(wordSet, node, cellWidth, cellHeight, center, maxFontSize);\r\n                if (size > bestSize) { //found new optimum\r\n                    bestSize = size;\r\n                    bestWordArrangement = wordSet;\r\n                }\r\n                if (size == maxFontSize) break; //if largest text found, no need to search more\r\n            }\r\n\r\n            findSpace(bestWordArrangement, node, cellWidth, cellHeight, center, maxFontSize);\r\n            return bestSize;\r\n        }\r\n\r\n        // add properties to the node to set the vertical alignment to center without using\r\n        // dominant-baseline, which isn't widely supported\r\n        function centerValign(node, fontSize=null) {\r\n            if (node.children && node.children.length > 0) {\r\n                for (let child of node.children) centerValign(child, node.getAttribute(\"font-size\"));\r\n            } else {\r\n                // base case\r\n                // transform by half the font size - 1/2px for proper centering\r\n                fontSize = fontSize ? fontSize : node.getAttribute(\"font-size\");\r\n                if (fontSize.endsWith(\"px\")) fontSize = Number(fontSize.split(\"px\")[0])\r\n                let currY = node.hasAttribute(\"y\") ? Number(node.getAttribute(\"y\")) : 0;\r\n                let newY = currY + Math.floor((fontSize * 0.3))\r\n                d3.select(node).attr(\"y\", newY);\r\n            }\r\n        }\r\n\r\n        class HeaderSectionContent {\r\n            label: string;\r\n            // either string to display in box, or a callback to create complex content in the box\r\n            // callback function option takes params node, width, height, and appends data to node\r\n            data: string | Function;\r\n        }\r\n        class HeaderSection {\r\n            title: string;\r\n            contents: HeaderSectionContent[];\r\n        }\r\n\r\n        let legend = {\"title\": \"legend\", \"contents\": []};\r\n        if (self.hasScores && self.showGradient()) legend.contents.push({\r\n            \"label\": \"gradient\", \"data\": function(group, sectionWidth, sectionHeight) {\r\n                let domain = [];\r\n                for (let i = 0; i < self.viewModel.gradient.colors.length; i++) {\r\n                    let percent = i / (self.viewModel.gradient.colors.length - 1);\r\n                    domain.push(d3.interpolateNumber(self.viewModel.gradient.minValue, self.viewModel.gradient.maxValue)(percent))\r\n                }\r\n                let colorScale = d3.scaleLinear()\r\n                    .domain(domain)\r\n                    .range(self.viewModel.gradient.colors.map(function (color) { return color.color; }))\r\n                let nCells = domain.length * 2;\r\n                let valuesRange = self.viewModel.gradient.maxValue - self.viewModel.gradient.minValue;\r\n                group.append(\"g\")\r\n                    .attr(\"transform\", \"translate(0, 5)\")\r\n                    .call(d3.legendColor()\r\n                    .shapeWidth((sectionWidth / nCells))\r\n                    .shapePadding(0)\r\n                    .cells(nCells)\r\n                    .shape(\"rect\")\r\n                    .orient(\"horizontal\")\r\n                    .scale(colorScale)\r\n                    .labelOffset(2)\r\n                    .labelFormat(d3.format(\"0.02r\"))\r\n                    \r\n                    // .labelFormat( valuesRange < nCells ? d3.format(\"0.01f\") : d3.format(\".2\"))\r\n                )\r\n            }\r\n        });\r\n        if (self.showLegend()) legend.contents.push({\r\n            \"label\": \"legend\", \"data\": function(group, sectionWidth, sectionHeight) {\r\n                let colorScale = d3.scaleOrdinal()\r\n                    .domain(self.viewModel.legendItems.map(function(item) { return item.label; }))\r\n                    .range(self.viewModel.legendItems.map(function(item) { return item.color; }))\r\n                group.append(\"g\")\r\n                    .attr(\"transform\", \"translate(0, 5)\")\r\n                    .call(d3.legendColor()\r\n                    .shapeWidth((sectionWidth / self.viewModel.legendItems.length))\r\n                    .shapePadding(0)\r\n                    .shape(\"rect\")\r\n                    .orient(\"horizontal\")\r\n                    .scale(colorScale)\r\n                    .labelOffset(2)\r\n                )\r\n            }\r\n        })\r\n\r\n        function descriptiveBox(group, sectionData: HeaderSection, boxWidth: number, boxHeight: number) {\r\n            let boxPadding = 5;\r\n            let boxGroup = group.append(\"g\")\r\n                .attr(\"transform\", `translate(0,${boxPadding})`);\r\n            // adjust height for padding\r\n            boxHeight -= 2 * boxPadding;\r\n            let outerbox = boxGroup.append(\"rect\")\r\n                .attr(\"class\", \"header-box\")\r\n                .attr(\"width\", boxWidth)\r\n                .attr(\"height\", boxHeight)\r\n                .attr(\"stroke\", \"black\")\r\n                .attr(\"fill\", \"white\")\r\n                .attr(\"rx\", boxPadding); //rounded corner\r\n            let titleEl = boxGroup.append(\"text\")\r\n                .attr(\"class\", \"header-box-label\")\r\n                .text(sectionData.title)\r\n                .attr(\"x\", 2 * boxPadding)\r\n                .attr(\"font-size\", 12)\r\n                .each(function() { centerValign(this); })\r\n                // .attr(\"dominant-baseline\", \"middle\")\r\n            // add cover mask so that the box lines crop around the text\r\n            let bbox = titleEl.node().getBBox();\r\n            let coverPadding = 2;\r\n            let cover = boxGroup.append(\"rect\")\r\n                .attr(\"class\", \"label-cover\")\r\n                .attr(\"x\", bbox.x - coverPadding)\r\n                .attr(\"y\", bbox.y - coverPadding)\r\n                .attr(\"width\", bbox.width + 2*coverPadding)\r\n                .attr(\"height\", bbox.height + 2*coverPadding)\r\n                .attr(\"fill\", \"white\")\r\n                .attr(\"rx\", boxPadding); //rounded corner just in case it's being shown on a transparent background\r\n            titleEl.raise(); //push title to front;\r\n\r\n            // add content to box\r\n            let boxContentGroup = boxGroup.append(\"g\")\r\n                .attr(\"class\", \"header-box-content\")\r\n                .attr(\"transform\", `translate(${boxPadding}, 0)`)\r\n            let boxContentHeight = boxHeight;// - 2*boxPadding;\r\n            let boxContentWidth = boxWidth - 2*boxPadding;\r\n\r\n            let boxGroupY = d3.scaleBand()\r\n                .padding(0.05)\r\n                .align(0.5)\r\n                .domain(sectionData.contents.map(function(content) { return content.label }))\r\n                .range([0, boxContentHeight]);\r\n            for (let i = 0; i < sectionData.contents.length; i++) {\r\n                let subsectionContent = sectionData.contents[i];\r\n                let contentGroup = boxContentGroup.append(\"g\")\r\n                    .attr(\"transform\", `translate(0, ${boxGroupY( subsectionContent.label )})`);\r\n                if (typeof(subsectionContent.data) == \"string\") {\r\n                    // add text to contentGroup\r\n                    contentGroup.append(\"text\")\r\n                        .text(subsectionContent)\r\n                        .attr(\"font-size\", function() {\r\n                            return optimalFontSize(subsectionContent.data as string, this, boxContentWidth, boxGroupY.bandwidth(), false, 12)\r\n                        })\r\n                        .each(function() { centerValign(this); })\r\n                        // .attr(\"dominant-baseline\", \"middle\")\r\n                } else {\r\n                    //call callback to add complex data to contentGroup\r\n                    (subsectionContent.data as Function)(contentGroup, boxContentWidth, boxGroupY.bandwidth());\r\n                }\r\n                if (i != sectionData.contents.length - 1) contentGroup.append(\"line\") //dividing line\r\n                    .attr(\"x1\", 0)\r\n                    .attr(\"x2\", boxContentWidth)\r\n                    .attr(\"y1\", boxGroupY.bandwidth())\r\n                    .attr(\"y2\", boxGroupY.bandwidth())\r\n                    .attr(\"stroke\", \"#dddddd\");\r\n            }\r\n        }\r\n\r\n        // ooooo ooooo                             oooo                        \r\n        //  888   888  ooooooooo8  ooooooo    ooooo888  ooooooooo8 oo oooooo   \r\n        //  888ooo888 888oooooo8   ooooo888 888    888 888oooooo8   888    888 \r\n        //  888   888 888        888    888 888    888 888          888        \r\n        // o888o o888o  88oooo888 88ooo88 8o  88ooo888o  88oooo888 o888o       \r\n                                                                            \r\n\r\n        if (self.config.showHeader) {\r\n            let headerSections: HeaderSection[] = []\r\n\r\n            if (self.showName() || self.showDescription()) {\r\n                let about = {\"title\": \"about\", \"contents\": []};\r\n                if (self.showName()) about.contents.push({\"label\": \"name\", \"data\": this.viewModel.name});\r\n                if (self.showDescription()) about.contents.push({\"label\": \"description\", \"data\": this.viewModel.description});\r\n                headerSections.push(about)\r\n            }\r\n\r\n            const config = {\"title\": \"domain\", \"contents\": []};\r\n            let filterConfig = {\"title\": \"platforms\", \"contents\": []};\r\n            if (self.showDomain()) {\r\n                let domain = this.dataService.getDomain(this.viewModel.domainVersionID);\r\n                config.contents.push({\"label\": \"domain\", \"data\": domain.name + \" \" + domain.version.name});\r\n            }\r\n            if (self.showFilters()) {\r\n              const filterData = {\"label\": \"platforms\", \"data\": this.viewModel.filters.platforms.selection.join(\", \")};\r\n              if (self.showAggregate()) {\r\n                config.title = \"domain & platforms\";\r\n                config.contents.push(filterData);\r\n              } else filterConfig.contents.push(filterData);\r\n            }\r\n            if (config.contents.length > 0) headerSections.push(config);\r\n            if (filterConfig.contents.length > 0) headerSections.push(filterConfig);\r\n\r\n            if (self.showAggregate()) {\r\n              const aggregateConfig = { \"title\": \"aggregate\", \"contents\": []};\r\n              aggregateConfig.contents.push({\"label\": \"function\", \"data\": \"showing aggregate scores using the \" + this.viewModel.layout.aggregateFunction + \" aggregate function\"});\r\n              if (this.viewModel.layout.countUnscored) aggregateConfig.contents.push({\"label\": \"unscored\", \"data\": \"includes unscored techniques as having a score of 0\"});\r\n              headerSections.push(aggregateConfig);\r\n            }\r\n\r\n            if (self.showLegendContainer() && self.showLegendInHeader()) headerSections.push(legend);\r\n\r\n            let headerGroup = svg.append(\"g\");\r\n\r\n            let headerX = d3.scaleBand()\r\n                .paddingInner(0.05)\r\n                // .align(0.5)\r\n                .domain(headerSections.map(function(section: HeaderSection) { return section.title }))\r\n                .range([0, width]);\r\n            \r\n            for (let section of headerSections) {\r\n                let sectionGroup = headerGroup.append(\"g\");\r\n                if (headerSections.length > 1) sectionGroup.attr(\"transform\", `translate(${headerX(section.title)}, 0)`);\r\n                descriptiveBox(sectionGroup, section, headerSections.length == 1? width : headerX.bandwidth(), headerHeight);\r\n            }\r\n\r\n            if (headerSections.length == 0) headerHeight = 0; //no header sections to show\r\n        } else { //no header\r\n            headerHeight = 0\r\n        }\r\n\r\n\r\n\r\n        // oooo     oooo            o8              o88               \r\n        //  8888o   888   ooooooo o888oo oo oooooo  oooo  oooo   oooo \r\n        //  88 888o8 88   ooooo888 888    888    888 888    888o888   \r\n        //  88  888  88 888    888 888    888        888    o88 88o   \r\n        // o88o  8  o88o 88ooo88 8o 888o o888o      o888o o88o   o88o \r\n                                                                   \r\n\r\n        let tablebody = svg.append(\"g\")\r\n            .attr(\"transform\", \"translate(0,\" + (headerHeight + 1) + \")\")\r\n\r\n        // build data model\r\n        let matrices: RenderableMatrix[] = this.dataService.getDomain(this.viewModel.domainVersionID).matrices.map(function(matrix: Matrix) {\r\n            return new RenderableMatrix(matrix, self.viewModel, self.config);\r\n        });\r\n\r\n        let tactics: RenderableTactic[] = [];\r\n        //flattened list of tactics\r\n        for (let matrix of matrices) { tactics = tactics.concat(matrix.tactics); }\r\n        \r\n\r\n        let x = d3.scaleBand()\r\n            .paddingInner(0.1)\r\n            .align(0.01)\r\n            .domain(tactics.map(function(tactic: RenderableTactic) { return tactic.tactic.id; }))\r\n            .range([0, width])\r\n\r\n        let y = d3.scaleLinear()\r\n            .domain([d3.max(tactics, function(tactic: RenderableTactic) { return tactic.height}), 0])\r\n            .range([height - (headerHeight), 0])\r\n            \r\n        // let subtechniqueIndent = (1/3) * x.bandwidth(); //2/3 of full techinque width\r\n        // let subtechniqueIndent = 2 * y(1); //2*the height of a cell, to make room for y(1) width sidebar\r\n        let subtechniqueIndent = Math.min(2 * y(1), 15);     \r\n        \r\n        //add tactic row backgroun\r\n        if (self.viewModel.showTacticRowBackground) {\r\n            tablebody.append(\"rect\")\r\n                .attr(\"class\", \"tactic-header-background\")\r\n                .attr(\"width\", width)\r\n                .attr(\"height\", y(1))\r\n                .attr(\"fill\", self.viewModel.tacticRowBackground)\r\n                .attr(\"stroke\", self.config.tableBorderColor)\r\n        }\r\n\r\n        let tacticGroups = tablebody.append(\"g\").selectAll(\"g\")\r\n            .data(tactics)\r\n            .enter().append(\"g\")\r\n            .attr(\"class\", function(tactic: RenderableTactic) { return \"tactic \" + tactic.tactic.shortname; })\r\n            .attr(\"transform\", function(tactic: RenderableTactic) {\r\n                return `translate(${x(tactic.tactic.id)}, 0)`;\r\n            })\r\n        // add technique and subtechnique groups\r\n        let techniqueGroups = tacticGroups.append(\"g\")\r\n            .attr(\"class\", \"techniques\").selectAll(\"g\")\r\n            .data(function(tactic: RenderableTactic) { return tactic.techniques})\r\n            .enter().append(\"g\")\r\n            .attr(\"class\", function(technique: RenderableTechnique) { return \"technique \" + technique.technique.attackID; })\r\n            .attr(\"transform\", function(technique: RenderableTechnique) {\r\n                return `translate(0, ${y(technique.yPosition)})`\r\n            });\r\n        let subtechniqueGroups = tacticGroups.append(\"g\")\r\n            .attr(\"class\", \"subtechniques\").selectAll(\"g\")\r\n            .data(function(tactic: RenderableTactic) { return tactic.subtechniques})\r\n            .enter().append(\"g\")\r\n            .attr(\"class\", function(subtechnique: RenderableTechnique) { return \"subtechnique \" + subtechnique.technique.attackID; })\r\n            .attr(\"transform\", function(subtechnique: RenderableTechnique) {\r\n                return `translate(${subtechniqueIndent}, ${y(subtechnique.yPosition)})`\r\n            });\r\n        // add cells to techniques and subtechniques\r\n        let techniqueRects = techniqueGroups.append(\"rect\")\r\n            .attr(\"class\", \"cell\")\r\n            .attr(\"height\", y(1))\r\n            .attr(\"width\", x.bandwidth())\r\n            .attr(\"fill\", function(technique: RenderableTechnique) { return technique.fill })\r\n            .attr(\"stroke\", self.config.tableBorderColor);\r\n        let subtechniqueRects = subtechniqueGroups.append(\"rect\")\r\n            .attr(\"class\", \"cell\")\r\n            .attr(\"height\", y(1))\r\n            .attr(\"width\", x.bandwidth() - subtechniqueIndent)\r\n            .attr(\"fill\", function(subtechnique: RenderableTechnique) { return subtechnique.fill })\r\n            .attr(\"stroke\", self.config.tableBorderColor);\r\n        // add sidebar\r\n        // let sidebarWidth = y(1);\r\n        let sidebarWidth = 3;\r\n\r\n        let sidebar = subtechniqueGroups.append(\"rect\")\r\n            .attr(\"class\", \"cell\")\r\n            .attr(\"height\", y(1))\r\n            .attr(\"width\", sidebarWidth)\r\n            .attr(\"transform\",  `translate(${-sidebarWidth}, 0)`)\r\n            .attr(\"fill\", self.config.tableBorderColor)\r\n            .attr(\"stroke\", self.config.tableBorderColor);\r\n        let sidebarAngle = techniqueGroups.append(\"polygon\")\r\n            .attr(\"class\", \"sidebar\")\r\n            .attr(\"transform\", `translate(0, ${y(1)})`)\r\n            .attr(\"points\", function(technique: RenderableTechnique) {\r\n                return [\r\n                    \"0,0\",\r\n                    `${subtechniqueIndent - sidebarWidth},0`,\r\n                    `${subtechniqueIndent - sidebarWidth},${Math.min(subtechniqueIndent - sidebarWidth, y(self.viewModel.filterTechniques(technique.technique.subtechniques, technique.tactic, technique.matrix).length))}`\r\n                ].join(\" \");\r\n            })\r\n            .attr(\"fill\", self.config.tableBorderColor)\r\n            .attr(\"visibility\", function(technique: RenderableTechnique) { return technique.technique.subtechniques.length > 0 && technique.showSubtechniques ? \"visible\" : \"hidden\"});\r\n\r\n        //   oooooooo8             o888  o888       ooooooooooo                          o8   \r\n        // o888     88  ooooooooo8  888   888       88  888  88 ooooooooo8 oooo   oooo o888oo \r\n        // 888         888oooooo8   888   888           888    888oooooo8    888o888    888   \r\n        // 888o     oo 888          888   888           888    888           o88 88o    888   \r\n        //  888oooo88    88oooo888 o888o o888o         o888o     88oooo888 o88o   o88o   888o \r\n                                                                                           \r\n        // Track the smallest optimal technique/subtechnique font size\r\n        let minCellTextSize = Infinity;\r\n\r\n        techniqueGroups.append(\"text\")\r\n            .text(function(technique: RenderableTechnique) { \r\n                return technique.text;\r\n            })\r\n            .attr(\"font-size\", function(technique: RenderableTechnique) {\r\n                const fontSize = optimalFontSize(technique.text, this, x.bandwidth(), y(1), false);\r\n                // Track the smallest font size found\r\n                if (fontSize < minCellTextSize) {\r\n                    minCellTextSize = fontSize;\r\n                }\r\n                return fontSize\r\n            })\r\n            // .attr(\"dominant-baseline\", \"middle\")\r\n            .each(function() { centerValign(this); })\r\n            .attr(\"fill\", function(technique: RenderableTechnique) { return technique.textColor; })\r\n\r\n        subtechniqueGroups.append(\"text\")\r\n            .text(function(subtechnique: RenderableTechnique) { \r\n                return subtechnique.text;\r\n            })\r\n            .attr(\"font-size\", function(subtechnique: RenderableTechnique) {\r\n                const fontSize = optimalFontSize(subtechnique.text, this, x.bandwidth() - subtechniqueIndent, y(1), false);\r\n                // Track the smallest font size found\r\n                if (fontSize < minCellTextSize) {\r\n                    minCellTextSize = fontSize;\r\n                }\r\n                return fontSize\r\n            })\r\n            // .attr(\"dominant-baseline\", \"middle\")\r\n            .attr(\"fill\", function(subtechnique: RenderableTechnique) { return subtechnique.textColor; })\r\n            .each(function() { centerValign(this); })\r\n    \r\n        // Set technique and subtechnique groups to the same font size\r\n        techniqueGroups.select(\"text\").attr(\"font-size\", minCellTextSize)\r\n        subtechniqueGroups.select(\"text\").attr(\"font-size\", minCellTextSize)\r\n\r\n        // Track the smallest optimal tactic label font size\r\n        let minTacticLabelTextSize = Infinity;\r\n\r\n        let tacticLabels = tacticGroups.append(\"g\")\r\n            .attr(\"class\", \"tactic-label\");\r\n        tacticLabels.append(\"text\")\r\n            .text(function(tactic: RenderableTactic) {\r\n                return tactic.tactic.name;\r\n            })\r\n            .attr(\"font-size\", function(tactic: RenderableTactic) {\r\n                const fontSize = optimalFontSize(tactic.tactic.name, this, x.bandwidth(), y(1), true);\r\n                // Track the smallest font size found\r\n                if (fontSize < minTacticLabelTextSize) {\r\n                    minTacticLabelTextSize = fontSize;\r\n                }\r\n                return fontSize\r\n            })\r\n            // .attr(\"dominant-baseline\", \"middle\")\r\n            .attr(\"fill\", function(tactic: RenderableTactic) {\r\n                if (self.viewModel.showTacticRowBackground) return tinycolor.mostReadable(self.viewModel.tacticRowBackground, [\"white\", \"black\"]); \r\n                else return \"black\";\r\n            })\r\n            .attr(\"font-weight\", \"bold\")\r\n            .each(function() { centerValign(this); })\r\n\r\n        // Set tactic labels to same font size\r\n        tacticLabels.select(\"text\").attr(\"font-size\", minTacticLabelTextSize)\r\n\r\n        //ooooo  oooo                  oooo                       oooo                         oooo      ooooo                                                            oooo \r\n        // 888    88 oo oooooo    ooooo888   ooooooo     ooooooo   888  ooooo ooooooooo8  ooooo888        888         ooooooooo8   oooooooo8 ooooooooo8 oo oooooo    ooooo888  \r\n        // 888    88  888   888 888    888 888     888 888     888 888o888   888oooooo8 888    888        888        888oooooo8  888    88o 888oooooo8   888   888 888    888  \r\n        // 888    88  888   888 888    888 888     888 888         8888 88o  888        888    888        888      o 888          888oo888o 888          888   888 888    888  \r\n        // 888oo88  o888o o888o  88ooo888o  88ooo88     88ooo888 o888o o888o  88oooo888  88ooo888o      o888ooooo88   88oooo888 888     888  88oooo888 o888o o888o  88ooo888o \r\n        //                                                                                                                         888ooo888                                    \r\n\r\n\r\n        if (self.showLegendContainer() && !self.showLegendInHeader()) {\r\n            let legendGroup = tablebody.append(\"g\")\r\n                .attr(\"transform\", `translate(${legendX}, ${legendY})`)\r\n            descriptiveBox(legendGroup, legend, legendWidth, legendHeight);\r\n        }\r\n    }\r\n\r\n    downloadSVG() {\r\n        let svgEl = document.getElementById(\"svg\" + this.viewModel.uid);\r\n        svgEl.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\r\n        let svgData = new XMLSerializer().serializeToString(svgEl);\r\n        // // var svgData = svgEl.outerHTML;\r\n        // console.log(svgData)\r\n        // let svgData2 = new XMLSerializer().serializeToString(svgEl);\r\n        // console.log(svgData2)\r\n        let filename = this.viewModel.name.split(' ').join('_');\r\n        filename = filename.replace(/\\W/g, \"\")  + \".svg\"; // remove all non alphanumeric characters\r\n        var preface = '<?xml version=\"1.0\" standalone=\"no\"?>\\r\\n';\r\n        var svgBlob = new Blob([preface, svgData], {type:\"image/svg+xml;charset=utf-8\"});\r\n        if (is.ie()) { //internet explorer\r\n            window.navigator.msSaveOrOpenBlob(svgBlob, filename)\r\n        } else {\r\n            var svgUrl = URL.createObjectURL(svgBlob);\r\n            var downloadLink = document.createElement(\"a\");\r\n            downloadLink.href = svgUrl;\r\n            downloadLink.download = filename\r\n            document.body.appendChild(downloadLink);\r\n            downloadLink.click();\r\n            document.body.removeChild(downloadLink);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Convert any length in various units to pixels\r\n     * @param  quantity what length\r\n     * @param  unit     which unit system (in, cm, px?)\r\n     * @return          that length in pixels\r\n     */\r\n    convertToPx(quantity: number, unit: string): number {\r\n        let factor;\r\n\r\n        switch(unit) {\r\n            case \"in\": {\r\n                factor = 96\r\n                break\r\n            }\r\n            case \"cm\": {\r\n                factor = 3.779375 * 10;\r\n                break;\r\n            }\r\n            case \"px\": {\r\n                factor = 1;\r\n                break;\r\n            }\r\n            case \"em\": {\r\n                factor = 16;\r\n                break;\r\n            }\r\n            case \"pt\": {\r\n                factor = 1.33;\r\n            }\r\n            default: {\r\n                console.error(\"unknown unit\", unit)\r\n                factor = 0;\r\n            }\r\n        }\r\n\r\n        return quantity * factor;\r\n    }\r\n\r\n    // wrap(text, width, padding) {\r\n    //     var self = d3.select(this),\r\n    //     textLength = self.node().getComputedTextLength(),\r\n    //     text = self.text();\r\n    //     while (textLength > (width - 2 * padding) && text.length > 0) {\r\n    //         text = text.slice(0, -1);\r\n    //         self.text(text + '...');\r\n    //         textLength = self.node().getComputedTextLength();\r\n    //     }\r\n    // }\r\n\r\n    /**\r\n     * wrap the given text svg element\r\n     * @param  text       element to wrap\r\n     * @param  width      width to wrap to\r\n     * @param  cellheight stop appending wraps after this height\r\n     * @param  self       reference to self this component because of call context\r\n     */\r\n    wrap(text, width, cellheight, self): void {\r\n        text.each(function() {\r\n            var text = d3.select(this),\r\n            words = text.text().split(/\\s+/).reverse(),\r\n            word,\r\n            line = [],\r\n            lineHeight = 1.1, // ems\r\n            y = text.attr(\"y\"),\r\n            dy = parseFloat(text.attr(\"dy\")),\r\n            tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\r\n            while (word = words.pop()) {\r\n                line.push(word);\r\n                tspan.text(line.join(\" \"));\r\n                if (tspan.node().getComputedTextLength() > width) {\r\n                    line.pop();\r\n                    tspan.text(line.join(\" \"));\r\n                    line = [word];\r\n                    let thisdy = lineHeight + dy\r\n                    // if (self.convertToPx(thisdy, \"em\") > cellheight) return;\r\n                    tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", thisdy + \"em\").text(word);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Recenter the selected element's tspan elements\r\n     * @param  height [description]\r\n     * @param  self   [description]\r\n     */\r\n    recenter(text, height, self): void {\r\n        text.each(function() {\r\n            text.selectAll('tspan').each(function(d, i, els) {\r\n                let numTSpan = els.length;\r\n                let location = self.getSpacing(height, numTSpan)[i]\r\n\r\n                let tspan = d3.select(this)\r\n                    .attr(\"y\", ( location))\r\n                    .attr(\"dy\", \"0\")\r\n            })\r\n        })\r\n    }\r\n\r\n    // Capitalizes the first letter of each word in a string\r\n    toCamelCase(str){\r\n        return str.replace(/\\w\\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});\r\n    }\r\n\r\n    //following two functions are only used for iterating over tableconfig options: remove when tableconfig options are hardcoded in html\r\n    getKeys(obj) { return Object.keys(obj) }\r\n    type(obj) { return typeof(obj) }\r\n\r\n    /**\r\n     * Return whether the given dropdown element would overflow the side of the page if aligned to the right of its anchor\r\n     * @param  dropdown the DOM node of the panel\r\n     * @return          true if it would overflow\r\n     */\r\n    checkalign(dropdown): boolean {\r\n        // console.log(anchor)\r\n        let anchor = dropdown.parentNode;\r\n        return anchor.getBoundingClientRect().left + dropdown.getBoundingClientRect().width > document.body.clientWidth;\r\n    }\r\n\r\n    /**\r\n     * Divide distance into divisions equidestant anchor points S.T they all have equal\r\n     * padding from each other and the beginning and end of the distance\r\n     * @param  distance  distance to divide\r\n     * @param  divisions number of divisions\r\n     * @return           number[] where each number corresponds to a division-center offset\r\n     */\r\n    getSpacing(distance: number, divisions: number): number[] {\r\n        distance = distance - 1; //1px padding for border\r\n        let spacing = distance/(divisions*2);\r\n        let res = []\r\n        for (let i = 1; i <= divisions*2; i+=2) {\r\n            res.push(1 + (spacing * i))\r\n        }\r\n        return res\r\n    }\r\n}\r\n\r\n\r\n\r\nclass RenderableMatrix {\r\n    public readonly matrix: Matrix;\r\n    public readonly tactics: RenderableTactic[] = [];\r\n    public get height() {\r\n        let heights = this.tactics.map(function(tactic: RenderableTactic) { return tactic.height; })\r\n        return Math.max(...heights);\r\n    }\r\n    constructor(matrix: Matrix, viewModel: ViewModel, renderConfig: any) {\r\n        this.matrix = matrix;\r\n        let filteredTactics = viewModel.filterTactics(matrix.tactics, matrix);\r\n        for (let tactic of filteredTactics) {\r\n            this.tactics.push(new RenderableTactic(tactic, matrix, viewModel, renderConfig));\r\n        }\r\n    }\r\n}\r\n\r\nclass RenderableTactic {\r\n    public readonly tactic: Tactic;\r\n    public readonly techniques: RenderableTechnique[] = [];\r\n    public readonly subtechniques: RenderableTechnique[] = [];\r\n    public readonly height: number;\r\n    constructor(tactic: Tactic, matrix: Matrix, viewModel: ViewModel, renderConfig: any) {\r\n        this.tactic = tactic;\r\n        let filteredTechniques = viewModel.sortTechniques(viewModel.filterTechniques(tactic.techniques, tactic, matrix), tactic);\r\n        let yPosition = 1; //start at 1 to make space for tactic label\r\n        for (let technique of filteredTechniques) {\r\n            let techniqueVM = viewModel.getTechniqueVM(technique, tactic);\r\n            let filteredSubtechniques = viewModel.filterTechniques(technique.subtechniques, tactic, matrix);\r\n            \r\n            let showSubtechniques = renderConfig.showSubtechniques == \"all\" || (renderConfig.showSubtechniques == \"expanded\" && techniqueVM.showSubtechniques)\r\n\r\n            this.techniques.push(new RenderableTechnique(yPosition++, technique, tactic, matrix, viewModel, showSubtechniques));\r\n\r\n            if (filteredSubtechniques.length > 0 && showSubtechniques) {\r\n                for (let subtechnique of filteredSubtechniques) {\r\n                    this.subtechniques.push(new RenderableTechnique(yPosition++, subtechnique, tactic, matrix, viewModel, renderConfig));\r\n                }\r\n            }\r\n        }\r\n        this.height = yPosition;\r\n    }\r\n}\r\n\r\nclass RenderableTechnique {\r\n    public readonly yPosition: number;\r\n    public readonly technique: Technique;\r\n    public readonly tactic: Tactic;\r\n    public readonly matrix: Matrix;\r\n    public readonly showSubtechniques;\r\n    private readonly viewModel: ViewModel;\r\n    constructor(yPosition, technique: Technique, tactic: Tactic, matrix: Matrix, viewModel: ViewModel, showSubtechniques=false) {\r\n        this.yPosition = yPosition;\r\n        this.technique = technique;\r\n        this.tactic = tactic;\r\n        this.matrix = matrix;\r\n        this.viewModel = viewModel;\r\n        this.showSubtechniques = showSubtechniques;\r\n    }\r\n\r\n    public get fill() {\r\n        if (this.viewModel.hasTechniqueVM(this.technique, this.tactic)) {\r\n            let techniqueVM: TechniqueVM = this.viewModel.getTechniqueVM(this.technique, this.tactic);\r\n            if (!techniqueVM.enabled) return \"white\";\r\n            if (techniqueVM.color) return techniqueVM.color;\r\n            if (this.viewModel.layout.showAggregateScores && techniqueVM.aggregateScoreColor) return techniqueVM.aggregateScoreColor;\r\n            if (techniqueVM.score) return techniqueVM.scoreColor;\r\n        } \r\n        return \"white\"; //default\r\n    }\r\n\r\n    public get textColor() {\r\n        if (this.viewModel.hasTechniqueVM(this.technique, this.tactic)) {\r\n            let techniqueVM: TechniqueVM = this.viewModel.getTechniqueVM(this.technique, this.tactic);\r\n            if (!techniqueVM.enabled) return \"#aaaaaa\";\r\n        }\r\n        return tinycolor.mostReadable(this.fill, [\"white\", \"black\"]); //default;\r\n    }\r\n\r\n    public get text() {\r\n        let text = [];\r\n        if (this.viewModel.layout.showID) text.push(this.technique.attackID);\r\n        if (this.viewModel.layout.showName) text.push(this.technique.name);\r\n        return text.join(\": \")\r\n    }\r\n}\r\n\r\n","<div class=\"controlsContainer\">\r\n    <ul class=\"control-sections\">\r\n        <li class=\"iewarning\" *ngIf=\"isIE()\">\r\n            Warning: this interface is not fully compatible with your browser. For best results please switch to Edge, Chrome, or Firefox.\r\n        </li>\r\n        <li>\r\n            <div class=\"control-row-item noselect\">\r\n                <!-- {{config.unit}} -->\r\n                <div class=\"control-row-button\"\r\n                     (click)=\"unitEnum = (unitEnum + 1) % 3; config.unit = ['in', 'cm', 'px'][unitEnum]; buildSVG()\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"toggle measurement unit\">\r\n                    <svg fill=\"currentColor\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <text x=\"4px\" y=\"50%\" dominant-baseline=\"middle\" style=\"font-size: 14px; font-weight: bold; font-family:monospace\">{{config.unit}}</text>\r\n                    </svg>\r\n                </div>\r\n            </div>\r\n\r\n        </li>\r\n        <li>\r\n            <div class=\"control-row-item\">\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     (click)=\"currentDropdown = currentDropdown !== 'imgsize' ? 'imgsize' : null;\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"image size\">\r\n                    <span class=\"material-icons\">photo_size_select_large</span>\r\n                </div>\r\n                <div class=\"dropdown-container size left\" *ngIf=\"currentDropdown === 'imgsize'\">\r\n                    <ul>\r\n                        <li>\r\n                            <mat-form-field>\r\n                                <input matInput\r\n                                       class=\"has-suffix\"\r\n                                       type=\"number\"\r\n                                       placeholder=\"width\"\r\n                                       step=\"0.01\"\r\n                                       [(ngModel)]=\"config.width\"\r\n                                       (input)=\"buildSVG()\" />\r\n                                <span matSuffix>{{config.unit}}</span>\r\n                            </mat-form-field>\r\n                        </li>\r\n                        <li>\r\n                            <mat-form-field>\r\n                                <input matInput\r\n                                       class=\"has-suffix\"\r\n                                       type=\"number\"\r\n                                       placeholder=\"height\"\r\n                                       step=\"0.01\"\r\n                                       [(ngModel)]=\"config.height\"\r\n                                       (input)=\"buildSVG()\" />\r\n                                <span matSuffix>{{config.unit}}</span>\r\n                            </mat-form-field>\r\n                        </li>\r\n                        <li>\r\n                            <mat-form-field>\r\n                                <input matInput\r\n                                       class=\"has-suffix\"\r\n                                       type=\"number\"\r\n                                       placeholder=\"header height\"\r\n                                       step=\"0.01\"\r\n                                       [disabled]=\"!config.showHeader\"\r\n                                       [(ngModel)]=\"config.headerHeight\"\r\n                                       (input)=\"buildSVG()\" />\r\n                                <span matSuffix [style.color]=\"!config.showHeader ? 'rgba(0,0,0,0.42)' : 'black'\">{{config.unit}}</span>\r\n                            </mat-form-field>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"control-row-item\">\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     (click)=\"currentDropdown = currentDropdown !== 'font' ? 'font' : null;\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"text\">\r\n                    <span class=\"material-icons\">format_size</span>\r\n                </div>\r\n                <div class=\"dropdown-container font left\" *ngIf=\"currentDropdown === 'font'\">\r\n                    <ul>\r\n                        <li>\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"font\" [(ngModel)]=\"config.font\" (selectionChange)=\"buildSVG()\">\r\n                                    <mat-option value=\"serif\">serif</mat-option>\r\n                                    <mat-option value=\"sans-serif\">sans-serif</mat-option>\r\n                                    <mat-option value=\"monospace\">monospace</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <div class=\"control-row-item\">\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     (click)=\"showLegendContainer()? currentDropdown = currentDropdown !== 'legend' ? 'legend' : null : null;\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"legend\"\r\n                     [style.color]=\"showLegendContainer() ? 'inherit' : '#aaaaaa'\">\r\n                    <span class=\"material-icons\">view_list</span>\r\n                </div>\r\n                <div class=\"dropdown-container legend left\" *ngIf=\"currentDropdown === 'legend'\">\r\n                    <ul>\r\n                        <li>\r\n                            <input [id]=\"uid + 'legendDockedCheckbox'\"type=\"checkbox\" class=\"checkbox-custom\" [(ngModel)]=\"config.legendDocked\" (change)=\"buildSVG()\">\r\n                            <label [for]=\"uid + 'legendDockedCheckbox'\" class=\"checkbox-custom-label noselect\">\r\n                                dock legend in header\r\n                            </label>\r\n                        </li>\r\n                        <li>\r\n                            <mat-form-field>\r\n                                <input matInput\r\n                                       class=\"has-suffix\"\r\n                                       type=\"number\"\r\n                                       placeholder=\"legend X position\"\r\n                                       [disabled]=\"config.legendDocked\"\r\n                                       step=\"1\"\r\n                                       [(ngModel)]=\"config.legendX\"\r\n                                       (input)=\"buildSVG()\" />\r\n                                <span [style.color]=\"config.legendDocked ? 'rgba(0,0,0,0.42)' : 'black'\" matSuffix>{{config.unit}}</span>\r\n                            </mat-form-field>\r\n                        </li>\r\n                        <li>\r\n                            <mat-form-field>\r\n                                <input matInput\r\n                                       class=\"has-suffix\"\r\n                                       type=\"number\"\r\n                                       placeholder=\"legend Y position\"\r\n                                       [disabled]=\"config.legendDocked\"\r\n                                       step=\"1\"\r\n                                       [(ngModel)]=\"config.legendY\"\r\n                                       (input)=\"buildSVG()\" />\r\n                                <span [style.color]=\"config.legendDocked ? 'rgba(0,0,0,0.42)' : 'black'\" matSuffix>{{config.unit}}</span>\r\n                            </mat-form-field>\r\n                        </li>\r\n                        <li>\r\n                            <mat-form-field>\r\n                                <input matInput\r\n                                       class=\"has-suffix\"\r\n                                       type=\"number\"\r\n                                       placeholder=\"legend width\"\r\n                                       [disabled]=\"config.legendDocked\"\r\n                                       step=\"1\"\r\n                                       [(ngModel)]=\"config.legendWidth\"\r\n                                       (input)=\"buildSVG()\" />\r\n                                <span [style.color]=\"config.legendDocked ? 'rgba(0,0,0,0.42)' : 'black'\" matSuffix>{{config.unit}}</span>\r\n                            </mat-form-field>\r\n                        </li>\r\n                        <li>\r\n                            <mat-form-field>\r\n                                <input matInput\r\n                                       class=\"has-suffix\"\r\n                                       type=\"number\"\r\n                                       placeholder=\"legend height\"\r\n                                       [disabled]=\"config.legendDocked\"\r\n                                       step=\"1\"\r\n                                       [(ngModel)]=\"config.legendHeight\"\r\n                                       (input)=\"buildSVG()\" />\r\n                                <span [style.color]=\"config.legendDocked ? 'rgba(0,0,0,0.42)' : 'black'\" matSuffix>{{config.unit}}</span>\r\n                            </mat-form-field>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <div class=\"control-row-item\">\r\n                <div class=\"control-row-button dropdown noselect\"\r\n                     (click)=\"currentDropdown = currentDropdown !== 'visibility' ? 'visibility' : null;\"\r\n                     matTooltipPosition=\"below\"\r\n                     matTooltip=\"display settings\">\r\n                    <span class=\"material-icons\">visibility</span>\r\n                </div>\r\n                <div class=\"dropdown-container visibility left\" *ngIf=\"currentDropdown === 'visibility'\">\r\n                    <ul>\r\n                        <li>\r\n                            <input [id]=\"uid+'checkboxheader'\" type=\"checkbox\" class=\"checkbox-custom\" [(ngModel)]=\"config.showHeader\" (change)=\"buildSVG()\">\r\n                            <label [for]=\"uid+'checkboxheader'\" class=\"checkbox-custom-label noselect\">show header</label>\r\n                        </li>\r\n                        <li>\r\n                            <input [id]=\"uid+'checkboxAbout'\" type=\"checkbox\" [disabled]=\"(!hasName() && !hasDescription()) || !config.showHeader\" class=\"checkbox-custom\" [(ngModel)]=\"config.showAbout\" (change)=\"buildSVG()\">\r\n                            <label [for]=\"uid+'checkboxAbout'\" class=\"checkbox-custom-label noselect\" [class.disabled]=\"(!hasName() && !hasDescription()) || !config.showHeader\">show about</label>\r\n                        </li>\r\n                        <li>\r\n                            <input [id]=\"uid+'checkboxDomain'\" type=\"checkbox\" [disabled]=\"(!hasDomain()) || !config.showHeader\" class=\"checkbox-custom\" [(ngModel)]=\"config.showDomain\" (change)=\"buildSVG()\">\r\n                            <label [for]=\"uid+'checkboxDomain'\" class=\"checkbox-custom-label noselect\" [class.disabled]=\"(!hasDomain()) || !config.showHeader\">show domain</label>\r\n                        </li>\r\n                        <li>\r\n                            <input [id]=\"uid+'checkboxfilters'\" type=\"checkbox\" class=\"checkbox-custom\" [disabled]=\"!config.showHeader\"[(ngModel)]=\"config.showFilters\" (change)=\"buildSVG()\">\r\n                            <label [for]=\"uid+'checkboxfilters'\" class=\"checkbox-custom-label noselect\" [class.disabled]=\"!config.showHeader\">show filters</label>\r\n                        </li>\r\n                        <li>\r\n                            <input [id]=\"uid+'checkboxlegend'\" type=\"checkbox\" [disabled]=\"!hasLegendItems()\" class=\"checkbox-custom\" [(ngModel)]=\"config.showLegend\" (change)=\"buildSVG()\">\r\n                            <label [for]=\"uid+'checkboxlegend'\" class=\"checkbox-custom-label noselect\" [class.disabled]=\"!hasLegendItems()\">show legend</label>\r\n                        </li>\r\n                        <li>\r\n                            <input [id]=\"uid+'checkboxGradient'\" type=\"checkbox\" [disabled]=\"!hasScores\" class=\"checkbox-custom\" [(ngModel)]=\"config.showGradient\" (change)=\"buildSVG()\">\r\n                            <label [for]=\"uid+'checkboxGradient'\" class=\"checkbox-custom-label noselect\" [class.disabled]=\"!hasScores\">show gradient score</label>\r\n                        </li>\r\n                        <li *ngIf=\"configService.getFeature('subtechniques')\" style=\"padding: 0 5px\">\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"sub-techniques\" [(ngModel)]=\"config.showSubtechniques\" (selectionChange)=\"buildSVG()\">\r\n                                    <mat-option value=\"all\">show all</mat-option>\r\n                                    <mat-option value=\"expanded\">show expanded</mat-option>\r\n                                    <mat-option value=\"none\">show none</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </li>\r\n                        <!-- <li>\r\n                            <input [id]=\"uid+'checkboxtcount'\" type=\"checkbox\" class=\"checkbox-custom\" [(ngModel)]=\"config.showTechniqueCount\" (change)=\"buildSVG()\">\r\n                            <label [for]=\"uid+'checkboxtcount'\" class=\"checkbox-custom-label noselect\">show technique count</label>\r\n                        </li> -->\r\n                        <li>\r\n                            <input [id]=\"uid+'tableBorderInput'\" class=\"colorpicker\" [(colorPicker)]=\"config.tableBorderColor\" [style.background]=\"config.tableBorderColor\" cpPosition=\"bottom\" [cpPresetColors]=\"['#6B7279', '#aaaaaa', '#205B8F', '#B9482D', '#ffffff', '#000000']\"\r\n                             (colorPickerSelect)=\"buildSVG()\" [cpOKButton]=\"true\" [cpOKButtonText]=\"'apply'\" [cpCancelButton]=\"true\" style=\"width: 14px; margin: 5px 0 0 5px;\">\r\n                             <label [for]=\"uid+'tableBorderInput'\" class=\"noselect\">cell border</label>\r\n\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n        </li>\r\n        <li>\r\n            <div class=\"control-row-item\">\r\n                <div class=\"control-row-button noselect\"\r\n                [id]=\"'download-button' + viewModel.uid\"\r\n                    (click)=\"downloadSVG()\"\r\n                    matTooltipPosition=\"below\"\r\n                    matTooltip=\"download SVG\">\r\n                    <span class=\"material-icons\" alt=\"save layer\">file_download</span>\r\n                </div>\r\n            </div>\r\n\r\n        </li>\r\n    </ul>\r\n</div>\r\n\r\n<div class=\"svgcontainer\" [id]=\"'svgInsert' + viewModel.uid\">\r\n    loading...\r\n</div>\r\n\r\n<div class=\"close-button\">\r\n    <button mat-button mat-dialog-close>close</button>\r\n</div>\r\n","import { Component, OnInit, Input, ViewEncapsulation } from '@angular/core';\r\nimport { ViewModel, ViewModelsService } from '../viewmodels.service';\r\nimport { BaseStix, DataService, Group, Mitigation, Software, Technique, Campaign } from '../data.service';\r\n\r\n@Component({\r\n  selector: 'app-search-and-multiselect',\r\n  templateUrl: './search-and-multiselect.component.html',\r\n  styleUrls: ['./search-and-multiselect.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\n\r\nexport class SearchAndMultiselectComponent implements OnInit {\r\n    @Input() viewModel: ViewModel;\r\n    public stixTypes: any[];\r\n    // Data Components is a map mainly because it is a collection of labels that map to\r\n    // an array of techniques, where we want to filter/sort by label name\r\n    public stixDataComponents = new Map<string, any>();\r\n    public stixDataComponentLabels: string[];\r\n    userClickedExpand = false;\r\n    expandedPanels = {\r\n        0: true, // techniques panel\r\n        1: false, // groups panel\r\n        2: false, // software panel\r\n        3: false, // campaign panel\r\n        4: false, // mitigations panel\r\n        5: false // data components panel\r\n    };\r\n\r\n    public fields = [\r\n        {\r\n            \"label\": \"name\",\r\n            \"field\": \"name\",\r\n            \"enabled\": true\r\n        },\r\n        {\r\n            \"label\": \"ATT&CK ID\",\r\n            \"field\": \"attackID\",\r\n            \"enabled\": true\r\n        },\r\n        {\r\n            \"label\": \"description\",\r\n            \"field\": \"description\",\r\n            \"enabled\": true\r\n        },\r\n        {\r\n            \"label\": \"data sources\",\r\n            \"field\": \"datasources\",\r\n            \"enabled\": true\r\n        }\r\n    ]\r\n\r\n    private debounceFunction;\r\n    private previousQuery: string = \"\";\r\n    private _query: string = \"\";\r\n    public set query(newQuery: string) {\r\n        this._query = newQuery;\r\n        if (!this.debounceFunction) {\r\n            this.debounceFunction = setTimeout(() => {\r\n                this.getResults(this._query);\r\n                this.debounceFunction = null;\r\n                this.previousQuery = this._query;\r\n                }, 300);\r\n        }\r\n    }\r\n\r\n    public get queryLength(): number {\r\n        return this._query.length;\r\n    }\r\n\r\n    public get stixDataComponentsResults(): Technique[] {\r\n      let results = [];\r\n      this.stixDataComponentLabels.forEach((label) => {\r\n        results = results.concat(this.stixDataComponents.get(label).objects);\r\n      });\r\n      return results;\r\n    }\r\n\r\n    public techniqueResults: Technique[] = [];\r\n\r\n    constructor(private dataService: DataService, private viewModelsService: ViewModelsService) {\r\n        this.stixTypes = [];\r\n        this.stixDataComponentLabels = [];\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.getResults();\r\n    }\r\n\r\n    /**\r\n     * filterAndSort() takes an array of items and does the following:\r\n     *       1) if the query is empty, then it sorts the array\r\n     *       2) if the query is not empty, then it filters the already sorted array until nothing is left, or until\r\n     *          the query is cleared out and empty again\r\n     * @param items BaseStix[] or Technique[] objects to be filtered and sorted\r\n     * @param query user-input query in search bar\r\n     * @param sortTechniquesAndSubtechniques will be true if called from getTechniqueResults(),\r\n     *                                       to sort techniques and all its subtechniques,\r\n     *                                       otherwise just sort BaseStix items by name\r\n     */\r\n    filterAndSort(items: BaseStix[], query = \"\", sortTechniquesAndSubtechniques = false): any[] {\r\n        let self = this;\r\n        let results = items.filter(t => !t.deprecated && !t.revoked);\r\n        if (query.trim() === \"\") {\r\n            if (sortTechniquesAndSubtechniques) {\r\n                results.sort((tA: Technique, tB: Technique) => {\r\n                    let c1 = tA.isSubtechnique ? tA.parent.name : tA.name;\r\n                    let c2 = tB.isSubtechnique ? tB.parent.name : tB.name;\r\n                    return c1.localeCompare(c2)\r\n                });\r\n            } else {\r\n                results.sort((a, b) => a.name.toLowerCase().localeCompare(b.name.toLowerCase()));\r\n            }\r\n        } else {\r\n            // deconflict IDs for cross-tactic techniques\r\n            let seenIDs = new Set();\r\n            results = results.filter(function (technique: Technique) {\r\n                if (seenIDs.has(technique.id)) return false;\r\n                for (let field of self.fields) {\r\n                    if (field.enabled) {\r\n                        // query in this field\r\n                        if (technique[field.field]?.toLowerCase().includes(query.trim().toLowerCase())) {\r\n                            seenIDs.add(technique.id);\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n                return false;\r\n            });\r\n        }\r\n        return results;\r\n    }\r\n\r\n    filterAndSortLabels(labels, query) {\r\n      let results = labels;\r\n      if (query.trim() === \"\") {\r\n        return results.sort();\r\n      } else {\r\n        return results.filter((r) => r.toLowerCase().includes(query.trim().toLowerCase()));\r\n      }\r\n    }\r\n\r\n\r\n    /**\r\n     * getResults() checks if this._query is:\r\n     *       1) valid, and\r\n     *       2) part of last query, otherwise call getTechniques() and getStixData() to search all objects again\r\n    **/\r\n\r\n    getResults(query = \"\", fieldToggled = false) {\r\n        if (query.trim() != \"\" && query.includes(this.previousQuery) && !fieldToggled) {\r\n            this.techniqueResults = this.filterAndSort(this.techniqueResults, query, true);\r\n            this.stixTypes.forEach(item => item['objects'] = this.filterAndSort(item['objects'], query));\r\n        } else {\r\n            this.getTechniques();\r\n            this.getStixData();\r\n        }\r\n        this.stixDataComponentLabels = this.filterAndSortLabels(this.stixDataComponentLabels, query);\r\n        this.expandPanels();\r\n    }\r\n\r\n    expandPanels() {\r\n        if (!this.userClickedExpand) {\r\n            this.expandedPanels[0] = this.techniqueResults.length > 0;\r\n            let isPrevExpanded = this.expandedPanels[0];\r\n            if (!isPrevExpanded) {\r\n                this.stixTypes.forEach((s, i) => {\r\n                  this.expandedPanels[i+1] = !isPrevExpanded && s.objects.length > 0;\r\n                  isPrevExpanded = s.isExpanded;\r\n                });\r\n            }\r\n            this.expandedPanels[4] = (!isPrevExpanded && this.stixDataComponentLabels.length > 0);\r\n        } else {\r\n            let isAllCollapsed = false;\r\n            for (const isPanelExpanded in this.expandedPanels) {\r\n                if (isPanelExpanded) {\r\n                  isAllCollapsed = true;\r\n                  break;\r\n                }\r\n            }\r\n            this.userClickedExpand = isAllCollapsed;\r\n        }\r\n    }\r\n\r\n    getTechniques() {\r\n        //get master list of techniques and sub-techniques\r\n        let allTechniques = this.dataService.getDomain(this.viewModel.domainVersionID).techniques;\r\n        for (let technique of allTechniques) {\r\n            allTechniques = allTechniques.concat(technique.subtechniques);\r\n        }\r\n        this.techniqueResults = this.filterAndSort(allTechniques, this._query, true);\r\n    }\r\n\r\n    getStixData() {\r\n        let domain = this.dataService.getDomain(this.viewModel.domainVersionID);\r\n\r\n        this.stixTypes = [{\r\n            \"label\": \"threat groups\",\r\n            \"objects\": this.filterAndSort(domain.groups, this._query)\r\n        }, {\r\n            \"label\": \"software\",\r\n            \"objects\": this.filterAndSort(domain.software, this._query)\r\n        }, {\r\n            \"label\": \"mitigations\",\r\n            \"objects\": this.filterAndSort(domain.mitigations, this._query)\r\n        }, {\r\n            \"label\": \"campaigns\",\r\n            \"objects\": this.filterAndSort(domain.campaigns, this._query)\r\n        }];\r\n\r\n        domain.dataComponents.forEach((c) => {\r\n          const source = c.source(this.viewModel.domainVersionID);\r\n          const label = `${source.name}: ${c.name}`;\r\n          const obj = {\r\n            \"objects\": c.techniques(this.viewModel.domainVersionID),\r\n            \"url\": source.url\r\n          }\r\n          this.stixDataComponents.set(label, obj);\r\n        });\r\n        this.stixDataComponentLabels = this.filterAndSortLabels(Array.from(this.stixDataComponents.keys()), this._query);\r\n    }\r\n\r\n    public toggleFieldEnabled(field: string) {\r\n        for (let thefield of this.fields) {\r\n            if (thefield.field == field) {\r\n                thefield.enabled = !thefield.enabled;\r\n                // set query to empty string to trigger getResults() in the case that:\r\n                // 1) a field was toggled, and\r\n                // 2) the query did not change\r\n                this.getResults(\"\", true);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    public mouseEnterAll(techniques: Technique[]) {\r\n      techniques.forEach((t) => this.mouseEnter(t));\r\n    }\r\n\r\n    public mouseEnter(technique: Technique, isTechnique = true): void {\r\n        if (!isTechnique) {\r\n            for (let t of this.getRelated(technique)) {\r\n                this.viewModel.selectTechniqueAcrossTactics(t, true, true);\r\n            }\r\n        } else {\r\n            this.viewModel.highlightTechnique(technique);\r\n        }\r\n    }\r\n\r\n    public mouseLeave(): void {\r\n        this.viewModel.clearHighlight();\r\n    }\r\n\r\n    public select(stixObject: any, isTechnique= true): void {\r\n        if (isTechnique) {\r\n            this.viewModel.selectTechniqueAcrossTactics(stixObject);\r\n        }\r\n        else if (!isTechnique) {\r\n            for (let technique of this.getRelated(stixObject)) {\r\n                this.viewModel.selectTechniqueAcrossTactics(technique);\r\n            }\r\n        }\r\n        this.viewModelsService.onSelectionChange.emit(); // emit selection change\r\n    }\r\n\r\n    public deselect(stixObject: any, isTechnique = true): void {\r\n        if (isTechnique) {\r\n            this.viewModel.unselectTechniqueAcrossTactics(stixObject);\r\n        }\r\n        else if (!isTechnique) {\r\n            for (let technique of this.getRelated(stixObject)) {\r\n                this.viewModel.unselectTechniqueAcrossTactics(technique);\r\n            }\r\n        }\r\n        this.viewModelsService.onSelectionChange.emit(); // emit selection change\r\n    }\r\n\r\n    public selectAll(items: any[], isTechniqueArray = true): void {\r\n        if (isTechniqueArray) {\r\n            for (let result of items) this.select(result, isTechniqueArray);\r\n        }\r\n        else if (!isTechniqueArray) {\r\n            for (let stixObject of items) this.select(stixObject, isTechniqueArray);\r\n        }\r\n        this.viewModelsService.onSelectionChange.emit(); // emit selection change\r\n    }\r\n\r\n    public deselectAll(items: any[], isTechniqueArray = true): void {\r\n        if (isTechniqueArray) {\r\n            for (let result of items) this.deselect(result, isTechniqueArray);\r\n        }\r\n        else if (!isTechniqueArray) {\r\n            for (let stixObject of items) this.deselect(stixObject, isTechniqueArray);\r\n        }\r\n        this.viewModelsService.onSelectionChange.emit(); // emit selection change\r\n    }\r\n\r\n    public getRelated(stixObject: BaseStix): Technique[] {\r\n        // master list of all techniques and sub-techniques\r\n        let techniques = this.dataService.getDomain(this.viewModel.domainVersionID).techniques;\r\n        let allTechniques = techniques.concat(this.dataService.getDomain(this.viewModel.domainVersionID).subtechniques);\r\n        let domainVersionID = this.viewModel.domainVersionID;\r\n\r\n        if (stixObject instanceof Group) {\r\n            return allTechniques.filter((technique: Technique) => (stixObject as Group).relatedTechniques(domainVersionID).includes(technique.id));\r\n        } else if (stixObject instanceof Software) {\r\n            return allTechniques.filter((technique: Technique) => (stixObject as Software).relatedTechniques(domainVersionID).includes(technique.id));\r\n        } else if (stixObject instanceof Mitigation) {\r\n            return allTechniques.filter((technique: Technique) => (stixObject as Mitigation).relatedTechniques(domainVersionID).includes(technique.id));\r\n        } else if (stixObject instanceof Campaign) {\r\n            return allTechniques.filter((technique: Technique) => (stixObject as Campaign).relatedTechniques(domainVersionID).includes(technique.id));\r\n        }\r\n    }\r\n}\r\n","<div class=\"search-and-multiselect\">\r\n    <mat-form-field appearance=\"outline\">\r\n        <mat-label>Search</mat-label>\r\n        <span matPrefix class=\"material-icons\" alt=\"search\">search</span>\r\n        <input matInput [(ngModel)]=\"query\" placeholder=\"Search\">\r\n    </mat-form-field>\r\n\r\n    <mat-divider></mat-divider>\r\n\r\n    <div class=\"sidebar-content\">\r\n        <mat-card>\r\n            <div class=\"settings\">\r\n                <mat-card-title><h4 class=\"title\">Search Settings</h4></mat-card-title>\r\n                <mat-card-content>\r\n                    <div class=\"fields\">\r\n                        <div class=\"field\" *ngFor=\"let field of fields\">\r\n                            <input [id]=\"field.field\" class=\"checkbox-custom\" type=\"checkbox\"\r\n                                   (click)=\"toggleFieldEnabled(field.field)\" [checked]=\"field.enabled\">\r\n                            <label [for]=\"field.field\" class=\"checkbox-custom-label noselect\">{{field.label}}</label>\r\n                        </div>\r\n                    </div>\r\n                </mat-card-content>\r\n            </div>\r\n        </mat-card>\r\n    </div>\r\n\r\n    <mat-divider></mat-divider>\r\n\r\n    <div class=\"sidebar-content\">\r\n        <mat-accordion multi>\r\n            <mat-expansion-panel [expanded]=\"expandedPanels[0]\" (click)=\"userClickedExpand = true\">\r\n                <mat-expansion-panel-header>\r\n                    <mat-panel-title>\r\n                        <h4>Techniques ({{techniqueResults.length}})</h4>\r\n                    </mat-panel-title>\r\n                    <mat-panel-description>\r\n                    </mat-panel-description>\r\n                </mat-expansion-panel-header>\r\n\r\n                <ng-template matExpansionPanelContent>\r\n                    <div>\r\n                        <div class=\"allresults-buttons\">\r\n                            <button class=\"button\" (click)=\"selectAll(techniqueResults)\">select all</button>\r\n                            <button class=\"button\" (click)=\"deselectAll(techniqueResults)\">deselect all</button>\r\n                        </div>\r\n                        <div class=\"results\">\r\n                            <table class=\"results\" *ngIf=\"techniqueResults.length > 0; else noTechniquesResults\">\r\n                                <tr *ngFor=\"let result of techniqueResults\">\r\n                                    <td (mouseenter)=\"mouseEnter(result)\" (mouseleave)=\"mouseLeave()\">\r\n                                        <span *ngIf=\"result.isSubtechnique\">{{result.parent.name}}\r\n                                            : </span>{{result.name}}\r\n                                    </td>\r\n                                    <td><a href=\"{{result.url}}\" target=\"_blank\">view</a></td>\r\n                                    <td>\r\n                                        <button class=\"button\" (click)=\"select(result)\">select</button>\r\n                                    </td>\r\n                                    <td>\r\n                                        <button class=\"button\" (click)=\"deselect(result)\">deselect</button>\r\n                                    </td>\r\n                                </tr>\r\n                            </table>\r\n                            <ng-template #noTechniquesResults>\r\n                                <div class=\"no-results\">no results for techniques</div>\r\n                            </ng-template>\r\n                        </div>\r\n                    </div>\r\n                </ng-template>\r\n            </mat-expansion-panel>\r\n\r\n            <mat-expansion-panel *ngFor=\"let stixType of stixTypes; let i = index\" class=\"stixType\" [expanded]=\"expandedPanels[i+1]\" (click)=\"userClickedExpand = true\">\r\n                <mat-expansion-panel-header>\r\n                    <mat-panel-title>\r\n                        <h4>\r\n                            {{stixType.label | titlecase }} ({{stixType.objects.length}})\r\n                        </h4>\r\n                    </mat-panel-title>\r\n                    <mat-panel-description>\r\n                    </mat-panel-description>\r\n                </mat-expansion-panel-header>\r\n\r\n                <ng-template matExpansionPanelContent>\r\n                    <div class=\"allresults-buttons\">\r\n                        <button class=\"button\" (click)=\"selectAll(stixType.objects, false)\">select all</button>\r\n                        <button class=\"button\" (click)=\"deselectAll(stixType.objects, false)\">deselect all</button>\r\n                    </div>\r\n                    <div class=\"results objects\">\r\n                        <table *ngIf=\"stixType.objects.length > 0; else noResults\">\r\n                            <tr *ngFor=\"let stixObject of stixType.objects\">\r\n                                <td (mouseenter)=\"mouseEnter(stixObject, false)\"\r\n                                    (mouseleave)=\"mouseLeave()\">\r\n                                    {{stixObject.name}}\r\n                                </td>\r\n                                <td><a href=\"{{stixObject.url}}\" target=\"_blank\">view</a></td>\r\n                                <td>\r\n                                    <button class=\"button\" (click)=\"select(stixObject, false)\">select</button>\r\n                                </td>\r\n                                <td>\r\n                                    <button class=\"button\" (click)=\"deselect(stixObject, false)\">deselect</button>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                        <ng-template #noResults>\r\n                            <div class=\"no-results\">no results for {{stixType.label}}</div>\r\n                        </ng-template>\r\n                    </div>\r\n                </ng-template>\r\n            </mat-expansion-panel>\r\n\r\n            <mat-expansion-panel [expanded]=\"expandedPanels[4]\" (click)=\"userClickedExpand = true\">\r\n                <mat-expansion-panel-header>\r\n                    <mat-panel-title>\r\n                        <h4>\r\n                            Data Sources ({{stixDataComponentLabels.length}})\r\n                        </h4>\r\n                    </mat-panel-title>\r\n                    <mat-panel-description>\r\n                    </mat-panel-description>\r\n                </mat-expansion-panel-header>\r\n\r\n                <ng-template matExpansionPanelContent>\r\n                    <div class=\"allresults-buttons\">\r\n                        <button class=\"button\" (click)=\"selectAll(stixDataComponentsResults, true)\">select all</button>\r\n                        <button class=\"button\" (click)=\"deselectAll(stixDataComponentsResults, true)\">deselect all</button>\r\n                    </div>\r\n                    <div class=\"results objects\">\r\n                        <table *ngIf=\"stixDataComponentLabels.length > 0; else noResults\">\r\n                            <tr  *ngFor=\"let label of stixDataComponentLabels\">\r\n                                <td (mouseenter)=\"mouseEnterAll(stixDataComponents.get(label).objects)\"\r\n                                    (mouseleave)=\"mouseLeave()\">\r\n                                    {{ label }}\r\n                                </td>\r\n                                <td><a href=\"{{stixDataComponents.get(label).url}}\" target=\"_blank\">view</a></td>\r\n                                <td>\r\n                                    <button class=\"button\" (click)=\"selectAll(stixDataComponents.get(label).objects, true)\">select</button>\r\n                                </td>\r\n                                <td>\r\n                                    <button class=\"button\" (click)=\"deselectAll(stixDataComponents.get(label).objects, true)\">deselect</button>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                        <ng-template #noResults>\r\n                            <div class=\"no-results\">no results for data sources</div>\r\n                        </ng-template>\r\n                    </div>\r\n                </ng-template>\r\n            </mat-expansion-panel>\r\n        </mat-accordion>\r\n    </div>\r\n\r\n    <mat-divider></mat-divider>\r\n\r\n    <div class=\"button-container sidebar-content\">\r\n        <button (click)=\"viewModel.sidebarOpened = !viewModel.sidebarOpened\" mat-raised-button>Close</button>\r\n    </div>\r\n</div>\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Buffer } from 'buffer';\r\nimport { Observable } from \"rxjs/Rx\";\r\nimport { fromPromise } from 'rxjs/observable/fromPromise';\r\nimport { TaxiiConnect, Collection } from './taxii2lib';\r\n\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class DataService {\r\n\r\n    constructor(private http: HttpClient) {\r\n        console.log(\"initializing data service\")\r\n        let subscription = this.getConfig().subscribe({\r\n            next: (config) => {\r\n                this.setUpURLs(config[\"versions\"]);\r\n            },\r\n            complete: () => { if (subscription) subscription.unsubscribe(); } //prevent memory leaks\r\n        })\r\n    }\r\n\r\n    public domain_backwards_compatibility = {\r\n        \"mitre-enterprise\": \"enterprise-attack\",\r\n        \"mitre-mobile\": \"mobile-attack\"\r\n    }\r\n    public domains: Domain[] = [];\r\n    public versions: Version[] = [];\r\n\r\n    public subtechniquesEnabled: boolean = true;\r\n\r\n    /**\r\n     * Callback functions passed to this function will be called after data is loaded\r\n     * @param {string} domainVersionID the ID of the domain and version to load\r\n     * @param {*} callback callback function to call when data is done loading\r\n     */\r\n    public onDataLoad(domainVersionID, callback) {\r\n        this.getDomain(domainVersionID).dataLoadedCallbacks.push(callback);\r\n    }\r\n\r\n    /**\r\n     * Parse the given stix bundle into the relevant data holders\r\n     * @param domain\r\n     * @param stixBundles\r\n     */\r\n    parseBundle(domain: Domain, stixBundles: any[]): void {\r\n        let platforms = new Set<String>();\r\n        let seenIDs = new Set<String>();\r\n        for (let bundle of stixBundles) {\r\n            let techniqueSDOs = [];\r\n            let matrixSDOs = [];\r\n            let idToTechniqueSDO = new Map<string, any>();\r\n            let idToTacticSDO = new Map<string, any>();\r\n            for (let sdo of bundle.objects) { //iterate through stix domain objects in the bundle\r\n                // Filter out object not included in this domain if domains field is available\r\n                if (!domain.isCustom) {\r\n                    if (\"x_mitre_domains\" in sdo && sdo.x_mitre_domains.length > 0 && !sdo.x_mitre_domains.includes(domain.domain_identifier)) continue;\r\n                }\r\n\r\n                // filter out duplicates\r\n                if (!seenIDs.has(sdo.id)) seenIDs.add(sdo.id)\r\n                else continue;\r\n\r\n                // parse according to type\r\n                switch (sdo.type) {\r\n                    case \"x-mitre-data-component\":\r\n                        domain.dataComponents.push(new DataComponent(sdo, this));\r\n                        break;\r\n                    case \"x-mitre-data-source\":\r\n                        domain.dataSources.set(sdo.id, { name: sdo.name, external_references: sdo.external_references });\r\n                        break;\r\n                    case \"intrusion-set\":\r\n                        domain.groups.push(new Group(sdo, this));\r\n                        break;\r\n                    case \"malware\":\r\n                    case \"tool\":\r\n                        domain.software.push(new Software(sdo, this));\r\n                        break;\r\n                    case \"campaign\":\r\n                        domain.campaigns.push(new Campaign(sdo, this));\r\n                        break;\r\n                    case \"course-of-action\":\r\n                        domain.mitigations.push(new Mitigation(sdo, this));\r\n                        break;\r\n                    case \"relationship\":\r\n                        if (sdo.relationship_type == \"subtechnique-of\" && this.subtechniquesEnabled) {\r\n                            // record subtechnique:technique relationship\r\n                            if (domain.relationships[\"subtechniques_of\"].has(sdo.target_ref)) {\r\n                                let ids = domain.relationships[\"subtechniques_of\"].get(sdo.target_ref);\r\n                                ids.push(sdo.source_ref);\r\n                            } else {\r\n                                domain.relationships[\"subtechniques_of\"].set(sdo.target_ref, [sdo.source_ref])\r\n                            }\r\n                        } else if (sdo.relationship_type == \"uses\") {\r\n                            if (sdo.source_ref.startsWith(\"intrusion-set\") && sdo.target_ref.startsWith(\"attack-pattern\")) {\r\n                                // record group:technique relationship\r\n                                if (domain.relationships[\"group_uses\"].has(sdo.source_ref)) {\r\n                                    let ids = domain.relationships[\"group_uses\"].get(sdo.source_ref);\r\n                                    ids.push(sdo.target_ref);\r\n                                } else {\r\n                                    domain.relationships[\"group_uses\"].set(sdo.source_ref, [sdo.target_ref])\r\n                                }\r\n                            } else if ((sdo.source_ref.startsWith(\"malware\") || sdo.source_ref.startsWith(\"tool\")) && sdo.target_ref.startsWith(\"attack-pattern\")) {\r\n                                // record software:technique relationship\r\n                                if (domain.relationships[\"software_uses\"].has(sdo.source_ref)) {\r\n                                    let ids = domain.relationships[\"software_uses\"].get(sdo.source_ref);\r\n                                    ids.push(sdo.target_ref);\r\n                                } else {\r\n                                    domain.relationships[\"software_uses\"].set(sdo.source_ref, [sdo.target_ref])\r\n                                }\r\n                            } else if (sdo.source_ref.startsWith(\"campaign\") && sdo.target_ref.startsWith(\"attack-pattern\")) {\r\n                                // record campaign:technique relationship\r\n                                if (domain.relationships[\"campaign_uses\"].has(sdo.source_ref)) {\r\n                                    let ids = domain.relationships[\"campaign_uses\"].get(sdo.source_ref);\r\n                                    ids.push(sdo.target_ref);\r\n                                } else {\r\n                                    domain.relationships[\"campaign_uses\"].set(sdo.source_ref, [sdo.target_ref])\r\n                                }\r\n                            }\r\n                        } else if (sdo.relationship_type == \"mitigates\") {\r\n                            if (domain.relationships[\"mitigates\"].has(sdo.source_ref)) {\r\n                                let ids = domain.relationships[\"mitigates\"].get(sdo.source_ref);\r\n                                ids.push(sdo.target_ref);\r\n                            } else {\r\n                                domain.relationships[\"mitigates\"].set(sdo.source_ref, [sdo.target_ref])\r\n                            }\r\n                        } else if (sdo.relationship_type == 'revoked-by') {\r\n                            // record stix object: stix object relationship\r\n                            domain.relationships[\"revoked_by\"].set(sdo.source_ref, sdo.target_ref)\r\n                        } else if (sdo.relationship_type === 'detects') {\r\n                            if (domain.relationships[\"component_rel\"].has(sdo.source_ref)) {\r\n                                let ids = domain.relationships[\"component_rel\"].get(sdo.source_ref);\r\n                                ids.push(sdo.target_ref);\r\n                            } else {\r\n                                domain.relationships[\"component_rel\"].set(sdo.source_ref, [sdo.target_ref])\r\n                            }\r\n                        } else if (sdo.relationship_type == \"attributed-to\") {\r\n                            if (domain.relationships[\"campaigns_attributed_to\"].has(sdo.target_ref)) {\r\n                                let ids = domain.relationships[\"campaigns_attributed_to\"].get(sdo.target_ref);\r\n                                ids.push(sdo.source_ref);\r\n                            } else {\r\n                                domain.relationships[\"campaigns_attributed_to\"].set(sdo.target_ref, [sdo.source_ref]); // group -> [campaigns]\r\n                            }\r\n                        }\r\n                        break;\r\n                    case \"attack-pattern\":\r\n                        idToTechniqueSDO.set(sdo.id, sdo);\r\n                        if (!sdo.x_mitre_is_subtechnique) {\r\n                            techniqueSDOs.push(sdo);\r\n                        }\r\n                        break;\r\n                    case \"x-mitre-tactic\":\r\n                        idToTacticSDO.set(sdo.id, sdo);\r\n                        break;\r\n                    case \"x-mitre-matrix\":\r\n                        matrixSDOs.push(sdo);\r\n                        break;\r\n                    case \"note\":\r\n                        domain.notes.push(new Note(sdo));\r\n                        break;\r\n                }\r\n            }\r\n\r\n            //create techniques\r\n            for (let techniqueSDO of techniqueSDOs) {\r\n                let subtechniques: Technique[] = [];\r\n                if (this.subtechniquesEnabled) {\r\n                    if (domain.relationships.subtechniques_of.has(techniqueSDO.id)) {\r\n                        domain.relationships.subtechniques_of.get(techniqueSDO.id).forEach((sub_id) => {\r\n                            if (idToTechniqueSDO.has(sub_id)) {\r\n                                let subtechnique = new Technique(idToTechniqueSDO.get(sub_id), [], this);\r\n                                subtechniques.push(subtechnique);\r\n                                domain.subtechniques.push(subtechnique);\r\n                            }\r\n                            // else the target was revoked or deprecated and we can skip honoring the relationship\r\n                        })\r\n                    }\r\n                }\r\n                domain.techniques.push(new Technique(techniqueSDO, subtechniques, this));\r\n            }\r\n\r\n            //create matrices, which also creates tactics and filters techniques\r\n            for (let matrixSDO of matrixSDOs) {\r\n                if (matrixSDO.x_mitre_deprecated) continue;\r\n                domain.matrices.push(new Matrix(matrixSDO, idToTacticSDO, domain.techniques, this));\r\n            }\r\n\r\n            // parse platforms\r\n            for (let technique of domain.techniques) {\r\n                if (technique.platforms) {\r\n                    for (let platform of technique.platforms) {\r\n                        platforms.add(platform)\r\n                    }\r\n                }\r\n            }\r\n            for (let subtechnique of domain.subtechniques) {\r\n                for (let platform of subtechnique.platforms) {\r\n                    platforms.add(platform)\r\n                }\r\n            }\r\n        }\r\n        domain.platforms = Array.from(platforms); // convert to array\r\n\r\n        // data loading complete; update watchers\r\n        domain.dataLoaded = true;\r\n        for (let callback of domain.dataLoadedCallbacks) {\r\n            callback();\r\n        }\r\n    }\r\n\r\n    // Observable for data in config.json\r\n    private configData$: Observable<Object>;\r\n\r\n    // Observable for data\r\n    private domainData$: Observable<Object>;\r\n\r\n    // URLs in case config file doesn't load properly\r\n    private latestVersion: Version = { name: \"ATT&CK v12\", number: \"12\" };\r\n    private lowestSupportedVersion: Version;\r\n    private enterpriseAttackURL: string = \"https://raw.githubusercontent.com/mitre/cti/master/enterprise-attack/enterprise-attack.json\";\r\n    private mobileAttackURL: string = \"https://raw.githubusercontent.com/mitre/cti/master/mobile-attack/mobile-attack.json\";\r\n    private icsAttackURL: string = \"https://raw.githubusercontent.com/mitre/cti/master/ics-attack/ics-attack.json\";\r\n\r\n    /**\r\n     * Set up the URLs for data\r\n     * @param {versions} list of versions and domains defined in the configuration file\r\n     * @memberof DataService\r\n     */\r\n    setUpURLs(versions: []) {\r\n        versions.forEach((version: any) => {\r\n            let v: Version = new Version(version[\"name\"], version[\"version\"].match(/[0-9]+/g)[0]);\r\n            this.versions.push(v);\r\n            version[\"domains\"].forEach((domain: any) => {\r\n                let identifier = domain[\"identifier\"];\r\n                let domainObject = new Domain(identifier, domain[\"name\"], v);\r\n                if (version[\"authentication\"]) domainObject.authentication = version[\"authentication\"];\r\n                if (domain[\"taxii_url\"] && domain[\"taxii_collection\"]) {\r\n                    domainObject.taxii_url = domain[\"taxii_url\"];\r\n                    domainObject.taxii_collection = domain[\"taxii_collection\"];\r\n                } else {\r\n                    domainObject.urls = domain[\"data\"];\r\n                }\r\n                this.domains.push(domainObject);\r\n            });\r\n        });\r\n\r\n        if (this.domains.length == 0) { // issue loading config\r\n            this.versions.push(this.latestVersion);\r\n            let enterpriseDomain = new Domain(\"enterprise-attack\", \"Enterprise\", this.latestVersion, [this.enterpriseAttackURL]);\r\n            let mobileDomain = new Domain(\"mobile-attack\", \"Mobile\", this.latestVersion, [this.mobileAttackURL]);\r\n            let icsDomain = new Domain(\"ics-attack\", \"ICS\", this.latestVersion, [this.icsAttackURL]);\r\n            this.domains.push(...[enterpriseDomain, mobileDomain, icsDomain]);\r\n        }\r\n\r\n        this.lowestSupportedVersion = this.versions[this.versions.length-1];\r\n    }\r\n\r\n    /**\r\n     * get the current config\r\n     * @param {boolean} refresh: if true fetches the config from file. Otherwise, only fetches if it's never been fetched before\r\n     */\r\n    getConfig(refresh: boolean = false) {\r\n        if (refresh || !this.configData$) {\r\n            this.configData$ = this.http.get(\"./assets/config.json\");\r\n        }\r\n        return this.configData$;\r\n    }\r\n\r\n    /**\r\n     * Fetch the domain data from the endpoint\r\n     */\r\n    getDomainData(domain: Domain, refresh: boolean = false): Observable<Object> {\r\n        if (domain.taxii_collection && domain.taxii_url) {\r\n            console.log(\"fetching data from TAXII server\");\r\n            let conn = new TaxiiConnect(domain.taxii_url, '', '', 5000);\r\n            let collectionInfo: any = {\r\n                'id': domain.taxii_collection,\r\n                'title': domain.name,\r\n                'description': '',\r\n                'can_read': true,\r\n                'can_write': false,\r\n                'media_types': ['application/vnd.oasis.stix+json']\r\n            }\r\n            const collection = new Collection(collectionInfo, domain.taxii_url + 'stix', conn);\r\n            this.domainData$ = Observable.forkJoin(fromPromise(collection.getObjects('', undefined)));\r\n        } else if (refresh || !this.domainData$) {\r\n            console.log(\"retrieving data\", domain.urls)\r\n            let bundleData = [];\r\n            const httpOptions = {\r\n                headers: undefined\r\n            }\r\n            if (domain.authentication && domain.authentication.enabled) { // include authorization header, if configured (integrations)\r\n                let token = `${domain.authentication.serviceName}:${domain.authentication.apiKey}`;\r\n                httpOptions.headers = new HttpHeaders({ 'Authorization': 'Basic ' + Buffer.from(token).toString('base64')})\r\n            }\r\n            domain.urls.forEach((url) => {\r\n                bundleData.push(this.http.get(url, httpOptions));\r\n            });\r\n            this.domainData$ = Observable.forkJoin(bundleData);\r\n        }\r\n        return this.domainData$;\r\n    }\r\n\r\n    /**\r\n     * Load and parse domain data\r\n     */\r\n    loadDomainData(domainVersionID: string, refresh: boolean = false): Promise<any> {\r\n        let dataPromise: Promise<any> = new Promise((resolve, reject) => {\r\n            let domain = this.getDomain(domainVersionID);\r\n            if (domain.dataLoaded && !refresh) resolve(null);\r\n            if (domain) {\r\n                let subscription = this.getDomainData(domain, refresh).subscribe({\r\n                    next: (data: Object[]) => {\r\n                        this.parseBundle(domain, data);\r\n                        resolve(null);\r\n                    },\r\n                    complete: () => { if (subscription) subscription.unsubscribe(); } //prevent memory leaks\r\n                });\r\n            } else if (!domain) { // domain not defined in config\r\n                reject(\"'\" + domainVersionID + \"' is not a valid domain & version.\")\r\n            }\r\n        });\r\n        return dataPromise;\r\n    }\r\n\r\n    /**\r\n     * Get domain object by domain ID\r\n     */\r\n    getDomain(domainVersionID: string): Domain {\r\n        return this.domains.find((d) => d.id === domainVersionID);\r\n    }\r\n\r\n    /**\r\n     * Get the ID from domain name & version\r\n     */\r\n    getDomainVersionID(domain: string, versionNumber: string): string {\r\n        if (!versionNumber) { // layer with no specified version defaults to current version\r\n            versionNumber = this.versions[0].number;\r\n        }\r\n        return domain + '-' + versionNumber;\r\n    }\r\n\r\n    /**\r\n     * Retrieve the technique object with the given attackID in the given domain/version\r\n     */\r\n    getTechnique(attackID: string, domainVersionID: string) {\r\n        let domain = this.getDomain(domainVersionID);\r\n        let all_techniques = domain.techniques.concat(domain.subtechniques);\r\n        return all_techniques.find(t => t.attackID == attackID);\r\n    }\r\n\r\n    /**\r\n     * Retrieves the first version defined in the config file\r\n     */\r\n    getCurrentVersion() {\r\n        return this.domains[0].version;\r\n    }\r\n\r\n    /**\r\n     * Is the given version supported?\r\n     */\r\n    isSupported(version: string) {\r\n        let supported = this.versions.map(v => v.number);\r\n        let match = version.match(/[0-9]+/g)[0];\r\n        return supported.includes(match);\r\n    }\r\n\r\n    /**\r\n     * Compares techniques between two ATT&CK versions and returns a set of object changes\r\n     * @param oldDomainVersionID imported layer domain & version to upgrade from\r\n     * @param newDomainVersionID latest ATT&CK domain & version to upgrade to\r\n     */\r\n    public compareVersions(oldDomainVersionID: string, newDomainVersionID: string): VersionChangelog {\r\n        let changelog = new VersionChangelog(oldDomainVersionID, newDomainVersionID);\r\n        let oldDomain = this.getDomain(oldDomainVersionID);\r\n        let newDomain = this.getDomain(newDomainVersionID);\r\n\r\n        let previousTechniques = oldDomain.techniques.concat(oldDomain.subtechniques);\r\n        let latestTechniques = newDomain.techniques.concat(newDomain.subtechniques);\r\n\r\n        // object lookup to increase efficiency\r\n        let objectLookup = new Map<string, Technique>(\r\n            latestTechniques.map(technique => [technique.id, previousTechniques.find(p => p.id == technique.id)])\r\n        );\r\n\r\n        for (let latestTechnique of latestTechniques) {\r\n            if (!latestTechnique) continue;\r\n\r\n            let prevTechnique = objectLookup.get(latestTechnique.id);\r\n            if (!prevTechnique) {\r\n                // object doesn't exist in previous version, added to latest version\r\n                changelog.additions.push(latestTechnique.attackID);\r\n            }\r\n            else if (latestTechnique.modified == prevTechnique.modified) {\r\n                if (prevTechnique.revoked || prevTechnique.deprecated) {\r\n                    // object is revoked or deprecated, ignore\r\n                    continue;\r\n                } else {\r\n                    // no changes made to the object\r\n                    changelog.unchanged.push(latestTechnique.attackID);\r\n                }\r\n            } else {\r\n                // changes were made to the object\r\n                if (latestTechnique.revoked && !prevTechnique.revoked) {\r\n                    // object was revoked since the previous version\r\n                    changelog.revocations.push(latestTechnique.attackID);\r\n                } else if (latestTechnique.revoked && prevTechnique.revoked) {\r\n                    // both objects are revoked, ignore\r\n                    continue;\r\n                } else if (latestTechnique.deprecated && !prevTechnique.deprecated) {\r\n                    // object was deprecated since the previous version\r\n                    changelog.deprecations.push(latestTechnique.attackID);\r\n                } else if (latestTechnique.deprecated && prevTechnique.deprecated) {\r\n                    // both objects are deprecated, ignore\r\n                    continue;\r\n                } else if (latestTechnique.compareVersion(prevTechnique) != 0) {\r\n                    // version number changed\r\n                    changelog.changes.push(latestTechnique.attackID);\r\n                } else { // minor change\r\n                    changelog.minor_changes.push(latestTechnique.attackID);\r\n                }\r\n            }\r\n        }\r\n        return changelog;\r\n    }\r\n}\r\n\r\n/**\r\n * Common attributes for STIX objects\r\n */\r\nexport abstract class BaseStix {\r\n    public readonly id: string;          // STIX ID\r\n    public readonly attackID: string;    // ATT&CK ID\r\n    public readonly name: string;        // name of object\r\n    public readonly description: string; // description of object\r\n    public readonly url: string;         // URL of object on the ATT&CK website\r\n    public readonly created: string;     // date object was created\r\n    public readonly modified: string;    // date object was last modified\r\n    public readonly revoked: boolean;    // is the object revoked?\r\n    public readonly deprecated: boolean; // is the object deprecated?\r\n    public readonly version: string;     // object version\r\n    protected readonly dataService: DataService;\r\n    constructor(stixSDO: any, dataService: DataService, supportsAttackID = true) {\r\n        this.id = stixSDO.id;\r\n        if (supportsAttackID) {\r\n            if (stixSDO.external_references && stixSDO.external_references[0] && stixSDO.external_references[0].external_id) this.attackID = stixSDO.external_references[0].external_id; else {\r\n                alert('Error: external_references has invalid format in imported BaseStix object (ID: ' + stixSDO.id + ')');\r\n                throw new Error('Error: external_references has invalid format in imported BaseStix object. Read more here: https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_72bcfr3t79jx');\r\n            }\r\n        }\r\n        this.name = stixSDO.name;\r\n        this.description = stixSDO.description;\r\n        if (stixSDO.id.includes(\"x-mitre-data-component\")) {\r\n            this.attackID = '';\r\n        } else if (stixSDO.external_references && stixSDO.external_references[0] && stixSDO.external_references[0].external_id) {\r\n            this.attackID = stixSDO.external_references[0].external_id;\r\n        } else {\r\n            alert('Error: external_references has invalid format in imported BaseStix object (ID: ' + stixSDO.id + ')');\r\n            throw new Error('Error: external_references has invalid format in imported BaseStix object. Read more here: https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_72bcfr3t79jx');\r\n        }\r\n        if (\"external_references\" in stixSDO && stixSDO.external_references.length > 0) {\r\n            this.url = stixSDO.external_references[0].url;\r\n        } else {\r\n            this.url = \"\";\r\n        }\r\n        this.created = stixSDO.created;\r\n        this.modified = stixSDO.modified;\r\n        this.revoked = stixSDO.revoked ? stixSDO.revoked : false;\r\n        this.deprecated = stixSDO.x_mitre_deprecated ? stixSDO.x_mitre_deprecated : false;\r\n        this.version = stixSDO.x_mitre_version ? stixSDO.x_mitre_version : '';\r\n        this.dataService = dataService;\r\n    }\r\n\r\n    /**\r\n     * Compare this object's version number to another object's version number\r\n     * @param that the object to compare to\r\n     * @returns 0 if the objects have the same version,\r\n     *          > 0 if this object's version is greater,\r\n     *          < 0 if that object's version is greater\r\n     */\r\n    public compareVersion(that: BaseStix): number {\r\n        if (!this.version || !that.version) return 0; // one or both of the objects have no version\r\n\r\n        let thisVersion = this.version.split('.');\r\n        let thatVersion = that.version.split('.');\r\n\r\n        for (let i = 0; i < Math.max(thisVersion.length, thatVersion.length); i++) {\r\n            if (thisVersion.length == thatVersion.length && thisVersion.length < i) return 0;\r\n            if (thisVersion.length < i) return -1;\r\n            if (thatVersion.length < i) return 1;\r\n            if (+thisVersion[i] == +thatVersion[i]) continue;\r\n            return +thisVersion[i] - +thatVersion[i];\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * get the stix object that this object is revoked by\r\n     * @param {string} domainVersionID the ID of the domain & version this object is found in\r\n     * @returns {string} object ID this object is revoked by\r\n     */\r\n    public revoked_by(domainVersionID): string {\r\n        let rels = this.dataService.getDomain(domainVersionID).relationships.revoked_by;\r\n        if (rels.has(this.id)) return rels.get(this.id);\r\n        else return undefined;\r\n    }\r\n}\r\n\r\n/**\r\n * Object representing an ATT&CK matrix (x-mitre-matrix)\r\n */\r\nexport class Matrix extends BaseStix {\r\n    public readonly tactics: Tactic[]; //tactics found under this Matrix\r\n    /**\r\n     * Creates an instance of Matrix.\r\n     * @param {*} stixSDO for the matrix\r\n     * @param {Map<string, any>} idToTacticSDO map of tactic ID to tactic SDO\r\n     * @param {Technique[]} techniques all techniques defined in the domain\r\n     */\r\n    constructor(stixSDO: any, idToTacticSDO: Map<string, any>, techniques: Technique[], dataService: DataService) {\r\n        super(stixSDO, dataService);\r\n        this.tactics = stixSDO.tactic_refs\r\n          .map(tacticID => idToTacticSDO.get(tacticID))  // Get tacticSDOs\r\n          .filter(tacticSDO => tacticSDO)                // Filter out nulls (tacticSDO not found)\r\n          .map(tacticSDO => new Tactic(tacticSDO, techniques, this.dataService));  // Create Tactic objects\r\n    }\r\n}\r\n\r\n/**\r\n * Object representing a Tactic (x-mitre-tactic) in the ATT&CK matrix\r\n */\r\nexport class Tactic extends BaseStix {\r\n    public readonly techniques: Technique[];  // techniques found under this tactic\r\n    public readonly shortname: string;        // shortname property, AKA phase-name for techniques' kill-chain phases\r\n    /**\r\n     * Creates an instance of Tactic.\r\n     * @param {*} stixSDO for the tactic\r\n     * @param {Technique[]} techniques all techniques in the domain\r\n     */\r\n    constructor(stixSDO: any, techniques: Technique[], dataService: DataService) {\r\n        super(stixSDO, dataService);\r\n        this.shortname = stixSDO.x_mitre_shortname;\r\n        this.techniques = techniques.filter((technique: Technique) => {\r\n            if (!technique.revoked && !technique.deprecated)\r\n                return technique.tactics.includes(this.shortname)\r\n        });\r\n    }\r\n}\r\n/**\r\n * Object representing a Technique (attack-pattern) in the ATT&CK matrix\r\n */\r\nexport class Technique extends BaseStix {\r\n    public readonly platforms: string[];        // platforms for this technique.\r\n    public readonly tactics: string[];          // tactics this technique is found under in phase-name format\r\n    public readonly subtechniques: Technique[]; // subtechniques under this technique\r\n    public readonly datasources: string;        // data sources of the technique\r\n    public parent: Technique = null;            // parent technique. Only present if it's a sub-technique\r\n    public get isSubtechnique() { return this.parent != null; }\r\n    /**\r\n     * Creates an instance of Technique.\r\n     * @param {*} stixSDO for the technique\r\n     * @param {Technique[]} subtechniques occuring under the technique\r\n     */\r\n    constructor(stixSDO: any, subtechniques: Technique[], dataService: DataService) {\r\n        super(stixSDO, dataService);\r\n        this.platforms = stixSDO.x_mitre_platforms ? stixSDO.x_mitre_platforms.map(platform => platform.trim()) : undefined;\r\n        this.datasources = stixSDO.x_mitre_data_sources ? stixSDO.x_mitre_data_sources.toString() : \"\";\r\n\r\n        if (!this.revoked && !this.deprecated) {\r\n            this.tactics = stixSDO.kill_chain_phases.map((phase) => phase.phase_name);\r\n        }\r\n\r\n        this.subtechniques = subtechniques.filter(sub => !(sub.deprecated || sub.revoked));\r\n        for (let subtechnique of this.subtechniques) {\r\n            subtechnique.parent = this;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get an ID identifying this technique under a specific tactic\r\n     * @param {string|Tactic} tactic tactic name in phase-name/shortname format, or a Tactic object itself\r\n     * @returns {string} ID for this technique under that tactic\r\n     */\r\n    public get_technique_tactic_id(tactic: string | Tactic): string {\r\n        let tactic_shortname = tactic instanceof Tactic ? tactic.shortname : tactic;\r\n        if (!this.tactics.includes(tactic_shortname)) {\r\n            throw new Error(tactic_shortname + \" is not a tactic of \" + this.attackID);\r\n        }\r\n        return this.attackID + \"^\" + tactic_shortname;\r\n    }\r\n\r\n    /**\r\n     * Get all possible IDs identifying this technique under tactics\r\n     * Basically the same as calling get_technique_tactic_id with all valid tactic values\r\n     */\r\n    public get_all_technique_tactic_ids(): string[] {\r\n        if (this.revoked || this.deprecated) return [];\r\n        return this.tactics.map((shortname: string) => this.get_technique_tactic_id(shortname));\r\n    }\r\n}\r\n\r\nexport class VersionChangelog {\r\n    public oldDomainVersionID: string;\r\n    public newDomainVersionID: string;\r\n    public additions: string[] = []; // new objects added to newest version\r\n    public changes: string[] = []; // object changes between versions\r\n    public minor_changes: string[] = []; // changes to objects without version increments\r\n    public deprecations: string[] = []; // objects deprecated since older version\r\n    public revocations: string[] = []; // objects revoked since older version\r\n    public unchanged: string[] = []; // objects which have not changed between versions\r\n\r\n    public reviewed = new Set<string>();\r\n    public copied = new Set<string>();\r\n\r\n    constructor(oldDomainVersionID: string, newDomainVersionID: string) {\r\n        this.oldDomainVersionID = oldDomainVersionID;\r\n        this.newDomainVersionID = newDomainVersionID;\r\n    }\r\n\r\n    public length(): number {\r\n        return this.additions.length\r\n            + this.changes.length\r\n            + this.minor_changes.length\r\n            + this.deprecations.length\r\n            + this.revocations.length\r\n            + this.unchanged.length;\r\n    }\r\n}\r\n\r\n/**\r\n * Object representing a Data Component in the ATT&CK catalogue\r\n */\r\nexport class DataComponent extends BaseStix {\r\n    public readonly url: string;\r\n    public readonly dataSource: string;\r\n    /**\r\n     * get techniques related to this data component\r\n     * @returns {string[]} technique IDs used by this data component\r\n     */\r\n    public techniques(domainVersionID): string[] {\r\n        const techniques = [];\r\n        const domain = this.dataService.getDomain(domainVersionID);\r\n        let rels = domain.relationships.component_rel;\r\n        if (rels.has(this.id)) {\r\n            rels.get(this.id).forEach((targetID) => {\r\n                const t = domain.techniques.find((t) => t.id === targetID);\r\n                if (t) techniques.push(t);\r\n            })\r\n        }\r\n        return techniques;\r\n    }\r\n    /**\r\n     * get data source related to this data component\r\n     * @returns {name: string, url: string} name, and first url of data source referenced by this data component\r\n     */\r\n    public source(domainVersionID) {\r\n        const dataSources = this.dataService.getDomain(domainVersionID).dataSources;\r\n        if (dataSources.has(this.dataSource)) {\r\n            const source = dataSources.get(this.dataSource);\r\n            let url = \"\";\r\n            if (source.external_references && source.external_references[0] && source.external_references[0].url)\r\n                url = source.external_references[0].url;\r\n            return { name: source.name, url: url };\r\n        }\r\n        else return { name: '', url: '' };\r\n    }\r\n\r\n    constructor(stixSDO: any, dataService: DataService) {\r\n        super(stixSDO, dataService, false);\r\n        this.dataSource = stixSDO.x_mitre_data_source_ref;\r\n    }\r\n}\r\n\r\n/**\r\n * Object representing a Software (tool, malware) in the ATT&CK catalogue\r\n */\r\nexport class Software extends BaseStix {\r\n    public readonly platforms: string[] = []; //platforms for this software\r\n\r\n    /**\r\n     * Creates an instance of Software.\r\n     * @param {*} stixSDO for the software\r\n     * @param {DataService} DataService the software occurs within\r\n    */\r\n    constructor(stixSDO: any, dataService: DataService) {\r\n        super(stixSDO, dataService);\r\n        this.platforms = stixSDO.x_mitre_platforms ? stixSDO.x_mitre_platforms.map(platform => platform.trim()) : undefined;\r\n    }\r\n\r\n    /**\r\n     * get techniques used by this software\r\n     * @returns {string[]} technique IDs used by this software\r\n     */\r\n    public used(domainVersionID): string[] {\r\n        let rels = this.dataService.getDomain(domainVersionID).relationships.software_uses;\r\n        if (rels.has(this.id)) return rels.get(this.id);\r\n        else return [];\r\n    }\r\n    /**\r\n     * Return all related techniques\r\n     */\r\n    public relatedTechniques(domainVersionID): string[] {\r\n        return this.used(domainVersionID);\r\n    }\r\n}\r\n\r\n/**\r\n * Object representing a Group (intrusion-set) in the ATT&CK catalogue\r\n */\r\nexport class Group extends BaseStix {\r\n    /**\r\n     * get techniques used by this group\r\n     * @returns {string[]} technique IDs used by this group\r\n     */\r\n    public used(domainVersionID): string[] {\r\n        let rels = this.dataService.getDomain(domainVersionID).relationships.group_uses;\r\n        if (rels.has(this.id)) return rels.get(this.id);\r\n        else return [];\r\n    }\r\n    /**\r\n     * get techniques used by campaigns attributed to this group\r\n     * @returns {string[]} technique IDs used by campaigns attributed to this group\r\n     */\r\n    public campaignsUsed(domainVersionID): string[] {\r\n        // get campaigns attributed to groups\r\n        let attributedCampaigns = this.dataService.getDomain(domainVersionID).relationships.campaigns_attributed_to;\r\n        // get techniques used by campaigns\r\n        let rels = this.dataService.getDomain(domainVersionID).relationships.campaign_uses;\r\n        if (attributedCampaigns.has(this.id)) {\r\n            // get set of techniques used by attributed campaigns\r\n            let techniques = [];\r\n            attributedCampaigns.get(this.id).forEach(campaign_id => {\r\n                if (rels.has(campaign_id)) techniques = techniques.concat(rels.get(campaign_id))\r\n            });\r\n            return techniques;\r\n        } else return []; // no attributed campaigns\r\n\r\n    }\r\n    /**\r\n     * Return all related techniques\r\n     */\r\n    public relatedTechniques(domainVersionID): string[] {\r\n        let usedSet = new Set(this.used(domainVersionID).concat(this.campaignsUsed(domainVersionID)));\r\n        return Array.from(usedSet);\r\n    }\r\n}\r\n\r\n/**\r\n * Object representing a Mitigation (course-of-action) in the ATT&CK catalogue\r\n */\r\nexport class Mitigation extends BaseStix {\r\n    /**\r\n     * get techniques mitigated by this mitigation\r\n     * @returns {string[]} list of technique IDs\r\n     */\r\n    public mitigated(domainVersionID): string[] {\r\n        let rels = this.dataService.getDomain(domainVersionID).relationships.mitigates;\r\n        if (rels.has(this.id)) {\r\n            return rels.get(this.id);\r\n        }\r\n        else return [];\r\n    }\r\n    /**\r\n     * Return all related techniques\r\n     */\r\n    public relatedTechniques(domainVersionID): string[] {\r\n        return this.mitigated(domainVersionID);\r\n    }\r\n}\r\n\r\nexport class Campaign extends BaseStix {\r\n    /**\r\n     * get techniques used by this campaign\r\n     * @returns {string[]} technique IDs used by this campaign\r\n     */\r\n     public used(domainVersionID): string[] {\r\n        let rels = this.dataService.getDomain(domainVersionID).relationships.campaign_uses;\r\n        if (rels.has(this.id)) return rels.get(this.id);\r\n        else return [];\r\n    }\r\n\r\n    /**\r\n     * Return all related techniques\r\n     */\r\n     public relatedTechniques(domainVersionID): string[] {\r\n        return this.used(domainVersionID);\r\n    }\r\n}\r\n\r\nexport class Note {\r\n    public readonly abstract?: string; // brief summary of note content\r\n    public readonly content: string; // content of the note\r\n    public readonly object_refs: string[]; // list of STIX objects the note is applied to\r\n\r\n    /**\r\n     * Creates an instance of Note.\r\n     * @param {*} stixSDO for the note\r\n    */\r\n    constructor(stixSDO: any) {\r\n        if (stixSDO.abstract) this.abstract = stixSDO.abstract;\r\n        this.content = stixSDO.content;\r\n        this.object_refs = stixSDO.object_refs;\r\n    }\r\n}\r\n\r\nexport class Domain {\r\n    public readonly id: string; // domain ID\r\n    public readonly domain_identifier: string //domain ID without the version suffix\r\n    public readonly name: string; // domain display name\r\n    public readonly version: Version; // ATT&CK version\r\n\r\n    public urls: string[] = [];\r\n    public taxii_url: string = \"\";\r\n    public taxii_collection: string = \"\";\r\n    public authentication: ServiceAuth;\r\n    public dataLoaded: boolean = false;\r\n    public dataLoadedCallbacks: any[] = [];\r\n    // this should only be enabled if the user loads custom data via URL\r\n    public isCustom: boolean = false;\r\n\r\n    public matrices: Matrix[] = [];\r\n\r\n    public get tactics(): Tactic[] {\r\n        let tactics = [];\r\n        for (let matrix of this.matrices) {\r\n            tactics = tactics.concat(matrix.tactics);\r\n        }\r\n        return tactics;\r\n    }\r\n    public techniques: Technique[] = [];\r\n    public platforms: String[] = []; // platforms defined on techniques and software of the domain\r\n    public subtechniques: Technique[] = [];\r\n    public software: Software[] = [];\r\n    public campaigns: Campaign[] = [];\r\n    public dataComponents: DataComponent[] = [];\r\n    public dataSources = new Map<string, { name: string, external_references: any[] }>(); // Map data source ID to name and urls to be used by data components\r\n    public groups: Group[] = [];\r\n    public mitigations: Mitigation[] = [];\r\n    public notes: Note[] = [];\r\n    public relationships: any = {\r\n        // subtechnique subtechnique-of technique\r\n        // ID of technique to [] of subtechnique IDs\r\n        subtechniques_of: new Map<string, string[]>(),\r\n        // data component related to technique\r\n        // ID of data component to [] of technique IDs\r\n        component_rel: new Map<string, string[]>(),\r\n        // group uses technique\r\n        // ID of group to [] of technique IDs\r\n        group_uses: new Map<string, string[]>(),\r\n        // software uses technique\r\n        // ID of software to [] of technique IDs\r\n        software_uses: new Map<string, string[]>(),\r\n        // campaign uses technique\r\n        // ID of campaign to [] of technique IDs\r\n        campaign_uses: new Map<string, string[]>(),\r\n        // campaigns attributed to group\r\n        // ID of group to [] of campaign IDs\r\n        campaigns_attributed_to: new Map<string, string[]>(),\r\n        // mitigation mitigates technique\r\n        // ID of mitigation to [] of technique IDs\r\n        mitigates: new Map<string, string[]>(),\r\n        // object is revoked-by object\r\n        // ID of object to ID of revoking object\r\n        revoked_by: new Map<string, string>()\r\n    }\r\n\r\n    constructor(domain_identifier: string, name: string, version: Version, urls?: string[]) {\r\n        this.id = `${domain_identifier}-${version.number}`;\r\n        this.domain_identifier = domain_identifier;\r\n        this.name = name;\r\n        this.version = version;\r\n        if (urls) this.urls = urls;\r\n    }\r\n\r\n    /**\r\n     * Get the version number for this domain\r\n     */\r\n    getVersion(): string {\r\n        return this.version.number;\r\n    }\r\n}\r\nexport class Version {\r\n    public readonly name: string;\r\n    public readonly number: string;\r\n\r\n    /**\r\n     * Creates an instance of Version\r\n     * @param name version name\r\n     * @param number version number\r\n     */\r\n    constructor(name: string, number: string) {\r\n        this.name = name;\r\n        this.number = number;\r\n    }\r\n}\r\n\r\nexport interface ServiceAuth {\r\n    enabled: boolean;\r\n    serviceName: string;\r\n    apiKey: string;\r\n}\r\n","import { Component, ViewChild, HostListener, OnInit } from '@angular/core';\r\nimport { Title } from '@angular/platform-browser';\r\nimport { TabsComponent } from './tabs/tabs.component';\r\nimport { ConfigService } from './config.service';\r\nimport * as globals from \"./globals\";\r\nimport { IconsService } from \"./icons.service\";\r\nimport { deleteCookie, getCookie, hasCookie, setCookie } from \"./cookies\";\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss'],\r\n})\r\nexport class AppComponent implements OnInit {\r\n  @ViewChild(TabsComponent) tabsComponent;\r\n\r\n  nav_version: string = globals.nav_version;\r\n  public user_theme: string;\r\n  title = 'ATT&CK Navigator';\r\n\r\n  @HostListener('window:beforeunload', ['$event'])\r\n  promptNavAway($event) {\r\n    if (!this.configService.getFeature('leave_site_dialog')) return;\r\n    //this text only shows in the data, not visible to user as far as I can tell\r\n    //however, if it's not included the window doesn't open.\r\n    $event.returnValue = 'Are you sure you want to navigate away? Your data may be lost!';\r\n  }\r\n\r\n  constructor(public configService: ConfigService, private iconsService: IconsService, private titleService:Title) {\r\n    Array.prototype.includes = function (value): boolean {\r\n      for (let i = 0; i < this.length; i++) {\r\n        if (this[i] === value) return true\r\n      }\r\n      return false;\r\n    }\r\n    if (hasCookie(\"is_user_theme_dark\") && getCookie(\"is_user_theme_dark\") === \"true\") {\r\n      this.user_theme = 'theme-override-dark';\r\n    } else if (getCookie(\"is_user_theme_dark\") === 'false') {\r\n      this.user_theme = 'theme-override-light';\r\n    }  else {\r\n      this.user_theme = 'theme-use-system';\r\n    }\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.iconsService.registerIcons();\r\n    this.titleService.setTitle(this.title);\r\n  }\r\n\r\n  themeChangeHandler(theme: string) {\r\n    if (theme === 'system') {\r\n      if (hasCookie(\"is_user_theme_dark\")) deleteCookie(\"is_user_theme_dark\");\r\n      this.user_theme = 'theme-use-system';\r\n    }\r\n    else {\r\n      this.user_theme = (theme === 'dark') ? 'theme-override-dark' : 'theme-override-light';\r\n      setCookie(\"is_user_theme_dark\", (theme === 'dark') ? \"true\" : \"false\", 180);\r\n    }\r\n  }\r\n}\r\n","<div [ngClass]=\"user_theme\">\r\n    <div class=\"app-container\">\r\n        <div class=\"nav-app\">\r\n            <tabs (onUserThemeChange)=\"themeChangeHandler($event)\" [userTheme]=\"user_theme\"></tabs>\r\n            <button class=\"version-footer\" (click)=\"tabsComponent.openDialog('changelog')\">MITRE ATT&CK&reg; Navigator\r\n                v{{nav_version}}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n","import { Component, OnInit, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { ViewModelsService } from '../viewmodels.service';\r\nimport { DataService } from '../data.service';\r\nimport * as globals from './../globals';\r\n\r\n@Component({\r\n    selector: 'app-version-upgrade',\r\n    templateUrl: './version-upgrade.component.html',\r\n    styleUrls: ['./version-upgrade.component.scss'],\r\n    providers: [ViewModelsService]\r\n})\r\nexport class VersionUpgradeComponent implements OnInit {\r\n\r\n    nav_version = globals.nav_version;\r\n    currVersion: string;\r\n    vmVersion: string;\r\n    layerName: string;\r\n\r\n    constructor(private dialogRef: MatDialogRef<VersionUpgradeComponent>, \r\n                public dataService: DataService,\r\n                private viewModelsService: ViewModelsService,\r\n                @Inject(MAT_DIALOG_DATA) public data) { }\r\n\r\n    ngOnInit() { \r\n        this.currVersion = this.data.currVersion;\r\n        this.vmVersion = this.data.vmVersion;\r\n        this.layerName = this.data.layerName;\r\n    }\r\n\r\n    upgradeVersion(upgrade: boolean) {\r\n        this.dialogRef.close({upgrade: upgrade});\r\n    }\r\n}\r\n","<div class=\"mat-dialog\">\r\n    <div>\r\n        <h3 mat-dialog-title>Upgrade layer version?</h3>\r\n        <mat-dialog-content>\r\n            <p>\r\n                The layer \"{{layerName}}\" uses an outdated version of ATT&CK (v{{vmVersion}}).\r\n                Do you want to open the workflow to upgrade this layer to ATT&CK v{{currVersion}}?\r\n                <em *ngIf=\"!this.dataService.isSupported(vmVersion)\">\r\n                    This version is not supported by Navigator v{{nav_version}} and must be upgraded for use.\r\n                </em>\r\n            </p>\r\n        </mat-dialog-content>\r\n    </div>\r\n\r\n    <div>\r\n        <mat-dialog-actions>\r\n            <button mat-button (click)=\"upgradeVersion(true)\">Yes</button>\r\n            <button mat-button (click)=\"upgradeVersion(false)\">No</button>\r\n        </mat-dialog-actions>\r\n    </div>\r\n</div>\r\n","import { Component, Inject, OnInit, Renderer2, ViewChild } from '@angular/core';\r\nimport { MAT_DIALOG_DATA, MatDialog } from \"@angular/material/dialog\";\r\nimport { MarkdownComponent, MarkdownService } from \"ngx-markdown\";\r\n\r\n@Component({\r\n  selector: 'app-changelog',\r\n  templateUrl: './changelog.component.html',\r\n  styleUrls: ['./changelog.component.scss']\r\n})\r\nexport class ChangelogComponent implements OnInit {\r\n  @ViewChild('markdownElement', {static: false}) private markdownElement: MarkdownComponent;\r\n\r\n  constructor(private dialog: MatDialog,\r\n              private markdownService: MarkdownService,\r\n              @Inject(MAT_DIALOG_DATA) public data) {}\r\n\r\n  ngOnInit(): void {\r\n  }\r\n\r\n}\r\n","<div class=\"changelog-dialog\">\r\n    <div class=\"content markdown\">\r\n        <markdown #markdownElement [src]=\"'./CHANGELOG.md'\"></markdown>\r\n    </div>\r\n    <div class=\"close-button\">\r\n        <button mat-button mat-dialog-close>close</button>\r\n    </div>\r\n</div>\r\n","import { Component, Input, OnInit, QueryList, ViewChild, ViewChildren, ViewEncapsulation } from '@angular/core';\r\nimport { ViewModel } from '../viewmodels.service';\r\nimport { DataService, Tactic, Technique, VersionChangelog } from '../data.service';\r\nimport { DndDropEvent } from 'ngx-drag-drop';\r\nimport { MatExpansionPanel } from '@angular/material/expansion';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\nimport { MatStepper } from '@angular/material/stepper';\r\n\r\n@Component({\r\n    selector: 'layer-upgrade',\r\n    templateUrl: './layer-upgrade.component.html',\r\n    styleUrls: ['./layer-upgrade.component.scss'],\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class LayerUpgradeComponent implements OnInit {\r\n    @Input() viewModel: ViewModel; // view model of new version\r\n    @ViewChildren(MatPaginator) paginators = new QueryList<MatPaginator>();\r\n    public paginator_map: Map<string, number> = new Map(); // section name mapped to index of paginator\r\n    public filteredIDs: string[] = [];\r\n\r\n    @ViewChild('stepper') stepper: MatStepper;\r\n\r\n    public changelog: VersionChangelog;\r\n    public compareTo: ViewModel; // view model of old version\r\n    public sections: string[] = [\r\n        \"additions\", \"changes\", \"minor_changes\",\r\n        \"revocations\", \"deprecations\", \"unchanged\"\r\n    ];\r\n    public filter: any = {\r\n        \"changes\": false,\r\n        \"minor_changes\": false,\r\n        \"revocations\": false,\r\n        \"deprecations\": false,\r\n        \"unchanged\": false\r\n    }\r\n    public loading: boolean = false;\r\n    \r\n    constructor(public dataService: DataService) { }\r\n\r\n    ngOnInit(): void {\r\n        this.changelog = this.viewModel.versionChangelog;\r\n        this.compareTo = this.viewModel.compareTo;\r\n        // map sections with techniques to paginator index\r\n        let i = 0;\r\n        for (let s of this.sections) {\r\n            if (this.changelog[s].length) this.paginator_map.set(s, i++);\r\n        }\r\n        this.applyFilters(this.sections[0]);\r\n        this.wait();\r\n    }\r\n\r\n    wait(): void {\r\n        this.loading = true;\r\n        setTimeout(() => this.loading = false, 1000);\r\n    }\r\n\r\n    /**\r\n     * Get a readable version for the name of the changelog section\r\n     * @param section name of the changelog section\r\n     * @returns {string} readable section header text\r\n     */\r\n    public getHeader(section: string): string {\r\n        return section.split(/[_-]+/).map((s) => s.charAt(0).toUpperCase() + s.substring(1)).join(' ');\r\n    }\r\n\r\n    /**\r\n     * Retrieve the URL for a given technique in the previous ATT&CK version\r\n     * @param attackID the ATT&CK ID of the technique\r\n     * @returns {string} the URL\r\n     */\r\n    public getPreservedURL(attackID: string): string {\r\n        let url = this.getTechnique(attackID, this.compareTo).url;\r\n        let i = url.search('/techniques');\r\n        return url.substring(0, i) + '/versions/v' + this.compareTo.version + url.substring(i);\r\n    }\r\n\r\n    /**\r\n     * Disable the annotated techniques filter?\r\n     * @param section the name of the changelog section\r\n     * @returns true if there are no annotated techniques in the given section, false otherwise\r\n     */\r\n    public disableFilter(section: string): boolean {\r\n        return !this.changelog[section].filter(id => this.anyAnnotated(id)).length\r\n    }\r\n\r\n    /**\r\n     * Apply filters to the changelog section\r\n     * @returns the list of filtered ATT&CK IDs in the changelog section\r\n     */\r\n    public applyFilters(section: string): void {\r\n        let sectionIDs = this.changelog[section];\r\n        if (this.filter[section]) sectionIDs = sectionIDs.filter(id => this.anyAnnotated(id));\r\n\r\n        let i = this.paginator_map.get(section);\r\n        let paginator = this.paginators.toArray()[i];\r\n        if (paginator && (paginator.pageIndex * paginator.pageSize > sectionIDs.length)) {\r\n            paginator.pageIndex = 0;\r\n        }\r\n        let start = paginator? paginator.pageIndex * paginator.pageSize : 0;\r\n        let end = paginator? start + paginator.pageSize : 10;\r\n        this.filteredIDs = sectionIDs.slice(start, end);\r\n    }\r\n\r\n    /**\r\n     * Update the list of IDs to render on step change\r\n     * @param section the name of the changelog section\r\n     * @param offset -1 if moving to the previous step, 1 if moving to the next step\r\n     */\r\n    public onStepChange(section: string, offset: number): void {\r\n        let i = this.sections.findIndex(s => s === section);\r\n        if (i + offset < this.sections.length) {\r\n            let nextSection = this.sections[i + offset];\r\n            this.applyFilters(nextSection);\r\n            if (this.changelog[nextSection].length > 0) this.wait();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the technique object in the domain of the given view model\r\n     * @param attackID the ATT&CK ID of the technique\r\n     * @param vm the view model\r\n     * @param section name of the changelog section\r\n     * @returns {Technique} the technique object\r\n     */\r\n    public getTechnique(attackID: string, vm: ViewModel, section?: string): Technique {\r\n        let domain = this.dataService.getDomain(vm.domainVersionID);\r\n        let all_techniques = domain.techniques.concat(domain.subtechniques);\r\n        let technique = all_techniques.find(t => t.attackID == attackID);\r\n\r\n        if (section == 'revocations' && this.viewModel.version == vm.version) {\r\n            // get revoking object\r\n            let revokedByID = technique.revoked_by(vm.domainVersionID);\r\n            let revokingObject = all_techniques.find(t => t.id == revokedByID);\r\n            return revokingObject;\r\n        } else return technique;\r\n    }\r\n\r\n    /**\r\n     * Get the list of tactic objects the given technique is found under \r\n     * @param attackID the ATT&CK ID of the object\r\n     * @param vm the view model used to identify the domain\r\n     * @param section name of the changelog section\r\n     * @returns {Tactic[]} list of tactic objects the object is found under\r\n     */\r\n    public getTactics(attackID: string, vm: ViewModel, section?: string): Tactic[] {\r\n        if (section == 'additions') vm = this.viewModel;\r\n        let technique = this.getTechnique(attackID, vm, section);\r\n        let domain = this.dataService.getDomain(vm.domainVersionID);\r\n        return technique.tactics.map(shortname => domain.tactics.find(t => t.shortname == shortname));\r\n    }\r\n\r\n    /**\r\n     * Determine if the lists of tactics between the technique in the new version and\r\n     * old version are the same\r\n     * @param attackID the ATT&CK ID of the object\r\n     * @param section name of the changelog section\r\n     * @returns {boolean} true if the list of tactics are not identical\r\n     */\r\n    public tacticsChanged(attackID: string, section: string): boolean {\r\n        if (section == 'deprecations' || section == 'additions') return false;\r\n        \r\n        let oldTechnique = this.getTechnique(attackID, this.compareTo);\r\n        let newTechnique = this.getTechnique(attackID, this.viewModel, section);\r\n\r\n        if (!oldTechnique.tactics && !newTechnique.tactics) return false;\r\n        if (oldTechnique.tactics.length !== newTechnique.tactics.length) return true;\r\n\r\n        // order lists and compare\r\n        let sortArray = function (a, b) {\r\n            if (a < b) return -1;\r\n            if (a > b) return 1;\r\n            return 0;\r\n        };\r\n        let oldTactics = oldTechnique.tactics.sort(sortArray);\r\n        let newTactics = newTechnique.tactics.sort(sortArray);\r\n        if (oldTactics.every((value, i) => value === newTactics[i])) return false;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Determine if the technique is marked as reviewed\r\n     * @param attackID the ATT&CK ID of the technique\r\n     * @returns {boolean} true if the technique has been marked as reviewed\r\n     */\r\n    public isReviewed(attackID: string): boolean {\r\n        return this.changelog.reviewed.has(attackID);\r\n    }\r\n\r\n    /**\r\n     * Marks or unmarks a single given technique as reviewed\r\n     * @param attackID the ATT&CK ID of the technique\r\n     * @param panel the object's expansion panel\r\n     */\r\n    public reviewedChanged(attackID: string, panel: MatExpansionPanel): void {\r\n        if (this.isReviewed(attackID)) {\r\n            this.changelog.reviewed.delete(attackID);\r\n        } else {\r\n            this.changelog.reviewed.add(attackID);\r\n            panel.expanded = false; // close on review\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the number of techniques marked as reviewed in the given section\r\n     * @param section the name of the changelog section\r\n     * @returns number of reviewed techniques\r\n     */\r\n    public countReviewed(section: string): number {\r\n        return this.changelog[section].filter(attackID => this.changelog.reviewed.has(attackID)).length;\r\n    }\r\n\r\n    // changelog section descriptions\r\n    private descriptions: any = {\r\n        \"additions\": \"The following techniques have been added to the dataset since the layer was created. You can review the techniques below to identify which may require annotations. Annotations may be added using the 'technique controls' in the toolbar.\",\r\n        \"changes\": \"The following techniques have undergone major changes since the layer was created such as changes to scope or technique name. You can view the annotations you had previously added, map them to the current ATT&CK version, and adjust them as needed. You can also review the previous and current technique definitions by clicking the version numbers in each row.\",\r\n        \"minor_changes\": \"The following techniques have had minor revisions since the layer was created such as typo corrections. The annotations have automatically been copied for these techniques, but you can review them if desired. You can also view the previous and current technique definitions by clicking the version numbers under the technique.\",\r\n        \"revocations\": \"These are techniques which have been replaced by other techniques since the layer was created. You can view the replacing techniques and transfer annotations from the replaced techniques, adjusting them as nessecary. You can also review the replaced and replacing technique definitions by clicking the version numbers under the technique.\",\r\n        \"deprecations\": \"These are techniques which have been removed from the dataset. You can view any annotations you had previously added to these techniques.\",\r\n        \"unchanged\": \"These are techniques which have not changed since the uploaded layer's ATT&CK version. The annotations have automatically been copied for these techniques, but you can review them if desired.\",\r\n        \"finish\": \"The overview below indicates either the number of techniques you have reviewed in a section, if you have skipped a section, or if there are no techniques to review in that section. Annotations mapped to the current version have been saved to the new layer.\\n\\nVerify your changes and click 'Done' to complete the layer upgrade workflow. Once completed you cannot return to this workflow.\"\r\n    }\r\n\r\n    /**\r\n     * Get the changelog section description\r\n     * @param section the name of the changelog section\r\n     * @returns the section description\r\n     */\r\n    public getDescription(section: string): string {\r\n        return this.descriptions[section];\r\n    }\r\n\r\n    /**\r\n     * Determine if any techniqueVM in the old version with the given\r\n     * ATT&CK ID has annotations\r\n     * @param attackID the ATT&CK ID of the technique\r\n     * @returns {boolean} true if any TechniqueVM for this technique is annotated\r\n     */\r\n     public anyAnnotated(attackID: string): boolean {\r\n        let oldTechnique = this.getTechnique(attackID, this.compareTo);\r\n        if (oldTechnique) {\r\n            let technique_tactic_ids = oldTechnique.get_all_technique_tactic_ids();\r\n\r\n            for (let id of technique_tactic_ids) {\r\n                if (this.compareTo.getTechniqueVM_id(id).annotated()) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Is the TechniqueVM for this technique-tactic annotated?\r\n     * @param technique the technique in the old version\r\n     * @param tactic the tactic the technique is found under\r\n     * @param vm the view model\r\n     * @returns {boolean} true if the TechniqueVM is annotated, false otherwise\r\n     */\r\n    public isAnnotated(technique: Technique, tactic: Tactic, vm: ViewModel): boolean {\r\n        return vm.getTechniqueVM(technique, tactic).annotated();\r\n    }\r\n\r\n    /**\r\n     * Get the total number of techniques currently displayed in a given section\r\n     * @param section the name of the changelog section\r\n     * @returns the total number of annotated techniques in the section if the filter is enabled,\r\n     * otherwise the total number of techniques in the seciton\r\n     */\r\n    public sectionLength(section: string): number {\r\n        if (this.filter[section]) return this.changelog[section].filter(attackID => this.anyAnnotated(attackID)).length;\r\n        else return this.changelog[section].length;\r\n    }\r\n\r\n    /**\r\n     * Determine if the annotations of the technique under the given tactic\r\n     * in the old version have been copied to the new version\r\n     * @param technique the technique in the old version\r\n     * @param tactic the tactic the technique is found under\r\n     * @returns {boolean} true if the annotations have been copied to the\r\n     * object in the new version\r\n     */\r\n    public isCopied(technique: Technique, tactic: Tactic): boolean {\r\n        if (this.changelog.copied.has(technique.get_technique_tactic_id(tactic))) return true;\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Copy the annotations from the technique in the old version\r\n     * to the technique in the new version\r\n     * @param attackID the ATT&CK ID of the technique\r\n     * @param tactic the tactic the technique is found under\r\n     */\r\n    public copyAnnotations(attackID: string, tactic: Tactic, section: string): void {\r\n        let fromTechnique = this.getTechnique(attackID, this.compareTo);\r\n        let toTechnique = this.getTechnique(attackID, this.viewModel, section);\r\n        this.viewModel.copyAnnotations(fromTechnique, toTechnique, tactic);\r\n    }\r\n\r\n    /**\r\n     * Re-enable the annotations on the technique in the old version and\r\n     * reset the annotations on the technique in the new version\r\n     * @param attackID the ATT&CK ID of the technique\r\n     * @param tactic the tactic the technique is found under\r\n     */\r\n    public revertCopy(attackID: string, tactic: Tactic, section: string): void {\r\n        let fromTechnique = this.getTechnique(attackID, this.compareTo);\r\n        let toTechnique = this.getTechnique(attackID, this.viewModel, section);\r\n        this.viewModel.revertCopy(fromTechnique, toTechnique, tactic);\r\n    }\r\n\r\n    /**\r\n     * Copy the annotations from the TechniqueVM in the old version\r\n     * to the TechniqueVM that the element was dropped over\r\n     * @param event the ngx drop event\r\n     * @param toTechnique the technique object to copy annotations to\r\n     * @param toTactic the tactic object to copy annotations to\r\n     * @param section the name of the changelog section\r\n     */\r\n    public onDrop(event: DndDropEvent, toTechnique: Technique, toTactic: Tactic, section: string): void {\r\n        let attackID = event.data.split(\"^\")[0];\r\n        let validTechnique = this.getTechnique(attackID, this.viewModel, section);\r\n\r\n        if (validTechnique.id === toTechnique.id) { // copying annotations to a valid target?\r\n            // retrieve relevant technique VMs\r\n            let fromTvm = this.compareTo.getTechniqueVM_id(event.data);\r\n            let toTvm = this.viewModel.getTechniqueVM(toTechnique, toTactic);\r\n\r\n            // copy annotations\r\n            let rep = fromTvm.serialize();\r\n            toTvm.resetAnnotations();\r\n            toTvm.deSerialize(rep, toTechnique.attackID, toTactic.shortname);\r\n            this.viewModel.updateScoreColor(toTvm);\r\n        } else {} // invalid target\r\n    }\r\n\r\n    /**\r\n     * Remove all annotations from the VM\r\n     * @param technique the technique object to remove annotations from\r\n     * @param tactic the tactic the technique is found under\r\n     */\r\n    public clearAnnotations(technique: Technique, tactic: Tactic): void {\r\n        this.viewModel.getTechniqueVM(technique, tactic).resetAnnotations();\r\n    }\r\n\r\n    /**\r\n     * Close the layer upgrade sidebar\r\n     */\r\n    public closeSidebar(): void {\r\n        this.viewModel.sidebarOpened = !this.viewModel.sidebarOpened;\r\n        this.viewModel.sidebarContentType = '';\r\n    }\r\n}","<link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\r\n\r\n<div class=\"layer-upgrade\">\r\n    <mat-card>\r\n        <mat-card-content>\r\n            <!-- title -->\r\n            <div class=\"title\">\r\n                <h2>Layer Upgrade</h2>\r\n                (ATT&CK v{{compareTo.version}} <mat-icon inline=\"true\">east</mat-icon> ATT&CK v{{viewModel.version}})\r\n            </div>\r\n            <p>\r\n                Review techniques which have been added, changed, replaced, or removed\r\n                from the knowledge base since ATT&CK v{{compareTo.version}} and update \r\n                your Navigator layer to reflect these changes.\r\n            </p>\r\n            <p>\r\n                <a href=\"https://attack.mitre.org/resources/versions/\" target=\"_blank\">\r\n                    View Versions of ATT&CK\r\n                </a>\r\n            </p>\r\n        </mat-card-content>\r\n    </mat-card>\r\n\r\n    <mat-divider></mat-divider>\r\n\r\n    <mat-vertical-stepper #stepper linear>\r\n        <mat-step *ngFor=\"let section of sections\">\r\n            <ng-template matStepLabel>Review {{getHeader(section)}}</ng-template>\r\n\r\n            <div *ngIf=\"getDescription(section) as desc\" class=\"description\">\r\n                <span>{{desc}}</span>\r\n            </div>\r\n\r\n            <mat-divider></mat-divider>\r\n\r\n            <div *ngIf=\"changelog[section].length > 0\">\r\n                <div *ngIf=\"section !== 'additions'\">\r\n                    <h4>Filters</h4>\r\n                    <input id=\"filter_{{section}}\" \r\n                        class=\"checkbox-custom\" type=\"checkbox\" \r\n                        [disabled]=\"disableFilter(section)\"\r\n                        [(ngModel)]=\"filter[section]\"\r\n                        (change)=\"applyFilters(section)\">\r\n                    <label for=\"filter_{{section}}\"  class=\"checkbox-custom-label noselect\" [class.disabled]=\"disableFilter(section)\"\r\n                        matTooltipPosition=\"above\" [matTooltip]=\"disableFilter(section) ? 'no annotated techniques' : ''\">\r\n                        show annotated techniques only\r\n                    </label>\r\n                </div>\r\n\r\n                <div class=\"spinner\" *ngIf=\"loading\">\r\n                    <mat-progress-spinner mode=\"indeterminate\"></mat-progress-spinner>\r\n                </div>\r\n\r\n                <ng-container *ngIf=\"stepper ? section == sections[stepper.selectedIndex] : section == sections[0]\">\r\n                    <div class=\"stepper-content\" *ngIf=\"!loading\">\r\n                        <mat-accordion>\r\n                            <mat-expansion-panel *ngFor=\"let attackID of filteredIDs\" #panel=\"matExpansionPanel\">\r\n                                <mat-expansion-panel-header>\r\n                                    <mat-panel-title>\r\n                                        <mat-icon *ngIf=\"isReviewed(attackID)\" class=\"reviewed\">check_circle_outline</mat-icon>\r\n                                        <mat-icon *ngIf=\"!isReviewed(attackID)\" class=\"disabled\">radio_button_unchecked</mat-icon>\r\n                                        <span>{{attackID}}: {{getTechnique(attackID, viewModel).name}}</span>\r\n                                    </mat-panel-title>\r\n                                </mat-expansion-panel-header>\r\n\r\n                                <ng-template matExpansionPanelContent>\r\n\r\n                                    <div class=\"cols\">\r\n                                        <div class=\"float wide\" *ngIf=\"section !== 'additions'\">\r\n                                            <div class=\"version\">\r\n                                                <a href=\"{{getPreservedURL(attackID)}}\" target=\"_blank\">ATT&CK v{{compareTo.version}}</a>\r\n                                            </div>\r\n                                            <mat-divider></mat-divider>\r\n                                        </div>\r\n                                        <div class=\"float arrow\" *ngIf=\"section !== 'additions' && section !== 'deprecations'\">\r\n                                            <mat-icon inline=\"true\">east</mat-icon>\r\n                                        </div>\r\n                                        <div class=\"float wide\" *ngIf=\"section !== 'deprecations'\">\r\n                                            <div class=\"version\">\r\n                                                <a href=\"{{getTechnique(attackID, viewModel, section).url}}\" target=\"_blank\">ATT&CK v{{viewModel.version}}</a>\r\n                                            </div>\r\n                                            <mat-divider></mat-divider>\r\n                                        </div>\r\n                                    </div>\r\n                    \r\n                                    <div class=\"cols\" *ngIf=\"tacticsChanged(attackID, section)\">\r\n                                        <div class=\"float wide\" *ngIf=\"getTechnique(attackID, compareTo) as oldTechnique\">\r\n                                            <div class=\"changelog-cells\" *ngFor=\"let tactic of getTactics(attackID, compareTo)\">\r\n                                                <div [dndDraggable]=\"oldTechnique.get_technique_tactic_id(tactic)\">\r\n                                                    <changelog-cell\r\n                                                        [tactic]=\"tactic\"\r\n                                                        [technique]=\"oldTechnique\" \r\n                                                        [viewModel]=\"compareTo\"\r\n                                                        [isCurrentVersion]=\"false\"\r\n                                                        [isDraggable]=\"true\"\r\n                                                        [section]=\"section\">\r\n                                                    </changelog-cell>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                    \r\n                                        <div class=\"float arrow\">\r\n                                            <mat-icon class=\"info\" matTooltipPosition=\"above\" \r\n                                                matTooltip='Drag and drop to copy annotations to the desired tactics in ATT&CK v{{viewModel.version}}.'>\r\n                                                info_outline\r\n                                            </mat-icon>\r\n                                        </div>\r\n                    \r\n                                        <div class=\"float wide\" *ngIf=\"getTechnique(attackID, viewModel, section) as newTechnique\">\r\n                                            <div class=\"changelog-cells\" *ngFor=\"let tactic of getTactics(attackID, viewModel, section)\"\r\n                                                dndDropzone (dndDrop)=\"onDrop($event, newTechnique, tactic, section)\">\r\n                                                <changelog-cell\r\n                                                    [tactic]=\"tactic\"\r\n                                                    [technique]=\"newTechnique\" \r\n                                                    [viewModel]=\"viewModel\"\r\n                                                    [isCurrentVersion]=\"true\"\r\n                                                    [section]=\"section\">\r\n                                                </changelog-cell>\r\n                    \r\n                                                <span class=\"clear-annotations\" *ngIf=\"isAnnotated(newTechnique, tactic, viewModel)\"\r\n                                                    matTooltipPosition=\"above\" matTooltip=\"clear annotations\"\r\n                                                    (click)=\"clearAnnotations(newTechnique, tactic)\">x</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                    \r\n                                    <div *ngIf=\"!tacticsChanged(attackID, section)\">\r\n                                        <table class=\"changelog-table\">\r\n                                            <tr *ngFor=\"let tactic of getTactics(attackID, compareTo, section)\">\r\n                                                <td *ngIf=\"section !== 'additions'\">\r\n                                                    <changelog-cell\r\n                                                        [tactic]=\"tactic\"\r\n                                                        [technique]=\"getTechnique(attackID, compareTo)\" \r\n                                                        [viewModel]=\"compareTo\"\r\n                                                        [isCurrentVersion]=\"false\"\r\n                                                        [section]=\"section\">\r\n                                                    </changelog-cell>\r\n                                                </td>\r\n                                                <td class=\"narrow button-container\" *ngIf=\"section !== 'additions' && section !== 'deprecations'\">\r\n                                                    <button class=\"button\" matTooltipPosition=\"above\" matTooltip=\"copy annotations\"\r\n                                                        [disabled]=\"isCopied(getTechnique(attackID, compareTo), tactic) || !anyAnnotated(attackID)\"\r\n                                                        (click)=\"copyAnnotations(attackID, tactic, section)\"><mat-icon inline=\"true\">chevron_right</mat-icon></button>\r\n                                                    <button class=\"button\" matTooltipPosition=\"above\" matTooltip=\"revert copy\"\r\n                                                        [disabled]=\"!isCopied(getTechnique(attackID, compareTo), tactic)\"\r\n                                                        (click)=\"revertCopy(attackID, tactic, section)\"><mat-icon inline=\"true\">chevron_left</mat-icon></button>\r\n                                                </td>\r\n                                                <td *ngIf=\"section !== 'deprecations'\">\r\n                                                    <changelog-cell\r\n                                                        [tactic]=\"tactic\"\r\n                                                        [technique]=\"getTechnique(attackID, viewModel, section)\" \r\n                                                        [viewModel]=\"viewModel\"\r\n                                                        [isCurrentVersion]=\"true\"\r\n                                                        [section]=\"section\">\r\n                                                    </changelog-cell>\r\n                                                </td>\r\n                                            </tr>\r\n                                        </table>\r\n                                    </div>\r\n                    \r\n                    \r\n                                    <div class=\"checkbox right\">\r\n                                        <input id=\"review_{{attackID}}\" class=\"checkbox-custom\" type=\"checkbox\"\r\n                                            [checked]=\"isReviewed(attackID)\" (click)=\"reviewedChanged(attackID, panel)\">\r\n                                        <label for=\"review_{{attackID}}\" class=\"checkbox-custom-label noselect\">reviewed</label>\r\n                                    </div>\r\n\r\n                                </ng-template>\r\n\r\n                            </mat-expansion-panel>\r\n                        </mat-accordion>\r\n                    </div>\r\n                </ng-container>\r\n                <mat-paginator [hidePageSize]=\"true\" pageSize=\"10\" (page)=\"applyFilters(section)\" [length]=\"sectionLength(section)\"></mat-paginator>\r\n            </div>\r\n\r\n            <div *ngIf=\"changelog[section].length == 0 && !loading\">\r\n                <div class=\"description center\">\r\n                    No objects to show\r\n                </div>\r\n            </div>\r\n\r\n            <mat-divider></mat-divider>\r\n\r\n            <div class=\"stepper-button\">\r\n                <span *ngIf=\"changelog[section].length > 0\">Reviewed {{countReviewed(section)}}/{{sectionLength(section)}} techniques</span>\r\n\r\n                <button *ngIf=\"section !== 'additions'\" mat-stroked-button matStepperPrevious (click)=\"onStepChange(section, -1)\">Back</button>\r\n                <button mat-stroked-button matStepperNext (click)=\"onStepChange(section, 1)\">{{countReviewed(section) > 0 ? 'Next' : 'Skip'}}</button>\r\n            </div>\r\n        </mat-step>\r\n\r\n        <mat-step>\r\n            <ng-template matStepLabel>Finish</ng-template>\r\n\r\n            <div class=\"description\">\r\n                <span>{{getDescription('finish')}}</span>\r\n            </div>\r\n\r\n            <mat-divider></mat-divider>\r\n\r\n            <h4>Overview</h4>\r\n            <div class=\"summary\" *ngFor=\"let section of sections\">\r\n                <span>{{getHeader(section)}}:&nbsp;</span>\r\n                <span *ngIf=\"countReviewed(section) > 0\">Reviewed {{countReviewed(section)}}/{{sectionLength(section)}} {{filter[section] ? 'annotated': ''}} techniques</span>\r\n                <span *ngIf=\"!changelog[section].length\">No objects to review</span>\r\n                <span *ngIf=\"changelog[section].length && countReviewed(section) == 0\">Skipped</span>\r\n            </div>\r\n\r\n            <mat-divider></mat-divider>\r\n\r\n            <div class=\"stepper-button\">\r\n                <button mat-stroked-button matStepperPrevious>Back</button>\r\n                <button mat-stroked-button (click)=\"closeSidebar()\">Done</button>\r\n            </div>\r\n        </mat-step>\r\n    </mat-vertical-stepper>\r\n</div>","import { BrowserModule, Title } from '@angular/platform-browser';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\nimport { NgModule } from '@angular/core';\r\nimport 'rxjs/add/operator/map'\r\n\r\n// material\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatExpansionModule } from '@angular/material/expansion';\r\nimport { MatSidenavModule } from '@angular/material/sidenav';\r\nimport { ColorPickerModule } from 'ngx-color-picker';\r\nimport { DndModule } from 'ngx-drag-drop';\r\nimport { PopoverModule } from 'ngx-smart-popover';\r\nimport { HttpClientModule } from '@angular/common/http';\r\n\r\nimport { AppComponent } from './app.component';\r\nimport { DataTableComponent } from './datatable/data-table.component';\r\nimport { TabsComponent } from './tabs/tabs.component';\r\nimport { HelpComponent } from './help/help.component';\r\nimport { ExporterComponent } from './exporter/exporter.component';\r\nimport { TechniqueCellComponent } from './matrix/technique-cell/technique-cell.component';\r\nimport { MatrixSideComponent } from './matrix/matrix-side/matrix-side.component';\r\nimport { MatrixFlatComponent } from './matrix//matrix-flat/matrix-flat.component';\r\nimport { MatrixMiniComponent } from './matrix//matrix-mini/matrix-mini.component';\r\nimport { TooltipComponent } from './matrix/technique-cell/tooltip/tooltip.component';\r\nimport { SearchAndMultiselectComponent } from './search-and-multiselect/search-and-multiselect.component';\r\nimport { ContextmenuComponent } from './matrix/technique-cell/contextmenu/contextmenu.component';\r\nimport { TacticCellComponent } from './matrix/tactic-cell/tactic-cell.component';\r\nimport { VersionUpgradeComponent } from './version-upgrade/version-upgrade.component';\r\nimport { SidebarComponent } from './sidebar/sidebar.component';\r\nimport { LayerUpgradeComponent } from './layer-upgrade/layer-upgrade.component';\r\nimport { ChangelogCellComponent } from './layer-upgrade/changelog-cell/changelog-cell.component';\r\nimport { MatCardModule } from \"@angular/material/card\";\r\nimport { MatDividerModule } from \"@angular/material/divider\";\r\nimport { MatStepperModule } from '@angular/material/stepper';\r\nimport { MatPaginatorModule } from '@angular/material/paginator';\r\n\r\n\r\nimport { MarkdownModule } from \"ngx-markdown\";\r\nimport { LayerInformationComponent } from './layer-information/layer-information.component';\r\nimport { ChangelogComponent } from './changelog/changelog.component';\r\nimport { MatTabsModule } from \"@angular/material/tabs\";\r\nimport { ListInputComponent } from './list-input/list-input.component';\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    AppComponent,\r\n    DataTableComponent,\r\n    TabsComponent,\r\n    HelpComponent,\r\n    ExporterComponent,\r\n    TechniqueCellComponent,\r\n    MatrixSideComponent,\r\n    MatrixFlatComponent,\r\n    MatrixMiniComponent,\r\n    TooltipComponent,\r\n    SearchAndMultiselectComponent,\r\n    ContextmenuComponent,\r\n    TacticCellComponent,\r\n    VersionUpgradeComponent,\r\n    SidebarComponent,\r\n    LayerUpgradeComponent,\r\n    ChangelogCellComponent,\r\n    LayerInformationComponent,\r\n    ChangelogComponent,\r\n    ListInputComponent,\r\n  ],\r\n  imports: [\r\n    BrowserModule,\r\n    HttpClientModule,\r\n    BrowserAnimationsModule,\r\n    MatSelectModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatInputModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatProgressSpinnerModule,\r\n    MatCheckboxModule,\r\n    MatTooltipModule,\r\n    MatMenuModule,\r\n    MatExpansionModule,\r\n    MatDialogModule,\r\n    ColorPickerModule,\r\n    DndModule,\r\n    MatSidenavModule,\r\n    MatCardModule,\r\n    MatDividerModule,\r\n    MatStepperModule,\r\n    MatPaginatorModule,\r\n    MarkdownModule.forRoot(),\r\n    PopoverModule,\r\n    MatTabsModule\r\n  ],\r\n  exports: [\r\n      MatSelectModule,\r\n      MatInputModule,\r\n      MatButtonModule,\r\n      MatIconModule,\r\n      MatTooltipModule,\r\n      MatMenuModule,\r\n      MatExpansionModule,\r\n      MatTabsModule,\r\n  ],\r\n  providers: [\r\n    Title\r\n  ],\r\n  bootstrap: [AppComponent],\r\n  entryComponents: [ VersionUpgradeComponent, HelpComponent, ExporterComponent ]\r\n})\r\nexport class AppModule { }","// https://embed.plnkr.co/wWKnXzpm8V31wlvu64od/\r\nimport { Component, AfterContentInit, ViewChild, TemplateRef, AfterViewInit, ViewEncapsulation, Input, Output, EventEmitter } from '@angular/core';\r\nimport { DataService, Domain, Technique, Version } from '../data.service'; //import the DataService component so we can use it\r\nimport { ConfigService } from '../config.service';\r\nimport * as is from 'is_js';\r\nimport { forkJoin } from 'rxjs';\r\nimport { VersionUpgradeComponent } from '../version-upgrade/version-upgrade.component';\r\nimport { HelpComponent } from '../help/help.component';\r\nimport { ExporterComponent } from '../exporter/exporter.component';\r\nimport { ViewModelsService, ViewModel } from \"../viewmodels.service\";\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport * as globals from './../globals';\r\nimport { ChangelogComponent } from \"../changelog/changelog.component\";\r\n\r\n@Component({\r\n    selector: 'tabs',\r\n    templateUrl: './tabs.component.html',\r\n    styleUrls: ['./tabs.component.scss'],\r\n    providers: [ViewModelsService],\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class TabsComponent implements AfterContentInit, AfterViewInit {\r\n    @Input() userTheme: string;\r\n    @Output() onUserThemeChange = new EventEmitter<string>();\r\n    //  _____ _   ___   ___ _____ _   _ ___ ___\r\n    // |_   _/_\\ | _ ) / __|_   _| | | | __| __|\r\n    //   | |/ _ \\| _ \\ \\__ \\ | | | |_| | _|| _|\r\n    //   |_/_/ \\_\\___/ |___/ |_|  \\___/|_| |_|\r\n\r\n\r\n    ds: DataService = null;\r\n    vms: ViewModelsService = null;\r\n    activeTab: Tab = null;\r\n    dropdownEnabled = '';\r\n    layerTabs: Tab[] = [];\r\n    adjustedHeaderHeight = 0;\r\n    techniques: Technique[] = [];\r\n\r\n    nav_version = globals.nav_version;\r\n\r\n    constructor(private dialog: MatDialog, private viewModelsService: ViewModelsService, private dataService: DataService, private http: HttpClient, private configService: ConfigService) {\r\n        console.log(\"tabs component initializing\");\r\n        this.ds = dataService;\r\n        this.viewModelsService = viewModelsService;\r\n    }\r\n\r\n    @ViewChild('safariWarning') safariWarning : TemplateRef<any>;\r\n\r\n    ngAfterContentInit() {\r\n        let subscription = this.ds.getConfig().subscribe({\r\n            next: (config: Object) => {\r\n                this.newBlankTab();\r\n                this.loadTabs(config[\"default_layers\"]).then( () => {\r\n                    if (this.layerTabs.length == 0) {\r\n                        this.newLayer(this.dataService.domains[0].id); // failed load from url, so create new blank layer\r\n                    }\r\n                    // let activeTabs = this.layerTabs.filter((tab)=>tab.active);\r\n\r\n                    // if there is no active tab set, activate the first\r\n                    if(!this.activeTab) { this.selectTab(this.layerTabs[0]); }\r\n                });\r\n                this.customizedConfig = this.configService.getFeatureList()\r\n                this.bannerContent = this.configService.banner;\r\n            },\r\n            complete: () => { if (subscription) subscription.unsubscribe(); } //prevent memory leaks\r\n        });\r\n    }\r\n\r\n    public safariDialogRef;\r\n    ngAfterViewInit() {\r\n        if (is.safari('<=13')) {\r\n            this.safariDialogRef = this.dialog.open(this.safariWarning, {\r\n                width: '350px',\r\n                disableClose: true,\r\n                panelClass: this.userTheme\r\n            });\r\n        }\r\n    }\r\n\r\n    tabHeight = 48;\r\n    adjustHeader(newHeight) {\r\n        this.adjustedHeaderHeight = newHeight;\r\n    }\r\n\r\n    /**\r\n     * Open initial tabs on application load\r\n     */\r\n     async loadTabs(defaultLayers) {\r\n        let bundle_url = this.getNamedFragmentValue(\"bundleURL\")[0];\r\n        let bundle_version = this.getNamedFragmentValue(\"version\")[0];\r\n        let bundle_domain = this.getNamedFragmentValue(\"domain\")[0];\r\n        let fragment_value = this.getNamedFragmentValue(\"layerURL\");\r\n\r\n        if (bundle_url && bundle_url.length > 0 && bundle_version && bundle_domain && bundle_domain.length > 0) {\r\n            // load base data from URL\r\n            let self = this;\r\n            await self.newLayerFromURL({\r\n                'url': bundle_url,\r\n                'version': bundle_version,\r\n                'identifier': bundle_domain\r\n            });\r\n        } else if (fragment_value && fragment_value.length > 0) {\r\n            // load layer from URL\r\n            let first = true;\r\n            let self = this;\r\n\r\n            for (var _i = 0, urls_1 = fragment_value; _i < urls_1.length; _i++) {\r\n                var url = urls_1[_i];\r\n                await self.loadLayerFromURL(url, first, true);\r\n                first = false;\r\n            }\r\n        } else if (defaultLayers[\"enabled\"]) {\r\n            // load any default layers from config\r\n            let first = true;\r\n            let self = this;\r\n            for (let url of defaultLayers[\"urls\"]) {\r\n                await self.loadLayerFromURL(url, first, true);\r\n                first = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Open a new tab\r\n     * @param  {[type]}  title               title of new tab\r\n     * @param  {[type]}  data                data to put in template\r\n     * @param  {Boolean} [isCloseable=false] can this tab be closed?\r\n     * @param  {Boolean} [replace=false]     replace the current tab with the new tab, TODO\r\n     * @param  {Boolean} [forceNew=false]    force open a new tab even if a tab of that name already exists\r\n     * @param  {Boolean} [dataTable=false]   is this a data-table tab? if so tab text should be editable\r\n\r\n     */\r\n    openTab(title: string, data, isCloseable = false, replace = true, forceNew = false, dataTable = false) {\r\n        // determine if tab is already open. If it is, just change to that tab\r\n        if (!forceNew) {\r\n            for (let i = 0; i < this.layerTabs.length; i++) {\r\n                if (this.layerTabs[i].title === title) {\r\n                    this.selectTab(this.layerTabs[i])\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n\r\n        // create a new tab\r\n        let domain = data? data.domainVersionID : \"\";\r\n        let tab = new Tab(title, isCloseable, false, domain, dataTable);\r\n        tab.dataContext = data;\r\n\r\n        // select new tab\r\n        if (!replace || this.layerTabs.length === 0) {\r\n            this.layerTabs.push(tab); //don't replace\r\n            this.selectTab(this.layerTabs[this.layerTabs.length - 1]);\r\n        } else {\r\n            // find active tab index\r\n            for (let i = 0; i < this.layerTabs.length; i++) {\r\n                if (this.layerTabs[i] == this.activeTab) {\r\n                    this.closeActiveTab(true) //close current and don't let it create a replacement tab\r\n                    this.layerTabs.splice(i, 0, tab) //replace\r\n                    this.selectTab(this.layerTabs[i]);\r\n                    return\r\n                }\r\n            }\r\n        }\r\n        this.dropdownEnabled = '';\r\n    }\r\n\r\n    /**\r\n     * Select a given tab: deselects other tabs.\r\n     * @param  {Tab} tab tab to select\r\n     */\r\n    selectTab(tab: Tab){\r\n        // deactivate all tabs\r\n        // this.layerTabs.forEach(tab => tab.active = false);\r\n        this.activeTab = tab;\r\n        // activate the tab the user has clicked on.\r\n        // tab.active = true;\r\n        this.viewModelsService.viewModels.forEach(viewModel => {\r\n            if (viewModel.sidebarContentType === 'search') {\r\n                viewModel.sidebarOpened = false;\r\n                viewModel.sidebarContentType = \"\";\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * close a tab\r\n     * @param  {Tab} tab              tab to close\r\n     * @param  {[type]}       allowNoTab=false if true, doesn't select another tab, and won't open a new tab if there are none\r\n     */\r\n    closeTab(tab: Tab, allowNoTab=false) {\r\n        let action = 0; //controls post close-tab behavior\r\n\r\n        // destroy tab viewmodel\r\n        this.viewModelsService.destroyViewModel(tab.dataContext);\r\n\r\n        for(let i=0; i<this.layerTabs.length;i++) {\r\n            if(this.layerTabs[i] === tab) { //close this tab\r\n\r\n                if (this.layerTabs[i] == this.activeTab) { //is the tab we're closing currently open??\r\n                    if (i == 0 && this.layerTabs.length > 1) { //closing first tab, first tab is active, and more tabs exist\r\n                        action = 1;\r\n                    } else if (i > 0) { //closing not first tab, implicitly more tabs exist\r\n                        action = 2;\r\n                    } else { //else closing first tab and no other tab exist\r\n                        action = 3;\r\n                    }\r\n                }\r\n                // remove the tab from our array\r\n                this.layerTabs.splice(i,1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        // post close-tab behavior: select new tab?\r\n        if (!allowNoTab) {\r\n            switch (action) {\r\n                case 0: //should only occur if the active tab is not closed: don't select another tab\r\n                    break;\r\n                case 1: //closing the first tab, more exist\r\n                    this.selectTab(this.layerTabs[0]) // select first tab\r\n                    break;\r\n                case 2: //closing any tab other than the first\r\n                    this.selectTab(this.layerTabs[0]); //select first tab\r\n                    break;\r\n                case 3://closing first tab and no other tab exist\r\n                    this.newBlankTab(); //make a new blank tab, automatically opens this tab\r\n                    break;\r\n                default: //should never occur\r\n                    console.error(\"post closetab action not specified (this should never happen)\")\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Close the currently selected tab\r\n     * @param  {[type]} allowNoTab=false if true, doesn't select another tab, and won't open a new tab if there are none\r\n     */\r\n    closeActiveTab(allowNoTab=false) {\r\n        if (this.activeTab) this.closeTab(this.activeTab, allowNoTab);\r\n        // this.activeTab = null;\r\n        // let activeTabs = this.layerTabs.filter((tab)=>tab.active);\r\n        // if(activeTabs.length > 0)  {\r\n        //     // close the 1st active tab (should only be one at a time)\r\n        //     this.closeTab(activeTabs[0], allowNoTab);\r\n        // }\r\n    }\r\n\r\n    getActiveTab() {\r\n        return this.activeTab;\r\n        // let activeTabs = this.layerTabs.filter((tab)=>tab.active);\r\n        // return activeTabs[0];\r\n    }\r\n\r\n    handleTabClick(tab) {\r\n        if (this.activeTab !== tab) {\r\n            this.activeTab = tab;\r\n            this.dropdownEnabled = '';\r\n        }\r\n        else this.dropdownEnabled = this.dropdownEnabled !== 'description' ? 'description' : '';\r\n    }\r\n\r\n    filterDomains(version: Version) {\r\n        return this.dataService.domains.filter((d) => d.version == version)\r\n    }\r\n\r\n    hasFeature(featureName: string): boolean {\r\n        return this.configService.getFeature(featureName);\r\n    }\r\n\r\n\r\n    //  _      ___   _____ ___   ___ _____ _   _ ___ ___\r\n    // | |    /_\\ \\ / / __| _ \\ / __|_   _| | | | __| __|\r\n    // | |__ / _ \\ V /| _||   / \\__ \\ | | | |_| | _|| _|\r\n    // |____/_/ \\_\\_| |___|_|_\\ |___/ |_|  \\___/|_| |_|\r\n\r\n    /**\r\n     * open a new \"blank\" tab showing a new layer button and an open layer button\r\n     * @param  {[type]} replace=false replace the current tab with this blank tab?\r\n     */\r\n    newBlankTab(replace=false) {\r\n        this.openTab('new tab', null, true, replace, true, false)\r\n    }\r\n\r\n    showHelpDropDown: boolean = false;\r\n\r\n\r\n    handleUserThemeChange(theme) {\r\n      this.onUserThemeChange.emit(theme);\r\n    }\r\n\r\n    /**\r\n     * open the help dialog\r\n     */\r\n    openDialog(dialogName: string) {\r\n        const settings = { maxWidth: \"75ch\", panelClass: this.userTheme };\r\n        if (dialogName == 'changelog') this.dialog.open(ChangelogComponent, settings);\r\n        else if (dialogName == 'help') this.dialog.open(HelpComponent, settings);\r\n    }\r\n\r\n    /**\r\n     * open the SVG exporter dialog\r\n     * @param {ViewModel} vm    the viewModel to render\r\n     */\r\n    openSVGDialog(vm: ViewModel) {\r\n        this.dialog.open(ExporterComponent,\r\n            { data: {vm: vm},\r\n              panelClass: ['dialog-custom', this.userTheme]\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Given a unique root, returns a layer name that does not conflict any existing layers, e.g 'new layer' -> 'new layer 1'\r\n     * @param  {string} root the root string to get the non-conflicting version of\r\n     * @return {string}      non-conflicted version\r\n     */\r\n    getUniqueLayerName(root: string) {\r\n        let conflictNumber = 0;\r\n        let viewModels = this.viewModelsService.viewModels\r\n\r\n        function isInteger(str) {\r\n            var n = Math.floor(Number(str));\r\n            return String(n) === str;\r\n        }\r\n\r\n        for (let i = 0; i < viewModels.length; i++) {\r\n            if (!viewModels[i].name.startsWith(root)) continue;\r\n            if (viewModels[i].name === root) { //case where it's \"new layer\" aka  \"new layer 0\"\r\n                conflictNumber = Math.max(conflictNumber, 1);\r\n                continue;\r\n            }\r\n\r\n            let numberPortion = viewModels[i].name.substring(root.length, viewModels[i].name.length)\r\n\r\n            //find lowest number higher than existing number\r\n            if (isInteger(numberPortion)) {\r\n                conflictNumber = Math.max(conflictNumber, Number(numberPortion) + 1)\r\n            }\r\n        }\r\n        // if no layers of this name exist (conflictNumber == 0) just return root\r\n        if (conflictNumber != 0) root = root + conflictNumber\r\n        return root;\r\n    }\r\n\r\n    loadData = {\r\n        url: undefined,\r\n        version: undefined,\r\n        identifier: undefined\r\n    }\r\n\r\n    /**\r\n     * Create a new layer from URL\r\n     */\r\n    newLayerFromURL(loadData: any, obj: any = undefined) {\r\n        let domain_id = loadData.identifier.toLowerCase();\r\n        let domainVersionID = this.dataService.getDomainVersionID(domain_id, loadData.version);\r\n\r\n        // validate input data\r\n        let valid = this.validateInput(loadData, domainVersionID);\r\n        if (!valid) return;\r\n\r\n        let url = new URL(loadData.url).toString();\r\n        let subscription = this.http.get(url).subscribe({\r\n            next: (res) => {\r\n                let exists = this.dataService.domains.find(d => d.isCustom && d.id === domainVersionID);\r\n                if (!exists) {\r\n                    // create or retrieve version\r\n                    let v: Version = this.dataService.versions.find(v => v.number == loadData.version);\r\n                    if (!v) {\r\n                        v = new Version(`ATT&CK v${loadData.version}`, String(loadData.version));\r\n                        this.dataService.versions.push(v);\r\n                    }\r\n        \r\n                    // create new custom domain object\r\n                    let domainObject = new Domain(domain_id, domain_id, v, [url]);\r\n                    domainObject.isCustom = true;\r\n                    this.dataService.domains.push(domainObject);\r\n                } \r\n\r\n                this.newLayer(domainVersionID, obj);\r\n            },\r\n            error: (err) => {\r\n                console.error(err)\r\n                if (err.status == 0) {\r\n                    // no response\r\n                    alert(\"ERROR retrieving data from \" + url + \", check the javascript console for more information.\")\r\n                } else {\r\n                    // response, but not a good one\r\n                    alert(\"ERROR retrieving data from \" + url + \", check the javascript console for more information.\")\r\n                }\r\n            },\r\n            complete: () => { if (subscription) subscription.unsubscribe(); } // prevent memory leaks\r\n        })\r\n    }\r\n\r\n    validateInput(loadData: any, domainVersionID: string): boolean {\r\n        try {\r\n            // validate URL\r\n            let url = new URL(loadData.url);\r\n\r\n            // validate version\r\n            if (isNaN(loadData.version)) {\r\n                throw {message: \"version is not a number\"};\r\n            }\r\n\r\n            // validate domainVersionID is unique\r\n            let exists = this.dataService.domains.find(d => d.id == domainVersionID);\r\n            // Note: if a user inputs the same domain, version, AND url, do not check for collisions, just reload the custom dataset\r\n            if (exists && !(exists.isCustom && exists.urls[0] == url.toString())) {\r\n                throw {message: `the domain and version specified conflict with an existing set of ATT&CK data (${exists.name} ${exists.version.name})`};\r\n            }\r\n\r\n            return true;\r\n        } catch (err) {\r\n            console.error(err);\r\n            if (err instanceof TypeError) {\r\n                alert(\"ERROR: invalid url, check the javascript console for more information.\");\r\n            } else {\r\n                alert(\"ERROR \" + err.message);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create a new layer in the given domain/version\r\n     */\r\n    newLayer(domainVersionID: string, obj: any = undefined) {\r\n        // load domain data, if not yet loaded\r\n        let domain = this.dataService.getDomain(domainVersionID);\r\n        if (!domain.dataLoaded) {\r\n            this.dataService.loadDomainData(domainVersionID, true);\r\n        }\r\n\r\n        // find non conflicting name\r\n        let name;\r\n        if (obj && 'name' in obj && obj['name']) {\r\n            name = obj['name']\r\n        } else name = this.getUniqueLayerName(\"layer\")\r\n\r\n        // create and open VM\r\n        let vm = this.viewModelsService.newViewModel(name, domainVersionID);\r\n\r\n        if (obj) {\r\n            // restore the VM from the given string\r\n            vm.deSerialize(obj);\r\n        }\r\n        vm.loadVMData();\r\n        this.openTab(name, vm, true, true, true, true)\r\n    }\r\n\r\n    /**\r\n     * Get a layer score expression variable for a tab\r\n     * @param  index index of tab\r\n     * @return       char expression variable\r\n     */\r\n    indexToChar(index: number) {\r\n        let realIndex = 0;\r\n        for (let i = 0; i < index; i++) {\r\n            if (this.layerTabs[i].dataContext) realIndex++;\r\n        }\r\n        return String.fromCharCode(97+realIndex);\r\n    }\r\n\r\n    /**\r\n     * Inverse of indextoChar, maps char to the tab it corresponds to\r\n     * @param  char score expression variable\r\n     * @return      tab index\r\n     */\r\n    charToIndex(char: string): number {\r\n        // console.log(\"searching for char\", char)\r\n        let realIndex = 0;\r\n        for (let i = 0; i < this.layerTabs.length; i++) {\r\n            if (this.layerTabs[i].dataContext) {\r\n                let charHere = String.fromCharCode(97+realIndex);\r\n                realIndex++;\r\n                if (charHere == char) return i;\r\n            }\r\n        }\r\n    }\r\n\r\n    domain: string = \"\";\r\n    gradient: ViewModel = null;\r\n    coloring: ViewModel = null;\r\n    comments: ViewModel = null;\r\n    links: ViewModel = null;\r\n    metadata: ViewModel = null;\r\n    enabledness: ViewModel = null;\r\n    filters: ViewModel = null;\r\n    scoreExpression: string = \"\";\r\n    legendItems: ViewModel = null;\r\n    /**\r\n     * layer layer operation\r\n     */\r\n    layerByOperation(): void {\r\n        // build score expression map, mapping inline variables to their actual VMs\r\n        let scoreVariables = new Map<string, ViewModel>();\r\n        let regex = /\\b[a-z]\\b/g //\\b matches word boundary\r\n        let matches = this.scoreExpression.match(regex);\r\n        let self = this;\r\n        if (matches) {\r\n            matches.forEach(function(match) {\r\n                // trim\r\n                let index = self.charToIndex(match);\r\n                let vm = self.layerTabs[index].dataContext;\r\n                scoreVariables.set(match, vm);\r\n            });\r\n        }\r\n\r\n        let layerName = this.getUniqueLayerName(\"layer by operation\")\r\n        try {\r\n            // all layers must be of the same domain/version\r\n            let vms = Array.from(scoreVariables.values());\r\n            if(vms && !vms.every((vm) => vm.domainVersionID === vms[0].domainVersionID)) {\r\n                throw {message: \"cannot apply operations to layers of different domains\"};\r\n            }\r\n            let vm = this.viewModelsService.layerLayerOperation(this.domain, this.scoreExpression, scoreVariables, this.comments, this.links, this.metadata, this.gradient, this.coloring, this.enabledness, layerName, this.filters, this.legendItems)\r\n            if (!this.dataService.getDomain(this.domain).dataLoaded) {\r\n                this.dataService.loadDomainData(this.domain, true).then( () => {\r\n                    vm.loadVMData();\r\n                    vm.updateGradient();\r\n                    this.openTab(layerName, vm, true, true, true, true)\r\n                })\r\n            } else {\r\n                vm.loadVMData();\r\n                vm.updateGradient();\r\n                this.openTab(layerName, vm, true, true, true, true)\r\n            }\r\n        } catch (err) {\r\n            console.error(err)\r\n            alert(\"Layer Layer operation error: \" + err.message)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Retrieves a list of view models with the chosen domain\r\n     */\r\n    getLayers(): ViewModel[] {\r\n        return this.viewModelsService.viewModels.filter((vm) => vm.domainVersionID == this.domain)\r\n    }\r\n\r\n    /**\r\n     * Check if there's an error in the score expression (syntax, etc)\r\n     * @return error or null if no error\r\n     */\r\n    getScoreExpressionError(): string {\r\n        let self = this;\r\n        try {\r\n            // build fake scope\r\n            let regex = /\\b[a-z]\\b/g //\\b matches word boundary\r\n            let matches = self.scoreExpression.match(regex);\r\n\r\n            let scope = {}\r\n            if (matches) {\r\n                let noMatch = \"\"\r\n                matches.forEach(function(match) {\r\n                    // trim\r\n                    scope[match] = 0;\r\n                    // check if letter is too large\r\n                    if (typeof(self.charToIndex(match)) == \"undefined\") {\r\n                        noMatch = \"Variable \" + match + \" does not match any layers\"\r\n                    } else if (self.domain && self.layerTabs[self.charToIndex(match)].dataContext.domainVersionID !== self.domain) {\r\n                        noMatch = \"Layer \" + match + \" does not match the chosen domain\"\r\n                    }\r\n                });\r\n                if (noMatch.length > 0) return noMatch;\r\n            }\r\n            return null;\r\n        } catch(err) {\r\n            return err.message\r\n        }\r\n    }\r\n\r\n    /**\r\n     * open upload new layer prompt\r\n     */\r\n    openUploadPrompt(): void {\r\n        var input = (<HTMLInputElement>document.getElementById(\"uploader\"));\r\n        input.click();\r\n    }\r\n\r\n    /**\r\n     * Dialog to upgrade version if layer is not the latest version\r\n     */\r\n    versionUpgradeDialog(viewModel): Promise<any> {\r\n        let dataPromise: Promise<any> = new Promise((resolve, reject) => {\r\n            let currVersion = this.dataService.getCurrentVersion().number;\r\n            if (viewModel.version !== currVersion) { // ask to upgrade\r\n                let dialog = this.dialog.open(VersionUpgradeComponent, {\r\n                    data: {\r\n                        layerName: viewModel.name,\r\n                        vmVersion: viewModel.version,\r\n                        currVersion: currVersion\r\n                    },\r\n                    disableClose: true,\r\n                    width: \"25%\",\r\n                    panelClass: this.userTheme\r\n                });\r\n                let subscription = dialog.afterClosed().subscribe({\r\n                    next: (result) => {\r\n                        if (!result.upgrade && !this.dataService.isSupported(viewModel.version)) {\r\n                            reject(\"Uploaded layer version (\" + String(viewModel.version) + \") is not supported by Navigator v\" + globals.nav_version)\r\n                        }\r\n                        if (result.upgrade) {\r\n                            let newDomainVersionID = this.dataService.getDomainVersionID(viewModel.domain, currVersion);\r\n                            resolve({oldID: viewModel.domainVersionID, newID: newDomainVersionID});\r\n                        }\r\n                        resolve(null);\r\n                    },\r\n                    complete: () => { if (subscription) subscription.unsubscribe(); } //prevent memory leaks\r\n                });\r\n            } else resolve(null); // layer is already current version\r\n        });\r\n        return dataPromise;\r\n    }\r\n\r\n    /**\r\n     * check if the layer needs to be upgraded and initialize the layer upgrade process if the user accepts the resultant dialog\r\n     * @param oldViewModel: blank viewmodel to upgrade\r\n     * @param serialized the viewmodel's raw serialized JSON string\r\n     * @param replace: replace if true, replace the current active tab with the layer\r\n     * @param defaultLayers: is this a layer being loaded by default (from the config or query string)?\r\n     *                       if so, will act as if the user decided not to upgrade the layer\r\n     */\r\n    layerUpgrade(oldViewModel: ViewModel, serialized: any, replace: boolean, defaultLayers: boolean = false): Promise<any> {\r\n        return new Promise((resolve, reject) => {\r\n            if (!defaultLayers) { \r\n            this.versionUpgradeDialog(oldViewModel)\r\n                .then((versions) => {\r\n                    if (versions) { // user upgraded to latest version\r\n                        // create and open the latest version\r\n                        let newViewModel = this.viewModelsService.newViewModel(\"loading layer...\", undefined);\r\n                        newViewModel.name = oldViewModel.name;\r\n                        newViewModel.domainVersionID = versions.newID; // update domainVersionID to new ID\r\n                        newViewModel.version = this.dataService.getCurrentVersion().number; // update version to new ID\r\n                        newViewModel.loadVMData();\r\n                        newViewModel.compareTo = oldViewModel;\r\n                        this.openTab(\"new layer\", newViewModel, true, replace, true, true);\r\n                        newViewModel.sidebarOpened = true;\r\n                        newViewModel.sidebarContentType = 'layerUpgrade'\r\n                        newViewModel.selectTechniquesAcrossTactics = false;\r\n        \r\n                        // load layer version & latest ATT&CK version\r\n                        let loads: any = {};\r\n                        if (!this.dataService.getDomain(versions.oldID).dataLoaded) loads.old = this.dataService.loadDomainData(versions.oldID, true);\r\n                        if (!this.dataService.getDomain(versions.newID).dataLoaded) loads.new = this.dataService.loadDomainData(versions.newID, true);\r\n                        if (Object.keys(loads).length) { //needs to fetch data\r\n                            let dataSubscription = forkJoin(loads).subscribe({\r\n                                next: () => {\r\n                                    newViewModel.versionChangelog = this.dataService.compareVersions(versions.oldID, versions.newID);\r\n                                    // load vm for uploaded layer\r\n                                    oldViewModel.deSerialize(serialized);\r\n                                    oldViewModel.loadVMData();\r\n                                    newViewModel.initCopyAnnotations();\r\n                                    resolve(null);\r\n                                },\r\n                                complete: () => { dataSubscription.unsubscribe(); }\r\n                            });\r\n                        } else { // did not need to fetch data\r\n                            newViewModel.versionChangelog = this.dataService.compareVersions(versions.oldID, versions.newID);\r\n                            // load vm for uploaded layer\r\n                            oldViewModel.deSerialize(serialized);\r\n                            oldViewModel.loadVMData();\r\n                            newViewModel.initCopyAnnotations();\r\n                            resolve(null);\r\n                        }\r\n                    } else { // user did not upgrade, keep the old version\r\n                        this.openTab(\"new layer\", oldViewModel, true, replace, true, true);\r\n                        if (!this.dataService.getDomain(oldViewModel.domainVersionID).dataLoaded) {\r\n                            this.dataService.loadDomainData(oldViewModel.domainVersionID, true).then( () => {\r\n                                oldViewModel.deSerialize(serialized);\r\n                                oldViewModel.loadVMData();\r\n                                resolve(null);\r\n                            });\r\n                        } else {\r\n                            oldViewModel.deSerialize(serialized);\r\n                            oldViewModel.loadVMData();\r\n                            resolve(null);\r\n                        }\r\n                    }\r\n                })\r\n                .catch( (err) => {\r\n                    console.error(err);\r\n                    alert(\"ERROR parsing file, check the javascript console for more information.\");\r\n                    resolve(null);\r\n                });\r\n            } else { // is a default layer, do not upgrade\r\n                this.openTab(\"new layer\", oldViewModel, true, replace, true, true);\r\n                if (!this.dataService.getDomain(oldViewModel.domainVersionID).dataLoaded) {\r\n                    this.dataService.loadDomainData(oldViewModel.domainVersionID, true).then( () => {\r\n                        oldViewModel.deSerialize(serialized);\r\n                        oldViewModel.loadVMData();\r\n                        resolve(null);\r\n                    });\r\n                } else {\r\n                    oldViewModel.deSerialize(serialized);\r\n                    oldViewModel.loadVMData();\r\n                    resolve(null);\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Loads an existing layer into a tab\r\n     */\r\n    loadLayerFromFile(): void {\r\n        var input = (<HTMLInputElement>document.getElementById(\"uploader\"));\r\n        if(input.files.length < 1){\r\n            alert(\"You must select a file to upload!\")\r\n            return;\r\n        }\r\n        this.readJSONFile(input.files[0]);\r\n    }\r\n\r\n    /**\r\n     * Retrieves a file from the input element,\r\n     * reads the json,\r\n     * and adds the properties to a new viewModel, and loads that viewmodel into a new layer.\r\n     */\r\n    readJSONFile(file: File) {\r\n        var reader = new FileReader();\r\n        let viewModel = this.viewModelsService.newViewModel(\"loading layer...\", undefined);\r\n\r\n        reader.onload = (e) =>{\r\n            var result = String(reader.result);\r\n            try{\r\n                let obj = (typeof(result) == \"string\")? JSON.parse(result) : result\r\n                viewModel.deSerializeDomainVersionID(obj);\r\n                let isCustom = \"customDataURL\" in obj ? true : false;\r\n                if (!isCustom) {\r\n                    if (!this.dataService.getDomain(viewModel.domainVersionID)) {\r\n                        throw {message: \"Error: '\" + viewModel.domain + \"' (v\" + viewModel.version + \") is an invalid domain.\"};\r\n                    }\r\n                    this.layerUpgrade(viewModel, obj, true);\r\n                } else {\r\n                    // load custom data\r\n                    viewModel.deSerialize(obj);\r\n                    this.openTab(\"new layer\", viewModel, true, true, true, true);\r\n                    this.newLayerFromURL({\r\n                        'url': obj['customDataURL'],\r\n                        'version': viewModel.version,\r\n                        'identifier': viewModel.domain\r\n                    }, obj);\r\n                }\r\n            }\r\n            catch(err){\r\n                console.error(\"ERROR: Either the file is not JSON formatted, or the file structure is invalid.\", err);\r\n                alert(\"ERROR: Either the file is not JSON formatted, or the file structure is invalid.\");\r\n                this.viewModelsService.destroyViewModel(viewModel);\r\n            }\r\n        }\r\n        reader.readAsText(file);\r\n    }\r\n\r\n    loadURL: string = \"\";\r\n    /**\r\n     * attempt an HTTP GET to loadURL, and load the response (if it exists) as a layer.\r\n     * @param loadURL the url to load\r\n     * @param replace replace the current active with the loaded layer?\r\n     * @param defaultLayers is this loading reflecting a set of default layers (from the config file or from the query string)?\r\n     * \r\n     */\r\n    async loadLayerFromURL(loadURL, replace, defaultLayers = false): Promise<any> {\r\n        return new Promise(async(resolve, reject) => {\r\n            // if (!loadURL.startsWith(\"http://\") && !loadURL.startsWith(\"https://\") && !loadURL.startsWith(\"FTP://\")) loadURL = \"https://\" + loadURL;\r\n            let subscription = this.http.get(loadURL).subscribe({\r\n                next: async (res) => {\r\n                    let viewModel = this.viewModelsService.newViewModel(\"loading layer...\", undefined);\r\n                    try {\r\n                        viewModel.deSerializeDomainVersionID(res);\r\n                        if (!this.dataService.getDomain(viewModel.domainVersionID)) {\r\n                            throw {message: \"Error: '\" + viewModel.domain + \"' (v\" + viewModel.version + \") is an invalid domain.\"};\r\n                        }\r\n                        await this.layerUpgrade(viewModel, res, replace, defaultLayers);\r\n                        console.log(\"loaded layer from\", loadURL);\r\n                        resolve(null); //continue\r\n                    } catch(err) {\r\n                        console.error(err)\r\n                        this.viewModelsService.destroyViewModel(viewModel);\r\n                        alert(\"ERROR parsing layer from \" + loadURL + \", check the javascript console for more information.\")\r\n                        resolve(null); //continue\r\n                    }\r\n                },\r\n                error: (err) => {\r\n                    console.error(err)\r\n                    if (err.status == 0) {\r\n                        // no response\r\n                        alert(\"ERROR retrieving layer from \" + loadURL + \", check the javascript console for more information.\")\r\n                    } else {\r\n                        // response, but not a good one\r\n                        alert(\"ERROR retrieving layer from \" + loadURL + \", check the javascript console for more information.\")\r\n                    }\r\n                    resolve(null); //continue\r\n                },\r\n                complete: () => { if (subscription) subscription.unsubscribe(); } //prevent memory leaks\r\n            });\r\n        });\r\n    }\r\n\r\n\r\n    //   ___ _   _ ___ _____ ___  __  __ ___ _______ ___    _  _   ___   _____ ___   _ _____ ___  ___   ___ _____ _   _ ___ ___\r\n    //  / __| | | / __|_   _/ _ \\|  \\/  |_ _|_  / __|   \\  | \\| | /_\\ \\ / /_ _/ __| /_\\_   _/ _ \\| _ \\ / __|_   _| | | | __| __|\r\n    // | (__| |_| \\__ \\ | || (_) | |\\/| || | / /| _|| |) | | .` |/ _ \\ V / | | (_ |/ _ \\| || (_) |   / \\__ \\ | | | |_| | _|| _|\r\n    //  \\___|\\___/|___/ |_| \\___/|_|  |_|___/___|___|___/  |_|\\_/_/ \\_\\_/ |___\\___/_/ \\_\\_| \\___/|_|_\\ |___/ |_|  \\___/|_| |_|\r\n    // layerLinkURL = \"\"; //the user inputted layer link which will get parsed into a param\r\n    layerLinkURLs: string[] = [];\r\n    customizedConfig = [];\r\n    bannerContent: string;\r\n\r\n    /**\r\n     * Helper function to track which layerLinkURLs have been added or removed\r\n     */\r\n    trackByFunction(index: number, obj: any): any {\r\n        return index;\r\n    }\r\n\r\n    /**\r\n     * Add a new empty layer link to the layerLinkURLs array\r\n     */\r\n    addLayerLink(): void {\r\n        this.layerLinkURLs.push(\"\");\r\n    }\r\n\r\n    /**\r\n     * Remove the given layer link URL from layerLinkURLs\r\n     * @param {number} index the index to remove\r\n     */\r\n    removeLayerLink(index: number): void {\r\n        console.log(\"removing index\", index)\r\n        console.log(this.layerLinkURLs);\r\n        if (this.layerLinkURLs.length == 1) this.layerLinkURLs = [];\r\n        else this.layerLinkURLs.splice(index, 1);\r\n        console.log(this.layerLinkURLs);\r\n    }\r\n\r\n    /**\r\n     * Convert layerLinkURL to a query string value for layerURL query string\r\n     * @return URL such that when opened will create navigator instance with a query String\r\n     *         specifying layerLinkURL as the URL to fetch the default layer from\r\n     */\r\n    getLayerLink(): string {\r\n        // if (!this.layerLinkURL) return \"\";\r\n        let str = window.location.href.split(\"#\")[0];\r\n        let join = \"#\" //hash first, then ampersand\r\n        for (let layerLinkURL of this.layerLinkURLs) {\r\n            str += join + \"layerURL=\" + encodeURIComponent(layerLinkURL)\r\n            join = \"&\";\r\n        }\r\n        for (let i = 0; i < this.customizedConfig.length; i++) {\r\n            if (this.customizedConfig[i].subfeatures) {\r\n                for (let j = 0; j < this.customizedConfig[i].subfeatures.length; j++) {\r\n                    if (!this.customizedConfig[i].subfeatures[j].enabled) {\r\n                        str += join + this.customizedConfig[i].subfeatures[j].name + \"=false\"\r\n                        join = \"&\";\r\n                    }\r\n                }\r\n            } else {\r\n                if (!this.customizedConfig[i].enabled) {\r\n                    str += join + this.customizedConfig[i].name + \"=false\"\r\n                    join = \"&\";\r\n                }\r\n            }\r\n        }\r\n\r\n        return str\r\n    }\r\n    /**\r\n     * Select the layer link field text\r\n     */\r\n    selectLayerLink(): void {\r\n        let copyText = <HTMLInputElement>document.getElementById(\"layerLink\");\r\n        console.log(copyText)\r\n        console.log(copyText.value)\r\n        copyText.select();\r\n    }\r\n\r\n    copiedRecently = false; // true if copyLayerLink has been called recently -- reverts to false after 2 seconds\r\n    /**\r\n     * copy the created layer link to the user's clipboard\r\n     */\r\n    copyLayerLink(): void {\r\n        console.log(\"attempting copy\")\r\n        this.selectLayerLink();\r\n        document.execCommand(\"Copy\");\r\n        this.copiedRecently = true;\r\n        let self = this;\r\n        window.setTimeout(function() {self.copiedRecently = false}, 2000);\r\n    }\r\n\r\n    /**\r\n     * Return true if the text is only letters a-z, false otherwise\r\n     * @param  text text to eval\r\n     * @return      true if a-z, false otherwise\r\n     */\r\n    alphabetical(text: string): boolean {\r\n        return /^[a-z]+$/.test(text);\r\n    }\r\n\r\n    /**\r\n     * get a key=value fragment value by key\r\n     * @param  {string} name name of param to get the value of\r\n     * @param  {string} url  optional, if unspecified searches in current window location. Otherwise searches this string\r\n     * @return {string}      fragment param value\r\n     */\r\n    getNamedFragmentValue(name: string, url?: string): any {\r\n\r\n        if (!url) url = window.location.href;\r\n        name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\r\n        var regex = new RegExp(\"[#&]\" + name + \"(?:=([^&#]*)|&|#|$)\", \"g\");\r\n        //match as many results as exist under the name\r\n        let results = [];\r\n        let match = regex.exec(url);\r\n        while (match != null) {\r\n            results.push(decodeURIComponent(match[1].replace(/\\+/g, \" \")));\r\n            match = regex.exec(url);\r\n        }\r\n        return results\r\n    }\r\n\r\n}\r\n\r\nexport class Tab {\r\n    title: string;\r\n    dataContext;\r\n    domain: string = \"\";\r\n    isDataTable: boolean;\r\n\r\n    isCloseable: boolean = false;\r\n    showScoreVariables: boolean = false;\r\n\r\n    constructor(title: string, isCloseable: boolean, showScoreVariables: boolean, domain: string, dataTable: boolean) {\r\n        this.title = title;\r\n        this.isCloseable = isCloseable;\r\n        this.showScoreVariables = showScoreVariables;\r\n        this.domain = domain;\r\n        this.isDataTable = dataTable;\r\n    }\r\n}\r\n","<div [style.margin-top]=\"adjustedHeaderHeight+'px'\" class=\"header-wrapper\">\r\n<!-- Banner -->\r\n<div *ngIf=\"hasFeature('header') && bannerContent\" class=\"header\">\r\n    <div class=\"banner\">\r\n        <span class=\"bannerContent\" role=\"alert\" [innerHTML]=\"bannerContent\"></span>\r\n        <div [style.margin-bottom]=\"hasFeature('tabs') ? '0px' : '15px'\" class=\"bannerLinks\">\r\n            <div>\r\n                <a href=\"http://attack.mitre.org\">MITRE ATT&CK&reg; Navigator</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- Header/Help -->\r\n<div *ngIf=\"hasFeature('header') && !bannerContent\" [style.margin-bottom]=\"hasFeature('tabs') ? '0px' : '15px'\"\r\n     class=\"header help-header\">\r\n    <div *ngIf=\"hasFeature('tabs')\" class=\"help-button\" [ngClass]=\"{'help-dropdown-open' : showHelpDropDown}\"\r\n         matTooltip=\"help\" (click)=\"showHelpDropDown = !showHelpDropDown\">\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 0 24 24\" width=\"24px\" fill=\"#9aa0a6\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z\"/></svg>\r\n    </div>\r\n    <div class=\"dropdown-container\" *ngIf=\"showHelpDropDown && adjustedHeaderHeight >= 0\">\r\n        <button (click)=\"openDialog('help')\">help</button>\r\n        <button (click)=\"openDialog('changelog')\">changelog</button>\r\n    </div>\r\n</div>\r\n\r\n\r\n<!-- Tabs display -->\r\n<div class=\"tabs-container\">\r\n    <nav mat-tab-nav-bar class=\"tabs\">\r\n        <a mat-tab-link\r\n           class=\"tab-title\"\r\n           [class.active]=\"activeTab === tab\"\r\n           *ngFor=\"let tab of layerTabs; let $i = index\"\r\n           (click)=\"handleTabClick(tab)\"\r\n           [active]=\"activeTab === tab\">\r\n            {{tab.isDataTable ? tab.dataContext.name : tab.title}}\r\n            <span class=\"tab-close\" *ngIf=\"tab.isCloseable\" (click)=\"closeTab(tab)\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 0 24 24\" width=\"24px\" [attr.fill]=\"activeTab === tab ? '#000000' : '#9aa0a6'\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/></svg>\r\n            </span>\r\n            <!-- tab enumerator (for layer operations) -->\r\n            <span class=\"tabEnumerator\" *ngIf=\"getActiveTab().showScoreVariables && tab.isDataTable && (!domain || tab.domain === domain) && alphabetical(indexToChar($i))\">{{indexToChar($i)}}</span>\r\n        </a>\r\n        <a mat-tab-link class=\"addTab\" *ngIf=\"layerTabs.length < 10\" (click)=\"newBlankTab()\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 0 24 24\" width=\"24px\" fill=\"#9aa0a6\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\"/></svg>\r\n        </a>\r\n    </nav>\r\n</div>\r\n\r\n\r\n<div *ngIf=\"layerTabs.length == 0\" class=\"newTab\">\r\n    <!-- you shouldn't ever see this, but just in case -->\r\n    <button (click)=\"newBlankTab()\">Start</button>\r\n</div>\r\n\r\n</div>\r\n\r\n\r\n<ng-template #safariWarning>\r\n    <div class=\"safari-warning\">\r\n        <h3>WARNING</h3>\r\n        <p>\r\n            Weve detected that you are using the Safari browser. As of Navigator version <b>4.3</b>, Safari versions 13\r\n            and below are not supported due to an unfixable freeze that can occur when selecting a layer tab.\r\n        </p>\r\n        <p>\r\n            We recommend you use Chrome or Firefox instead. You can continue to use the Navigator in Safari (versions 13\r\n            and below), but you may lose work if the application freezes.\r\n        </p>\r\n        <button mat-button (click)=\"safariDialogRef.close()\">Dismiss</button>\r\n    </div>\r\n</ng-template>\r\n\r\n<!-- New tab template -->\r\n<ng-template [ngIf]=\"activeTab && !activeTab.isDataTable\">\r\n    <div class=\"newTab\">\r\n        <div class=\"description\">\r\n            <div class=\"logo\">\r\n                <h1><a href=\"http://attack.mitre.org\">MITRE ATT&CK&reg; Navigator</a></h1>\r\n            </div>\r\n            <div>\r\n                <p>\r\n                    The ATT&CK Navigator is a web-based tool for annotating and exploring ATT&CK matrices. It can be\r\n                    used to visualize defensive coverage, red/blue team planning, the frequency of detected techniques,\r\n                    and more.\r\n                </p>\r\n            </div>\r\n            <!-- Help dialog -->\r\n            <div class=\"help-links-container\">\r\n                <button mat-button (click)=\"openDialog('help')\">help</button>\r\n                <button mat-button (click)=\"openDialog('changelog')\">changelog</button>\r\n\r\n\r\n                <button mat-button (click)=\"select.open()\" class=\"theme-select-container\">\r\n                    <mat-label>\r\n                        theme \r\n                    </mat-label>\r\n                    <mat-select #select (selectionChange)=\"handleUserThemeChange($event.value)\">\r\n                        <mat-option value=\"dark\">dark</mat-option>\r\n                        <mat-option value=\"light\">light</mat-option>\r\n                        <mat-option value=\"system\">use system</mat-option>\r\n                    </mat-select>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <mat-accordion class=\"headers-align\">\r\n\r\n            <!-- Create new layer interface -->\r\n            <mat-expansion-panel #newlayer>\r\n                <mat-expansion-panel-header>\r\n                    <mat-panel-title>\r\n                        Create New Layer\r\n                    </mat-panel-title>\r\n                    <mat-panel-description>\r\n                        Create a new empty layer\r\n                    </mat-panel-description>\r\n                </mat-expansion-panel-header>\r\n\r\n                <!-- Domain buttons for latest version -->\r\n                <table class=\"btn-group\" role=\"group\">\r\n                    <ng-template ngFor let-domain [ngForOf]=\"filterDomains(ds.versions[0])\" let-domainIndex=\"index\">\r\n                        <td>\r\n                            <button mat-raised-button (click)=\"newLayer(domain.id)\">{{domain.name}}</button>\r\n                        </td>\r\n                    </ng-template>\r\n                </table>\r\n\r\n                <!-- More domain/version options -->\r\n                <mat-expansion-panel>\r\n                    <mat-expansion-panel-header>\r\n                        <mat-panel-title>\r\n                            More Options\r\n                        </mat-panel-title>\r\n                    </mat-expansion-panel-header>\r\n\r\n                    <table class=\"inputTable\">\r\n                        <tr>\r\n                            <!-- Load data from different version -->\r\n                            <td class=\"width-lg\">\r\n                                <!-- Choose version -->\r\n                                <mat-form-field>\r\n                                    <mat-select placeholder=\"Choose a version\" [(ngModel)]=\"nVersion\" required>\r\n                                        <mat-option [value]=\"null\">none</mat-option>\r\n                                        <mat-option *ngFor=\"let nVersion of this.dataService.versions\"\r\n                                                    [value]=\"nVersion\">{{nVersion.name}}</mat-option>\r\n                                    </mat-select>\r\n                                </mat-form-field>\r\n                                <!-- Choose domain -->\r\n                                <mat-form-field>\r\n                                    <mat-select placeholder=\"Choose a domain\" [(ngModel)]=\"nDomain\" [disabled]=\"!nVersion\"\r\n                                                required>\r\n                                        <mat-option [value]=\"null\">none</mat-option>\r\n                                        <mat-option *ngFor=\"let nDomain of filterDomains(nVersion)\"\r\n                                                    [value]=nDomain>{{nDomain.name}}</mat-option>\r\n                                    </mat-select>\r\n                                </mat-form-field>\r\n                                <div>\r\n                                    <em>* Official ATT&CK Versions prior to {{ds.lowestSupportedVersion.name}} are not supported by Navigator v{{nav_version}}.</em>\r\n                                </div>\r\n                            </td>\r\n\r\n                            <td class=\"width-sm\"><b style=\"font-size: 8pt\">OR</b></td>\r\n    \r\n                            <!-- Load data from collection or STIX bundle URL -->\r\n                            <td class=\"width-lg\">\r\n                                <mat-form-field>\r\n                                    <input type=\"url\" matInput placeholder=\"Collection or STIX bundle URL\" [(ngModel)]=\"loadData.url\"/>\r\n                                </mat-form-field>\r\n                                <mat-form-field>\r\n                                    <input type=\"number\" matInput placeholder=\"Version number\" [(ngModel)]=\"loadData.version\"/>\r\n                                    <mat-hint>ATT&CK version (e.g. 12)</mat-hint>\r\n                                </mat-form-field>\r\n                                <mat-form-field>\r\n                                    <input type=\"text\" matInput placeholder=\"Domain\" [(ngModel)]=\"loadData.identifier\"/>\r\n                                    <mat-hint>Domain identifier (e.g. defending-iaas)</mat-hint>\r\n                                </mat-form-field>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"width-lg\">\r\n                                <button style=\"margin-top: 20px\" mat-button [disabled]=\"!nVersion || !nDomain\" (click)=\"newLayer(nDomain.id)\">\r\n                                    Create layer from Version\r\n                                </button>\r\n                            </td>\r\n                            <td class=\"width-sm\"></td>\r\n                            <td class=\"width-lg\">\r\n                                <button style=\"margin-top: 20px\" mat-button [disabled]=\"!loadData.url || !loadData.version || !loadData.identifier\" (click)=\"newLayerFromURL(loadData)\">\r\n                                    Create layer from URL\r\n                                </button>\r\n                            </td>\r\n                        </tr>\r\n                    </table>\r\n                </mat-expansion-panel>\r\n            </mat-expansion-panel>\r\n\r\n            <!-- Open existing layer interface -->\r\n            <mat-expansion-panel>\r\n                <mat-expansion-panel-header>\r\n                    <mat-panel-title>\r\n                        Open Existing Layer\r\n                    </mat-panel-title>\r\n                    <mat-panel-description>\r\n                        Load a layer from your computer or a URL\r\n                    </mat-panel-description>\r\n                </mat-expansion-panel-header>\r\n                <table class=\"inputTable\">\r\n                    <tr>\r\n                        <!-- Upload file from local -->\r\n                        <td>\r\n                            <button mat-button (click)=\"openUploadPrompt()\">Upload from local</button>\r\n                            <input id=\"uploader\" type=\"file\" style=\"display: none\" (change)=\"loadLayerFromFile()\"/></td>\r\n\r\n                        <td><b style=\"font-size: 8pt\">OR</b></td>\r\n\r\n                        <!-- Upload layer via URL -->\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <input type=\"text\"\r\n                                       matInput\r\n                                       placeholder=\"Load from URL\"\r\n                                       [(ngModel)]=\"loadURL\"/>\r\n                                <button mat-button matSuffix mat-icon-button aria-label=\"go\" *ngIf=\"loadURL\"\r\n                                        (click)=\"loadLayerFromURL(loadURL, true)\">>\r\n                                </button>\r\n                            </mat-form-field>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </mat-expansion-panel>\r\n\r\n            <!-- Create layer from other layers -->\r\n            <mat-expansion-panel (opened)=\"activeTab.showScoreVariables = true\"\r\n                                 (closed)=\"activeTab.showScoreVariables = false\">\r\n                <mat-expansion-panel-header>\r\n                    <mat-panel-title>\r\n                        Create Layer from other layers\r\n                    </mat-panel-title>\r\n                    <mat-panel-description>\r\n                        Choose layers to inherit properties from\r\n                    </mat-panel-description>\r\n                </mat-expansion-panel-header>\r\n\r\n                <table class=\"layerOpTable\">\r\n                    <!-- Domain -->\r\n                    <tr>\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"domain\" [(ngModel)]=\"domain\" required>\r\n                                    <mat-option [value]=\"null\">none</mat-option>\r\n                                    <mat-option *ngFor=\"let domain of this.dataService.domains\"\r\n                                                [value]=domain.id>{{domain.name}} {{domain.version.name}}</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </td>\r\n                        <td>\r\n                            Choose the domain and version for the new layer. Only layers of the same domain and version\r\n                            can be merged.\r\n                        </td>\r\n                    </tr>\r\n\r\n                    <!-- Score expression -->\r\n                    <tr>\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <input type=\"text\"\r\n                                       matInput\r\n                                       placeholder=\"score expression\"\r\n                                       [disabled]=\"!domain\"\r\n                                       [(ngModel)]=\"scoreExpression\"\r\n                                       (keyup)=\"scoreExpression = scoreExpression.toLowerCase()\"\r\n                                       style=\"letter-spacing: 2px\"/>\r\n                                <mat-hint style=\"color: red\" align=\"start\">{{getScoreExpressionError()}}</mat-hint>\r\n                            </mat-form-field>\r\n                        </td>\r\n                        <td [ngClass]=\"{disabled: !domain}\">\r\n                            Use constants (numbers) and layer variables (yellow, above) to write an expression for the\r\n                            initial value of scores in the new layer. A full list of supported operations can be found\r\n                            <a href=\"http://mathjs.org/docs/expressions/syntax.html#operators\">here</a>. Leave blank to\r\n                            initialize scores to 0. Here's a list of available layer variables:\r\n                            <ul *ngFor=\"let tab of layerTabs; let $i = index\">\r\n                                <li *ngIf=\"getActiveTab().showScoreVariables && tab.isDataTable && (!domain || tab.domain === domain) && alphabetical(indexToChar($i))\"><span class=\"tab-enumerator\">{{indexToChar($i)}}</span> ({{tab.title}})</li>\r\n                            </ul>\r\n                        </td>\r\n                    </tr>\r\n\r\n                    <!-- Gradient -->\r\n                    <tr>\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"gradient\" [(ngModel)]=\"gradient\" [disabled]=\"!domain\">\r\n                                    <mat-option [value]=\"null\">none</mat-option>\r\n                                    <mat-option *ngFor=\"let vm of getLayers()\" [value]=vm>{{vm.name}}</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </td>\r\n                        <td [ngClass]=\"{disabled: !domain}\">\r\n                            Choose which layer to import the scoring gradient from. Leave blank to initialize with the\r\n                            default scoring gradient.\r\n                        </td>\r\n                    </tr>\r\n\r\n                    <!-- Coloring -->\r\n                    <tr>\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"coloring\" [(ngModel)]=\"coloring\" [disabled]=\"!domain\">\r\n                                    <mat-option [value]=\"null\">none</mat-option>\r\n                                    <mat-option *ngFor=\"let vm of getLayers()\" [value]=vm>{{vm.name}}</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </td>\r\n                        <td [ngClass]=\"{disabled: !domain}\">\r\n                            Choose which layer to import manually assigned colors from. Leave blank to initialize with\r\n                            no colors.\r\n                        </td>\r\n                    </tr>\r\n\r\n                    <!-- Comments -->\r\n                    <tr>\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"comments\" [(ngModel)]=\"comments\" [disabled]=\"!domain\">\r\n                                    <mat-option [value]=\"null\">none</mat-option>\r\n                                    <mat-option *ngFor=\"let vm of getLayers()\" [value]=vm>{{vm.name}}</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </td>\r\n                        <td [ngClass]=\"{disabled: !domain}\">\r\n                            Choose which layer to import comments from. Leave blank to initialize with no comments.\r\n                        </td>\r\n                    </tr>\r\n\r\n                    <!-- Links -->\r\n                    <tr>\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"links\" [(ngModel)]=\"links\" [disabled]=\"!domain\">\r\n                                    <mat-option [value]=\"null\">none</mat-option>\r\n                                    <mat-option *ngFor=\"let vm of getLayers()\" [value]=vm>{{vm.name}}</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </td>\r\n                        <td [ngClass]=\"{disabled: !domain}\">\r\n                            Choose which layer to import technique links from. Leave blank to initialize without links.\r\n                        </td>\r\n                    </tr>\r\n\r\n                    <!-- Metadata -->\r\n                    <tr>\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"metadata\" [(ngModel)]=\"metadata\" [disabled]=\"!domain\">\r\n                                    <mat-option [value]=\"null\">none</mat-option>\r\n                                    <mat-option *ngFor=\"let vm of getLayers()\" [value]=vm>{{vm.name}}</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </td>\r\n                        <td [ngClass]=\"{disabled: !domain}\">\r\n                            Choose which layer to import technique metadata from. Leave blank to initialize without metadata.\r\n                        </td>\r\n                    </tr>\r\n\r\n                    <!-- States -->\r\n                    <tr>\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"states\" [(ngModel)]=\"enabledness\" [disabled]=\"!domain\">\r\n                                    <mat-option [value]=\"null\">none</mat-option>\r\n                                    <mat-option *ngFor=\"let vm of getLayers()\" [value]=vm>{{vm.name}}</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </td>\r\n                        <td [ngClass]=\"{disabled: !domain}\">\r\n                            Choose which layer to import enabled/disabled states from. Leave blank to initialize all to\r\n                            enabled.\r\n                        </td>\r\n                    </tr>\r\n\r\n                    <!-- Filters -->\r\n                    <tr>\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"filters\" [(ngModel)]=\"filters\" [disabled]=\"!domain\">\r\n                                    <mat-option [value]=\"null\">none</mat-option>\r\n                                    <mat-option *ngFor=\"let vm of getLayers()\" [value]=vm>{{vm.name}}</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </td>\r\n                        <td [ngClass]=\"{disabled: !domain}\">\r\n                            Choose which layer to import filters from. Leave blank to initialize with no filters.\r\n                        </td>\r\n                    </tr>\r\n\r\n                    <!-- Legend -->\r\n                    <tr>\r\n                        <td>\r\n                            <mat-form-field>\r\n                                <mat-select placeholder=\"legend\" [(ngModel)]=\"legendItems\" [disabled]=\"!domain\">\r\n                                    <mat-option [value]=\"null\">none</mat-option>\r\n                                    <mat-option *ngFor=\"let vm of getLayers()\" [value]=vm>{{vm.name}}</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </td>\r\n                        <td [ngClass]=\"{disabled: !domain}\">\r\n                            Choose which layer to import the legend from. Leave blank to initialize with an empty\r\n                            legend.\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n\r\n                <!-- Create -->\r\n                <button mat-button [disabled]=\"getScoreExpressionError() || !domain\"\r\n                        (click)=\"layerByOperation(); showScoreVariables = false\">Create\r\n                </button>\r\n            </mat-expansion-panel>\r\n\r\n            <!-- Customized Navigator-->\r\n            <mat-expansion-panel>\r\n                <mat-expansion-panel-header>\r\n                    <mat-panel-title>\r\n                        Create Customized Navigator\r\n                    </mat-panel-title>\r\n                    <mat-panel-description>\r\n                        Create a hyperlink to a customized ATT&CK Navigator\r\n                    </mat-panel-description>\r\n                </mat-expansion-panel-header>\r\n\r\n                <table class=\"inputTable\">\r\n                    <!-- Default layers -->\r\n                    <tr>\r\n                        <td><h1>Default Layers</h1></td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <tr class=\"custom_nav_inputsection\">\r\n                        <td>\r\n                            <ul class=\"layerLinks\">\r\n                                <li *ngFor=\"let layerLinkURL of layerLinkURLs; let i = index trackBy:trackByFunction\">\r\n                                    <mat-form-field>\r\n                                        <input type=\"text\" matInput\r\n                                               [placeholder]=\"'default layer URL ' + (i + 1)\"\r\n                                               [(ngModel)]=\"layerLinkURLs[i]\"/>\r\n                                        <button mat-button matSuffix mat-icon-button aria-label=\"remove\"\r\n                                                (click)=\"removeLayerLink(i)\">\r\n                                            x\r\n                                        </button>\r\n                                    </mat-form-field>\r\n                                </li>\r\n                                <li>\r\n                                    <button mat-button (click)=\"addLayerLink()\">\r\n                                        add {{layerLinkURLs.length > 0 ? \"another\" : \"a\"}} layer link\r\n                                    </button>\r\n                                </li>\r\n                            </ul>\r\n                        </td>\r\n                        <td>Enter the URLs of layers hosted on the web. The custom navigator will open these layers by\r\n                            default.\r\n                        </td>\r\n                    </tr>\r\n\r\n                    <!-- Navigator Features -->\r\n                    <tr>\r\n                        <td><h1>Navigator Features</h1></td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <ng-template ngFor let-featureItem [ngForOf]=\"customizedConfig\" let-featureItemIndex=\"index\">\r\n                        <!-- features -->\r\n                        <tr class=\"featureRow noselect\" *ngIf=\"!featureItem.subfeatures\"\r\n                            (click)=\"featureItem.enabled = !featureItem.enabled\">\r\n                            <td class=\"featureRow-button\">\r\n                                <ng-template [ngIf]=\"featureItem.enabled\">\r\n                                    <svg fill=\"currentColor\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                        <path d=\"M0 0h24v24H0z\" fill=\"none\"/>\r\n                                        <path d=\"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/>\r\n                                    </svg>\r\n                                </ng-template>\r\n                                <ng-template [ngIf]=\"!featureItem.enabled\">\r\n                                    <svg fill=\"currentColor\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                        <path d=\"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z\"/>\r\n                                        <path d=\"M0 0h24v24H0z\" fill=\"none\"/>\r\n                                    </svg>\r\n                                </ng-template>\r\n                                {{featureItem.name.split(\"_\").join(\" \")}}\r\n                            </td>\r\n                            <td>{{featureItem.description}}</td>\r\n                        </tr>\r\n                        <!-- sub-featuers -->\r\n                        <tr *ngIf=\"featureItem.subfeatures\">\r\n                            <td>\r\n                                <h2>{{featureItem.name.split(\"_\").join(\" \")}}</h2>\r\n                            </td>\r\n                            <td></td>\r\n                        </tr>\r\n                        <ng-template ngFor let-subfeature [ngForOf]=\"featureItem.subfeatures\"\r\n                                     let-subfeatureIndex=\"index\" let-last=\"last\">\r\n                            <tr class=\"featureRow noselect\" (click)=\"subfeature.enabled = !subfeature.enabled\">\r\n                                <td class=\"featureRow-button subfeature\" [class.last]=\"last\" style=\"padding-left: 20px\">\r\n                                    <ng-template [ngIf]=\"subfeature.enabled\">\r\n                                        <svg fill=\"currentColor\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                            <path d=\"M0 0h24v24H0z\" fill=\"none\"/>\r\n                                            <path d=\"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/>\r\n                                        </svg>\r\n                                    </ng-template>\r\n                                    <ng-template [ngIf]=\"!subfeature.enabled\">\r\n                                        <svg fill=\"currentColor\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                            <path d=\"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z\"/>\r\n                                            <path d=\"M0 0h24v24H0z\" fill=\"none\"/>\r\n                                        </svg>\r\n                                    </ng-template>\r\n                                    {{subfeature.name.split(\"_\").join(\" \")}}\r\n                                </td>\r\n                                <td class=\"subfeature\" [class.last]=\"last\">{{subfeature.description}}</td>\r\n                            </tr>\r\n                        </ng-template>\r\n                    </ng-template>\r\n                </table>\r\n\r\n                <!-- Custom Navigator URL -->\r\n                <div style=\"text-align: center; margin-top: 20px\">\r\n                    <mat-form-field id=\"layerlinkfield\">\r\n                        <input id=\"layerLink\" type=\"text\"\r\n                               matInput\r\n                               readonly=\"readonly\"\r\n                               (click)=\"selectLayerLink()\"\r\n                               [value]=\"getLayerLink()\"\r\n                               placeholder=\"custom navigator URL\"/>\r\n                        <button (click)=\"copyLayerLink()\" mat-button matSuffix mat-icon-button aria-label=\"copy\"><span class=\"layerLinkCopy\"\r\n                                matTooltip=\"copy\" matTooltipPosition=\"right\">\r\n                                <svg fill=\"currentColor\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                    <path d=\"M0 0h24v24H0z\" fill=\"none\"/>\r\n                                    <path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"/>\r\n                                </svg>\r\n                            </span>\r\n                        </button>\r\n                        <mat-hint *ngIf=\"copiedRecently\">copied</mat-hint>\r\n                    </mat-form-field>\r\n                </div>\r\n            </mat-expansion-panel>\r\n        </mat-accordion>\r\n\r\n    </div>\r\n</ng-template>\r\n\r\n<ng-template [ngIf]=\"activeTab && activeTab.isDataTable\">\r\n    <DataTable [viewModel]=\"activeTab.dataContext\" [currentDropdown]=\"dropdownEnabled\" (dropdownChange)=\"dropdownEnabled = $event\" (onScroll)=\"adjustHeader($event)\"></DataTable>\r\n</ng-template>\r\n","import { Input, Directive } from '@angular/core';\r\nimport { Technique, Tactic, DataService } from '../data.service';\r\nimport { ViewModel } from '../viewmodels.service';\r\nimport { getCookie, hasCookie } from \"../cookies\";\r\nimport { ConfigService } from '../config.service';\r\nimport * as tinycolor from 'tinycolor2';\r\n\r\n@Directive()\r\nexport abstract class Cell {\r\n    @Input() viewModel: ViewModel;\r\n    @Input() technique: Technique;\r\n    @Input() tactic: Tactic;\r\n\r\n    public showContextmenu: boolean = false;\r\n    isDarkTheme: boolean;\r\n\r\n    constructor(public dataService: DataService, public configService: ConfigService) {\r\n        this.dataService = dataService;\r\n        this.configService = configService;\r\n        if (hasCookie(\"is_user_theme_dark\")) this.isDarkTheme = getCookie(\"is_user_theme_dark\") === \"true\";\r\n        else this.isDarkTheme = window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\r\n    }\r\n\r\n    public get isHighlighted(): boolean {\r\n        let isHighlighted = this.showContextmenu;\r\n        let idToMatch = this.technique.id;\r\n        if (this.viewModel.selectSubtechniquesWithParent && this.technique.isSubtechnique) idToMatch = this.technique.parent.id;\r\n\r\n        if (this.viewModel.highlightedTechniques.has(idToMatch)) {\r\n            if (!this.viewModel.highlightedTactic) { // highlight is called from search component\r\n                return true;\r\n            } else {\r\n                const isTacticMatching = this.viewModel.highlightedTactic.id === this.tactic.id;\r\n                return (this.viewModel.selectTechniquesAcrossTactics || isTacticMatching);\r\n            }\r\n        }\r\n\r\n        return isHighlighted;\r\n    }\r\n\r\n    /**\r\n     * Return css classes for a technique\r\n     * @param  {technique} technique the technique to get the class of\r\n     * @param  {boolean}   mini is it the minitable?\r\n     * @return {string}               the classes the technique should currently have\r\n     */\r\n    public getClass(): string {\r\n        let theclass = 'link noselect cell'\r\n        if (this.tactic && this.viewModel.isTechniqueSelected(this.technique, this.tactic))\r\n            theclass += \" editing\"\r\n        if (this.isHighlighted) { //open context menu always keeps highlight even if the mouse has moved elsewhere\r\n            theclass += \" highlight\";\r\n        }\r\n\r\n        // classes added by layout config\r\n        if (this.viewModel.layout.showID)\r\n            theclass += \" showID\"\r\n        if (this.viewModel.layout.showName)\r\n            theclass += \" showName\"\r\n        theclass += \" \" + this.viewModel.layout.layout;\r\n\r\n        // classes according to annotations\r\n        if (this.tactic && this.viewModel.getTechniqueVM(this.technique, this.tactic).comment.length > 0 ||\r\n                this.viewModel.getTechniqueVM(this.technique, this.tactic).metadata.length > 0 ||\r\n                this.viewModel.getTechniqueVM(this.technique, this.tactic).links.length > 0 ||\r\n                this.hasNotes())\r\n            theclass += \" underlined\"\r\n        if (this.getTechniqueBackground())\r\n            theclass += \" colored\"\r\n        if (this.tactic && !this.viewModel.getTechniqueVM(this.technique, this.tactic).enabled)\r\n            theclass += \" disabled\"\r\n\r\n        return theclass\r\n    }\r\n\r\n    /**\r\n     * Emulate transparency without an alpha channel\r\n     * @param color color with alpha channel\r\n     * @returns color without an alpha channel which has been mixed with the proper background color as if it is transparent\r\n     */\r\n    private emulate_alpha(color: any) {\r\n        /* note: constructing a tinycolor of a tinycolor makes them aliases. E.g:\r\n         *\r\n         *    x = tinycolor(\"#ffffff\")\r\n         *    y = tinycolor(x)\r\n         *    y.getAlpha() -> 1\r\n         *    x.setAlpha(0)\r\n         *    y.getAlpha() -> 0\r\n         *\r\n         * Therefore y must be cloned after it is constructed to avoid transformations of x affecting it.\r\n         * In this context, the color arg must be cloned because\r\n         * in some contexts it is a tinycolor and we change its alpha below,\r\n         * which could affect the copy in the calling function\r\n         */\r\n        if (!color || color.length < 1) return \"\";\r\n        let cell_color = tinycolor(color).clone();\r\n        let cell_color_alpha = cell_color.getAlpha();\r\n        cell_color.setAlpha(1)\r\n        let result = tinycolor.mix(this.isDarkTheme ? \"#2e2e3f\" : \"#ffffff\", cell_color, cell_color_alpha * 100)\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Get most readable text color for the given technique\r\n     * @param  technique     the technique to get the text color for\r\n     * @param  antihighlight boolean, true if the column is not selected.\r\n     * @return               black, white, or gray, depending on technique and column state\r\n     */\r\n    public getTechniqueTextColor() {\r\n        if (!this.tactic) return this.isDarkTheme ? \"white\" : \"black\";\r\n        let tvm = this.viewModel.getTechniqueVM(this.technique, this.tactic)\r\n        if (!tvm.enabled) return this.isDarkTheme ? \"rgb(255 255 255 / 25%)\" : \"#aaaaaa\";\r\n        // don't display if disabled or highlighted\r\n        // if (this.viewModel.highlightedTechnique && this.viewModel.highlightedTechnique.technique_tactic_union_id == this.technique.technique_tactic_union_id) return \"black\"\r\n        if (tvm.color) return tinycolor.mostReadable(this.emulate_alpha(tvm.color), [\"white\", \"black\"]);\r\n        if (this.viewModel.layout.showAggregateScores && tvm.aggregateScoreColor) return tinycolor.mostReadable(this.emulate_alpha(tvm.aggregateScoreColor), [\"white\", \"black\"]);\r\n        if (tvm.score && !isNaN(Number(tvm.score))) return tinycolor.mostReadable(this.emulate_alpha(tvm.scoreColor), [\"white\", \"black\"]);\r\n        else return this.isDarkTheme ? \"white\" : \"black\";\r\n    }\r\n\r\n    /**\r\n     * Get the underline color for the given technique. The comment/metadata\r\n     * underscore color overrides the link underscore color.\r\n     */\r\n    public getTechniqueUnderlineColor() {\r\n        if (this.tactic) {\r\n            let tvm = this.viewModel.getTechniqueVM(this.technique, this.tactic);\r\n            if (tvm.comment.length > 0 || tvm.metadata.length > 0 || this.hasNotes()) {\r\n                if (this.configService.getFeature('comment_underline')) return this.configService.comment_color;\r\n            }\r\n            if (tvm.links.length > 0) {\r\n                if (this.configService.getFeature('link_underline')) return this.configService.link_color;\r\n            }\r\n        }\r\n        return '';\r\n    }\r\n\r\n    /**\r\n     * Check if technique has notes\r\n     * @return      true if technique has notes, false otherwise\r\n     */\r\n    public hasNotes() {\r\n        let domain = this.dataService.getDomain(this.viewModel.domainVersionID);\r\n        let notes = domain.notes.filter(note => {\r\n            return note.object_refs.includes(this.technique.id);\r\n        });\r\n        return notes.length > 0;\r\n    }\r\n\r\n    /**\r\n     * get the technique background style for ngstyle\r\n     * @param  technique technique\r\n     * @return           background object\r\n     */\r\n    public getTechniqueBackground(): any {\r\n        if (!this.tactic) return null;\r\n        let tvm = this.viewModel.getTechniqueVM(this.technique, this.tactic)\r\n        // don't display if disabled or highlighted\r\n        if (!tvm.enabled || this.isHighlighted) return null;\r\n        if (tvm.color) return { \"background\": this.emulate_alpha(tvm.color) }\r\n        if (this.viewModel.layout.showAggregateScores && !isNaN(Number(tvm.aggregateScore)) && tvm.aggregateScore.length > 0) return { \"background\": this.emulate_alpha(tvm.aggregateScoreColor) }\r\n        if (tvm.score) return { \"background\": this.emulate_alpha(tvm.scoreColor) }\r\n        // return tvm.enabled && tvm.score && !tvm.color && !(this.viewModel.highlightedTechnique && this.viewModel.highlightedTechnique.technique_id == technique.technique_id)\r\n    }\r\n}\r\n","import { Input, Output, EventEmitter, Directive } from '@angular/core';\r\nimport { Matrix, Technique, Tactic } from '../data.service';\r\nimport { ViewModel, ViewModelsService } from '../viewmodels.service';\r\nimport { ConfigService } from '../config.service';\r\nimport * as tinycolor from 'tinycolor2';\r\n\r\n@Directive()\r\nexport abstract class MatrixCommon {\r\n    @Input() matrix: Matrix;\r\n    @Input() viewModel: ViewModel;\r\n\r\n    constructor(private configService: ConfigService, private viewModelsService: ViewModelsService) {\r\n        this.configService = configService;\r\n    }\r\n\r\n\r\n    /**\r\n     * filter tactics according to viewmodel state\r\n     * @param {Tactic[]} tactics to filter\r\n     * @returns {Tactic[]} filtered tactics\r\n     */\r\n    public filterTactics(tactics: Tactic[]): Tactic[] {\r\n        return this.viewModel.filterTactics(tactics, this.matrix);\r\n    }\r\n\r\n    /**\r\n     * filter techniques according to viewModel state\r\n     * @param {Technique[]} techniques list of techniques to filter\r\n     * @param {Tactic} tactic tactic the techniques fall under\r\n     * @returns {Technique[]} filtered techniques\r\n     */\r\n    public filterTechniques(techniques: Technique[], tactic: Tactic): Technique[] {\r\n        return this.viewModel.filterTechniques(techniques, tactic, this.matrix);\r\n    }\r\n\r\n    /**\r\n     * sort techniques accoding to viewModel state\r\n     * @param {Technique[]} techniques techniques to sort\r\n     * @param {Tactic} tactic tactic the techniques fall under\r\n     * @returns {Technique[]} sorted techniques\r\n     */\r\n    public sortTechniques(techniques: Technique[], tactic: Tactic): Technique[] {\r\n        return this.viewModel.sortTechniques(techniques, tactic);\r\n    }\r\n\r\n    /**\r\n     * apply sort and filter state to techniques\r\n     * @param {Technique[]} techniques techniques to sort and filter\r\n     * @param {Tactic} tactic that the techniques fall under\r\n     * @returns {Technique[]} sorted and filtered techniques\r\n     */\r\n    public applyControls(techniques: Technique[], tactic: Tactic): Technique[] {\r\n        return this.viewModel.applyControls(techniques, tactic, this.matrix);\r\n    }\r\n\r\n\r\n    public onTechniqueLeftClick(event: any, technique: Technique, tactic: Tactic) {\r\n        if (!this.configService.getFeature('selecting_techniques')) {\r\n            //if selecting is disabled, same behavior as right click. Shouldn't ever get to this point because it should be handled in technique-cell\r\n            return;\r\n        }\r\n        if (event.shift || event.ctrl || event.meta) {\r\n            // add to selection\r\n            if (this.viewModel.isTechniqueSelected(technique, tactic)) this.viewModel.unselectTechnique(technique, tactic);\r\n            else this.viewModel.selectTechnique(technique, tactic)\r\n        } else {\r\n            // replace selection\r\n            if (this.viewModel.getSelectedTechniqueCount() > 1) {\r\n                if (this.viewModel.isTechniqueSelected)\r\n                this.viewModel.clearSelectedTechniques();\r\n                this.viewModel.selectTechnique(technique, tactic);\r\n            } else if (this.viewModel.isTechniqueSelected(technique, tactic))  { //unselect currently selected\r\n                this.viewModel.clearSelectedTechniques();\r\n            } else { //replace\r\n                this.viewModel.clearSelectedTechniques();\r\n                this.viewModel.selectTechnique(technique, tactic);\r\n            }\r\n        }\r\n        this.viewModelsService.onSelectionChange.emit();\r\n    }\r\n\r\n    public onToggleSubtechniquesVisible(technique: Technique, tactic: Tactic) {\r\n        if (technique.subtechniques.length == 0) return;\r\n        let tvm = this.viewModel.getTechniqueVM(technique, tactic);\r\n        tvm.showSubtechniques = !tvm.showSubtechniques;\r\n    }\r\n\r\n    public onTechniqueHighlight(event: any, technique: Technique, tactic: Tactic) {\r\n        this.viewModel.highlightTechnique(technique, tactic);\r\n    }\r\n    public onTechniqueUnhighlight(event: any) {\r\n        this.viewModel.clearHighlight();\r\n    }\r\n\r\n    public onTacticClick(tactic: Tactic) {\r\n        if (this.viewModel.isTacticSelected(tactic)) this.viewModel.unselectAllTechniquesInTactic(tactic);\r\n        else this.viewModel.selectAllTechniquesInTactic(tactic);\r\n    }\r\n\r\n    public get tacticRowStyle(): any {\r\n        return this.viewModel.showTacticRowBackground ? { \r\n            \"background\": this.viewModel.tacticRowBackground,\r\n            \"color\": tinycolor.mostReadable(this.viewModel.tacticRowBackground, ['white', 'black'])\r\n         } : {}\r\n    }\r\n}\r\n\r\n// export class TechniqueEvent {\r\n//     public readonly event: Event;\r\n//     public readonly technique: Technique;\r\n//     constructor(event, technique) {\r\n//         this.technique = technique;\r\n//         this.event = event;\r\n//     }\r\n// }\r\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"crnd\";","import { Component, Input, OnInit, ViewEncapsulation } from '@angular/core';\r\nimport { Link, Metadata, ViewModel } from '../viewmodels.service';\r\n\r\n@Component({\r\n    selector: 'app-list-input',\r\n    templateUrl: './list-input.component.html',\r\n    styleUrls: ['./list-input.component.scss'],\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class ListInputComponent implements OnInit {\r\n    @Input() config: ListInputConfig;\r\n    public list: (Link|Metadata)[];\r\n    private fieldToClass = {\r\n        \"links\": Link,\r\n        \"metadata\": Metadata\r\n    }\r\n    public get includeLinks(): boolean { return this.config.type == \"links\"; }\r\n\r\n    constructor() { }\r\n\r\n    ngOnInit(): void {\r\n        if (this.config.level == 'technique') {\r\n            this.list = this.config.list.map(item => {\r\n                let clone = new this.fieldToClass[this.config.type]();\r\n                clone.deSerialize(item.serialize());\r\n                return clone;\r\n            });\r\n        } else {\r\n            this.list = this.config.list;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Adds a new item to the list\r\n     */\r\n    public add(): void {\r\n        this.list.push(new this.fieldToClass[this.config.type]());\r\n    }\r\n\r\n    /**\r\n     * Removes an item from the list at the given index\r\n     * @param i the index of the item to remove\r\n     */\r\n    public remove(i: number): void {\r\n        if (this.list[i - 1] && this.list[i - 1].divider && this.list[i + 1] && this.list[i + 1].divider) {\r\n            this.list.splice(i - 1, 2);\r\n        } else {\r\n            this.list.splice(i, 1);\r\n        }\r\n\r\n        if (this.list[0] && this.list[0].divider) this.removeDivider(0);\r\n        if (this.list[this.list.length - 1] && this.list[this.list.length - 1].divider) this.removeDivider(this.list.length - 1);\r\n\r\n        this.updateList();\r\n    }\r\n\r\n    /**\r\n     * Validate items in the list and update the field on selected techniques\r\n     */\r\n    public updateList(): void {\r\n        let value = this.list.filter(item => item.valid());\r\n\r\n        if (this.config.level == 'technique') { // do not update techniques if editing a layer-level list\r\n            this.config.viewModel.editSelectedTechniqueValues(this.config.type, value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checks if a divider can be added at the previous index\r\n     * \r\n     * Note: a divider can only be added if both the items at the current and previous\r\n     * indices are valid non-divider items.\r\n     * \r\n     * @param i the current index\r\n     * @returns true, if a divider can be added, false otherwise\r\n     */\r\n    public canAddDivider(i: number): boolean {\r\n        if (i < 1) return false; // cannot add divider before the first item\r\n        if (this.list[i] && this.list[i].valid() && !this.list[i].divider && \r\n            this.list[i - 1] && this.list[i - 1].valid() && !this.list[i - 1].divider) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Add a divider at the given index\r\n     * @param i the index at which to add a divider\r\n     */\r\n    public addDivider(i: number): void {\r\n        let item = new this.fieldToClass[this.config.type]();\r\n        item.divider = true;\r\n        this.list.splice(i, 0, item);\r\n        this.updateList();\r\n    }\r\n\r\n    /**\r\n     * Remove a divider at the given index\r\n     * @param i the index of the divider to remove\r\n     */\r\n    public removeDivider(i: number): void {\r\n        this.list.splice(i, 1);\r\n        this.updateList();\r\n    }\r\n}\r\n\r\nexport interface ListInputConfig {\r\n    /** The viewmodel */\r\n    viewModel: ViewModel;\r\n    /** The list to edit */\r\n    list: (Link|Metadata)[];\r\n    /** The item type */\r\n    type: \"links\" | \"metadata\";\r\n    /**\r\n     * Identifies whether the list exists on the technique or layer level\r\n     * If on the technique level, the list must be cloned to prevent \r\n     * empty values from being added; all selected techniques\r\n     * will be updated with the new values\r\n     * If on the layer level, the list is edited directly and does\r\n     * not update selected techniques with the new values\r\n     */\r\n    level: \"layer\" | \"technique\";\r\n    /** The label attribute of the list */\r\n    nameField: string;\r\n    /** The value attribute of the list */\r\n    valueField: string;\r\n}","<div class=\"list-container\">\r\n    <div *ngFor=\"let item of list; let i = index\">\r\n        <div class=\"divider-container\">\r\n            <!-- divider -->\r\n            <div *ngIf=\"item.divider\" class=\"divider\" (click)=\"removeDivider(i)\" matTooltipPosition=\"below\" matTooltip=\"remove divider\">\r\n                <mat-divider></mat-divider>\r\n                <button mat-icon-button class=\"icon\">-</button>\r\n                <mat-divider></mat-divider>\r\n            </div>\r\n            <div *ngIf=\"!item.divider && canAddDivider(i)\" class=\"divider-option\" (click)=\"addDivider(i)\" matTooltipPosition=\"below\" matTooltip=\"add a divider\">\r\n                <mat-divider></mat-divider>\r\n                <button mat-icon-button class=\"icon\">+</button>\r\n                <mat-divider></mat-divider>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- list item -->\r\n        <div class=\"item-container\" *ngIf=\"!item.divider\">\r\n            <mat-form-field>\r\n                <textarea matInput\r\n                        matTextareaAutosize\r\n                        [placeholder]=\"config.nameField\"\r\n                        [(ngModel)]=\"item[config.nameField]\"\r\n                        (input)=\"updateList()\">\r\n                </textarea>\r\n            </mat-form-field>\r\n            <mat-form-field>\r\n                <textarea matInput\r\n                        matTextareaAutosize\r\n                        [placeholder]=\"config.valueField\"\r\n                        [(ngModel)]=\"item[config.valueField]\"\r\n                        (input)=\"updateList()\">\r\n                </textarea>\r\n            </mat-form-field>\r\n            <a *ngIf=\"includeLinks && item.valid()\" class=\"assigned-link\" href=\"{{item[config.valueField]}}\" target=\"_blank\">{{item[config.nameField]}}</a>\r\n            <div class=\"remove-button\">\r\n                <button class=\"button\" (click)=\"remove(i)\">remove</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class=\"add-more\">\r\n    <button class=\"button\" (click)=\"add()\">add {{config.type}}</button>\r\n</div>","import { ElementRef } from \"@angular/core\";\r\n\r\nexport abstract class CellPopover {\r\n    private theElement: any;\r\n    constructor(element: ElementRef) {\r\n        this.theElement = element.nativeElement;\r\n    }\r\n\r\n    /**\r\n     * Get the location of the tooltip according to the location on the screen. \r\n     * Returns one of the following:\r\n     * \"top left\":\r\n     * ------------------\r\n     * |    XXXX      |\r\n     * |    XXXX      |\r\n     * |       X      |\r\n     * |              |\r\n     * ------------------\r\n     * \"top right\":\r\n     * ------------------\r\n     * |        XXXX  |\r\n     * |        XXXX  |\r\n     * |       X      |\r\n     * |              |\r\n     * ------------------\r\n     * \"bottom left\":\r\n     * ------------------\r\n     * |                |\r\n     * |  XXXX X        |\r\n     * |  XXXX          |\r\n     * ------------------\r\n     * \"bottom right\":\r\n     * ------------------\r\n     * |                |\r\n     * |       X XXXX   |\r\n     * |         XXXX   |\r\n     * ------------------\r\n     * @returns {string} direction\r\n     */\r\n    protected getPosition(): string {\r\n        let boundingRect = this.theElement.getBoundingClientRect();\r\n        let halfWidth = window.innerWidth / 2;\r\n        let halfHeight = window.innerHeight / 2;\r\n        let position = [];\r\n        if (boundingRect.right > halfWidth) position.push(\"left\");\r\n        else                               position.push(\"right\");\r\n        if (boundingRect.bottom > halfHeight) position.push(\"top\");\r\n        else                               position.push(\"bottom\");\r\n        return position.join(\" \");\r\n    }\r\n}","import { Component, OnInit, Inject, ViewEncapsulation, ViewChild, Renderer2 } from '@angular/core';\r\nimport { MAT_DIALOG_DATA, MatDialog } from '@angular/material/dialog';\r\nimport { MarkdownComponent, MarkdownService } from \"ngx-markdown\";\r\nimport { LayerInformationComponent } from \"../layer-information/layer-information.component\";\r\n\r\n@Component({\r\n    selector: 'help',\r\n    templateUrl: './help.component.html',\r\n    styleUrls: ['./help.component.scss'],\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class HelpComponent implements OnInit {\r\n    private listenObj: any;\r\n    @ViewChild('markdownElement', {static: false}) private markdownElement: MarkdownComponent;\r\n    public headingAnchors: MarkdownHeadingAnchor[] = [];\r\n\r\n\r\n    constructor(private dialog: MatDialog,\r\n                private markdownService: MarkdownService,\r\n                private renderer: Renderer2,\r\n                @Inject(MAT_DIALOG_DATA) public data) {}\r\n\r\n    ngOnInit(): void {\r\n        setTimeout(() => {\r\n           this.scrollTo('toc');\r\n        }, 175);\r\n\r\n        let self = this;\r\n        this.markdownService.renderer.heading = (text: string, level: number) => {\r\n            let img = text.match(/(<img src(.*?)>)/g) ? text.match(/(<img src(.*?)>)/g)[0].replace(/(nav-app\\/src\\/)/g, '') : '';\r\n            text = text.replace(/(<img src(.*?)>)/g, '');\r\n            const escapedText = text.toLowerCase().trim().replace(/[^\\w]+/g, '-');\r\n            self.headingAnchors.push({\r\n                level: level,\r\n                anchor: escapedText,\r\n                label: text.replace(\"&amp;\", \"&\")\r\n            });\r\n            return '<h' + level + ' class=\"' + escapedText + '\">' + img +\r\n              text +\r\n              '</h' + level + '>';\r\n        }\r\n\r\n        this.markdownService.renderer.html = (html: string) => {\r\n            if (!html.match(/(nav-app\\/src\\/)/g))\r\n                return html;\r\n            return html.replace(/(nav-app\\/src\\/)/g, '');\r\n        }\r\n    }\r\n\r\n    // from https://github.com/jfcere/ngx-markdown/issues/125#issuecomment-518025821\r\n    public onMarkdownLoad(e) {\r\n        // hijack clicks on links\r\n        if (this.markdownElement) {\r\n            this.listenObj = this.renderer.listen(this.markdownElement.element.nativeElement, 'click', (e: Event) => {\r\n                if (e.target && (e.target as any).tagName === 'A') {\r\n                    const el = (e.target as HTMLElement);\r\n                    const linkURL = el.getAttribute && el.getAttribute('href');\r\n                    if (linkURL) {\r\n                        e.preventDefault();\r\n                        if (linkURL.charAt(0) === '#') this.scrollTo(linkURL.replace('#', ''));\r\n                        else if (linkURL.includes('layers/')) this.openLayerDialog();\r\n                        else if (linkURL.match((/(nav-app\\/src\\/)/g))) window.open(linkURL.replace(/(nav-app\\/src\\/)/g, ''))\r\n                        else window.open(linkURL);\r\n                    }\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        if (this.listenObj) {\r\n            this.listenObj();\r\n        }\r\n    }\r\n\r\n    public scrollTo(anchor) {\r\n        let element = document.querySelector(\".\" + anchor);\r\n        if (element) element.scrollIntoView({behavior: 'smooth', block: 'start', inline: 'nearest'});\r\n    }\r\n\r\n    /**\r\n     * open the layer information dialog\r\n     */\r\n    openLayerDialog() {\r\n        this.dialog.open(LayerInformationComponent, {\r\n            maxWidth: \"90ch\"\r\n        });\r\n    }\r\n}\r\n\r\n\r\ninterface MarkdownHeadingAnchor {\r\n    level: number,\r\n    anchor: string,\r\n    label: string\r\n}\r\n","<div class=\"help-dialog\">\r\n    <div class=\"content markdown\">\r\n        <div class=\"col toc\">\r\n            <h1>Table of Contents</h1>\r\n            <ul class=\"table-of-contents\" *ngIf=\"headingAnchors.length > 0\">\r\n                <li *ngFor=\"let heading of headingAnchors\" class=\"toc-heading level-{{heading.level}}\">\r\n                    <a (click)=\"scrollTo(heading.anchor)\">{{heading.label}}</a>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <markdown #markdownElement [src]=\"'./USAGE.md'\" (load)=\"onMarkdownLoad($event)\"></markdown>\r\n    </div>\r\n    <div class=\"top-button\">\r\n        <button mat-button (click)=\"scrollTo('toc')\">Top ^</button>\r\n    </div>\r\n    <div class=\"close-button\">\r\n        <button mat-button mat-dialog-close>close</button>\r\n    </div>\r\n</div>\r\n","import { Component, OnInit, ViewEncapsulation } from '@angular/core';\r\nimport { MatrixCommon } from '../matrix-common';\r\nimport { ConfigService } from '../../config.service';\r\nimport { ViewModelsService } from '../../viewmodels.service';\r\n\r\n@Component({\r\n  selector: 'matrix-flat',\r\n  templateUrl: './matrix-flat.component.html',\r\n  styleUrls: ['./matrix-flat.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class MatrixFlatComponent extends MatrixCommon implements OnInit  {\r\n\r\n    constructor(configService: ConfigService, viewModelsService: ViewModelsService) {\r\n        super(configService, viewModelsService);\r\n    }\r\n\r\n    ngOnInit() {}\r\n}\r\n","<table class=\"matrix flat\">\r\n    <thead [ngStyle]=\"tacticRowStyle\">\r\n        <tr>\r\n            <td *ngFor=\"let tactic of filterTactics(matrix.tactics)\" class=\"tactic name\">\r\n                <a (click)=\"onTacticClick(tactic)\">\r\n                    <tactic-cell [viewModel]=\"viewModel\" [tactic]=\"tactic\"></tactic-cell>\r\n                </a>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td *ngFor=\"let tactic of filterTactics(matrix.tactics)\" class=\"tactic count\">\r\n                {{filterTechniques(tactic.techniques, tactic).length }}<ng-container *ngIf=\"viewModel.layout.showName\">&nbsp;techniques</ng-container>\r\n            </td>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr>\r\n            <td *ngFor=\"let tactic of filterTactics(matrix.tactics)\" class=\"tactic\">\r\n                <ng-container *ngFor=\"let technique of applyControls(tactic.techniques, tactic)\">\r\n                    <ng-container *ngIf=\"technique.subtechniques.length == 0; else supertechnique\">\r\n                        <technique-cell\r\n                                        [tactic]=\"tactic\"\r\n                                        [technique]=\"technique\" \r\n                                        [viewModel]=\"viewModel\"\r\n                                        [matrix]=\"matrix\"\r\n                                        (leftclick)=\"onTechniqueLeftClick($event, technique, tactic)\"\r\n                                        (rightclick)=\"onTechniqueRightClick($event, technique)\"\r\n                                        (highlight)=\"onTechniqueHighlight($event, technique, tactic)\"\r\n                                        (unhighlight)=\"onTechniqueUnhighlight($event)\">\r\n                        </technique-cell>\r\n                    </ng-container>\r\n                    <ng-template #supertechnique>\r\n                        <table class=\"supertechnique\">\r\n                            <tr>\r\n                                <td *ngIf=\"technique.subtechniques.length > 0\" class=\"sidebar technique\" [ngClass]=\"{disabled: applyControls(technique.subtechniques, tactic).length == 0}\" (click)=\"onToggleSubtechniquesVisible(technique, tactic)\">\r\n                                    <div class=\"handle\"> = </div>\r\n                                </td>\r\n                                <td class=\"technique\">\r\n                                    <technique-cell\r\n                                                    [tactic]=\"tactic\"\r\n                                                    [technique]=\"technique\" \r\n                                                    [viewModel]=\"viewModel\"\r\n                                                    [matrix]=\"matrix\"\r\n                                                    (leftclick)=\"onTechniqueLeftClick($event, technique, tactic)\"\r\n                                                    (rightclick)=\"onTechniqueRightClick($event, technique)\"\r\n                                                    (highlight)=\"onTechniqueHighlight($event, technique, tactic)\"\r\n                                                    (unhighlight)=\"onTechniqueUnhighlight($event)\">\r\n                                    </technique-cell>\r\n                                </td>\r\n                            </tr>\r\n                            <tr class=\"subtechniques-row subtechniques-container\" [class.hidden]=\"!viewModel.getTechniqueVM(technique, tactic).showSubtechniques\">\r\n                                <td *ngIf=\"applyControls(technique.subtechniques, tactic).length > 0\" class=\"sidebar subtechniques\">\r\n                                    <svg width=\"12px\" height=\"12px\">\r\n                                        <path d=\"M0 0H12V12Z\"/>\r\n                                    </svg>\r\n                                </td>\r\n                                <td class=\"subtechniques\">\r\n                                    <div class=\"subtechniques\">\r\n                                        <technique-cell \r\n                                                *ngFor=\"let subtechnique of applyControls(technique.subtechniques, tactic)\"\r\n                                                [tactic]=\"tactic\"\r\n                                                [technique]=\"subtechnique\" \r\n                                                [viewModel]=\"viewModel\"\r\n                                                [matrix]=\"matrix\"\r\n                                                (leftclick)=\"onTechniqueLeftClick($event, subtechnique, tactic)\"\r\n                                                (rightclick)=\"onTechniqueRightClick($event, subtechnique)\"\r\n                                                (highlight)=\"onTechniqueHighlight($event, subtechnique, tactic)\"\r\n                                                (unhighlight)=\"onTechniqueUnhighlight($event)\">\r\n                                        </technique-cell>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                    </ng-template>\r\n                </ng-container>\r\n            </td>\r\n        </tr>\r\n    </tbody>\r\n</table>","// utilities for working with browser cookies\r\n\r\n\r\n/**\r\n * Set a cookie\r\n * @param  {string} key            key to set under\r\n * @param  {string} value          value to set under key\r\n * @param  {number} expirationDays when cookie expires in days\r\n */\r\n const setCookie = function(key: string, value: string, expirationDays: number) {\r\n    let d = new Date();\r\n    d.setTime(d.getTime() + (expirationDays*24*60*60*1000));\r\n    let expires = \"expires=\"+ d.toUTCString();\r\n    document.cookie = key + \"=\" + value + \";\" + expires + \";path=/;SameSite=Strict\";\r\n}\r\n\r\n/**\r\n * Get the value of the cookie under the given key\r\n * @param  {string} key to retrieve from\r\n * @return {string}     cookie value\r\n */\r\nconst getCookie = function(key: string): string {\r\n    let name = key + \"=\";\r\n    let decodedCookie = decodeURIComponent(document.cookie);\r\n    let ca = decodedCookie.split(';');\r\n    for(let i = 0; i <ca.length; i++) {\r\n        let c = ca[i];\r\n        while (c.charAt(0) == ' ') {\r\n            c = c.substring(1);\r\n        }\r\n        if (c.indexOf(name) == 0) {\r\n            return c.substring(name.length, c.length);\r\n        }\r\n    }\r\n    return \"\";\r\n}\r\n/**\r\n * Does a cookie exist under the given key?\r\n * @param  {string} key to check\r\n * @return {boolean}    true if cookie is stored under key, false otherwise\r\n */\r\nconst hasCookie = function(key: string): boolean {\r\n    return getCookie(key) !== \"\";\r\n}\r\n\r\n/**\r\n * Delete the given cookie\r\n * @param {string} key to delete\r\n */\r\nconst deleteCookie = function(key: string) {\r\n  document.cookie = key + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/;SameSite=Strict';\r\n}\r\n\r\nexport {setCookie, getCookie, hasCookie, deleteCookie};\r\n","import { EventEmitter, Injectable, Output } from '@angular/core';\r\nimport { DataService, Technique, Tactic, Matrix, Domain, VersionChangelog } from \"./data.service\";\r\nimport * as tinygradient from 'tinygradient';\r\nimport * as tinycolor from 'tinycolor2';\r\nimport { evaluate } from 'mathjs';\r\nimport * as globals from './globals'; //global variables\r\nimport * as is from 'is_js';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ViewModelsService {\r\n    @Output() onSelectionChange = new EventEmitter<any>();\r\n    pinnedCell = \"\";\r\n\r\n    constructor(private dataService: DataService) { }\r\n\r\n    viewModels: ViewModel[] = [];\r\n\r\n    /**\r\n     * Emit event when technique selection changes\r\n     */\r\n    selectionChanged() {\r\n        this.onSelectionChange.emit();\r\n    }\r\n\r\n    /**\r\n     * Create and return a new viewModel\r\n     * @param {string} name the viewmodel name\r\n     * @param {string} domainVersionID the ID of the domain & version\r\n     * @return {ViewModel} the created ViewModel\r\n     */\r\n    newViewModel(name: string, domainVersionID: string) {\r\n        let vm = new ViewModel(name, \"vm\"+ this.getNonce(), domainVersionID, this.dataService);\r\n        this.viewModels.push(vm);\r\n        return vm;\r\n    }\r\n\r\n    nonce: number = 0;\r\n    /**\r\n     * Get a nonce.\r\n     * @return a number that will never be regenerated by sequential calls to getNonce.\r\n     *         Note: this applies on a session-by-session basis, nonces are not\r\n     *         unique between app instances.\r\n     */\r\n    getNonce(): number {\r\n        return this.nonce++;\r\n    }\r\n\r\n    /**\r\n     * Destroy the viewmodel completely Nessecary if tab is closed!\r\n     * @param vm viewmodel to destroy.\r\n     */\r\n    destroyViewModel(vm: ViewModel): void {\r\n        for (let i = 0; i < this.viewModels.length; i++) {\r\n            if (this.viewModels[i] == vm) {\r\n                // console.log(\"destroying viewmodel\", vm)\r\n                this.viewModels.splice(i,1)\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * layer combination operation\r\n     * @param  domainVersionID  domain & version ID\r\n     * @param  scoreExpression  math expression of score expression\r\n     * @param  scoreVariables   variables in math expression, mapping to viewmodel they correspond to\r\n     * @param  comments         what viewmodel to inherit comments from\r\n     * @param  links            what viewmodel to inherit links from\r\n     * @param  metadata         what viewmodel to inherit technique metadata from\r\n     * @param  coloring         what viewmodel to inherit manual colors from\r\n     * @param  enabledness      what viewmodel to inherit state from\r\n     * @param  layerName        new layer name\r\n     * @param  filters          viewmodel to inherit filters from\r\n     * @return                  new viewmodel inheriting above properties\r\n     */\r\n    layerLayerOperation(domainVersionID: string, scoreExpression: string, scoreVariables: Map<string, ViewModel>, comments: ViewModel, links: ViewModel, metadata: ViewModel, gradient: ViewModel, coloring: ViewModel, enabledness: ViewModel, layerName: string, filters: ViewModel, legendItems: ViewModel): ViewModel {\r\n        let result = new ViewModel(\"layer by operation\", \"vm\" + this.getNonce(), domainVersionID, this.dataService);\r\n\r\n        if (scoreExpression) {\r\n            scoreExpression = scoreExpression.toLowerCase() //should be enforced by input, but just in case\r\n            let score_min = Infinity;\r\n            let score_max = -Infinity;\r\n\r\n            //get list of all technique IDs used in the VMs\r\n            let techniqueIDs = new Set<string>();\r\n            scoreVariables.forEach(function(vm, key) {\r\n                vm.techniqueVMs.forEach(function(techniqueVM, techniqueID) {\r\n                    techniqueIDs.add(techniqueID);\r\n                })\r\n            })\r\n            //attempt to evaluate without a scope to catch the case of a static assignment\r\n            try {\r\n                // evaluate with an empty scope\r\n                let mathResult = evaluate(scoreExpression, {});\r\n                // if it didn't except after this, it evaluated to a single result.\r\n                console.log(\"score expression evaluated to single result to be applied to all techniques\");\r\n                if (is.boolean(mathResult)) {\r\n                    mathResult = mathResult ? \"1\" : \"0\"; //boolean to binary\r\n                } else if (is.not.number(mathResult)) { //user inputted something weird, complain about it\r\n                    throw {message: \"math result ( \" + mathResult + \" ) is not a number\"};\r\n                }\r\n                // if it didn't error, and outputted a single value, apply this to all techniques.\r\n                result.initializeScoresTo = String(mathResult); //initialize scores to this value\r\n                score_min = mathResult;\r\n                score_max = mathResult;\r\n            } catch(err) { //couldn't evaluate with empty scope, build scope for each technique\r\n                // compute the score of each techniqueID\r\n                techniqueIDs.forEach(function(technique_id) {\r\n                    let new_tvm = new TechniqueVM(technique_id);\r\n                    let scope = {};\r\n                    let misses = 0; //number of times a VM is missing the value\r\n                    scoreVariables.forEach(function(vm, key) {\r\n                        let scoreValue: number;\r\n                        if (!vm.hasTechniqueVM_id(technique_id)) { //missing technique\r\n                            scoreValue = 0;\r\n                            misses++;\r\n                        } else { //technique exists\r\n                            let score = vm.getTechniqueVM_id(technique_id).score;\r\n                            if (score == \"\") {\r\n                                scoreValue = 0;\r\n                                misses++;\r\n                            } else if (isNaN(Number(score))) {\r\n                                scoreValue = 0;\r\n                                misses++;\r\n                            } else {\r\n                                scoreValue = Number(score);\r\n                            }\r\n                        }\r\n                        scope[key] = scoreValue;\r\n                    });\r\n                    //don't record a result if none of VMs had a score for this technique\r\n                    //did at least one technique have a score for this technique?\r\n                    if (misses < scoreVariables.size) {\r\n                        let mathResult = evaluate(scoreExpression, scope);\r\n                        if (is.boolean(mathResult)) {\r\n                            mathResult = mathResult ? \"1\" : \"0\"; //boolean to binary\r\n                        } else if (is.not.number(mathResult)) { //user inputted something weird, complain about it\r\n                            throw {message: \"math result ( \" + mathResult + \" ) is not a number\"};\r\n                        }\r\n                        new_tvm.score = String(mathResult);\r\n                        result.techniqueVMs.set(technique_id, new_tvm);\r\n\r\n                        score_min = Math.min(score_min, mathResult);\r\n                        score_max = Math.max(score_max, mathResult);\r\n                    }\r\n                })\r\n            }\r\n            //don't do gradient if there's no range of values\r\n            if (score_min != score_max) {\r\n                // set up gradient according to result range\r\n                if (score_min != Infinity) result.gradient.minValue = score_min;\r\n                if (score_max != -Infinity) result.gradient.maxValue = score_max;\r\n                // if it's a binary range, set to transparentblue gradient\r\n                if (score_min == 0 && score_max == 1) result.gradient.setGradientPreset(\"transparentblue\");\r\n            }\r\n        }\r\n\r\n\r\n        /**\r\n         * Inherit a field from a vm\r\n         * @param  {ViewModel} inherit_vm the viewModel to inherit from\r\n         * @param  {string}    fieldname  the field to inherit from the viewmodel\r\n         */\r\n        function inherit(inherit_vm: ViewModel, fieldname: string) {\r\n            // console.log(\"inherit\", fieldname)\r\n            inherit_vm.techniqueVMs.forEach(function(inherit_TVM) {\r\n                let tvm = result.hasTechniqueVM_id(inherit_TVM.technique_tactic_union_id) ? result.getTechniqueVM_id(inherit_TVM.technique_tactic_union_id) : new TechniqueVM(inherit_TVM.technique_tactic_union_id)\r\n                tvm[fieldname] = inherit_TVM[fieldname];\r\n                result.techniqueVMs.set(inherit_TVM.technique_tactic_union_id, tvm);\r\n            })\r\n        }\r\n\r\n        if (comments) inherit(comments, \"comment\");\r\n        if (links) inherit(links, \"links\");\r\n        if (metadata) inherit(metadata, \"metadata\");\r\n        if (coloring) inherit(coloring, \"color\");\r\n        if (enabledness) inherit(enabledness, \"enabled\");\r\n\r\n        if (filters) { //copy filter settings\r\n            result.filters.deSerialize(JSON.parse(filters.filters.serialize()))\r\n        }\r\n\r\n        if (legendItems) {\r\n            result.legendItems = JSON.parse(JSON.stringify(legendItems.legendItems));\r\n        }\r\n\r\n        if (gradient) {\r\n            result.gradient = new Gradient();\r\n            result.gradient.deSerialize(gradient.gradient.serialize());\r\n        }\r\n\r\n        result.name = layerName;\r\n        // console.log(result)\r\n        this.viewModels.push(result)\r\n        result.updateGradient();\r\n        return result;\r\n    } //end layer layer operation\r\n}\r\n\r\n\r\n\r\n/**\r\n * Gradient class used by viewmodels\r\n */\r\nexport class Gradient {\r\n    //official colors used in gradients:\r\n\r\n    colors: Gcolor[] = [new Gcolor(\"red\"), new Gcolor(\"green\")]; //current colors\r\n    // options: string[] = [\"white\", \"red\", \"orange\", \"yellow\", \"green\", \"blue\", \"purple\"]; //possible colors\r\n    options: string[] = [\"#ffffff\", \"#ff6666\", \"#ffaf66\",\"#ffe766\", \"#8ec843\", \"#66b1ff\", \"#ff66f4\"]; //possible colors\r\n    minValue: number = 0;\r\n    maxValue: number = 100;\r\n    gradient: any;\r\n    gradientRGB: any;\r\n\r\n    /**\r\n     * Create a string version of this gradient\r\n     * @return string version of gradient\r\n     */\r\n    serialize(): string {\r\n        let colorList: string[] = [];\r\n        let self = this;\r\n        this.colors.forEach(function(gColor: Gcolor) {\r\n            let hexstring = (tinycolor(gColor.color).toHex8String()); // include the alpha channel\r\n            colorList.push(hexstring)\r\n        });\r\n\r\n        let rep = {\r\n                \"colors\": colorList,\r\n                \"minValue\": this.minValue,\r\n                \"maxValue\": this.maxValue,\r\n              }\r\n        return JSON.stringify(rep, null, \"\\t\")\r\n    }\r\n\r\n    /**\r\n     * Restore this gradient from the given serialized representation\r\n     * @param  rep serialized gradient\r\n     */\r\n    deSerialize(rep: string): void {\r\n        let obj = JSON.parse(rep)\r\n        let isColorStringArray = function(check): boolean {\r\n            for (let i = 0; i < check.length; i++) {\r\n                if (typeof(check[i]) !== \"string\" || !tinycolor(check[i]).isValid()) {\r\n                    console.error(\"TypeError:\", check[i], \"(\",typeof(check[i]),\")\", \"is not a color-string\")\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n\r\n\r\n        if (isColorStringArray(obj.colors)) {\r\n            this.colors = []\r\n            let self = this;\r\n            obj.colors.forEach(function(hex: string) {\r\n                self.colors.push(new Gcolor(hex));\r\n            });\r\n        } else console.error(\"TypeError: gradient colors field is not a color-string[]\")\r\n        this.minValue = obj.minValue;\r\n        this.maxValue = obj.maxValue;\r\n        this.updateGradient();\r\n    }\r\n\r\n    //presets in dropdown menu\r\n    presets = {\r\n        redgreen: [new Gcolor(\"#ff6666\"), new Gcolor(\"#ffe766\"), new Gcolor(\"#8ec843\")],\r\n        greenred: [new Gcolor(\"#8ec843\"), new Gcolor(\"#ffe766\"), new Gcolor(\"#ff6666\")],\r\n        bluered: [new Gcolor(\"#66b1ff\"), new Gcolor(\"#ff66f4\"), new Gcolor(\"#ff6666\")],\r\n        redblue: [new Gcolor(\"#ff6666\"), new Gcolor(\"#ff66f4\"), new Gcolor(\"#66b1ff\")],\r\n        transparentblue: [new Gcolor(\"#ffffff00\"), new Gcolor(\"#66b1ff\")],\r\n        transparentred: [new Gcolor(\"#ffffff00\"), new Gcolor(\"#ff6666\")]\r\n    }\r\n\r\n    /**\r\n     * Convert a preset to tinycolor array\r\n     * @param  preset preset name from preset array\r\n     * @return        [description]\r\n     */\r\n    presetToTinyColor(preset) {\r\n        let colorarray = []\r\n        let self = this;\r\n        this.presets[preset].forEach(function(gcolor: Gcolor) {\r\n            colorarray.push(gcolor.color);\r\n        });\r\n        return tinygradient(colorarray).css('linear', 'to right');\r\n    }\r\n\r\n    constructor() { this.setGradientPreset('redgreen'); }\r\n\r\n    /**\r\n     * set this gradient to use the preset\r\n     * @param  preset preset to use\r\n     */\r\n    setGradientPreset(preset: string): void {\r\n        this.colors = this.presets[preset].map((color: Gcolor) => new Gcolor(color.color)); //deep copy gradient preset\r\n        this.updateGradient();\r\n    }\r\n\r\n    /**\r\n     * recompute gradient\r\n     */\r\n    updateGradient(): void {\r\n        let colorarray = [];\r\n        let self = this;\r\n        this.colors.forEach(function(colorobj) {\r\n            // figure out what kind of color this is\r\n            // let format = tinycolor(colorobj.color).getFormat();\r\n            // if (format == \"name\" && colorobj.color in self.labelToColor)\r\n            colorarray.push(colorobj.color)\r\n        });\r\n        this.gradient = tinygradient(colorarray);\r\n        this.gradientRGB = this.gradient.rgb(100);\r\n    }\r\n\r\n    /**\r\n     * Add a color to the end of the gradient\r\n     */\r\n    addColor(): void {\r\n        this.colors.push(new Gcolor(this.colors[this.colors.length - 1].color));\r\n    }\r\n\r\n    /**\r\n     * Remove color at the given index\r\n     * @param index index to remove color at\r\n     */\r\n    removeColor(index): void {\r\n        this.colors.splice(index, 1)\r\n    }\r\n\r\n    // get the gradient color for a given value in the scale. Value is string format number\r\n    getColor(valueString: string) {\r\n        if (!this.gradient) this.updateGradient();\r\n\r\n        let value: number;\r\n        if (valueString.length == 0) return;\r\n        else value = Number(valueString);\r\n\r\n        if (value >= this.maxValue) { return this.gradientRGB[this.gradientRGB.length - 1]; }\r\n        if (value <= this.minValue) { return this.gradientRGB[0]; }\r\n        let index = (value - this.minValue)/(this.maxValue - this.minValue) * 100;\r\n        // console.log(value, \"->\", index)\r\n        return this.gradientRGB[Math.round(index)];\r\n    }\r\n}\r\n//a color in the gradient\r\nexport class Gcolor {color: string; constructor(color: string) {this.color = color}};\r\n\r\n//semi-synonymous with \"layer\"\r\nexport class ViewModel {\r\n    // PROPERTIES & DEFAULTS\r\n\r\n    name: string; // layer name\r\n    domain: string = \"\"; // attack domain\r\n    version: string = \"\"; // attack version\r\n    domainVersionID: string; // layer domain & version\r\n    description: string = \"\"; //layer description\r\n    uid: string; //unique identifier for this ViewModel. Do not serialize, let it get initialized by the VmService\r\n    bundleURL: string; // the STIX bundle URL that a custom layer was loaded from\r\n    loaded: boolean = false; // whether or not techniqueVMs are loaded\r\n\r\n    filters: Filter;\r\n\r\n    metadata: Metadata[] = [];\r\n    links: Link[] = [];\r\n\r\n    /*\r\n     * sorting int meanings (see filterTechniques()):\r\n     * 0: ascending alphabetically\r\n     * 1: descending alphabetically\r\n     * 2: ascending numerically\r\n     * 3: descending numerically\r\n     */\r\n    sorting: number = 0;\r\n\r\n    layout: LayoutOptions = new LayoutOptions();\r\n\r\n\r\n    hideDisabled: boolean = false; //are disabled techniques hidden?\r\n\r\n\r\n    gradient: Gradient = new Gradient(); //gradient for scores\r\n\r\n    backgroundPresets: string[] = ['#e60d0d', '#fc3b3b', '#fc6b6b', '#fca2a2', '#e6550d', '#fd8d3c', '#fdae6b', '#fdd0a2', '#e6d60d', '#fce93b', '#fcf26b', '#fcf3a2', '#31a354', '#74c476', '#a1d99b', '#c7e9c0', '#3182bd', '#6baed6', '#9ecae1', '#c6dbef', '#756bb1', '#9e9ac8', '#bcbddc', '#dadaeb', '#636363', '#969696', '#bdbdbd', '#d9d9d9'];\r\n    legendColorPresets: string[] = [];\r\n\r\n    selectTechniquesAcrossTactics: boolean = true;\r\n    selectSubtechniquesWithParent: boolean = false;\r\n\r\n    needsToConstructTechniqueVMs = false;\r\n    legacyTechniques = [];\r\n\r\n    initializeScoresTo = \"\"; //value to initialize scores to\r\n\r\n    techIDtoUIDMap: Object = {};\r\n    techUIDtoIDMap: Object = {};\r\n\r\n    compareTo?: ViewModel;\r\n    versionChangelog?: VersionChangelog;\r\n\r\n    private _sidebarOpened: boolean;\r\n    public get sidebarOpened(): boolean { return this._sidebarOpened; };\r\n    public set sidebarOpened(newVal: boolean) { this._sidebarOpened = newVal; };\r\n\r\n    public readonly sidebarContentTypes = ['layerUpgrade', 'search'];\r\n    private _sidebarContentType: string;\r\n    public get sidebarContentType(): string { return this._sidebarContentType; };\r\n    public set sidebarContentType(newVal: string) {\r\n        if (this.sidebarContentTypes.includes(newVal)) this._sidebarContentType = newVal;\r\n        else this._sidebarContentType = '';\r\n    };\r\n\r\n    constructor(name: string, uid: string, domainVersionID: string, private dataService: DataService) {\r\n        this.domainVersionID = domainVersionID;\r\n        console.log(\"initializing ViewModel '\" + name + \"'\");\r\n        this.filters = new Filter();\r\n        this.name = name;\r\n        this.uid = uid;\r\n    }\r\n\r\n    loadVMData() {\r\n        let domain = this.dataService.getDomain(this.domainVersionID);\r\n        if (domain.isCustom) {\r\n            this.bundleURL = domain.urls[0];\r\n        }\r\n\r\n        if (!this.domainVersionID || !domain.dataLoaded) {\r\n            let self = this;\r\n            this.dataService.onDataLoad(this.domainVersionID, function() {\r\n                self.initTechniqueVMs()\r\n                self.filters.initPlatformOptions(self.dataService.getDomain(self.domainVersionID));\r\n            });\r\n        } else {\r\n            this.initTechniqueVMs();\r\n            this.filters.initPlatformOptions(domain);\r\n        }\r\n        this.loaded = true;\r\n    }\r\n\r\n    initTechniqueVMs() {\r\n        console.log(this.name, \"initializing technique VMs\");\r\n        for (let technique of this.dataService.getDomain(this.domainVersionID).techniques) {\r\n            for (let id of technique.get_all_technique_tactic_ids()) {\r\n                let techniqueVM = new TechniqueVM(id);\r\n                techniqueVM.score = this.initializeScoresTo;\r\n                this.setTechniqueVM(techniqueVM, false);\r\n            }\r\n            //init subtechniques\r\n            for (let subtechnique of technique.subtechniques) {\r\n                for (let id of subtechnique.get_all_technique_tactic_ids()) {\r\n                    let techniqueVM = new TechniqueVM(id);\r\n                    techniqueVM.score = this.initializeScoresTo;\r\n                    this.setTechniqueVM(techniqueVM, false);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // changeTechniqueIDSelectionLock() {\r\n    //     this.selectTechniquesAcrossTactics = !this.selectTechniquesAcrossTactics;\r\n    // }\r\n\r\n    showTacticRowBackground: boolean = false;\r\n    tacticRowBackground: string = \"#dddddd\";\r\n\r\n    // getTechniqueIDFromUID(technique_tactic_union_id: string){\r\n    //     return this.techIDtoUIDMap[technique_tactic_union_id];\r\n    // }\r\n\r\n    // getTechniquesUIDFromID(technique_id: string){\r\n    //     return this.techIDtoUIDMap[technique_id];\r\n    // }\r\n\r\n    // setTechniqueMaps(techIDtoUIDMapt, techUIDtoIDMapt){\r\n    //     this.techIDtoUIDMap = Object.freeze(techIDtoUIDMapt);\r\n    //     this.techUIDtoIDMap = Object.freeze(techUIDtoIDMapt);\r\n    // }\r\n\r\n     //  _____ ___ ___ _  _ _  _ ___ ___  _   _ ___     _   ___ ___\r\n     // |_   _| __/ __| || | \\| |_ _/ _ \\| | | | __|   /_\\ | _ \\_ _|\r\n     //   | | | _| (__| __ | .` || | (_) | |_| | _|   / _ \\|  _/| |\r\n     //   |_| |___\\___|_||_|_|\\_|___\\__\\_\\\\___/|___| /_/ \\_\\_| |___|\r\n\r\n    techniqueVMs: Map<string, TechniqueVM> = new Map<string, TechniqueVM>(); //configuration for each technique\r\n    // Getter\r\n    public getTechniqueVM(technique: Technique, tactic: Tactic): TechniqueVM {\r\n        if (!this.hasTechniqueVM(technique, tactic)) throw Error(\"technique VM not found: \" + technique.attackID + \", \" + tactic.attackID);\r\n        return this.techniqueVMs.get(technique.get_technique_tactic_id(tactic));\r\n    }\r\n    public getTechniqueVM_id(technique_tactic_id: string): TechniqueVM {\r\n        if (!this.hasTechniqueVM_id(technique_tactic_id)) throw Error(\"technique VM not found: \" + technique_tactic_id);\r\n        return this.techniqueVMs.get(technique_tactic_id);\r\n    }\r\n    /**\r\n     * setter\r\n     * @param {techniqueVM} techniqueVM: the techniqueVM to set\r\n     * @param {boolean} overwrite (default true) if true, overwrite existing techniqueVMs under that ID.\r\n     */\r\n    public setTechniqueVM(techniqueVM: TechniqueVM, overwrite=true): void {\r\n        if (this.techniqueVMs.has(techniqueVM.technique_tactic_union_id)) {\r\n            if (overwrite) this.techniqueVMs.delete(techniqueVM.technique_tactic_union_id)\r\n            else return;\r\n        }\r\n        this.techniqueVMs.set(techniqueVM.technique_tactic_union_id, techniqueVM);\r\n    }\r\n    //checker\r\n    public hasTechniqueVM(technique: Technique, tactic: Tactic): boolean {\r\n        return this.techniqueVMs.has(technique.get_technique_tactic_id(tactic));\r\n    }\r\n    public hasTechniqueVM_id(technique_tactic_id: string): boolean {\r\n        return this.techniqueVMs.has(technique_tactic_id);\r\n    }\r\n\r\n    //  ___ ___ ___ _____ ___ _  _  ___     _   ___ ___\r\n    // | __|   \\_ _|_   _|_ _| \\| |/ __|   /_\\ | _ \\_ _|\r\n    // | _|| |) | |  | |  | || .` | (_ |  / _ \\|  _/| |\r\n    // |___|___/___| |_| |___|_|\\_|\\___| /_/ \\_\\_| |___|\r\n\r\n\r\n    public highlightedTactic: Tactic = null;\r\n    public highlightedTechniques: Set<string> = new Set<string>();\r\n    public highlightedTechnique: Technique = null; // the Technique that was actually moused over\r\n\r\n    /**\r\n     * Highlight the given technique under the given tactic\r\n     * @param {Technique} technique to highlight\r\n     * @param {Tactic} tactic wherein the technique occurs\r\n     */\r\n    public highlightTechnique(technique: Technique, tactic?: Tactic | null) {\r\n        if (this.selectSubtechniquesWithParent && technique.isSubtechnique) this.highlightedTechniques.add(technique.parent.id);\r\n        this.highlightedTechnique = technique;\r\n        this.highlightedTechniques.add(technique.id);\r\n        this.highlightedTactic = tactic;\r\n    }\r\n    /**\r\n     * Clear the technique highlight\r\n     */\r\n    public clearHighlight() {\r\n        this.highlightedTactic = null;\r\n        this.highlightedTechnique = null;\r\n        this.highlightedTechniques = new Set<string>();\r\n    }\r\n\r\n    /**\r\n     * currently selected techniques in technique_tactic_id format\r\n     */\r\n    private selectedTechniques: Set<string> = new Set<string>();\r\n\r\n    /**\r\n     * Select the given technique. Depending on selectTechniquesAcrossTactics, either selects in all tactics or in given tactic\r\n     * @param {Technique} technique to select\r\n     * @param {Tactic} tactic wherein the technique occurs\r\n     */\r\n    public selectTechnique(technique: Technique, tactic: Tactic): void {\r\n        if (this.selectTechniquesAcrossTactics) this.selectTechniqueAcrossTactics(technique);\r\n        else (this.selectTechniqueInTactic(technique, tactic));\r\n    }\r\n\r\n    /**\r\n     * unselect the given technique. Depending on selectTechniquesAcrossTactics, either unselects in all tactics or in given tactic\r\n     * @param {Technique} technique to select\r\n     * @param {Tactic} tactic wherein the technique occurs\r\n     */\r\n    public unselectTechnique(technique: Technique, tactic: Tactic): void {\r\n        if (this.selectTechniquesAcrossTactics) this.unselectTechniqueAcrossTactics(technique);\r\n        else (this.unselectTechniqueInTactic(technique, tactic));\r\n    }\r\n\r\n    /**\r\n     * select the given technique in the given tactic\r\n     * @param {Technique} technique to select\r\n     * @param {Tactic} tactic wherein the technique occurs\r\n     * @param {boolean} walkChildren (recursion helper) if true and selectSubtechniquesWithParent is true, walk selection up to parent technique\r\n     */\r\n    public selectTechniqueInTactic(technique: Technique, tactic: Tactic, walkChildren=true): void {\r\n        if (this.selectSubtechniquesWithParent && walkChildren) { //check parent / children / siblings\r\n            if (technique.isSubtechnique) { //select from parent\r\n                this.selectTechniqueInTactic(technique.parent, tactic, true);\r\n                return;\r\n            } else { //select subtechniques\r\n                for (let subtechnique of technique.subtechniques) {\r\n                    this.selectTechniqueInTactic(subtechnique, tactic, false);\r\n                }\r\n            }\r\n        }\r\n        let technique_tactic_id = technique.get_technique_tactic_id(tactic);\r\n        if (!this.isCurrentlyEditing()) this.activeTvm = this.getTechniqueVM_id(technique_tactic_id); // first selection\r\n        this.selectedTechniques.add(technique_tactic_id);\r\n        this.checkValues(true, technique_tactic_id);\r\n    }\r\n\r\n    /**\r\n     * select all techniques under the given tactic\r\n     * @param {Tactic} tactic wherein the techniques occur\r\n     */\r\n    public selectAllTechniquesInTactic(tactic: Tactic): void {\r\n        for (let technique of tactic.techniques) {\r\n            this.selectTechnique(technique, tactic);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * select the given technique across all tactics in which it occurs\r\n     * @param {Technique} technique to select\r\n     * @param {boolean} walkChildren (recursion helper) if true and selectSubtechniquesWithParent is true, walk selection up to parent technique\r\n     * @param highlightTechniques, if true, highlight techniques rather than add to selected techniques group\r\n     */\r\n    public selectTechniqueAcrossTactics(technique: Technique, walkChildren= true, highlightTechniques = false): void {\r\n        if (this.selectSubtechniquesWithParent && walkChildren) { //walk to parent / children / siblings\r\n            if (technique.isSubtechnique) { //select from parent\r\n                this.selectTechniqueAcrossTactics(technique.parent, true, highlightTechniques);\r\n                return;\r\n            } else { //select subtechniques\r\n                for (let subtechnique of technique.subtechniques) {\r\n                    this.selectTechniqueAcrossTactics(subtechnique, false, highlightTechniques);\r\n                }\r\n            }\r\n        }\r\n        if (highlightTechniques) {\r\n            this.highlightTechnique(technique);\r\n        }\r\n        else {\r\n            for (let id of technique.get_all_technique_tactic_ids()) {\r\n                if (!this.isCurrentlyEditing()) this.activeTvm = this.getTechniqueVM_id(id); // first selection\r\n                this.selectedTechniques.add(id);\r\n                this.checkValues(true, id);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * unselect the given technique in the given tactic\r\n     * @param {Technique} technique to unselect\r\n     * @param {Tactic} tactic wherein the technique occurs\r\n     * @param {boolean} walkChildren (recursion helper) if true and selectSubtechniquesWithParent is true, walk selection up to parent technique\r\n     */\r\n    public unselectTechniqueInTactic(technique: Technique, tactic: Tactic, walkChildren=true): void {\r\n        if (this.selectSubtechniquesWithParent && walkChildren) { //walk to parent / children / siblings\r\n            if (technique.isSubtechnique) { //select from parent\r\n                this.unselectTechniqueInTactic(technique.parent, tactic, true);\r\n                return;\r\n            } else { //select subtechniques\r\n                for (let subtechnique of technique.subtechniques) {\r\n                    this.unselectTechniqueInTactic(subtechnique, tactic, false);\r\n                }\r\n            }\r\n        }\r\n        let technique_tactic_id = technique.get_technique_tactic_id(tactic);\r\n        this.selectedTechniques.delete(technique_tactic_id);\r\n        this.checkValues(false, technique_tactic_id);\r\n    }\r\n\r\n    /**\r\n     * unselect all techniques in the given tactic\r\n     * @param {Tactic} tactic wherein the techniques occur\r\n     */\r\n    public unselectAllTechniquesInTactic(tactic: Tactic): void {\r\n        for (let technique of tactic.techniques) {\r\n            this.unselectTechnique(technique, tactic);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * unselect the given technique across all tactics in which it occurs\r\n     * @param {Technique} technique to unselect\r\n     * @param {boolean} walkChildren (recursion helper) if true and selectSubtechniquesWithParent is true, walk selection up to parent technique\r\n     */\r\n    public unselectTechniqueAcrossTactics(technique: Technique, walkChildren=true) {\r\n        if (this.selectSubtechniquesWithParent && walkChildren) { //walk to parent / children / siblings\r\n            if (technique.isSubtechnique) { //select from parent\r\n                this.unselectTechniqueAcrossTactics(technique.parent, true);\r\n                return;\r\n            } else { //select subtechniques\r\n                for (let subtechnique of technique.subtechniques) {\r\n                    this.unselectTechniqueAcrossTactics(subtechnique, false);\r\n                }\r\n            }\r\n        }\r\n        for (let id of technique.get_all_technique_tactic_ids()) {\r\n            this.selectedTechniques.delete(id);\r\n            this.checkValues(false, id);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * unselect all techniques\r\n     */\r\n    public clearSelectedTechniques() {\r\n        this.selectedTechniques.clear();\r\n        this.activeTvm = undefined;\r\n        this.linkMismatches = [];\r\n        this.metadataMismatches = [];\r\n    }\r\n\r\n    /**\r\n     * Select all techniques\r\n     */\r\n    public selectAllTechniques(): void {\r\n        this.clearSelectedTechniques()\r\n        this.invertSelection();\r\n    }\r\n\r\n    /**\r\n     * Set all selected techniques to deselected, and select all techniques not currently selected\r\n     */\r\n    public invertSelection(): void {\r\n        let previouslySelected = new Set(this.selectedTechniques);\r\n        this.clearSelectedTechniques();\r\n        let self = this;\r\n        this.techniqueVMs.forEach(function(tvm, key) {\r\n            if (!previouslySelected.has(tvm.technique_tactic_union_id)) {\r\n                if (!self.isCurrentlyEditing()) self.activeTvm = self.getTechniqueVM_id(tvm.technique_tactic_union_id); // first selection\r\n                self.selectedTechniques.add(tvm.technique_tactic_union_id);\r\n                self.checkValues(true, tvm.technique_tactic_union_id);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Select all techniques with annotations if nothing is currently selected, or select a subset of\r\n     * the current selection that has annotations\r\n     */\r\n    public selectAnnotated(): void {\r\n        let self = this;\r\n        if (this.isCurrentlyEditing()) {\r\n            // deselect techniques without annotations\r\n            let selected = new Set(this.selectedTechniques);\r\n            this.techniqueVMs.forEach(function(tvm, key) {\r\n                if (selected.has(tvm.technique_tactic_union_id) && !tvm.annotated()) {\r\n                    self.selectedTechniques.delete(tvm.technique_tactic_union_id);\r\n                    self.checkValues(false, tvm.technique_tactic_union_id);\r\n                }\r\n            });\r\n        } else {\r\n            // select all techniques with annotations\r\n            this.techniqueVMs.forEach(function(tvm, key) {\r\n                if (tvm.annotated()) {\r\n                    if (!self.isCurrentlyEditing()) self.activeTvm = self.getTechniqueVM_id(tvm.technique_tactic_union_id); // first selection\r\n                    self.selectedTechniques.add(tvm.technique_tactic_union_id);\r\n                    self.checkValues(true, tvm.technique_tactic_union_id);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Select all techniques without annotations if nothing is currently selected, or select a subset of\r\n     * the current selection that do not have annotations\r\n     */\r\n    public selectUnannotated(): void {\r\n        let self = this;\r\n        if (this.isCurrentlyEditing()) {\r\n            // deselect techniques with annotations\r\n            let selected = new Set(this.selectedTechniques);\r\n            this.techniqueVMs.forEach(function(tvm, key) {\r\n                if (selected.has(tvm.technique_tactic_union_id) && tvm.annotated()) {\r\n                    self.selectedTechniques.delete(tvm.technique_tactic_union_id);\r\n                    self.checkValues(false, tvm.technique_tactic_union_id);\r\n                }\r\n            });\r\n        } else {\r\n            // select all techniques without annotations\r\n            this.selectAnnotated();\r\n            this.invertSelection();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Copies all annotations from unchanged techniques and techniques\r\n     * which have had minor changes\r\n     */\r\n    public initCopyAnnotations(): void {\r\n        let self = this;\r\n\r\n        function copy(attackID: string) {\r\n            let fromTechnique = self.dataService.getTechnique(attackID, self.compareTo.domainVersionID);\r\n            let domain = self.dataService.getDomain(self.domainVersionID);\r\n            let tactics = fromTechnique.tactics.map(shortname => domain.tactics.find(t => t.shortname == shortname));\r\n            tactics.forEach(tactic => {\r\n                let fromVM = self.compareTo.getTechniqueVM(fromTechnique, tactic);\r\n                if (fromVM.annotated()) {\r\n                    let toTechnique = self.dataService.getTechnique(attackID, self.domainVersionID);\r\n                    self.copyAnnotations(fromTechnique, toTechnique, tactic);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (this.versionChangelog) {\r\n            this.versionChangelog.unchanged.forEach(attackID => copy(attackID));\r\n            this.versionChangelog.minor_changes.forEach(attackID => copy(attackID));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Copy annotations from one technique to another under the given tactic.\r\n     * The previous technique will be disabled\r\n     * @param fromTechnique the technique to copy annotations from\r\n     * @param toTechnique the technique to copy annotations to\r\n     * @param tactic the tactic the techniques are found under\r\n     */\r\n    public copyAnnotations(fromTechnique: Technique, toTechnique: Technique, tactic: Tactic): void {\r\n        let fromVM = this.compareTo.getTechniqueVM(fromTechnique, tactic);\r\n        let toVM = this.getTechniqueVM(toTechnique, tactic);\r\n\r\n        this.versionChangelog.reviewed.delete(fromTechnique.attackID);\r\n\r\n        toVM.deSerialize(fromVM.serialize(), fromTechnique.attackID, tactic.shortname);\r\n        this.updateScoreColor(toVM);\r\n        fromVM.enabled = false;\r\n\r\n        this.versionChangelog.copied.add(fromVM.technique_tactic_union_id);\r\n        if (fromTechnique.get_all_technique_tactic_ids().every(id => this.versionChangelog.copied.has(id))) {\r\n            this.versionChangelog.reviewed.add(fromTechnique.attackID);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset the techniqueVM that the annotations were previously copied to\r\n     * and re-enable the technique the annotations were copied from\r\n     * @param fromTechnique the technique that annotations were copied from\r\n     * @param toTechnique the technique that annotations were copied to\r\n     * @param tactic the tactic the techniques are found under\r\n     */\r\n    public revertCopy(fromTechnique: Technique, toTechnique: Technique, tactic: Tactic): void {\r\n        let fromVM = this.compareTo.getTechniqueVM(fromTechnique, tactic);\r\n        let toVM = this.getTechniqueVM(toTechnique, tactic);\r\n        this.versionChangelog.reviewed.delete(fromTechnique.attackID);\r\n\r\n        toVM.resetAnnotations();\r\n        fromVM.enabled = true;\r\n\r\n        this.versionChangelog.copied.delete(fromVM.technique_tactic_union_id);\r\n        if (!fromTechnique.get_all_technique_tactic_ids().every(id => this.versionChangelog.copied.has(id))) {\r\n            this.versionChangelog.reviewed.delete(fromTechnique.attackID);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Return true if the given technique is selected, false otherwise\r\n     * @param  {Technique}  technique the technique to check\r\n    * * @param  {Tactic}  tactic wherein the technique occurs\r\n     * @return {boolean}           true if selected, false otherwise\r\n     */\r\n    public isTechniqueSelected(technique: Technique, tactic: Tactic, walkChildren=true): boolean {\r\n        if (this.selectTechniquesAcrossTactics) {\r\n            if (this.selectSubtechniquesWithParent && walkChildren) { //check parent / children / siblings\r\n                if (technique.isSubtechnique) { //select from parent\r\n                    return this.isTechniqueSelected(technique.parent, tactic, true);\r\n                } else {\r\n                    for (let subtechnique of technique.subtechniques) {\r\n                        if (this.isTechniqueSelected(subtechnique, tactic, false)) return true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let id of technique.get_all_technique_tactic_ids()) {\r\n                if (this.selectedTechniques.has(id)) return true;\r\n            }\r\n            return false;\r\n        } else {\r\n            if (this.selectSubtechniquesWithParent && walkChildren) { //check parent / children / siblings\r\n                if (technique.isSubtechnique) { //select from parent\r\n                    return this.isTechniqueSelected(technique.parent, tactic, true);\r\n                } else {\r\n                    for (let subtechnique of technique.subtechniques) {\r\n                        if (this.isTechniqueSelected(subtechnique, tactic, false)) return true;\r\n                    }\r\n                }\r\n            }\r\n            return this.selectedTechniques.has(technique.get_technique_tactic_id(tactic));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * return the number of selected techniques\r\n     * @return {number} the number of selected techniques\r\n     */\r\n    public getSelectedTechniqueCount(): number {\r\n        if (this.selectTechniquesAcrossTactics) {\r\n            if (this.selectSubtechniquesWithParent) {\r\n                // match across tactics\r\n                // match subtechniques and parents\r\n\r\n                // matches this part\r\n                // vvvvv\r\n                // T1001.001^TA1000\r\n                let ids = new Set();\r\n                this.selectedTechniques.forEach((unionID) => ids.add(unionID.split(\"^\")[0].split(\".\")[0]));\r\n                return ids.size;\r\n            } else {\r\n                // match across tactics\r\n                // differentiate subtechniques and parents\r\n\r\n                // matches this part\r\n                // vvvvv vvv\r\n                // T1001.001^TA1000\r\n                let ids = new Set();\r\n                this.selectedTechniques.forEach((unionID) => ids.add(unionID.split(\"^\")[0]));\r\n                return ids.size;\r\n            }\r\n        } else {\r\n            if (this.selectSubtechniquesWithParent) {\r\n                // differentiate tactics\r\n                // match subtechniques and parents\r\n\r\n                // matches this part\r\n                // vvvvv     vvvvvv\r\n                // T1001.001^TA1000\r\n                let ids = new Set();\r\n                this.selectedTechniques.forEach((unionID) => {\r\n                    let split = unionID.split(\"^\");\r\n                    let tacticID = split[1];\r\n                    let techniqueID = split[0].split(\".\")[0];\r\n                    ids.add(techniqueID + \"^\" + tacticID);\r\n                })\r\n                return ids.size;\r\n            } else {\r\n                // differentiate tactics\r\n                // differentiate subtechniques and parents\r\n\r\n                // matches this part\r\n                // vvvvv vvv vvvvvv\r\n                // T1001.001^TA1000\r\n                return this.selectedTechniques.size;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns true if the given tactic is selected\r\n     * @param  {Tactic}  tactic to check\r\n     * @return {boolean} true if selected\r\n     */\r\n    public isTacticSelected(tactic: Tactic) {\r\n        let self = this;\r\n        var result = tactic.techniques.every(function(technique) {\r\n            return self.isTechniqueSelected(technique, tactic)\r\n        });\r\n        return result;\r\n    }\r\n\r\n\r\n    /**\r\n     * Return true if currently editing any techniques, false otherwise\r\n     * @return {boolean} true if currently editing any techniques, false otherwise\r\n     */\r\n    public isCurrentlyEditing(): boolean {\r\n        return this.getSelectedTechniqueCount() > 0;\r\n    }\r\n\r\n    /**\r\n     * edit the selected techniques\r\n     * @param {string} field the field to edit\r\n     * @param {any}    value the value to place in the field\r\n     */\r\n    public editSelectedTechniques(field: string, value: any): void {\r\n        this.selectedTechniques.forEach((id) => {\r\n            this.getTechniqueVM_id(id)[field] = value;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Edit the selected techniques list attribute\r\n     * @param {string}  field the field to edit\r\n     * @param {(Link|Metadata)[]} values the list of values to place in the field\r\n     */\r\n    public editSelectedTechniqueValues(field: string, values: (Link | Metadata)[]): void {\r\n        let fieldToType: any = {\"links\": Link, \"metadata\": Metadata};\r\n        this.selectedTechniques.forEach(id => {\r\n            const value_clone = values.map(value => { // deep copy\r\n                let clone = new fieldToType[field]();\r\n                clone.deSerialize(value.serialize());\r\n                return clone;\r\n            });\r\n            this.getTechniqueVM_id(id)[field] = value_clone;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Reset the selected techniques' annotations to their default values\r\n     */\r\n    public resetSelectedTechniques(): void {\r\n        this.selectedTechniques.forEach((id) => {\r\n            this.getTechniqueVM_id(id).resetAnnotations();\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Get get a common value from the selected techniques\r\n     * @param  field the field to get the common value from\r\n     * @return       the value of the field if all selected techniques have the same value, otherwise \"\"\r\n     */\r\n    public getEditingCommonValue(field: string): any {\r\n        if (!this.isCurrentlyEditing()) return \"\";\r\n        let ids = Array.from(this.selectedTechniques);\r\n        let commonValue = this.getTechniqueVM_id(ids[0])[field];\r\n        for (let i = 1; i < ids.length; i++) {\r\n            if (this.getTechniqueVM_id(ids[i])[field] != commonValue) return \"\"\r\n        }\r\n\r\n        return commonValue;\r\n    }\r\n\r\n    activeTvm: TechniqueVM; // first selected techniqueVM\r\n    linkMismatches: string[] = []; // subsequent selected technique_tactic_ids that do not have matching links\r\n    public get linksMatch(): boolean { return !this.linkMismatches.length; }\r\n    metadataMismatches: string[] = []; // subsequent selected technique_tactic_ids that do not have matching metadata\r\n    public get metadataMatch(): boolean { return !this.metadataMismatches.length; }\r\n\r\n    /**\r\n     * If a technique has been selected, checks whether the link & metadata values of the selected technique match \r\n     * the link & metadata values of the first selected technique. If a technique has been deselected, removes it from\r\n     * the lists of mismatching techniques (if applicable) or re-evalutes the lists of mismatching\r\n     * techniques in the case where the deselected technique was the first selected technique\r\n     * @param selected true if the technique was selected, false if it was deselected\r\n     * @param id the technique_tactic_union_id of the technique\r\n     */\r\n    public checkValues(selected: boolean, id: string): void {\r\n        if (selected) { // selected technique(s)\r\n            let tvm = this.getTechniqueVM_id(id);\r\n            if (this.activeTvm.linkStr !== tvm.linkStr) this.linkMismatches.push(id);\r\n            if (this.activeTvm.metadataStr !== tvm.metadataStr) this.metadataMismatches.push(id);\r\n        } else { // deselected technique(s)\r\n            if (this.linkMismatches.includes(id)) this.linkMismatches.splice(this.linkMismatches.indexOf(id), 1);\r\n            if (this.metadataMismatches.includes(id)) this.metadataMismatches.splice(this.metadataMismatches.indexOf(id), 1);\r\n\r\n            if (this.activeTvm && this.activeTvm.technique_tactic_union_id == id) { // edge case where deselection was the first selected technique\r\n                let first_id = this.selectedTechniques.values().next().value;\r\n                this.activeTvm = first_id ? this.getTechniqueVM_id(first_id): undefined;\r\n\r\n                // re-evaluate mismatched values\r\n                this.linkMismatches = [];\r\n                this.metadataMismatches = [];\r\n                for (let technique_tactic_id of Array.from(this.selectedTechniques.values())) {\r\n                    let tvm = this.getTechniqueVM_id(technique_tactic_id);\r\n                    if (this.activeTvm.linkStr !== tvm.linkStr) this.linkMismatches.push(technique_tactic_id);\r\n                    if (this.activeTvm.metadataStr !== tvm.metadataStr) this.metadataMismatches.push(technique_tactic_id);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //  oooooooo8                          o8          o88 ooooooooooo o88   o888   o8\r\n    // 888           ooooooo  oo oooooo  o888oo       o88   888    88  oooo   888 o888oo ooooooooo8 oo oooooo\r\n    //  888oooooo  888     888 888    888 888       o88     888ooo8     888   888  888  888oooooo8   888    888\r\n    //         888 888     888 888        888     o88       888         888   888  888  888          888\r\n    // o88oooo888    88ooo88  o888o        888o o88        o888o       o888o o888o  888o  88oooo888 o888o\r\n    //                                         o88\r\n    //    ooooo ooooo            o888\r\n    //     888   888  ooooooooo8  888 ooooooooo    ooooooooo8 oo oooooo    oooooooo8\r\n    //     888ooo888 888oooooo8   888  888    888 888oooooo8   888    888 888ooooooo\r\n    //     888   888 888          888  888    888 888          888                888\r\n    //    o888o o888o  88oooo888 o888o 888ooo88     88oooo888 o888o       88oooooo88\r\n    //                                o888\r\n\r\n    /**\r\n     * filter tactics according to viewmodel state\r\n     * @param {Tactic[]} tactics to filter\r\n     * @param {Matrix} matrix that the tactics fall under\r\n     * @returns {Tactic[]} filtered tactics\r\n     */\r\n    public filterTactics(tactics: Tactic[], matrix: Matrix): Tactic[] {\r\n        if (!this.loaded) return; // still initializing technique VMs\r\n        return tactics.filter((tactic: Tactic) => this.filterTechniques(tactic.techniques, tactic, matrix).length > 0);\r\n    }\r\n\r\n    /**\r\n     * filter techniques according to viewModel state\r\n     * @param {Technique[]} techniques list of techniques to filter\r\n     * @param {Tactic} tactic tactic the techniques fall under\r\n     * @param {Matrix} matrix that the techniques fall under\r\n     * @returns {Technique[]} filtered techniques\r\n     */\r\n    public filterTechniques(techniques: Technique[], tactic: Tactic, matrix: Matrix): Technique[] {\r\n        return techniques.filter((technique: Technique) => {\r\n            let techniqueVM = this.getTechniqueVM(technique, tactic);\r\n            // filter by enabled\r\n            if (this.hideDisabled && !this.isSubtechniqueEnabled(technique, techniqueVM, tactic)) return false;\r\n            if (matrix.name == \"PRE-ATT&CK\") return true; // don't filter by platform if it's pre-attack\r\n            // filter by platform\r\n            let platforms = new Set(technique.platforms)\r\n            for (let platform of this.filters.platforms.selection) {\r\n                if (platforms.has(platform)) return true; //platform match\r\n            }\r\n            return false; //no platform match\r\n        })\r\n    }\r\n\r\n    public isSubtechniqueEnabled(technique, techniqueVM, tactic): boolean {\r\n        if (techniqueVM.enabled) return true;\r\n        else if (technique.subtechniques.length > 0) {\r\n            return technique.subtechniques.some(subtechnique => {\r\n                let sub_platforms = new Set(subtechnique.platforms);\r\n                let filter = new Set(this.filters.platforms.selection);\r\n                let platforms = new Set(Array.from(filter.values()).filter(p => sub_platforms.has(p)));\r\n                return this.getTechniqueVM(subtechnique, tactic).enabled && platforms.size > 0;\r\n            });\r\n        }\r\n        else return false;\r\n    }\r\n\r\n    /**\r\n     * sort techniques according to viewModel state\r\n     * @param {Technique[]} techniques techniques to sort\r\n     * @param {Tactic} tactic tactic the techniques fall under\r\n     * @returns {Technique[]} sorted techniques\r\n     */\r\n    public sortTechniques(techniques: Technique[], tactic: Tactic): Technique[] {\r\n        return techniques.sort((technique1: Technique, technique2: Technique) => {\r\n            const techniqueVM1 = this.getTechniqueVM(technique1, tactic);\r\n            const techniqueVM2 = this.getTechniqueVM(technique2, tactic);\r\n            let score1, score2;\r\n\r\n            this.sortSubTechniques(technique1, tactic);\r\n            this.sortSubTechniques(technique2, tactic);\r\n\r\n            if (!this.layout.showAggregateScores) {\r\n                score1 = techniqueVM1.score.length > 0 ? Number(techniqueVM1.score) : 0;\r\n                score2 = techniqueVM2.score.length > 0 ? Number(techniqueVM2.score) : 0;\r\n            }\r\n            else { // if show aggregate scores is enabled, factor that into sorting, and prefer techniques scored 0 over unscored\r\n                score1 = this.calculateAggregateScore(technique1, tactic);\r\n                techniqueVM1.aggregateScore = Number.isFinite(score1) ? score1.toString() : \"\";\r\n                score2 = this.calculateAggregateScore(technique2, tactic);\r\n                techniqueVM2.aggregateScore = Number.isFinite(score2) ? score2.toString() : \"\";\r\n            }\r\n            return this.sortingAlgorithm(technique1, technique2, score1, score2);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * sort subtechniques according to viewModel state\r\n     * @param {Technique} technique technique to sort\r\n     * @param {Tactic} tactic tactic the technique falls under\r\n     */\r\n    public sortSubTechniques(technique: Technique, tactic: Tactic) {\r\n        technique.subtechniques.sort((technique1: Technique, technique2: Technique) => {\r\n            const techniqueVM1 = this.getTechniqueVM(technique1, tactic);\r\n            const techniqueVM2 = this.getTechniqueVM(technique2, tactic);\r\n            const score1 = techniqueVM1.score.length > 0 ? Number(techniqueVM1.score) : 0;\r\n            const score2 = techniqueVM2.score.length > 0 ? Number(techniqueVM2.score) : 0;\r\n            return this.sortingAlgorithm(technique1, technique2, score1, score2);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * execute the sorting algorithm for techniques according to the viewModel state\r\n     * @param {Technique} technique1 the first technique in the comparison\r\n     * @param {Technique} technique2 the second technique in the comparison\r\n     * @param {number} score1 the first score in the comparison\r\n     * @param {number} score2 the second score in the comparison\r\n     * @returns technique or score comparison\r\n     */\r\n    private sortingAlgorithm(technique1: Technique, technique2: Technique, score1: number, score2: number) {\r\n        switch (this.sorting) {\r\n            default:\r\n            case 0: // A-Z\r\n                return technique1.name.localeCompare(technique2.name);\r\n            case 1: // Z-A\r\n                return technique2.name.localeCompare(technique1.name);\r\n            case 2: // 1-2\r\n                if (score1 === score2) {\r\n                    return technique1.name.localeCompare(technique2.name);\r\n                } else {\r\n                    return score1 - score2;\r\n                }\r\n            case 3: // 2-1\r\n                if (score1 === score2) {\r\n                    return technique1.name.localeCompare(technique2.name);\r\n                } else {\r\n                    return score2 - score1;\r\n                }\r\n        }\r\n    }\r\n\r\n    public calculateAggregateScore(technique: Technique, tactic: Tactic): any {\r\n        const tvm = this.getTechniqueVM(technique, tactic);\r\n        let score = tvm.score.length > 0 ? Number(tvm.score) : 0;\r\n        let validTechniquesCount = tvm.score.length > 0 ? 1 : 0;\r\n        let scores = [score];\r\n\r\n        technique.subtechniques.forEach((subtechnique) => {\r\n            const svm = this.getTechniqueVM(subtechnique, tactic);\r\n            const scoreNum = svm.score.length > 0 ? Number(svm.score) : 0;\r\n            if (svm.score.length > 0) {\r\n                validTechniquesCount += 1;\r\n                scores.push(scoreNum);\r\n            }\r\n        });\r\n\r\n        if (validTechniquesCount === 0) return tvm.score.length > 0 ? score : Number.NEGATIVE_INFINITY;\r\n\r\n        let aggScore: any = 0;\r\n\r\n        switch (this.layout.aggregateFunction) {\r\n            default:\r\n            case \"average\":\r\n                // Divide by count of all subtechniques + 1 (for parent technique) if counting unscored is enabled\r\n                // Otherwise, divide by count of all scored only\r\n                score = scores.reduce((a, b) => a + b);\r\n                aggScore = score / (this.layout.countUnscored ? (technique.subtechniques.length + 1) : validTechniquesCount);\r\n                break;\r\n            case \"min\":\r\n                if (scores.length > 0) aggScore = Math.min(...scores);\r\n                break;\r\n            case \"max\":\r\n                if (scores.length > 0) aggScore = Math.max(...scores);\r\n                break;\r\n            case \"sum\":\r\n                aggScore = scores.reduce((a, b) => a + b);\r\n                break;\r\n        }\r\n\r\n        aggScore = aggScore.toFixed(2);\r\n        tvm.aggregateScoreColor = this.gradient.getColor(aggScore.toString());\r\n        return +aggScore;\r\n    }\r\n\r\n    /**\r\n     * apply sort and filter state to techniques\r\n     * @param {Technique[]} techniques techniques to sort and filter\r\n     * @param {Tactic} tactic that the techniques fall under\r\n     * @param {Matrix} matrix that the techniques fall under\r\n     * @returns {Technique[]} sorted and filtered techniques\r\n     */\r\n    public applyControls(techniques: Technique[], tactic: Tactic, matrix: Matrix): Technique[] {\r\n        //apply sort and filter\r\n        return this.sortTechniques(this.filterTechniques(techniques, tactic, matrix), tactic);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    //  ___ ___ ___ ___   _   _    ___ ____  _ _____ ___ ___  _  _\r\n    // / __| __| _ \\_ _| /_\\ | |  |_ _|_  / /_\\_   _|_ _/ _ \\| \\| |\r\n    // \\__ \\ _||   /| | / _ \\| |__ | | / / / _ \\| |  | | (_) | .` |\r\n    // |___/___|_|_\\___/_/ \\_\\____|___/___/_/ \\_\\_| |___\\___/|_|\\_|\r\n\r\n    /**\r\n     * stringify this vm\r\n     * @return string representation\r\n     */\r\n    serialize(): string {\r\n        let modifiedTechniqueVMs = []\r\n        let self = this;\r\n        this.techniqueVMs.forEach(function(value,key) {\r\n            if (value.modified()) modifiedTechniqueVMs.push(JSON.parse(value.serialize())) //only save techniqueVMs which have been modified\r\n        })\r\n        let rep: {[k: string]: any } = {};\r\n        rep.name = this.name;\r\n\r\n        rep.versions = {\r\n            \"attack\": this.dataService.getDomain(this.domainVersionID).getVersion(),\r\n            \"navigator\": globals.nav_version,\r\n            \"layer\": globals.layer_version\r\n        }\r\n\r\n        let domain = this.dataService.getDomain(this.domainVersionID);\r\n        rep.domain = domain.domain_identifier;\r\n        if (domain.isCustom) {\r\n            // custom data url\r\n            rep.customDataURL = domain.urls[0];\r\n        }\r\n        rep.description = this.description;\r\n        rep.filters = JSON.parse(this.filters.serialize());\r\n        rep.sorting = this.sorting;\r\n        rep.layout = this.layout.serialize();\r\n        rep.hideDisabled = this.hideDisabled;\r\n        rep.techniques = modifiedTechniqueVMs;\r\n        rep.gradient = JSON.parse(this.gradient.serialize());\r\n        rep.legendItems = JSON.parse(JSON.stringify(this.legendItems));\r\n        rep.metadata = this.metadata.filter(m => m.valid()).map(m => m.serialize());\r\n        rep.links = this.links.filter(l => l.valid()).map(l => l.serialize());\r\n\r\n        rep.showTacticRowBackground = this.showTacticRowBackground;\r\n        rep.tacticRowBackground = this.tacticRowBackground;\r\n        rep.selectTechniquesAcrossTactics = this.selectTechniquesAcrossTactics;\r\n        rep.selectSubtechniquesWithParent = this.selectSubtechniquesWithParent;\r\n\r\n        return JSON.stringify(rep, null, \"\\t\");\r\n    }\r\n\r\n    /**\r\n     * restore the domain and version from a string\r\n     * @param rep string to restore from\r\n     */\r\n    deSerializeDomainVersionID(rep: any): void {\r\n        let obj = (typeof(rep) == \"string\")? JSON.parse(rep) : rep\r\n        this.name = obj.name\r\n        this.version = this.dataService.getCurrentVersion().number; // layer with no specified version defaults to current version\r\n        if (\"versions\" in obj) {\r\n            if (\"attack\" in obj.versions) {\r\n                if (typeof(obj.versions.attack) === \"string\") {\r\n                    if (obj.versions.attack.length > 0) this.version = obj.versions.attack.match(/[0-9]+/g)[0];\r\n                }\r\n                else console.error(\"TypeError: attack version field is not a string\");\r\n            }\r\n            if(obj.versions[\"layer\"] !== globals.layer_version){\r\n                alert(\"WARNING: Uploaded layer version (\" + String(obj.versions[\"layer\"]) + \") does not match Navigator's layer version (\"\r\n                + String(globals.layer_version) + \"). The layer configuration may not be fully restored.\");\r\n            }\r\n        }\r\n        if (\"version\" in obj) { // backwards compatibility with Layer Format 3\r\n            if (obj.version !== globals.layer_version){\r\n                alert(\"WARNING: Uploaded layer version (\" + String(obj.version) + \") does not match Navigator's layer version (\"\r\n                + String(globals.layer_version) + \"). The layer configuration may not be fully restored.\");\r\n            }\r\n        }\r\n        // patch for old domain name convention\r\n        if(obj.domain in this.dataService.domain_backwards_compatibility) {\r\n            this.domain = this.dataService.domain_backwards_compatibility[obj.domain];\r\n        } else { this.domain = obj.domain; }\r\n        this.domainVersionID = this.dataService.getDomainVersionID(this.domain, this.version);\r\n    }\r\n\r\n    /**\r\n     * restore this vm from a string\r\n     * @param  rep string to restore from\r\n     */\r\n    deSerialize(rep: any): void {\r\n        let obj = (typeof(rep) == \"string\")? JSON.parse(rep) : rep\r\n\r\n        if (\"description\" in obj) {\r\n            if (typeof(obj.description) === \"string\") this.description = obj.description;\r\n            else console.error(\"TypeError: description field is not a string\")\r\n        }\r\n        if (\"filters\" in obj) { this.filters.deSerialize(obj.filters); }\r\n        if (\"sorting\" in obj) {\r\n            if (typeof(obj.sorting) === \"number\") this.sorting = obj.sorting;\r\n            else console.error(\"TypeError: sorting field is not a number\")\r\n        }\r\n        if (\"hideDisabled\" in obj) {\r\n            if (typeof(obj.hideDisabled) === \"boolean\") this.hideDisabled = obj.hideDisabled;\r\n            else console.error(\"TypeError: hideDisabled field is not a boolean\")\r\n        }\r\n\r\n        if (\"gradient\" in obj) {\r\n            this.gradient = new Gradient();\r\n            this.gradient.deSerialize(JSON.stringify(obj.gradient))\r\n        }\r\n\r\n        if (\"legendItems\" in obj) {\r\n            for (let i = 0; i < obj.legendItems.length; i++) {\r\n                let legendItem = {\r\n                    color: \"#defa217\",\r\n                    label: \"default label\"\r\n                };\r\n                if (!(\"label\" in obj.legendItems[i])) {\r\n                    console.error(\"Error: LegendItem required field 'label' not present\")\r\n                    continue;\r\n                }\r\n                if (!(\"color\" in obj.legendItems[i])) {\r\n                    console.error(\"Error: LegendItem required field 'label' not present\")\r\n                    continue;\r\n                }\r\n\r\n                if (typeof(obj.legendItems[i].label) === \"string\") {\r\n                    legendItem.label = obj.legendItems[i].label;\r\n                } else {\r\n                    console.error(\"TypeError: legendItem label field is not a string\")\r\n                    continue\r\n                }\r\n\r\n                if (typeof(obj.legendItems[i].color) === \"string\" && tinycolor(obj.legendItems[i].color).isValid()) {\r\n                    legendItem.color = obj.legendItems[i].color;\r\n                } else {\r\n                    console.error(\"TypeError: legendItem color field is not a color-string:\", obj.legendItems[i].color, \"(\", typeof(obj.legendItems[i].color),\")\")\r\n                    continue\r\n                }\r\n                this.legendItems.push(legendItem);\r\n            }\r\n        }\r\n\r\n        if (\"showTacticRowBackground\" in obj) {\r\n            if (typeof(obj.showTacticRowBackground) === \"boolean\") this.showTacticRowBackground = obj.showTacticRowBackground\r\n            else console.error(\"TypeError: showTacticRowBackground field is not a boolean\")\r\n        }\r\n        if (\"tacticRowBackground\" in obj) {\r\n            if (typeof(obj.tacticRowBackground) === \"string\" && tinycolor(obj.tacticRowBackground).isValid()) this.tacticRowBackground = obj.tacticRowBackground;\r\n            else console.error(\"TypeError: tacticRowBackground field is not a color-string:\", obj.tacticRowBackground, \"(\", typeof(obj.tacticRowBackground),\")\")\r\n        }\r\n        if (\"selectTechniquesAcrossTactics\" in obj) {\r\n            if (typeof(obj.selectTechniquesAcrossTactics) === \"boolean\") this.selectTechniquesAcrossTactics = obj.selectTechniquesAcrossTactics\r\n            else console.error(\"TypeError: selectTechniquesAcrossTactics field is not a boolean\")\r\n        }\r\n        if (\"selectSubtechniquesWithParent\" in obj) {\r\n            if (typeof(obj.selectSubtechniquesWithParent) === \"boolean\") this.selectSubtechniquesWithParent = obj.selectSubtechniquesWithParent\r\n            else console.error(\"TypeError: selectSubtechniquesWithParent field is not a boolean\")\r\n        }\r\n        if (\"techniques\" in obj) {\r\n            if(obj.techniques.length > 0) {\r\n                for (let i = 0; i < obj.techniques.length; i++) {\r\n                    var obj_technique = obj.techniques[i];\r\n                    if (\"tactic\" in obj_technique) {\r\n                        let tvm = new TechniqueVM(\"\");\r\n                        tvm.deSerialize(JSON.stringify(obj_technique),\r\n                                        obj_technique.techniqueID,\r\n                                        obj_technique.tactic);\r\n                        this.setTechniqueVM(tvm);\r\n                    } else {\r\n                        // occurs in multiple tactics\r\n                        // match to Technique by attackID\r\n                        for (let technique of this.dataService.getDomain(this.domainVersionID).techniques) {\r\n                            if (technique.attackID == obj_technique.techniqueID) {\r\n                                // match technique\r\n                                // don't load deprecated/revoked, causes crash since tactics don't get loaded on revoked techniques\r\n                                if (technique.deprecated || technique.revoked) break;\r\n\r\n                                for (let tactic of technique.tactics) {\r\n                                    let tvm = new TechniqueVM(\"\");\r\n                                    tvm.deSerialize(JSON.stringify(obj_technique),\r\n                                                    obj_technique.techniqueID,\r\n                                                    tactic);\r\n                                    this.setTechniqueVM(tvm);\r\n                                }\r\n                                break;\r\n                            }\r\n                            //check against subtechniques\r\n                            for (let subtechnique of technique.subtechniques) {\r\n                                if (subtechnique.attackID == obj_technique.techniqueID) {\r\n                                    // don't load deprecated/revoked, causes crash since tactics don't get loaded on revoked techniques\r\n                                    if (subtechnique.deprecated || subtechnique.revoked) break;\r\n\r\n                                    for (let tactic of subtechnique.tactics) {\r\n                                        let tvm = new TechniqueVM(\"\");\r\n                                        tvm.deSerialize(JSON.stringify(obj_technique),\r\n                                                        obj_technique.techniqueID,\r\n                                                        tactic);\r\n                                        this.setTechniqueVM(tvm);\r\n                                    }\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (\"metadata\" in obj) {\r\n            for (let metadataObj of obj.metadata) {\r\n                let m = new Metadata();\r\n                m.deSerialize(metadataObj);\r\n                if (m.valid()) this.metadata.push(m)\r\n            }\r\n        }\r\n        if (\"links\" in obj) {\r\n            for (let link of obj.links) {\r\n                let l = new Link();\r\n                l.deSerialize(link);\r\n                if (l.valid()) this.links.push(l);\r\n            }\r\n        }\r\n        // add custom data URL\r\n        if (\"customDataURL\" in obj) {\r\n            this.bundleURL = obj.customDataURL;\r\n        }\r\n        if (\"layout\" in obj) {\r\n            this.layout.deserialize(obj.layout);\r\n        }\r\n        else if (\"viewMode\" in obj) {\r\n            /*\r\n             * viewMode backwards compatibility:\r\n             * 0: full table (side layout, show name)\r\n             * 1: compact table (side layout, show ID)\r\n             * 2: mini table (mini layout, show neither name nor ID)\r\n             */\r\n            if (typeof(obj.viewMode) === \"number\") {\r\n                switch(obj.viewMode) {\r\n                    default:\r\n                    case 0:\r\n                        break; //default matrix layout already initialized\r\n                    case 1:\r\n                        this.layout.layout = \"side\";\r\n                        this.layout.showName = false;\r\n                        this.layout.showID = true;\r\n                        break;\r\n                    case 2:\r\n                        this.layout.layout = \"mini\";\r\n                        this.layout.showName = false;\r\n                        this.layout.showID = false;\r\n                }\r\n            }\r\n            else console.error(\"TypeError: viewMode field is not a number\")\r\n        }\r\n\r\n        this.updateGradient();\r\n    }\r\n\r\n    /**\r\n     * Add a color to the end of the gradient\r\n     */\r\n    addGradientColor(): void {\r\n        this.gradient.addColor();\r\n        this.updateGradient();\r\n    }\r\n\r\n    /**\r\n     * Remove color at the given index\r\n     * @param index index to remove color at\r\n     */\r\n    removeGradientColor(index: number): void {\r\n        this.gradient.removeColor(index)\r\n        this.updateGradient();\r\n    }\r\n\r\n    /**\r\n     * Update this vm's gradient\r\n     */\r\n    updateGradient(): void {\r\n        console.log(\"updating gradient\")\r\n        this.gradient.updateGradient();\r\n        let self = this;\r\n        this.techniqueVMs.forEach(function(tvm, key) {\r\n            tvm.scoreColor = self.gradient.getColor(tvm.score);\r\n        });\r\n        this.updateLegendColorPresets();\r\n    }\r\n\r\n    /**\r\n     * Update the score color of a single technique VM to match the current\r\n     * score and gradient\r\n     * @param tvm technique VM to update\r\n     */\r\n    updateScoreColor(tvm: TechniqueVM): void {\r\n        tvm.scoreColor = this.gradient.getColor(tvm.score);\r\n    }\r\n\r\n    legendItems = [\r\n\r\n    ];\r\n\r\n    addLegendItem(): void {\r\n        var newObj = {\r\n            label: \"NewItem\",\r\n            color: '#00ffff'\r\n        }\r\n        this.legendItems.push(newObj);\r\n    }\r\n\r\n    deleteLegendItem(index: number): void {\r\n        this.legendItems.splice(index,1);\r\n    }\r\n\r\n    clearLegend(): void {\r\n        this.legendItems = [];\r\n    }\r\n\r\n    updateLegendColorPresets(): void {\r\n        this.legendColorPresets = [];\r\n        for(var i = 0; i < this.backgroundPresets.length; i++){\r\n            this.legendColorPresets.push(this.backgroundPresets[i]);\r\n        }\r\n        for(var i = 0; i < this.gradient.colors.length; i++){\r\n            this.legendColorPresets.push(this.gradient.colors[i].color);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * return an acronym version of the given string\r\n     * @param  words the string of words to get the acrnoym of\r\n     * @return       the acronym string\r\n     */\r\n    acronym(words: string): string {\r\n        let skipWords = [\"on\",\"and\", \"the\", \"with\", \"a\", \"an\", \"of\", \"in\", \"for\", \"from\"]\r\n\r\n        let result = \"\";\r\n        let wordSplit = words.split(\" \");\r\n        if (wordSplit.length > 1) {\r\n            let wordIndex = 0;\r\n            // console.log(wordSplit);\r\n            while (result.length < 4 && wordIndex < wordSplit.length) {\r\n                if (skipWords.includes(wordSplit[wordIndex].toLowerCase())) {\r\n                    wordIndex++;\r\n                    continue;\r\n                }\r\n\r\n                //find first legal char of word\r\n                for (let charIndex = 0; charIndex < wordSplit[wordIndex].length; charIndex++) {\r\n                    let code = wordSplit[wordIndex].charCodeAt(charIndex);\r\n                    if (code < 48 || (code > 57 && code < 65) || (code > 90 && code < 97) || code > 122) { //illegal character\r\n                        continue;\r\n                    } else {\r\n                        result += wordSplit[wordIndex].charAt(charIndex).toUpperCase()\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                wordIndex++;\r\n            }\r\n\r\n            return result;\r\n        } else {\r\n            return wordSplit[0].charAt(0).toUpperCase();\r\n        }\r\n    }\r\n}\r\n\r\n// the viewmodel for a specific technique\r\nexport class TechniqueVM {\r\n    techniqueID: string;\r\n    technique_tactic_union_id: string;\r\n    tactic: string;\r\n\r\n    score: string = \"\";\r\n    scoreColor: any; //color for score gradient\r\n\r\n    color: string = \"\"; //manually assigned color-class name\r\n    enabled: boolean = true;\r\n    comment: string = \"\"\r\n    metadata: Metadata[] = [];\r\n    public get metadataStr(): string { return JSON.stringify(this.metadata); }\r\n    links: Link[] = [];\r\n    public get linkStr(): string { return JSON.stringify(this.links); }\r\n\r\n    showSubtechniques = false;\r\n    aggregateScore: any; // number rather than string as this is not based on an input from user\r\n    aggregateScoreColor: any;\r\n\r\n    //print this object to the console\r\n    print(): void {\r\n        console.log(this.serialize())\r\n        console.log(this)\r\n    }\r\n\r\n    /**\r\n     * Has this TechniqueVM been modified from its initialized state?\r\n     * @return true if it has been modified, false otherwise\r\n     */\r\n    modified(): boolean {\r\n        return (this.annotated() || this.showSubtechniques);\r\n    }\r\n\r\n    /**\r\n     * Check if this TechniqueVM has been annotated\r\n     * @return true if it has annotations, false otherwise\r\n     */\r\n    annotated(): boolean {\r\n        return (this.score != \"\" || this.color != \"\" || !this.enabled || this.comment != \"\" || this.links.length !== 0 || this.metadata.length !== 0);\r\n    }\r\n\r\n    /**\r\n     * Reset this TechniqueVM's annotations to their default values\r\n     */\r\n    resetAnnotations(): void {\r\n        this.score = \"\";\r\n        this.comment = \"\";\r\n        this.color = \"\";\r\n        this.enabled = true;\r\n        this.aggregateScore = \"\";\r\n        this.aggregateScoreColor = \"\";\r\n        this.links = [];\r\n        this.metadata = [];\r\n    }\r\n\r\n    /**\r\n     * Convert to string representation\r\n     * @return string representation\r\n     */\r\n    serialize(): string {\r\n        let rep: {[k: string]: any } = {};\r\n        rep.techniqueID = this.techniqueID;\r\n        rep.tactic = this.tactic;\r\n        if (this.score !== \"\" && !(isNaN(Number(this.score)))) rep.score = Number(this.score);\r\n        rep.color = this.color;\r\n        rep.comment = this.comment;\r\n        rep.enabled = this.enabled;\r\n        rep.metadata = this.metadata.filter(m => m.valid()).map(m => m.serialize());\r\n        rep.links = this.links.filter(l => l.valid()).map(l => l.serialize());\r\n        rep.showSubtechniques = this.showSubtechniques;\r\n        return JSON.stringify(rep, null, \"\\t\")\r\n    }\r\n\r\n    /**\r\n     * Restore this technique from serialized technique\r\n     * @param rep serialized technique string\r\n     */\r\n    deSerialize(rep: string, techniqueID: string, tactic: string): void {\r\n        let obj = JSON.parse(rep);\r\n        if (techniqueID !== undefined) this.techniqueID = techniqueID;\r\n        else console.error(\"ERROR: TechniqueID field not present in technique\")\r\n\r\n        if (tactic !== undefined && tactic !== \"\") this.tactic = tactic;\r\n        else {\r\n            console.error(\"WARNING: tactic field not present in technique\");\r\n            alert(`WARNING: The tactic field on the technique ID ${techniqueID} is not defined. Annotations for this technique may not be restored.`);\r\n        }\r\n        if (\"comment\" in obj) {\r\n            if (typeof(obj.comment) === \"string\") this.comment = obj.comment;\r\n            else console.error(\"TypeError: technique comment field is not a number:\", obj.comment, \"(\",typeof(obj.comment),\")\")\r\n        }\r\n        if (\"color\" in obj && obj.color !== \"\") {\r\n            if (typeof(obj.color) === \"string\" && tinycolor(obj.color).isValid()) this.color = obj.color;\r\n            else console.error(\"TypeError: technique color field is not a color-string:\", obj.color, \"(\", typeof(obj.color),\")\")\r\n        }\r\n        if (\"score\" in obj) {\r\n            if (typeof(obj.score) === \"number\") this.score = String(obj.score);\r\n            else console.error(\"TypeError: technique score field is not a number:\", obj.score, \"(\", typeof(obj.score), \")\")\r\n        }\r\n        if (\"enabled\" in obj) {\r\n            if (typeof(obj.enabled) === \"boolean\") this.enabled = obj.enabled;\r\n            else console.error(\"TypeError: technique enabled field is not a boolean:\", obj.enabled, \"(\", typeof(obj.enabled), \")\");\r\n        }\r\n        if (\"showSubtechniques\" in obj) {\r\n            if (typeof(obj.showSubtechniques) === \"boolean\") this.showSubtechniques = obj.showSubtechniques;\r\n            else console.error(\"TypeError: technique showSubtechnique field is not a boolean:\", obj.showSubtechniques, \"(\", typeof(obj.showSubtechniques), \")\");\r\n        }\r\n        if (this.tactic !== undefined && this.techniqueID !== undefined) {\r\n            this.technique_tactic_union_id = this.techniqueID + \"^\" + this.tactic;\r\n        } else {\r\n            console.log(\"ERROR: Tactic and TechniqueID field needed.\")\r\n        }\r\n\r\n        if (\"metadata\" in obj) {\r\n            for (let metadataObj of obj.metadata) {\r\n                let m = new Metadata();\r\n                m.deSerialize(metadataObj);\r\n                if (m.valid()) this.metadata.push(m)\r\n            }\r\n        }\r\n        if (\"links\" in obj) {\r\n            for (let linkObj of obj.links) {\r\n                let link = new Link();\r\n                link.deSerialize(linkObj);\r\n                if (link.valid()) this.links.push(link);\r\n            }\r\n        }\r\n    }\r\n\r\n    constructor(technique_tactic_union_id: string) {\r\n        this.technique_tactic_union_id = technique_tactic_union_id;\r\n        var idSplit = technique_tactic_union_id.split(\"^\");\r\n        this.techniqueID = idSplit[0];\r\n        this.tactic = idSplit[1];\r\n    }\r\n}\r\n\r\n// the data for a specific filter\r\nexport class Filter {\r\n    private readonly domain: string;\r\n    platforms: {\r\n        options: string[],\r\n        selection: string[]\r\n    }\r\n    constructor() {\r\n        this.platforms = {\r\n            selection: [],\r\n            options: []\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Initialize the platform options according to the data in the domain\r\n     * @param {Domain} domain the domain to parse for platform options\r\n     */\r\n    public initPlatformOptions(domain: Domain): void {\r\n        this.platforms.options = JSON.parse(JSON.stringify(domain.platforms));\r\n        if (!this.platforms.selection.length) { // prevent overwriting current selection\r\n            this.platforms.selection = JSON.parse(JSON.stringify(domain.platforms));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * toggle the given value in the given filter\r\n     * @param {*} filterName the name of the filter\r\n     * @param {*} value the value to toggle\r\n     */\r\n    toggleInFilter(filterName: string, value: string): void {\r\n        if (!this[filterName].options.includes(value)) { console.log(\"not a valid option to toggle\", value, this[filterName]); return }\r\n        if (this[filterName].selection.includes(value)) {\r\n            let index = this[filterName].selection.indexOf(value)\r\n            this[filterName].selection.splice(index, 1);\r\n        } else {\r\n            this[filterName].selection.push(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * determine if the given value is active in the filter\r\n     * @param {*} filterName the name of the filter\r\n     * @param {*} value the value to determine\r\n     * @returns {boolean} true if value is currently enabled in the filter\r\n     */\r\n    inFilter(filterName, value): boolean {\r\n        return this[filterName].selection.includes(value)\r\n    }\r\n\r\n    /**\r\n     * Return the string representation of this filter\r\n     * @return stringified filter\r\n     */\r\n    serialize(): string {\r\n        return JSON.stringify({\"platforms\": this.platforms.selection})\r\n    }\r\n\r\n    /**\r\n     * Replace the properties of this object with those of the given serialized filter\r\n     * @param rep filter object\r\n     */\r\n    deSerialize(rep: any): void {\r\n        // console.log(rep)\r\n        let isStringArray = function(check): boolean {\r\n            for (let i = 0; i < check.length; i++) {\r\n                if (typeof(check[i]) !== \"string\") {\r\n                    console.error(\"TypeError:\", check[i], \"(\",typeof(check[i]),\")\", \"is not a string\")\r\n                    return false;\r\n                }\r\n\r\n            }\r\n            return true;\r\n        }\r\n        // let obj = JSON.parse(rep);\r\n        if (rep.platforms) {\r\n            if (isStringArray(rep.platforms)) {\r\n                let backwards_compatibility_mappings = { //backwards compatibility with older layers\r\n                    \"android\": \"Android\",\r\n                    \"ios\": \"iOS\",\r\n\r\n                    \"windows\": \"Windows\",\r\n                    \"linux\": \"Linux\",\r\n                    \"mac\": \"macOS\",\r\n\r\n                    \"AWS\": \"IaaS\",\r\n                    \"GCP\": \"IaaS\",\r\n                    \"Azure\": \"IaaS\"\r\n                }\r\n                const selection = new Set<string>();\r\n                rep.platforms.forEach(function (platform) {\r\n                    if (platform in backwards_compatibility_mappings) selection.add(backwards_compatibility_mappings[platform]);\r\n                    else selection.add(platform);\r\n                });\r\n                this.platforms.selection = Array.from(selection);\r\n            } else console.error(\"TypeError: filter platforms field is not a string[]\");\r\n        }\r\n    }\r\n}\r\n\r\n// { name, value } with serialization\r\nexport class Metadata {\r\n    public name: string;\r\n    public value: string;\r\n    public divider: boolean;\r\n\r\n    constructor() { }\r\n\r\n    serialize(): object {\r\n        return this.name && this.value ? {name: this.name, value: this.value} : {divider: this.divider};\r\n    }\r\n\r\n    deSerialize(rep: any): void {\r\n        let obj = (typeof(rep) == \"string\")? JSON.parse(rep) : rep;\r\n        if (\"name\" in obj) { // name & value object\r\n            if (typeof(obj.name) === \"string\") this.name = obj.name;\r\n            else console.error(\"TypeError: Metadata field 'name' is not a string\");\r\n\r\n            if (\"value\" in obj) {\r\n                if (typeof(obj.value) === \"string\") this.value = obj.value;\r\n                else console.error(\"TypeError: Metadata field 'value' is not a string\")\r\n            }\r\n            else console.error(\"Error: Metadata required field 'value' not present\");\r\n        }\r\n        else if (\"divider\" in obj) { // divider object\r\n            if (typeof(obj.divider) === \"boolean\") this.divider = obj.divider;\r\n            else  console.error(\"TypeError: Metadata field 'divider' is not a boolean\");\r\n        }\r\n        else console.error(\"Error: Metadata required field 'name' or 'divider' not present\");\r\n    }\r\n\r\n    valid(): boolean {\r\n        return (this.name && this.name.length > 0 && this.value && this.value.length > 0) || (this.divider !== undefined)\r\n    }\r\n}\r\n\r\n// { label, url } with serialization\r\nexport class Link {\r\n    public label: string;\r\n    public url: string;\r\n    public divider: boolean;\r\n\r\n    constructor() { }\r\n\r\n    serialize(): object { \r\n        return this.label && this.url ? {label: this.label, url: this.url} : {divider: this.divider};\r\n    }\r\n\r\n    deSerialize(rep: any): void {\r\n        let obj = (typeof(rep) == \"string\")? JSON.parse(rep) : rep;\r\n        if (\"url\" in obj) { // label & url object\r\n            if (typeof(obj.url) === \"string\") this.url = obj.url;\r\n            else console.error(\"TypeError: Link field 'url' is not a string\");\r\n\r\n            if (\"label\" in obj) {\r\n                if (typeof(obj.label) === \"string\") this.label = obj.label;\r\n                else console.error(\"TypeError: Link field 'label' is not a string\");\r\n            }\r\n            else console.error(\"Error: Link required field 'label' not present\");\r\n        }\r\n        else if (\"divider\" in obj) { // divider object\r\n            if (typeof(obj.divider) === \"boolean\") this.divider = obj.divider;\r\n            else  console.error(\"TypeError: Link field 'divider' is not a boolean\");\r\n        }\r\n        else console.error(\"Error: Link required field 'url' or 'divider' not present\");\r\n    }\r\n\r\n    valid(): boolean {\r\n        return (this.label && this.label.length > 0 && this.url && this.url.length > 0) || (this.divider !== undefined)\r\n    }\r\n}\r\n\r\nexport class LayoutOptions {\r\n    // current layout selection\r\n    public readonly layoutOptions: string[] = [\"side\", \"flat\", \"mini\"];\r\n    private _layout = this.layoutOptions[0]; //current selection\r\n    public set layout(newLayout) {\r\n        if (!this.layoutOptions.includes(newLayout)) {\r\n            console.warn(\"invalid matrix layout\", newLayout);\r\n            return;\r\n        }\r\n        let oldLayout = this._layout;\r\n        this._layout = newLayout;\r\n        if (this._layout == \"mini\") { //mini-table cannot show ID or name\r\n            this.showID = false;\r\n            this.showName = false;\r\n        }\r\n        if (oldLayout == \"mini\" && newLayout != \"mini\") {\r\n            this.showName = true; //restore default show value for name\r\n        }\r\n    }\r\n    public get layout(): string { return this._layout; }\r\n\r\n    public readonly aggregateFunctionOptions: string[] = [\"average\", \"min\", \"max\", \"sum\"];\r\n    private _aggregateFunction = this.aggregateFunctionOptions[0];\r\n    public set aggregateFunction(newAggregateFunction) {\r\n        if (!this.aggregateFunctionOptions.includes(newAggregateFunction)) {\r\n            console.warn(\"invalid aggregate fx option\", newAggregateFunction);\r\n            return;\r\n        }\r\n        this._aggregateFunction = newAggregateFunction;\r\n    }\r\n\r\n    public get aggregateFunction(): string { return this._aggregateFunction; }\r\n\r\n    //show technique/tactic IDs in the view?\r\n    public _showID: boolean = false;\r\n    public set showID(newval: boolean) {\r\n        this._showID = newval;\r\n        if (newval == true && this._layout == \"mini\") this._layout = \"side\";\r\n    }\r\n    public get showID(): boolean { return this._showID; }\r\n\r\n    //show technique/tactic names in the view?\r\n    public _showName: boolean = true;\r\n    public set showName(newval: boolean) {\r\n        this._showName = newval;\r\n        if (newval == true && this._layout == \"mini\") this._layout = \"side\";\r\n    }\r\n    public get showName(): boolean { return this._showName; }\r\n\r\n    public _showAggregateScores: boolean = false;\r\n    public set showAggregateScores(newval: boolean) { this._showAggregateScores = newval; }\r\n    public get showAggregateScores(): boolean { return this._showAggregateScores; }\r\n\r\n    public _countUnscored: boolean = false;\r\n    public set countUnscored(newval: boolean) { this._countUnscored = newval; }\r\n    public get countUnscored(): boolean { return (this.aggregateFunction === \"average\") ? this._countUnscored : false; }\r\n\r\n    public serialize(): object {\r\n        return {\r\n            \"layout\": this.layout,\r\n            \"aggregateFunction\": this.aggregateFunction,\r\n            \"showID\": this.showID,\r\n            \"showName\": this.showName,\r\n            \"showAggregateScores\": this.showAggregateScores,\r\n            \"countUnscored\": this.countUnscored\r\n        };\r\n    }\r\n\r\n    public deserialize(rep: any) {\r\n        if (\"showID\" in rep) {\r\n            if (typeof (rep.showID) === \"boolean\") this.showID = rep.showID;\r\n            else console.error(\"TypeError: layout field 'showID' is not a boolean:\", rep.showID, \"(\", typeof (rep.showID), \")\");\r\n        }\r\n      if (\"showName\" in rep) {\r\n          if (typeof (rep.showName) === \"boolean\") this.showName = rep.showName;\r\n          else console.error(\"TypeError: layout field 'showName' is not a boolean:\", rep.showName, \"(\", typeof (rep.showName), \")\");\r\n      }\r\n      //make sure this one goes last so that it can override name and ID if layout == 'mini'\r\n      if (\"layout\" in rep) {\r\n          if (typeof (rep.layout) === \"string\") this.layout = rep.layout;\r\n          else console.error(\"TypeError: layout field 'layout' is not a string:\", rep.layout, \"(\", typeof (rep.layout), \")\");\r\n      }\r\n      if (\"aggregateFunction\" in rep) {\r\n          if (typeof (rep.aggregateFunction) === \"string\") this.aggregateFunction = rep.aggregateFunction;\r\n          else console.error(\"TypeError: layout field 'aggregateFunction' is not a boolean:\", rep.aggregateFunction, \"(\", typeof (rep.aggregateFunction), \")\");\r\n      }\r\n      if (\"showAggregateScores\" in rep) {\r\n          if (typeof (rep.showAggregateScores) === \"boolean\") this.showAggregateScores = rep.showAggregateScores;\r\n          else console.error(\"TypeError: layout field 'showAggregateScores' is not a boolean:\", rep.showAggregateScores, \"(\", typeof (rep.showAggregateScores), \")\");\r\n      }\r\n      if (\"countUnscored\" in rep) {\r\n          if (typeof (rep.countUnscored) === \"boolean\") this.countUnscored = rep.countUnscored;\r\n          else console.error(\"TypeError: layout field 'countUnscored' is not a boolean:\", rep.countUnscored, \"(\", typeof (rep.countUnscored), \")\");\r\n      }\r\n  }\r\n}\r\n\r\n\r\n","import { Component, OnInit, Input, EventEmitter, Output, ViewEncapsulation } from '@angular/core';\r\nimport { Technique, Tactic, Matrix, DataService } from '../../data.service';\r\nimport { ConfigService } from '../../config.service';\r\nimport { Cell } from '../cell';\r\nimport { ViewModelsService } from '../../viewmodels.service';\r\n\r\n@Component({\r\n    selector: 'technique-cell',\r\n    templateUrl: './technique-cell.component.html',\r\n    styleUrls: ['./technique-cell.component.scss'],\r\n    encapsulation: ViewEncapsulation.None,\r\n})\r\nexport class TechniqueCellComponent extends Cell implements OnInit {\r\n    @Input() matrix: Matrix;\r\n    @Output() highlight = new EventEmitter<any>(); // emit with the highlighted technique, or null to unhighlight\r\n    @Output() unhighlight = new EventEmitter<any>();\r\n    @Output() leftclick = new EventEmitter<any>(); // emit with the selected technique and the modifier keys\r\n\r\n    public get isCellPinned(): boolean {\r\n        return this.viewModelsService.pinnedCell === this.viewModel.getTechniqueVM(this.technique, this.tactic).technique_tactic_union_id\r\n    }\r\n\r\n    public get showTooltip(): boolean {\r\n        if (this.isCellPinned) return true;\r\n        if (this.showContextmenu) return false;\r\n        if (this.viewModel.highlightedTechniques.size === 0) return false;\r\n\r\n        return (this.viewModel.highlightedTechnique === this.technique && this.viewModel.highlightedTactic && this.viewModel.highlightedTactic.id === this.tactic.id);\r\n    }\r\n\r\n    constructor(public dataService: DataService, public configService: ConfigService, public viewModelsService: ViewModelsService) {\r\n        super(dataService, configService);\r\n    }\r\n\r\n    ngOnInit() {}\r\n\r\n    // count number of annotated sub-techniques on this technique\r\n    public annotatedSubtechniques() {\r\n        let annotatedSubs: Technique[] = []\r\n        for (let s of this.technique.subtechniques) {\r\n            let subVM = this.viewModel.getTechniqueVM(s, this.tactic);\r\n            if (subVM.annotated()) annotatedSubs.push(s);\r\n        }\r\n        return this.applyControls(annotatedSubs, this.tactic).length;\r\n    }\r\n\r\n    // sort and filter techniques\r\n    public applyControls(techniques: Technique[], tactic: Tactic): Technique[] {\r\n        return this.viewModel.applyControls(techniques, tactic, this.matrix)\r\n    }\r\n\r\n    // events to pass to parent component\r\n    public onMouseEnter() {\r\n        this.highlight.emit();\r\n    }\r\n    public onMouseLeave() {\r\n        this.unhighlight.emit();\r\n    }\r\n    public onLeftClick(event) {\r\n        if (!this.isCellPinned) this.viewModelsService.pinnedCell = \"\";\r\n        if (this.configService.getFeature(\"selecting_techniques\")) this.leftclick.emit({\r\n                \"technique\": this.technique,\r\n                // modifier keys\r\n                \"shift\": event.shiftKey,\r\n                \"ctrl\": event.ctrlKey,\r\n                \"meta\": event.metaKey,\r\n                // position of event on page\r\n                \"x\": event.pageX,\r\n                \"y\": event.pageY\r\n            });\r\n        else this.onRightClick(event);\r\n    }\r\n    public onRightClick(event) {\r\n        if (!this.isCellPinned) this.viewModelsService.pinnedCell = \"\";\r\n        this.showContextmenu = true;\r\n    }\r\n\r\n    // return css classes for a technique\r\n    public getClass(): string {\r\n        let theclass = super.getClass();\r\n\r\n        // classes by annotated sub-techniques\r\n        if (!this.annotatedSubtechniques())\r\n            theclass += \" unannotated\"\r\n\r\n        if (this.isCellPinned) theclass += \" editing\";\r\n\r\n        return theclass;\r\n    }\r\n}\r\n\r\nexport class TechniqueEvent {\r\n    public readonly event: Event;\r\n    public readonly technique: Technique;\r\n    constructor(event, technique) {\r\n        this.technique = technique;\r\n        this.event = event;\r\n    }\r\n}\r\n","<div class=\"technique-cell\" \r\n     [ngStyle]=\"getTechniqueBackground()\" \r\n     [ngClass]=\"getClass()\">\r\n    <div (click)=\"onLeftClick($event)\" \r\n         (contextmenu)=\"onRightClick($event)\"\r\n         (mouseenter)=\"onMouseEnter()\"\r\n         (mouseleave)=\"onMouseLeave()\">\r\n        <span [style.border-color]=\"getTechniqueUnderlineColor()\"\r\n              [style.color]=\"getTechniqueTextColor()\">\r\n            <ng-container *ngIf=\"viewModel.layout.showID\">{{technique.attackID}}</ng-container><div class=\"id-name-break\" *ngIf=\"viewModel.layout.showID && viewModel.layout.showName\"></div><ng-container *ngIf=\"viewModel.layout.showName\">{{technique.name}}</ng-container>\r\n        </span>\r\n        <ng-container *ngIf=\"technique.subtechniques.length > 0\">\r\n            <sub *ngIf=\"viewModel.layout.showID || viewModel.layout.showName\" class=\"sub\">&nbsp;({{annotatedSubtechniques()}}/{{applyControls(technique.subtechniques, tactic).length}})</sub></ng-container>\r\n    </div>\r\n    <app-tooltip *ngIf=\"showTooltip\"  [technique]=\"technique\" [tactic]=\"tactic\" [viewModel]=\"viewModel\"></app-tooltip>\r\n    <app-contextmenu *ngIf=\"showContextmenu\" [technique]=\"technique\" [tactic]=\"tactic\" [viewModel]=\"viewModel\" (close)=\"showContextmenu = false; onMouseLeave()\"></app-contextmenu>\r\n</div>\r\n","import { Component, OnInit, Input, ElementRef, ViewEncapsulation } from '@angular/core';\r\nimport { Technique, Tactic, DataService, Note } from '../../../data.service';\r\nimport { ViewModel, TechniqueVM, ViewModelsService } from '../../../viewmodels.service';\r\nimport { CellPopover } from '../cell-popover';\r\n\r\n@Component({\r\n  selector: 'app-tooltip',\r\n  templateUrl: './tooltip.component.html',\r\n  styleUrls: ['./tooltip.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class TooltipComponent extends CellPopover implements OnInit {\r\n    @Input() technique: Technique;\r\n    @Input() tactic: Tactic;\r\n    @Input() viewModel: ViewModel;\r\n    public placement: string;\r\n    public notes: Note[];\r\n\r\n    public get isCellPinned(): boolean {\r\n        return this.viewModelsService.pinnedCell === this.techniqueVM.technique_tactic_union_id\r\n    }\r\n\r\n    public get techniqueVM(): TechniqueVM {\r\n        return this.viewModel.getTechniqueVM(this.technique, this.tactic);\r\n    }\r\n\r\n    constructor(private element: ElementRef, private dataService: DataService, private viewModelsService: ViewModelsService) {\r\n        super(element);\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.placement = this.getPosition();\r\n        let domain = this.dataService.getDomain(this.viewModel.domainVersionID);\r\n        this.notes = domain.notes.filter(note => {\r\n            return note.object_refs.includes(this.technique.id);\r\n        });\r\n    }\r\n}\r\n","<div [ngClass]=\"'tooltip ' + placement\" [style.width]=\"isCellPinned ? '200ch' : ''\">\r\n    <table>\r\n        <tr>\r\n            <td colspan=2 class=\"technique-name\">\r\n                {{technique.name}} ({{technique.attackID}})\r\n            </td>\r\n        </tr>\r\n        <tr *ngIf=\"!techniqueVM.enabled\">\r\n            <td colspan=2>Disabled</td>\r\n        </tr>\r\n        <tr *ngIf=\"techniqueVM.score\">\r\n            <td>Score:</td>\r\n            <td>{{techniqueVM.score}}\r\n            </td>\r\n        </tr>\r\n        <tr *ngIf=\"technique.subtechniques.length > 0 && viewModel.layout.showAggregateScores && techniqueVM.aggregateScore.length > 0\">\r\n            <td>Aggregate Score ({{viewModel.layout.aggregateFunction}}):</td>\r\n            <td>{{techniqueVM.aggregateScore}}</td>\r\n        </tr>\r\n        <tr *ngIf=\"techniqueVM.comment\">\r\n            <td>Comment:</td>\r\n            <td>{{techniqueVM.comment}}</td>\r\n        </tr>\r\n        <tr *ngFor=\"let note of notes\">\r\n            <td *ngIf=\"note.abstract\" class=\"wrap\">{{note.abstract}}:</td>\r\n            <td class=\"wrap\" [attr.colspan]=\"note.abstract ? '1' : '2'\">{{note.content}}</td>\r\n        </tr>\r\n        <tr *ngFor=\"let metadata of techniqueVM.metadata\">\r\n            <td *ngIf=\"metadata.divider\" class=\"divider\" colspan=2><hr></td>\r\n            <td *ngIf=\"!metadata.divider\">{{metadata.name}}:</td>\r\n            <td *ngIf=\"!metadata.divider\">{{metadata.value}}</td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n","import { Injectable } from '@angular/core';\r\nimport { DataService, Technique, Tactic } from './data.service'; //import the DataService component so we can use it\r\n\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class ConfigService {\r\n    public comment_color = \"yellow\";\r\n    public link_color = \"blue\";\r\n    public banner: string;\r\n    private features = new Map<string, boolean>();\r\n    private featureGroups = new Map<string, string[]>();\r\n    private featureStructure: object[];\r\n\r\n    public contextMenuItems: ContextMenuItem[] = [];\r\n    constructor(private dataService: DataService) {\r\n        console.log(\"initializing config service\");\r\n        let self = this;\r\n        let subscription = dataService.getConfig().subscribe({\r\n            next: function(config: any) {\r\n                //parse feature preferences from config json\r\n                config[\"features\"].forEach(function(featureObject: any) {\r\n                    self.setFeature_object(featureObject);\r\n                })\r\n                //override json preferences with preferences from URL fragment\r\n                self.getAllFragments().forEach(function(value: string, key: string) {\r\n                    let valueBool = (value == 'true');\r\n                    if (self.isFeature(key) || self.isFeatureGroup(key)) {\r\n                        self.setFeature(key, valueBool);\r\n                    }\r\n                })\r\n                dataService.subtechniquesEnabled = self.getFeature(\"subtechniques\");\r\n                self.featureStructure = config[\"features\"];\r\n                self.comment_color = config[\"comment_color\"];\r\n                self.link_color = config[\"link_color\"];\r\n                self.banner = config[\"banner\"];\r\n                for (let obj of config[\"custom_context_menu_items\"]) {\r\n                    self.contextMenuItems.push(new ContextMenuItem(obj.label, obj.url, obj.subtechnique_url))\r\n                }\r\n            }, \r\n            complete: () => { if (subscription) subscription.unsubscribe(); } //prevent memory leaks \r\n        });\r\n    }\r\n\r\n    public getFeatureList(): object[] {\r\n        if (!this.featureStructure) return []\r\n        return this.featureStructure;\r\n    }\r\n\r\n    public getFeature(featureName: string): boolean {\r\n        return this.features.get(featureName);\r\n    }\r\n\r\n    /**\r\n     * Return true if any/all features in the group are enabled\r\n     * @param  featureGroup feature group name\r\n     * @param  type         'any' or 'all' for logical or/and\r\n     * @return              true iffany/all are enabled, false otherwise\r\n     */\r\n    public getFeatureGroup(featureGroup: string, type?: string): boolean {\r\n        if (!this.featureGroups.has(featureGroup)) return true;\r\n\r\n        let subFeatures = this.featureGroups.get(featureGroup)\r\n        let count = this.getFeatureGroupCount(featureGroup);\r\n        return type == \"any\" ? count > 0 : count === subFeatures.length;\r\n    }\r\n\r\n    /**\r\n     * Return the number of enabled features in the group\r\n     * @param  featureGroup feature group name\r\n     * @return              the number of enabled features in the group, or -1 if\r\n     *                      the group does not exist\r\n     */\r\n    public getFeatureGroupCount(featureGroup: string): number {\r\n        if (!this.featureGroups.has(featureGroup)) return -1;\r\n        let count = 0\r\n        let subFeatures = this.featureGroups.get(featureGroup)\r\n        for (let i = 0; i < subFeatures.length; i++) {\r\n            if (this.getFeature(subFeatures[i])) count += 1\r\n        }\r\n        return count;\r\n    }\r\n\r\n    /**\r\n     * Recursively search an object for boolean properties, set these as features\r\n     * Take a key:value pair of an object. If the value is a boolean, set the\r\n     * feature[key] to value. Otherwise recursively walk value to find boolean\r\n     * options.\r\n     *\r\n     * Additionally, if the given feature grouping (where value is an obj)\r\n     * has been previously defined, boolean properties assigned to the grouping\r\n     * name will apply to all subfeatures of the grouping.\r\n     *\r\n     * @param  featureName string, the fieldname the value was found in\r\n     * @param  value       boolean:object the value of the field. If a boolean,\r\n     *                     sets feature[featureName] = value, otherwise walks recursively\r\n     */\r\n    public setFeature(featureName: string, value: any): string[] {\r\n        let self = this\r\n\r\n        if (typeof(value) == \"boolean\") { //base case\r\n            if (this.featureGroups.has(featureName)) { //feature group, assign to all subfeatures\r\n                this.featureGroups.get(featureName).forEach(function(subFeatureName: string) {\r\n                    self.setFeature(subFeatureName, value);\r\n                })\r\n            } else { //single feature\r\n                this.features.set(featureName, value);\r\n            }\r\n            return [featureName];\r\n        }\r\n\r\n        if (typeof(value) == \"object\") { //keep walking\r\n            let subfeatures = [];\r\n            Object.keys(value).forEach(function(fieldname: string) {\r\n                subfeatures = Array.prototype.concat(subfeatures, self.setFeature(fieldname, value[fieldname]));\r\n            })\r\n            this.featureGroups.set(featureName, subfeatures);\r\n            return subfeatures;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * given a set of feature objects, set the enabledness of that object and all subobjects\r\n     *\r\n     * @param  featureObject {name: string, enabled: boolean, subfeatures?: featureObject[] }\r\n     *                       Of enabled is false and it has subfeatures, they will all be forced to be false too\r\n     * @param  override      Set all subfeatures, and their subfeatures, values to\r\n     *                       this value\r\n     */\r\n    public setFeature_object(featureObject: any, override=null):string[] {\r\n        let self = this\r\n\r\n        // base case\r\n        if (!featureObject.hasOwnProperty(\"subfeatures\")) {\r\n\r\n            let enabled = override !== null? override : featureObject.enabled\r\n            this.features.set(featureObject.name, enabled)\r\n            return [featureObject.name]\r\n        } else { //has subfeatures\r\n            override = override ? override : !featureObject.enabled ? false : null;\r\n            let subfeatures = [];\r\n            featureObject.subfeatures.forEach(function(subfeature) {\r\n                subfeatures = Array.prototype.concat(subfeatures, self.setFeature_object(subfeature, override))\r\n            })\r\n            this.featureGroups.set(featureObject.name, subfeatures)\r\n            return subfeatures;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    /**\r\n     * Return if the given string corresponds to a defined feature\r\n     * @param  featureName the name of the feature\r\n     * @return             true if the feature exists, false otherwise\r\n     */\r\n    public isFeature(featureName: string): boolean {\r\n        return this.features.has(featureName)\r\n    }\r\n    /**\r\n     * return if the given string corresponds to a defined feature group\r\n     * @param  featureGroupName the name of the feature group\r\n     * @return                  true if it is a feature group, false otherwise\r\n     */\r\n    public isFeatureGroup(featureGroupName: string): boolean {\r\n        return this.featureGroups.has(featureGroupName);\r\n    }\r\n\r\n    public getFeatureGroups(): string[] {\r\n        let keys = [];\r\n        this.featureGroups.forEach(function(value, key) { keys.push(key) })\r\n        return keys;\r\n    }\r\n\r\n    public getFeatures(): string[] {\r\n        let keys = [];\r\n        this.features.forEach(function(value, key) { keys.push(key) })\r\n        return keys;\r\n    }\r\n\r\n    /**\r\n     * Get all url fragments\r\n     * @param  url optional, url to parse instead of window location href\r\n     * @return     all fragments as key-value pairs\r\n     */\r\n    getAllFragments(url?: string): Map<string, string> {\r\n        if (!url) url = window.location.href;\r\n        let fragments = new Map<string, string>();\r\n        let regex = /[#&](\\w+)=(\\w+)/g\r\n\r\n        // let results = url.match(regex)\r\n        var match;\r\n        while (match = regex.exec(url)) {\r\n            fragments.set(match[1], match[2])\r\n        }\r\n\r\n        return fragments;\r\n    }\r\n}\r\n\r\nexport class ContextMenuItem {\r\n    public readonly label: string;\r\n    private readonly url: string;\r\n    private readonly subtechnique_url: string;\r\n\r\n    constructor(label, url, subtechnique_url=null) {\r\n        this.label = label;\r\n        this.url = url;\r\n        this.subtechnique_url = subtechnique_url;\r\n    }\r\n\r\n    public getReplacedURL(technique: Technique, tactic: Tactic): string {\r\n        if (this.subtechnique_url && technique.isSubtechnique) {\r\n            return this.subtechnique_url.replace(/{{parent_technique_attackID}}/g, technique.parent.attackID)\r\n                                        .replace(/{{parent_technique_stixID}}/g, technique.parent.id)\r\n                                        .replace(/{{parent_technique_name}}/g, technique.parent.name.replace(/ /g, \"-\").toLowerCase())\r\n\r\n                                        .replace(/{{subtechnique_attackID}}/g, technique.attackID)\r\n                                        .replace(/{{subtechnique_attackID_suffix}}/g, technique.attackID.split(\".\")[1])\r\n                                        .replace(/{{subtechnique_stixID}}/g, technique.id)\r\n                                        .replace(/{{subtechnique_name}}/g, technique.name.replace(/ /g, \"-\").toLowerCase())\r\n\r\n                                        .replace(/{{tactic_attackID}}/g, tactic.attackID)\r\n                                        .replace(/{{tactic_stixID}}/g, tactic.id)\r\n                                        .replace(/{{tactic_name}}/g, tactic.shortname);\r\n        } else {\r\n            return this.url.replace(/{{technique_attackID}}/g, technique.attackID)\r\n                           .replace(/{{technique_stixID}}/g, technique.id)\r\n                           .replace(/{{technique_name}}/g, technique.name.replace(/ /g, \"-\").toLowerCase())\r\n\r\n                           .replace(/{{tactic_attackID}}/g, tactic.attackID)\r\n                           .replace(/{{tactic_stixID}}/g, tactic.id)\r\n                           .replace(/{{tactic_name}}/g, tactic.shortname);\r\n        }\r\n    }\r\n}\r\n","'use strict';\r\nimport * as app_package from \"../../package.json\";\r\n\r\n //   ___ _    ___  ___   _   _     __   ___   ___ ___   _   ___ _    ___ ___\r\n //  / __| |  / _ \\| _ ) /_\\ | |    \\ \\ / /_\\ | _ \\_ _| /_\\ | _ ) |  | __/ __|\r\n // | (_ | |_| (_) | _ \\/ _ \\| |__   \\ V / _ \\|   /| | / _ \\| _ \\ |__| _|\\__ \\\r\n //  \\___|____\\___/|___/_/ \\_\\____|   \\_/_/ \\_\\_|_\\___/_/ \\_\\___/____|___|___/\r\n //\r\n\r\nexport const nav_version: string = app_package[\"version\"];\r\nexport const layer_version: string = \"4.4\";\r\n","import { Component, Input, OnInit, ViewEncapsulation } from '@angular/core';\r\nimport { ViewModelsService } from '../../viewmodels.service';\r\nimport { ConfigService } from '../../config.service';\r\nimport { DataService } from '../../data.service';\r\nimport { Cell } from '../../matrix/cell';\r\n\r\n@Component({\r\n    selector: 'changelog-cell',\r\n    templateUrl: './changelog-cell.component.html',\r\n    styleUrls: ['./changelog-cell.component.scss'],\r\n    encapsulation: ViewEncapsulation.None\r\n})\r\nexport class ChangelogCellComponent extends Cell implements OnInit {\r\n    @Input() isCurrentVersion?: boolean = true;\r\n    @Input() isDraggable?: boolean = false;\r\n    @Input() section: string;\r\n\r\n    constructor(public configService: ConfigService, public dataService: DataService, public viewModelsService: ViewModelsService) {\r\n        super(dataService, configService);\r\n    }\r\n\r\n    ngOnInit(): void { }\r\n\r\n    /**\r\n     * Highlight the moused over technique\r\n     */\r\n    public highlight(): void {\r\n        if (this.isCurrentVersion) {\r\n            this.viewModel.highlightTechnique(this.technique, this.tactic)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear the technique highlight\r\n     */\r\n    public unhighlight(): void {\r\n        if (this.isCurrentVersion) this.viewModel.clearHighlight();\r\n    }\r\n\r\n    /**\r\n     * Select or unselect this technique\r\n     */\r\n    public onClick(): void {\r\n        if (this.isCurrentVersion) {\r\n            // unselect technique\r\n            if (this.viewModel.isTechniqueSelected(this.technique, this.tactic)) {\r\n                this.viewModel.unselectTechnique(this.technique, this.tactic);\r\n            }\r\n            // select technique\r\n            else {\r\n                this.viewModel.clearSelectedTechniques();\r\n                this.viewModel.selectTechnique(this.technique, this.tactic);\r\n            }\r\n            this.viewModelsService.selectionChanged(); // emit selection change\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Retrieve css classes for this technique\r\n     */\r\n    public getClass(): string {\r\n        let theclass = super.getClass();\r\n        if (!this.isCurrentVersion && !this.isDraggable) {\r\n            theclass += \" nopointer\";\r\n        }\r\n        if (this.section == 'additions' || this.section == 'deprecations') {\r\n            theclass += \" setwidth\";\r\n        }\r\n        return theclass;\r\n    }\r\n}\r\n","<div class=\"technique-cell\" [ngStyle]=\"getTechniqueBackground()\" [ngClass]=\"getClass()\">\r\n    <div (click)=\"onClick()\" (mouseenter)=\"highlight()\" (mouseleave)=\"unhighlight()\">\r\n        <div class=\"section\">\r\n            <span [style.border-color]=\"configService.comment_color\" [style.color]=\"getTechniqueTextColor()\">\r\n                <b>{{tactic.name}}</b>\r\n            </span>\r\n        </div>\r\n        <div class=\"section\">\r\n            <span [style.border-color]=\"configService.comment_color\" [style.color]=\"getTechniqueTextColor()\">{{technique.attackID}}</span>\r\n        </div>\r\n        <div class=\"section\">\r\n            <span [style.border-color]=\"configService.comment_color\" [style.color]=\"getTechniqueTextColor()\">{{technique.name}}</span>\r\n        </div>\r\n    </div>\r\n</div>","/**\r\n * @file\r\n * A TAXII 2.0 Javascript client library. Converted to Typescript by Isabel Tuson 24 May 2018\r\n *\r\n * @see https://oasis-open.github.io/cti-documentation/\r\n *\r\n * @author R. Wathelet, September 2017, modified by I Tuson 24 May 2018\r\n * @version 0.2\r\n */\r\n\r\n/**\r\n * Provide asynchronous network communications to a TAXII 2.0 server.\r\n *\r\n */\r\nexport class TaxiiConnect {\r\n    baseURL: string;\r\n    user: string;\r\n    password: string;\r\n    hash: string;\r\n    timeout: number;\r\n    version: string;\r\n    getConfig: any;\r\n    postConfig: any;\r\n    getStixConfig: any;\r\n\r\n    /**\r\n     * provide network communication to a Taxii 2.0 server.\r\n     * @param {String} url - the base url of the Taxii2 server, for example https://example.com/\r\n     * @param {String} user - the user name required for authentication.\r\n     * @param {String} password - the user password required for authentication.\r\n     * @param {Integer} timeout - the connection timeout in millisec\r\n     */\r\n    constructor(url, user, password, timeout) {\r\n        this.baseURL = TaxiiConnect.withoutLastSlash(url);\r\n        this.user = user;\r\n        this.password = password;\r\n        this.hash = btoa(this.user + \":\" + this.password);\r\n        this.timeout = timeout ? timeout : 10000; // default timeout\r\n\r\n        this.version = '2.0';\r\n\r\n        // default headers configurations\r\n        this.getConfig = {\r\n            'method': 'get',\r\n            'headers': new Headers({\r\n                'Accept': 'application/vnd.oasis.taxii+json',\r\n                'version': this.version,\r\n                'Authorization': 'Basic ' + this.hash\r\n            })\r\n        };\r\n\r\n        this.postConfig = {\r\n            'method': 'post',\r\n            'headers': new Headers({\r\n                'Accept': 'application/vnd.oasis.taxii+json',\r\n                'Content-Type': 'application/vnd.oasis.stix+json',\r\n                'version': this.version,\r\n                'Authorization': 'Basic ' + this.hash\r\n            })\r\n        };\r\n\r\n        this.getStixConfig = {\r\n            'method': 'get',\r\n            'headers': new Headers({\r\n                'Accept': 'application/vnd.oasis.stix+json',\r\n                'version': this.version,\r\n                'Authorization': 'Basic ' + this.hash\r\n            })\r\n        };\r\n\r\n    }\r\n\r\n    // original code from: https://github.com/jkomyno/fetch-timeout\r\n    timeoutPromise(promise, timeout, error) {\r\n        return new Promise((resolve, reject) => {\r\n            setTimeout(() => reject(error), timeout);\r\n            promise.then(resolve, reject);\r\n        });\r\n    }\r\n    // original code from: https://github.com/jkomyno/fetch-timeout\r\n    fetchTimeout(url, options, timeout, error) {\r\n        error = error || 'Timeout error';\r\n        options = options || {};\r\n        timeout = timeout || 10000;\r\n        return this.timeoutPromise(fetch(url, options), timeout, error);\r\n    }\r\n\r\n    /**\r\n     * send an async request (GET or POST) to the taxii2 server.\r\n     *\r\n     * @param {String} path - the full path to connect to.\r\n     * @param {Object} config - the request configuration, see getConfig and postConfig for examples\r\n     * @param {Object} filter - the filter object describing the filtering requested, this is added to the path as a query string\r\n     * @returns {Promise} the server response in json.\r\n     */\r\n    async asyncFetch(path, config, filter?) { //CHANGED\r\n        let fullPath = (filter === undefined) ? path : path + \"?\" + TaxiiConnect.asQueryString(filter);\r\n        return await (await (\r\n            this.fetchTimeout(fullPath, config, this.timeout, 'connection timeout')\r\n                .then((res: Response) => res.json())\r\n                .catch(err => { throw new Error(\"fetch error: \" + err); } ) ));\r\n    }\r\n\r\n    /**\r\n     * send a GET async request to the taxii2 server.\r\n     *\r\n     * The server response is assigned to the cache attribute of the options object, and\r\n     * the options flag attribute is set to true if a server request was performed.\r\n     * Otherwise if the options.flag is initially true, the cached response (options.cache) is returned and\r\n     * no server request is performed.\r\n     * To force a server request used invalidate(), for example: server.invalidate()\r\n     *\r\n     * @param {String} path - the path to connect to.\r\n     * @param {Object} options - an option object of the form: { \"cache\": {}, \"flag\": false }\r\n     * @param {Object} filter - the filter object describing the filtering requested, this is added to the path as a query string\r\n     * @param {Object} config - the request configuration\r\n     * @returns {Promise} the server response object\r\n     */\r\n    async fetchThis(path, options, filter?, config?) { //CHANGED\r\n        let conf = config === undefined ? this.getConfig : config;\r\n        if (!options.flag) {\r\n            options.cache = await (this.asyncFetch(path, conf, filter));\r\n            options.flag = true;\r\n        }\r\n        return options.cache;\r\n    }\r\n\r\n    /**\r\n     * return the url without the last slash.\r\n     * @param {String} url - the URL string to process.\r\n     * @returns {String} the url without the last slash.\r\n     */\r\n    static withoutLastSlash(url) {\r\n        return (url.substr(-1) === '/') ? url.substr(0, url.length - 1) : url;\r\n    }\r\n\r\n    /**\r\n     * return the url with a terminating slash.\r\n     * @param {String} url - the URL string to process.\r\n     * @returns {String} the url with a terminating slash.\r\n     */\r\n    static withLastSlash(url) {\r\n        return (url.substr(-1) === '/') ? url : url + \"/\";\r\n    }\r\n\r\n    /**\r\n     * convert a filter object into a query string.\r\n     * @param {Object} filter - the filter object to process.\r\n     * @returns {String} the query string corresponding to the filter object.\r\n     */\r\n    static asQueryString(filter) {\r\n        return Object.keys(filter).map(k => {\r\n            let value = (k === \"added_after\") ? k : \"match[\" + k + \"]\";\r\n            return encodeURIComponent(value) + '=' + encodeURIComponent(filter[k]);\r\n        }).join('&');\r\n    }\r\n}\r\n\r\n/**\r\n * Server encapsulates a discovery and api roots endpoints.\r\n */\r\nexport class Server {\r\n    path: string;\r\n    conn: TaxiiConnect;\r\n    disOptions: any;\r\n    apiOptions: any;\r\n\r\n    /**\r\n     * A TAXII Server endpoint representation.\r\n     * @param {String} path - the path to the server discovery endpoint, for example \"/taxii/\"\r\n     * @param {TaxiiConnect} conn - a TaxiiConnection instance providing network communications.\r\n     */\r\n    constructor(path, conn) {\r\n        this.path = TaxiiConnect.withLastSlash(path);\r\n        this.conn = conn;\r\n        // cache represents the cached results and flag determines if it needs a re-fetch\r\n        this.disOptions = {\"cache\": {}, \"flag\": false};\r\n        this.apiOptions = {\"cache\": [], \"flag\": false};\r\n    }\r\n\r\n    /**\r\n     * determine if the obj is empty, {}\r\n     * @param {Object} obj - the object to test\r\n     * @returns {Boolean} - true if empty else false\r\n     */\r\n    static isEmpty(obj) {\r\n        return Object.keys(obj).length === 0 && obj.constructor === Object;\r\n    }\r\n\r\n    /**\r\n     * reset the internal options flags so that the next method call of this class will\r\n     * send a request to the server rather than retreive the results from cache.\r\n     */\r\n    invalidate() {\r\n        this.disOptions.flag = false;\r\n        this.apiOptions.flag = false;\r\n    }\r\n\r\n    /**\r\n     * retrieve the information about a TAXII Server and the list of API Roots.\r\n     * @returns {Promise} the server discovery information object.\r\n     */\r\n    async discovery() {\r\n        return this.conn.fetchThis(this.conn.baseURL + this.path, this.disOptions);\r\n    }\r\n\r\n    /**\r\n     * retrieve the api roots information objects.\r\n     * Note: unreachable roots are not part of the results.\r\n     *\r\n     * API Roots are logical groupings of TAXII Channels, Collections, and related functionality.\r\n     * Each API Root contains a set of Endpoints that a TAXII Client contacts in order to interact with the TAXII Server.\r\n     * This returns the api roots information objects from the string urls.\r\n     * @returns {Promise} the Array of api roots information objects\r\n     */\r\n    async api_roots() {\r\n        return this.discovery().then(discovery => this._getApiRoots(discovery));\r\n    }\r\n\r\n    /**\r\n     * retrieve a map of key=the api root url and value=the api root object.\r\n     *\r\n     * API Roots are logical groupings of TAXII Channels, Collections, and related functionality.\r\n     * Each API Root contains a set of Endpoints that a TAXII Client contacts in order to interact with the TAXII Server.\r\n     * @returns {Promise} a Map of key=the url and value=the api root object.\r\n     */\r\n    async api_rootsMap() {\r\n        var apiRootMap = new Map();\r\n        await this.discovery().then(discovery => this._getApiRoots(discovery, apiRootMap));\r\n        return apiRootMap;\r\n    }\r\n\r\n    /**\r\n     * private function to retrieve the api roots\r\n     * @param {discovery} discovery - a discovery object\r\n     * @param {Map} apiRootMap - a map of key=url, value=api root object\r\n     * @returns {Promise} the Array of api roots information objects\r\n     */\r\n    async _getApiRoots(discovery, apiRootMap?) { //CHANGED\r\n        if (!this.apiOptions.flag) {\r\n            // clear the cache\r\n            this.apiOptions.cache = [];\r\n            // fetch all the api_roots in parallel\r\n            await Promise.all(discovery.api_roots.map(async url => {\r\n                let apiroot = await this.conn.asyncFetch(url, this.conn.getConfig);\r\n                // add to the map\r\n                if (apiRootMap !== undefined) {\r\n                    apiRootMap.set(url, apiroot);\r\n                }\r\n                // add to the array of results\r\n                this.apiOptions.cache.push(apiroot);\r\n            }));\r\n            // remove the undefined and empty elements, that is those we could not connect to.\r\n            this.apiOptions.cache = this.apiOptions.cache.filter(element => (element !== undefined && !Server.isEmpty(element)));\r\n            this.apiOptions.flag = true;\r\n        }\r\n        return this.apiOptions.cache;\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Collections resource endpoint.\r\n * A TAXII Collections is an interface to a logical repository of CTI objects\r\n * provided by a TAXII Server and is used by TAXII Clients to send information\r\n * to the TAXII Server or request information from the TAXII Server.\r\n * A TAXII Server can host multiple Collections per API Root, and Collections\r\n * are used to exchange information in a requestresponse manner.\r\n */\r\nexport class Collections {\r\n    api_root_path: string;\r\n    conn: TaxiiConnect;\r\n    options: any;\r\n    collectionsFlag: boolean;\r\n    // hash: string;\r\n\r\n    /**\r\n     * A TAXII Collections for a specific api root path.\r\n     * The collections resource is a simple wrapper around a list of collection resources.\r\n     * @param {String} api_root_path - the full path to the desired api root endpoint\r\n     * @param {TaxiiConnection} conn a TaxiiConnection class instance.\r\n     */\r\n    constructor(api_root_path, conn) {\r\n        this.api_root_path = TaxiiConnect.withLastSlash(api_root_path);\r\n        this.conn = conn;\r\n        // cache represents the cached results and flag determines if it needs a re-fetch\r\n        this.options = {\"cache\": {}, \"flag\": false};\r\n    }\r\n\r\n    /**\r\n     * reset the internal options flags so that the next method call of this class will\r\n     * send a request to the server rather than retreive the results from cache.\r\n     */\r\n    invalidate() {\r\n        this.options.flag = false;\r\n    }\r\n\r\n    /**\r\n     * provide information about a specific Collection hosted under this API Root.\r\n     *\r\n     * @param {Integer} index - the index of the desired collection object.\r\n     * @returns {Object} a specific collection object.\r\n     */\r\n    async get(index) {\r\n        if (Number.isInteger(index) && index >= 0) {\r\n            // return a specific collection info\r\n            if (!this.collectionsFlag) {\r\n                return this.collections().then(cols => {\r\n                    if (index < this.options.cache.collections.length) {\r\n                        return this.options.cache.collections[index];\r\n                    } else {\r\n                        console.log(\"----> in Collections get(index) invalid index value: \" + index);\r\n                    }\r\n                });\r\n            } else {\r\n                if (index < this.options.cache.collections.length) {\r\n                    return this.options.cache.collections[index];\r\n                } else {\r\n                    console.log(\"----> in Collections get(index) invalid index value: \" + index);\r\n                }\r\n            }\r\n        } else {\r\n            console.log(\"----> in Collections get(index) invalid index value: \" + index);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * provide information about the Collections hosted under this API Root.\r\n     *\r\n     * @param {String} range - a pagination range string, for example \"0-10\"\r\n     * @returns {Array} an array of collection objects\r\n     */\r\n    async collections(range?) { //CHANGED\r\n        var theConfig = this.conn.getConfig;\r\n        if (range !== undefined) {\r\n            theConfig = {\r\n                'method': 'get',\r\n                'headers': new Headers({\r\n                    'Accept': 'application/vnd.oasis.taxii+json',\r\n                    'version': this.conn.version,\r\n                    'Authorization': 'Basic ' + this.conn.hash, //CHANGED\r\n                    'Range': 'items=' + range\r\n                })\r\n            };\r\n        }\r\n        // return a list of collection info\r\n        await this.conn.fetchThis(this.api_root_path + \"collections/\", this.options, \"\", theConfig);\r\n        return this.options.cache.collections;\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * A Collection resource endpoint.\r\n */\r\nexport class Collection {\r\n    collectionInfo: any;\r\n    api_root_path: string;\r\n    conn: TaxiiConnect;\r\n    path: string;\r\n    colOptions: any;\r\n    objsOptions: any;\r\n    objOptions: any;\r\n    manOptions: any;\r\n\r\n    /**\r\n     * Collection resource endpoint.\r\n     * @param {CollectionInfoObject} collectionInfo - the collection object of this endpoint.\r\n     * @param {String} api_root_path - the full path to the desired api root endpoint.\r\n     * @param {TaxiiConnection} conn - a TaxiiConnection class instance.\r\n     */\r\n    constructor(collectionInfo, api_root_path, conn) {\r\n        this.collectionInfo = collectionInfo;\r\n        this.api_root_path = TaxiiConnect.withLastSlash(api_root_path);\r\n        this.conn = conn;\r\n        // construct the path\r\n        this.path = this.api_root_path + \"collections/\" + collectionInfo.id + \"/\";\r\n        // cache represents the cached results and flag determines if it needs a re-fetch\r\n        this.colOptions = {\"cache\": {}, \"flag\": false};\r\n        this.objsOptions = {\"cache\": {}, \"flag\": false};\r\n        this.objOptions = {\"cache\": {}, \"flag\": false};\r\n        this.manOptions = {\"cache\": {}, \"flag\": false};\r\n    }\r\n\r\n    /**\r\n     * reset the internal options flags so that the next method call of this class will\r\n     * send a request to the server rather than retreive the results from cache.\r\n     */\r\n    invalidate() {\r\n        this.colOptions.flag = false;\r\n        this.objsOptions.flag = false;\r\n        this.objOptions.flag = false;\r\n        this.manOptions.flag = false;\r\n    }\r\n\r\n    /**\r\n     * check that the collection allows reading, if true then return the function passed in\r\n     * else log an error\r\n     * @param {Function} func - the function to return if the collection allows reading it\r\n     * @returns {Function} the function if this collection allow reading else undefined\r\n     */\r\n    ifCanRead(func) {\r\n        if (this.collectionInfo.can_read) {\r\n            return func;\r\n        } else {\r\n            console.log(\"this collection does not allow reading: \\n\" + JSON.stringify(this.collectionInfo));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * check that the collection allows writing, if true then return the function passed in else log an error\r\n     * @param {Function} func - the function to return if the collection allows writing it\r\n     * @returns {Function} the function if this collection allow writing else undefined\r\n     */\r\n    ifCanWrite(func) {\r\n        if (this.collectionInfo.can_write) {\r\n            return func;\r\n        } else {\r\n            console.log(\"this collection does not allow writing: \\n\" + JSON.stringify(this.collectionInfo));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * retrieve this Collection object.\r\n     * @returns {Promise} the Collection object\r\n     */\r\n    async get() {\r\n        return this.ifCanRead(this.conn.fetchThis(this.path, this.colOptions));\r\n    }\r\n\r\n    /**\r\n     * retrieve a STIX-2 bundle from this Collection.\r\n     *\r\n     * @param {Object} filter - the filter object describing the filtering requested, this is added to the path as a query string.\r\n     * For example: {\"added_after\": \"2016-02-01T00:00:01.000Z\"}\r\n     *              {\"type\": [\"incident\",\"ttp\",\"actor\"]}\r\n     * @param {String} range - a pagination range string, for example \"0-10\"\r\n     * @returns {Promise} the Bundle with the STIX-2 objects of this collection\r\n     */\r\n    async getObjects(filter, range) {\r\n        var theConfig = this.conn.getStixConfig;\r\n        if (range !== undefined) {\r\n            theConfig = {\r\n                'method': 'get',\r\n                'headers': new Headers({\r\n                    'Accept': 'application/vnd.oasis.stix+json',\r\n                    'version': this.conn.version,\r\n                    'Authorization': 'Basic ' + this.conn.hash, //CHANGED\r\n                    'Range': 'items=' + range\r\n                })\r\n            };\r\n        }\r\n        return this.ifCanRead(this.conn.fetchThis(this.path + \"objects/\", this.objsOptions, filter, theConfig));\r\n    }\r\n\r\n    /**\r\n     * retrieve a specific STIX-2 object from this collection objects bundle.\r\n     *\r\n     * @param {String} obj_id - the STIX-2 object id to retrieve\r\n     * @param {Object} filter - the filter object describing the filtering requested, this is added to the path as a query string.\r\n     * For example: {\"version\": \"2016-01-01T01:01:01.000Z\"}\r\n     */\r\n    async getObject(obj_id, filter) {\r\n        return await (await (this.ifCanRead(this.conn.fetchThis(this.path + \"objects/\" + obj_id + \"/\", this.objOptions, filter, this.conn.getStixConfig)\r\n        .then(bundle => bundle.objects.find(obj => obj.id === obj_id) ))));\r\n    }\r\n\r\n    /**\r\n     * add a STIX-2 bundle object to this Collection objects.\r\n     * @param {Bundle} bundle - the STIX-2 bundle object to add\r\n     * @return {Status} a status object\r\n     */\r\n    async addObject(bundle) {\r\n        return this.ifCanWrite(this.conn.asyncFetch(this.path + \"objects/\", this.conn.postConfig));\r\n    }\r\n\r\n    /**\r\n     * retrieve all manifests about objects from this Collection.\r\n     * Manifests are metadata about the objects.\r\n     *\r\n     * @param {Object} filter - the filter object describing the filtering requested, this is added to the path as a query string.\r\n     * @param {String} range - a pagination range string, for example \"0-10\"\r\n     * @return {Array} an array of manifest entries object\r\n     */\r\n    async getManifests(filter, range?) {\r\n        var theConfig = this.conn.getConfig;\r\n        if (range !== undefined) {\r\n            theConfig = {\r\n                'method': 'get',\r\n                'headers': new Headers({\r\n                    'Accept': 'application/vnd.oasis.taxii+json',\r\n                    'version': this.conn.version,\r\n                    'Authorization': 'Basic ' + this.conn.hash, //CHANGED\r\n                    'Range': 'items=' + range\r\n                })\r\n            };\r\n        }\r\n        this.ifCanRead(await this.conn.fetchThis(this.path + \"manifest/\", this.manOptions, filter, theConfig));\r\n        return this.manOptions.cache.objects;\r\n    }\r\n\r\n    /**\r\n     * retrieve the manifest about a specific object (obj_id) from this Collection.\r\n     * Manifests are metadata about the objects.\r\n     *\r\n     * @param {String} obj_id - the STIX-2 object id of the manifest to retrieve.\r\n     * @param {Object} filter - the filter object describing the filtering requested, this is added to the path as a query string.\r\n     * @return {Object} a manifest entry of the desired STIX-2 object.\r\n     */\r\n    async getManifest(obj_id, filter) {\r\n        return await (this.getManifests(filter).then(objects => objects.find(obj => obj.id === obj_id)));\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * This Endpoint provides information about the status of a previous request.\r\n * In TAXII 2.0, the only request that can be monitored is one to add objects to a Collection.\r\n */\r\nexport class Status {\r\n    api_root_path: string;\r\n    status_id: string;\r\n    conn: TaxiiConnect;\r\n    path: string;\r\n\r\n    /**\r\n     * provide information about the status of a previous request.\r\n     * @param {String} api_root_path - the full path to the desired api root\r\n     * @param {String} status_id - the identifier of the status message being requested, for STIX objects, their id.\r\n     * @param {TaxiiConnection} conn - a TaxiiConnection class instance.\r\n     */\r\n    constructor(api_root_path, status_id, conn) {\r\n        this.api_root_path = TaxiiConnect.withLastSlash(api_root_path);\r\n        this.status_id = status_id;\r\n        this.conn = conn;\r\n        this.path = this.api_root_path + \"status/\" + status_id + \"/\";\r\n    }\r\n\r\n    /**\r\n     * retrieve the Status information about a request to add objects to a Collection.\r\n     * @return {Promise} the status object\r\n     */\r\n    async get() {\r\n        return this.conn.asyncFetch(this.path, this.conn.getConfig);\r\n    }\r\n\r\n}\r\n","import { enableProdMode } from '@angular/core';\r\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport { AppModule } from './app/app.module';\r\nimport { environment } from './environments/environment';\r\n\r\nif (environment.production) {\r\n  enableProdMode();\r\n}\r\n\r\nplatformBrowserDynamic().bootstrapModule(AppModule)\r\n  .catch(err => console.log(err));\r\n"]}